!function(e){window.popReplicate={replicateTopLevel:function(a){var t=this,n=a.pageSection;a.targets.each(function(){var a=e(this),i=a.data("replicate-type");i==M.REPLICATETYPES.MULTIPLE?t.replicateMultipleTopLevel(n,a):i==M.REPLICATETYPES.SINGLE&&t.replicateSingleTopLevel(n,a)})},replicatePageSection:function(a){var t=this,n=a.pageSection;a.targets.each(function(){var a=e(this),i=a.data("replicate-type");i==M.REPLICATETYPES.MULTIPLE?t.replicateMultiplePageSection(n,a):i==M.REPLICATETYPES.SINGLE&&t.replicateSinglePageSection(n,a)})},replicateMultipleTopLevel:function(a,t){var n=this;t.click(function(t){t.preventDefault();var i=e(this),r=i.data("unique-url")||!1;n.execReplicateTopLevel(a,i,!0,r)})},replicateSingleTopLevel:function(a,t){var n=this;t.one("click",function(t){t.preventDefault();var i=e(this);n.execReplicateTopLevel(a,i,!1,!1)})},execReplicateTopLevel:function(a,t,n,i){var r=t.data("original-url"),p=getDomain(r),c=(popManager.getMemory(p),t.data("intercept-url")),o=popManager.getFrameTarget(a),l=popManager.getReplicableMemory(c,o),g=popManager.getTopLevelFeedback(p);e.each(l.feedback.toplevel,function(a,t){"array"==e.type(t)&&0==t.length||("object"==e.type(t)?(g[a]||(g[a]={}),e.extend(g[a],t)):g[a]=t)}),n&&(i&&r.indexOf("#")>-1?g[M.UNIQUEID]=r.substr(r.indexOf("#")+1):(popManager.generateUniqueId(p),i&&(r=popManager.addUniqueId(r))));var u=t.data("title");g[M.URLPARAM_TITLE]=u,g[M.URLPARAM_PARENTPAGEID]=null,g[M.URLPARAM_URL]=r,popManager.maybeUpdateDocument(p,a)},replicateMultiplePageSection:function(a,t){var n=this;t.click(function(t){t.preventDefault();var i=e(this);n.execReplicatePageSection(a,i)})},replicateSinglePageSection:function(a,t){var n=this;t.one("click",function(t){t.preventDefault();var i=e(this);n.execReplicatePageSection(a,i)})},execReplicatePageSection:function(a,t){t.data("block-settingsid"),popManager.getSettingsId(a);var n=t.data("templateid"),i=t.data("intercept-url"),r=getDomain(i),p=popManager.getMemory(r),c=popManager.getFrameTarget(a),o=popManager.getReplicableMemory(i,c);e.extend(p.feedback.pagesection,o.feedback.pagesection),e.each(o.feedback.block,function(a,t){e.extend(p.feedback.block[a],t),e.extend(p.dataset[a],o.dataset[a]),e.extend(p["query-state"].general[a],o["query-state"].general[a]),e.extend(p["query-state"].domain[a],o["query-state"].domain[a])});var l=popManager.getTopLevelFeedback(r),g=popManager.getPageSectionFeedback(r,a),u=popManager.getPageSectionConfiguration(r,a);g["intercept-urls"][n]||(g["intercept-urls"][n]={}),g["intercept-urls"][n][n]=l[M.URLPARAM_URL],u[M.JS_TEMPLATE]=n;var d={};t.next(".pop-interceptor-blocksettingsids").children().each(function(){var a=e(this),t=a.data("value");t=a.data("value")?[a.data("value")]:[],d[a.data("key")]=t}),u[M.JS_BLOCKSETTINGSIDS]=d,popManager.initPageSectionSettings(r,a,u);var s={"js-args":{relatedTarget:t},url:l[M.URLPARAM_URL]};popManager.renderPageSection(r,a,s)}}}(jQuery),popJSLibraryManager.register(popReplicate,["replicateTopLevel","replicatePageSection"]);