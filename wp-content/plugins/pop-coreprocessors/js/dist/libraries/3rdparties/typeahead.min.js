!function(e){popTypeahead={typeaheadSearchBtn:function(t){var a=this,n=t.pageSection,i=t.block;t.targets.click(function(){var t=e(this).closest(".pop-typeahead");a.executeTypeaheadSearch(n,i,t)})},typeaheadSearchInput:function(t){var a=this,n=t.pageSection,i=t.block;t.targets.keypress(function(t){if(13==event.which){event.preventDefault();var r=e(this).closest(".pop-typeahead");r.find('input[type="text"].tt-input').typeahead("close"),a.executeTypeaheadSearch(n,i,r)}})},fillTypeahead:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block;t.targets.each(function(){var t=e(this),o=t.data("urlparam");if(o){var p=popManager.getBlockTopLevelURL(r),c=getParam(o,p);if(c){var l=t.data("database-key");e.each(c,function(e,o){var p=popManager.getItemObject(n,l,o);a.selectTypeahead(n,i,r,t,p)}),popBootstrap.execOpenParentCollapse(t)}}})},selectDatum:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block;t.targets.click(function(t){t.preventDefault();var o=e(this),p=e(o.data("target")),c=o.data("objectid"),l=o.data("db-key"),d=popManager.getItemObject(n,l,c);a.selectTypeahead(n,i,r,p,d)})},selectableTypeahead:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block,o=t.targets;a.typeahead(n,i,r,o),o.each(function(){var t=e(this);a.validateMaxSelected(i,r,t),t.bind("typeahead:selected",function(t,o,p){var c=e(this);a.selectTypeahead(n,i,r,c,o)})})},fetchlinkTypeahead:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block,o=t.targets;a.typeahead(n,i,r,o),o.each(function(){e(this).bind("typeahead:selected",function(t,a,n){var i=e(this).closest(".pop-typeahead");popManager.click(a.url,"",i)})})},selectableTypeaheadTrigger:function(t){var a=this;t.pageSection,t.block;t.targets.on("close.bs.alert",function(){var t=e(this),n=t.closest(".pop-typeahead"),i=a.getElementsToDisable(n);i.attr("disabled",!1),i.removeClass("disabled");var r=t.children('input[type="hidden"]').val();n.triggerHandler("close",[t,r])})},removeLocalStorageItem:function(e){var t=e.path,a=e.key;e.result=e.result||a.startsWith("__"+t)},selectTypeahead:function(e,t,a,n,i){var r=this,o=n.find('input[type="text"].tt-input');r.triggerSelect(e,t,a,n,i),o.typeahead("val","")},executeTypeaheadSearch:function(e,t,a){var n=a.find('input[type="text"].tt-input'),i=popManager.getQueryUrl(e,t);n.typeahead("val")&&(i=i.replace(M.JSPLACEHOLDER_QUERY,n.typeahead("val")),popManager.click(i,"",a))},getElementsToDisable:function(e){return e.children("div.pop-operation").find("a, button, input")},typeahead:function(t,a,n,i){var r=this;popManager.getPageSectionPage(n).one("destroy",function(){r.destroy(i)}),n.one("rerender",function(e){r.destroy(i)}),i.each(function(){var i=e(this),r=i.find('input[type="text"]'),o=popManager.getJsSettings(t,a,n,i),p=[];e.each(o["dataset-components"],function(e,i){var r=popManager.getJsSettings(t,a,n,i);p.push(r.dataset)}),e.each(p,function(e,t){var a=t.layout;t.template=popManager.getScriptTemplate(a);var n={};t.prefetch&&(n.url=t.prefetch,popJSLibraryManager.execute("typeaheadPrefetchURL",n),t.prefetch=n.url),t.remote&&(n.url=t.remote,popJSLibraryManager.execute("typeaheadRemoteURL",n),t.remote=n.url)});var c=[],l=[];e.each(p,function(t,a){var n=a.limit;p.length>1&&n>3&&(n=3);var i={datumTokenizer:function(t){var n=[];return e.each(a.tokenizerKeys,function(e,a){n=n.concat(Bloodhound.tokenizers.whitespace(t[a]))}),n},queryTokenizer:Bloodhound.tokenizers.whitespace};a.local&&(i.local=a.local),a.prefetch&&(i.prefetch={url:a.prefetch,thumbprint:a[M.KEYS_THUMBPRINT]}),a.remote&&(i.remote={url:a.remote,wildcard:M.JSPLACEHOLDER_QUERY});var r=new Bloodhound(i);c.push(r);var o;o=a.staticSuggestions?function(t,n){var i=[];e.each(a.staticSuggestions,function(a,n){var r={};e.each(n,function(e,a){"string"==typeof a&&(a=a.replace(M.JSPLACEHOLDER_QUERY,t)),r[e]=a}),i.push(r)}),n(i)}:r.ttAdapter(),l.push({source:o,name:a.name,display:a.valueKey,limit:n,templates:{suggestion:a.template,header:a.header,pending:a.pending,notFound:a.notFound}})}),e.each(c,function(e,t){t.initialize()}),1==l.length?r.typeahead({highlight:!0},l[0]):2==l.length?r.typeahead({highlight:!0},l[0],l[1]):3==l.length?r.typeahead({highlight:!0},l[0],l[1],l[2]):4==l.length&&r.typeahead({highlight:!0},l[0],l[1],l[2],l[3])})},triggerSelect:function(t,a,n,i,r){var o=this;if(r&&r.id&&0==i.find('input[type="hidden"][value="'+r.id+'"]').length){var p=popManager.getJsSettings(t,a,n,i),c=p["trigger-layout"],l=(popManager.getSettingsId(a),popManager.getSettingsId(n),{extendContext:e.extend({itemObject:r},p["datum-context"])});popJSRuntimeManager.setBlockURL(n);var d=popManager.getTemplateHtml(t,a,n,c,l);popManager.mergeHtml(d,i.find(".pop-box")),popManager.runJSMethods(t,a,n,c,"last"),popJSRuntimeManager.deleteBlockLastSessionIds(t,a,n,c),o.validateMaxSelected(a,n,i),i.triggerHandler("selected",[r])}},validateMaxSelected:function(e,t,a){var n=this;if(a.data("max-selected")&&a.find('input[type="hidden"]').length==a.data("max-selected")){var i=n.getElementsToDisable(a);i.attr("disabled","disabled"),i.addClass("disabled")}},removeSelected:function(e,t){e.find('input[type="hidden"][value="'+t+'"]').closest(".alert").alert("close")},destroy:function(e){e.find('input[type="text"].tt-input').typeahead("destroy")}}}(jQuery),popJSLibraryManager.register(popTypeahead,["selectableTypeahead","fillTypeahead","selectDatum","fetchlinkTypeahead","selectableTypeaheadTrigger","typeaheadSearchBtn","typeaheadSearchInput","removeLocalStorageItem"]);