Handlebars.registerHelper('breaklines',function(text){text=Handlebars.Utils.escapeExpression(text);text=text.toString();text=text.replace(/(\r\n|\n|\r)/gm,'<br>');return new Handlebars.SafeString(text);});Handlebars.registerHelper('showmore',function(str,options){var len=options.hash.len||0;if(len>0&&str.length>len+100){var delim="</p>";var total_len=len;var morelink='<a href="#" class="pop-showmore-more">'+M.STRING_MORE+'</a>';var lesslink='<a href="#" class="pop-showmore-less hidden">'+M.STRING_LESS+'</a>';var moreless=false,add_morelink=true;if((str.length>total_len)&&(str.substr(len).indexOf(delim)>-1)){moreless=true;add_morelink=false;str=str.substr(0,len)+'<span class="pop-showmore-more-full hidden">'+
str.substr(len,str.substr(len).indexOf(delim))+'</span> '+
morelink+
str.substr(len+str.substr(len).indexOf(delim));total_len=len+str.substr(len).indexOf(delim)+delim.length;}
if(moreless||(str.length>total_len)){var str_end=str.substr(total_len);var has_endstr=str_end.trim().length;if(moreless||has_endstr){var str_beg=str.substr(0,total_len);var str_new='<span class="pop-showmore-more-teaser">'+str_beg+'</span>'+
(has_endstr?'<span class="pop-showmore-more-full hidden">'+str_end+'</span> ':' ')+
(add_morelink?morelink:'')+
lesslink;return new Handlebars.SafeString(str_new);}}}
return str;});Handlebars.registerHelper('ondate',function(date,options){return new Handlebars.SafeString(M.ONDATE.format(date));});Handlebars.registerHelper('img',function(imageData,options){var url=options.hash.url,title=options.hash.title||"",alt=options.hash.alt||"",classs=options.hash.class||"",ret="";if(url){ret+='<a href="'+url+'" title="'+title+'">';}
ret+='<img src="'+imageData.src+'" width="'+imageData.width+'" height="'+imageData.height+'" alt="'+alt+'" class="'+classs+'">';if(url){ret+='</a>';}
return new Handlebars.SafeString(ret);});Handlebars.registerHelper('addParam',function(url,param,value,options){if(!jQuery.isArray(value)){value=[value];}
jQuery.each(value,function(index,val){url=add_query_arg(param,val,url);});return url;});Handlebars.registerHelper('destroyUrl',function(url,options){return new Handlebars.SafeString(popManager.getDestroyUrl(url));});Handlebars.registerHelper('statusLabel',function(status,options){var ret='<span class="label '+M.STATUS.class[status]+' label-'+status+'">'+M.STATUS.text[status]+'</span>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('labelize',function(strings,label,options){var ret='',extra_class='';if(strings){for(var i=0;i<strings.length;i++){extra_class=M.LABELIZE_CLASSES[strings[i]]?M.LABELIZE_CLASSES[strings[i]]:'';ret+='<span class="label '+label+' '+extra_class+'">'+strings[i]+'</span>\n';}}
return new Handlebars.SafeString(ret);});Handlebars.registerHelper('infoButton',function(id,itemObjectId,options){var classs=options.hash.classs||'';var ret='<a class="'+classs+'" data-toggle="collapse" href="#'+id+'-'+itemObjectId+'" role="button"><span class="glyphicon glyphicon-info-sign"></span></a>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('infoCollapse',function(id,itemObjectId,options){var content=options.fn(this);var ret='<div class="collapse" id="'+id+'-'+itemObjectId+'">'+content+'</div>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('mod',function(lvalue,rvalue,options){if(arguments.length<3)
throw new Error("Handlebars Helper equal needs 2 parameters");offset=options.hash.offset||0;if((lvalue+offset)%rvalue===0){return options.fn(this);}else{return options.inverse(this);}});Handlebars.registerHelper('compare',function(lvalue,rvalue,options){if(arguments.length<3)
throw new Error("Handlerbars Helper 'compare' needs 2 parameters");operator=options.hash.operator||"==";var operators={'eq':function(l,r){return l==r||l.toString()==r.toString();},'==':function(l,r){return l==r;},'===':function(l,r){return l===r;},'!=':function(l,r){return l!=r;},'<':function(l,r){return l<r;},'>':function(l,r){return l>r;},'<=':function(l,r){return l<=r;},'>=':function(l,r){return l>=r;},'typeof':function(l,r){return typeof l==r;},'in':function(l,r){return r.indexOf(l)>=0;},'notin':function(l,r){return r.indexOf(l)==-1;}}
if(!operators[operator])
throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);var result=operators[operator](lvalue,rvalue);if(result){return options.fn(this);}else{return options.inverse(this);}});Handlebars.registerHelper('get',function(db,index,options){if(typeof db=='undefined'||typeof db[index]=='undefined'){return'';}
return db[index];});Handlebars.registerHelper('ifget',function(db,index,options){if(typeof db=='undefined'){return'';}
var condition=false;if(options.hash.method){var executed=popJSLibraryManager.execute(options.hash.method,{input:db[index]});jQuery.each(executed,function(index,value){if(value){condition=true;return-1;}});}
else{condition=db[index];}
if(condition){return options.fn(this);}
else{return options.inverse(this);}});Handlebars.registerHelper('withget',function(db,index,options){if(typeof db=='undefined'||typeof db[index]=='undefined'){return'';}
var context=db[index];popManager.expandJSKeys(context);return options.fn(context);});Handlebars.registerHelper('interceptAttr',function(options){var context=options.hash.context||this;var intercept=context[M.JS_INTERCEPT]||{};return new Handlebars.SafeString((intercept[M.JS_TYPE]?' data-intercept="'+intercept[M.JS_TYPE]+'"':'')+(intercept.settings?' data-intercept-settings="'+intercept[M.JS_SETTINGS]+'"':'')+(intercept[M.JS_TARGET]?' target="'+intercept[M.JS_TARGET]+'"':'')+(intercept[M.JS_SKIPSTATEUPDATE]?' data-intercept-skipstateupdate="true"':'')+' style="display: none;"');});Handlebars.registerHelper('generateId',function(options){var context=options.hash.context||this;var pssId=options.hash.pssId||context.pss.pssId;var targetId=options.hash.targetId||context.bs.bsId;var template=options.hash.template||context[M.JS_TEMPLATE];var fixed=options.hash.fixed||context[M.JS_FIXEDID];var isIdUnique=options.hash.idUnique||context[M.JS_ISIDUNIQUE];var group=options.hash.group;var id=options.fn(this);var generatedId=popJSRuntimeManager.addTemplateId(pssId,targetId,template,id,group,fixed,isIdUnique);return new Handlebars.SafeString('id="'+generatedId+'" data-templateid="'+template+'"');});Handlebars.registerHelper('lastGeneratedId',function(options){var context=options.hash.context||this;var pssId=options.hash.pssId||context.pss.pssId;var targetId=options.hash.targetId||context.bs.bsId;var template=options.hash.template||context[M.JS_TEMPLATE];var group=options.hash.group;return popJSRuntimeManager.getLastGeneratedId(pssId,targetId,template,group);});Handlebars.registerHelper('applyLightTemplate',function(template,options){var context=options.hash.context||this;var response=popManager.getHtml(template,context);return new Handlebars.SafeString(response);});Handlebars.registerHelper('json',function(context){return JSON.stringify(context);});Handlebars.registerHelper('enterModule',function(prevContext,options){var context=options.hash.context||this;var templateName=options.hash.template||context[M.JS_TEMPLATE];var tls=prevContext.tls;var pss=prevContext.pss;var bs=prevContext.bs;var itemObject=prevContext.itemObject;var itemObjectDBKey=prevContext.itemObjectDBKey;var itemDBKey=(typeof options.hash.itemDBKey!='undefined')?options.hash.itemDBKey:prevContext.itemDBKey;var items=(typeof options.hash.items!='undefined')?options.hash.items:prevContext.items;var extend={itemObject:itemObject,itemObjectDBKey:itemObjectDBKey,itemDBKey:itemDBKey,items:items,tls:tls,pss:pss,bs:bs};var pssId=pss.pssId;var psId=pss.psId;var bsId=bs.bsId;var bId=bs.bId;jQuery.extend(context,popManager.getRuntimeConfiguration(pssId,bsId,templateName));popManager.expandJSKeys(context);var itemObjectId=options.hash.itemObjectId;if(jQuery.type(itemObjectId)==="array"){if(itemObjectId.length){itemObjectId=itemObjectId[0];}
else{itemObjectId=null;itemObject=null;extend.itemObject=itemObject;}}
if(options.hash.itemDBKey&&itemObjectId){itemDBKey=options.hash.itemDBKey;itemObject=popManager.getItemObject(itemDBKey,itemObjectId);extend.itemObject=itemObject;extend.itemObjectDBKey=itemDBKey;extend.itemDBKey=itemDBKey;extend.items=[itemObjectId];}
else if(options.hash.itemDBKey&&options.hash.items){extend.itemDBKey=options.hash.itemDBKey;extend.items=options.hash.items;}
else if(options.hash.subcomponent&&itemObjectId){itemDBKey=bs['db-keys'][M.JS_SUBCOMPONENTS][options.hash.subcomponent]['db-key'];itemObject=popManager.getItemObject(itemDBKey,itemObjectId);extend.itemObject=itemObject;extend.itemObjectDBKey=itemDBKey;extend.itemDBKey=itemDBKey;extend.items=[itemObjectId];}
else if(options.hash.subcomponent&&options.hash.items){itemDBKey=bs['db-keys'][M.JS_SUBCOMPONENTS][options.hash.subcomponent]['db-key'];extend.itemDBKey=itemDBKey;extend.items=options.hash.items;}
else if(options.hash.items){extend.items=options.hash.items;}
else if(options.hash.itemDBKey){extend.itemDBKey=options.hash.itemDBKey;extend.itemObject=null;extend.itemObjectDBKey=null;extend.items=null;}
if(extend.items){if(jQuery.type(extend.items)!=="array"){extend.items=[extend.items];}}
if(options.hash['feedback-msg']){extend['feedback-msg']=options.hash['feedback-msg'];}
var overrideFields=[],staticStrReplace=[],runtimeStrReplace=[];if(context[M.JS_MODULEOPTIONS]){overrideFields=context[M.JS_MODULEOPTIONS][M.JS_OVERRIDEFROMITEMOBJECT]||[];staticStrReplace=context[M.JS_MODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[];}
if(context[M.JS_RUNTIMEMODULEOPTIONS]){runtimeStrReplace=context[M.JS_RUNTIMEMODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[];}
if(overrideFields.length){popManager.overrideFromItemObject(itemObject,extend,overrideFields);}
var strReplace=staticStrReplace.concat(runtimeStrReplace);if(strReplace.length){popManager.replaceFromItemObject(pssId,bsId,templateName,itemObject,extend,strReplace);}
var parentContext=options.hash.parentContext||{};if(parentContext){extend['parent-context']=parentContext;var rootContext=parentContext;while(rootContext['parent-context']){rootContext=rootContext['parent-context'];}
extend['root-context']=rootContext;}
jQuery.extend(context,extend);var response=popManager.getHtml(templateName,context);if(options.hash.unsafe){return response;}
return new Handlebars.SafeString(response);});function getMultiLayoutKey(itemDBKey,itemObject){var keyFields=M.MULTILAYOUT_KEYFIELDS[itemDBKey]||[];if(!keyFields.length){return'default';}
var keyParts=[];jQuery.each(keyFields,function(index,field){keyParts.push(itemObject[field]);});return keyParts.join('-');}
Handlebars.registerHelper('withLayout',function(itemDBKey,itemObjectId,multipleLayouts,context,options){var itemObject=popManager.getItemObject(itemDBKey,itemObjectId);var key=getMultiLayoutKey(itemDBKey,itemObject);var layout=multipleLayouts[key];if(!layout){layout=multipleLayouts['default'];}
if(!layout){return'';}
var layoutContext=context[M.JS_MODULES][layout];jQuery.extend(layoutContext,{itemDBKey:itemDBKey,itemObjectId:itemObjectId});popManager.expandJSKeys(layoutContext);return options.fn(layoutContext);});Handlebars.registerHelper('layoutLabel',function(itemDBKey,itemObject,options){var key=getMultiLayoutKey(itemDBKey,itemObject);return M.MULTILAYOUT_LABELS[key]||'';});Handlebars.registerHelper('withOptions',function(context,options){if(typeof context!='undefined'){jQuery.extend(context,options.hash);popManager.expandJSKeys(context);return options.fn(context);}});Handlebars.registerHelper('withBlock',function(context,blockSettingsId,options){if(typeof context=='undefined'||typeof context[M.JS_MODULES]=='undefined'||typeof context[M.JS_MODULES][blockSettingsId]=='undefined'){return;}
context=context[M.JS_MODULES][blockSettingsId];popManager.expandJSKeys(context);return options.fn(context);});Handlebars.registerHelper('withModule',function(context,module,options){if(typeof context=='undefined'||typeof context[M.JS_SETTINGSIDS]=='undefined'||typeof context[M.JS_SETTINGSIDS][module]=='undefined'){return;}
var moduleSettingsId=context[M.JS_SETTINGSIDS][module];if(typeof context[M.JS_MODULES]=='undefined'||typeof context[M.JS_MODULES][moduleSettingsId]=='undefined'){return;}
context=context[M.JS_MODULES][moduleSettingsId];popManager.expandJSKeys(context);jQuery.extend(context,options.hash);return options.fn(context);});Handlebars.registerHelper('withSublevel',function(sublevel,options){var context=options.hash.context||this;popManager.expandJSKeys(context);return options.fn(context[sublevel]);});Handlebars.registerHelper('withItemObject',function(itemDBKey,itemObjectId,options){var context=popManager.getItemObject(itemDBKey,itemObjectId);return options.fn(context);});Handlebars.registerHelper('join',function(items,block){var delimiter=block.hash.delimiter||",",start=start=block.hash.start||0,len=items?items.length:0,end=block.hash.end||len,out="";if(end>len)end=len;if('function'===typeof block){for(i=start;i<end;i++){if(i>start)out+=delimiter;if('string'===typeof items[i])
out+=items[i];else
out+=block(items[i]);}
return out;}else{return[].concat(items).slice(start,end).join(delimiter);}});;function unescapeHtml(unsafe){var d=document.createElement("div");d.innerHTML=unsafe;return d.innerText||d.text||d.textContent;}
function add_query_arg(key,value,url){url+=(url.split('?')[1]?'&':'?')+key+'='+value;return url;}
var removeQueryFields=function(url,args){if(!args.length){return url;}
var fields=args.join('|'),parts=url.split(new RegExp('[&?]('+fields+')=[^&]*')),length=parts.length-1;return parts[0]+(length?parts[length].slice(1):'');}
if(!String.prototype.format){String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});};}
if(typeof String.prototype.startsWith!='function'){String.prototype.startsWith=function(str){return this.indexOf(str)==0;};}
function removeParams(url){if(url.indexOf('?')>-1){return url.substr(0,url.indexOf('?'));}
return url;}
function getParams(url){if(url.indexOf('?')>-1){var params=url.substr(url.indexOf('?')+1);if(params.indexOf('#')>-1){params=params.substr(0,params.indexOf('#'));}
return params;}
return'';}
var urlParams={};function getParam(key,url){var params;if(url){params=getParams(url);}
else{params=window.location.search.substring(1);}
var paramsObj=splitUrlParams(params);return paramsObj[key];}
function splitUrlParams(params){if(typeof urlParams[params]!='undefined'){return urlParams[params];}
urlParams[params]=jQuery.extend({},splitParams(params));return urlParams[params];}
function splitParams(params){var splitParams={};var e,d=function(s){return decodeURIComponent(s).replace(/\+/g," ");},q=decodeURI(params),r=/([^&=]+)=?([^&]*)/g;while(e=r.exec(q)){if(e[1].indexOf("[")=="-1")
splitParams[d(e[1])]=d(e[2]);else{var b1=e[1].indexOf("["),aN=e[1].slice(b1+1,e[1].indexOf("]",b1)),pN=d(e[1].slice(0,b1));if(typeof splitParams[pN]!="object"){splitParams[d(pN)]={};}
if(aN)
splitParams[d(pN)][d(aN)]=d(e[2]);else
Array.prototype.push.call(splitParams[d(pN)],d(e[2]));}}
return splitParams;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1)+min);}
function doScroll(elem,animate){animate=animate||false;var top=elem.offset().top-20;if(animate){jQuery('html, body').animate({scrollTop:top});}
else{window.scrollTo(0,top);}}
function removeMarker(url){if(url.indexOf('#')>-1){return url.substr(0,url.indexOf('#'));}
return url;}
var counter=0;function counterNext(){counter++;return counter;}
function gd_clone(elems){var cloned={};jQuery.each(elems,function(key,value){if(jQuery.type(value)==="array"){cloned[key]=jQuery.extend({},value);}
else{cloned[key]=value;}});return cloned;}
function windowResize(){var evt=document.createEvent('UIEvents');evt.initUIEvent('resize',true,false,window,0);window.dispatchEvent(evt);jQuery(document).ready(function($){$(window).triggerHandler('resized');});}
if(!Date.now){Date.now=function(){return new Date().getTime();}}
function isUrlValid(url){return /^(https?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);}
function beep(){var snd=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");snd.play();};(function($){popJSLibraryManager={libraries:[],methods:{},register:function(library,methods,highPriority,override){var t=this;t.libraries.push(library);$.each(methods,function(index,method){if(!t.methods[method]||override){t.methods[method]=[];}
if(highPriority){t.methods[method].unshift(library);}
else{t.methods[method].push(library);}})},getLibraries:function(method){var t=this;return t.methods[method]||[];},execute:function(method,args){var t=this;var ret={};var libraries=t.methods[method];if(libraries){$.each(libraries,function(index,library){ret['l'+index]=library[method](args);});}
return ret;}};})(jQuery);;(function($){popJSRuntimeManager={'full-session-ids':{},'last-session-ids':{},initPageSectionVarPaths:function(vars,pssId,template,group){var t=this;if(!vars[pssId]){vars[pssId]={};}
if(!vars[pssId][template]){vars[pssId][template]={};}
if(!vars[pssId][template][group]){vars[pssId][template][group]=[];}},initBlockVarPaths:function(vars,pssId,targetId,template,group){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;if(!vars[pssId]){vars[pssId]={};}
if(!vars[pssId][targetId]){vars[pssId][targetId]={};}
if(!vars[pssId][targetId][template]){vars[pssId][targetId][template]={};}
if(!vars[pssId][targetId][template][group]){vars[pssId][targetId][template][group]=[];}},initVars:function(pssId,targetId,template,group){var t=this;t.initBlockVarPaths(t['full-session-ids'],pssId,targetId,template,group);t.initBlockVarPaths(t['last-session-ids'],pssId,targetId,template,group);},addGroup:function(id,group){var t=this;if(group){id+=M.ID_SEPARATOR+group;}
return id;},addPageSectionId:function(pssId,template,id,group){var t=this;id=t.addGroup(id,group);t.addTargetId(pssId,pssId,template,group,id);return id;},addTemplateId:function(pssId,targetId,template,id,group,fixed,isIdUnique){var t=this;id=t.addGroup(id,group);if(!isIdUnique){id+=popManager.getUniqueId();}
if(!fixed){id+=M.ID_SEPARATOR+counterNext();}
t.addTargetId(pssId,pssId,template,group,id);t.addTargetId(pssId,targetId,template,group,id);return id;},addTargetId:function(pssId,targetId,template,group,id){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;t.initVars(pssId,targetId,template,group);t['full-session-ids'][pssId][targetId][template][group].push(id);t['last-session-ids'][pssId][targetId][template][group].push(id);return id;},getLastGeneratedId:function(pssId,targetId,template,group){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;var ids=t['full-session-ids'][pssId][targetId][template][group];return ids[ids.length-1];},getPageSectionSessionIds:function(pageSection,session){var t=this;return t.getTargetSessionIds(pageSection,pageSection,session);},getBlockSessionIds:function(pageSection,block,session){var t=this;return t.getTargetSessionIds(pageSection,block,session);},getTargetSessionIds:function(pageSection,target,session){var t=this;var pssId=popManager.getSettingsId(pageSection);var targetId=popManager.getSettingsId(target);session=session||'last';if(t[session+'-session-ids'][pssId]){return t[session+'-session-ids'][pssId][targetId];}
return null;},deletePageSectionLastSessionIds:function(pageSection){var t=this;var pssId=popManager.getSettingsId(pageSection);delete t['last-session-ids'][pssId][pssId];},deleteBlockLastSessionIds:function(pageSection,block){var t=this;var pssId=popManager.getSettingsId(pageSection);var targetId=popManager.getSettingsId(block);if(t['last-session-ids'][pssId]&&t['last-session-ids'][pssId][targetId]){delete t['last-session-ids'][pssId][targetId];}},};})(jQuery);;function showTopNav(){popPageSectionManager.open(popPageSectionManager.getTopNav());}
function hideTopNav(){popPageSectionManager.close(popPageSectionManager.getTopNav());}
(function($){popPageSectionManager={offcanvasToggle:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var control=$(this);var mode=control.data('mode');var target=$(control.data('target'));var action=control.data('toggle');if(action=='offcanvas-open'){t.open(target,mode);}
else if(action=='offcanvas-close'){t.close(target,mode);}
else if(action=='offcanvas-toggle'){t.toggle(target,mode);}});},isHidden:function(args){var t=this;var targets=args.targets;var offcanvas=targets.closest('.offcanvas');return t.execIsHidden(offcanvas);},execIsHidden:function(offcanvas){var t=this;if(offcanvas.length){var classs=t.getOffcanvasActiveClass(offcanvas);return!t.getGroup(offcanvas).hasClass(classs);}
return false;},getOffcanvasActiveClass:function(offcanvas,mode){var t=this;var section=offcanvas.data('offcanvas');var ret='active-'+section;if(mode=='xs'){ret+='-xs';}
return ret;},open:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);group.addClass(classs);t.triggerStatus(offcanvas,mode,'opened');},close:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);group.removeClass(classs);t.triggerStatus(offcanvas,mode,'closed');},toggle:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);if(group.hasClass(classs)){t.close(offcanvas,mode);}
else{t.open(offcanvas,mode);}},triggerStatus:function(offcanvas,mode,status){var t=this;var group=t.getGroup(offcanvas);group.triggerHandler('on.bs.pagesection-group:pagesection-'+offcanvas.attr('id')+':'+status,[offcanvas,mode]);},getTopLevelSettingsId:function(){var t=this;return M.TEMPLATE_TOPLEVEL_SETTINGS_ID;},getPageSectionStatus:function(pageSection){var t=this;return $('#'+pageSection.attr('id')+'-status');},getGroup:function(offcanvas){var t=this;if(offcanvas){return offcanvas.closest('.pop-pagesection-group');}
return $('#'+M.TEMPLATE_PAGESECTIONGROUP_ID);},theater:function(theater){var t=this;var group=t.getGroup();t.transitionEndResize();if(theater){group.addClass('theater');group.triggerHandler('on.bs.pagesection:theater');}
else{group.removeClass('theater');group.triggerHandler('off.bs.pagesection:theater');}},isTheater:function(){var t=this;var group=t.getGroup();return group.hasClass('theater');},transitionEndResize:function(){var t=this;var offCanvasGroup=t.getGroup();offCanvasGroup.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){windowResize();});},enableShowHideTopNav:function(){var t=this;$(window).on('scroll:down',hideTopNav);$(window).on('scroll:up',showTopNav);},disableShowHideTopNav:function(){var t=this;$(window).off('scroll:down',hideTopNav);$(window).off('scroll:up',showTopNav);},getTopNav:function(){var t=this;var offCanvasGroup=t.getGroup();return offCanvasGroup.find('.offcanvas-topnav');},getOpenMode:function(pageSection){return pageSection.data('pagesection-openmode')||'automatic';}};})(jQuery);popJSLibraryManager.register(popPageSectionManager,['isHidden','offcanvasToggle'],true);;(function($){popBrowserHistory={loaded:false,documentInitialized:function(args){var t=this;$(window).on("popstate",function(e){if(t.loaded){var url=t.removePushURLAtts(window.location.href);var options={skipPushState:true};if(popURLInterceptors.getInterceptors(url).length){popURLInterceptors.intercept(url,options);}
else{popManager.fetch(url,options);}}
else{t.loaded=true;}});},addPushURLAtts:function(url){var t=this;var tlFeedback=popManager.getTopLevelFeedback();$.each(tlFeedback[M.DATALOAD_PUSHURLATTS],function(key,value){url=add_query_arg(key,value,url);});return url;},removePushURLAtts:function(url){var t=this;var tlFeedback=popManager.getTopLevelFeedback(),args=[];$.each(tlFeedback[M.DATALOAD_PUSHURLATTS],function(key,value){args.push(key);});return removeQueryFields(url,args);},pushState:function(url){var t=this;url=t.addPushURLAtts(url);if(!url.startsWith(M.HOME_URL)){url=add_query_arg(M.URLPARAM_URL,encodeURIComponent(url),M.EXTERNAL_URL);}
history.pushState({url:url},'',url);t.loaded=true;},replaceState:function(url){var t=this;if(window.location.url==url){return;}
url=t.addPushURLAtts(url);history.replaceState({url:url},'',url);t.loaded=true;}};})(jQuery);popJSLibraryManager.register(popBrowserHistory,['documentInitialized'],true);;(function($){popURLInterceptors={'fullurl':{},'partialurl':{},pageSectionNewDOMsInitialized:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;newDOMs.find('[data-intercept="fullurl"]').addBack('[data-intercept="fullurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);if(!t.fullurl[target]){t.fullurl[target]={};}
if(!t.fullurl[target][url]){t.fullurl[target][url]=[];}
t.fullurl[target][url].push(id);});newDOMs.find('[data-intercept="partialurl"]').addBack('[data-intercept="partialurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);if(!t.partialurl[target]){t.partialurl[target]={};}
t.partialurl[target][id]=url;});},destroyTarget:function(args){var t=this;var pageSection=args.pageSection,destroyTarget=args.destroyTarget;destroyTarget.find('[data-intercept="fullurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);var interceptors=t.fullurl[target][url];if(interceptors){interceptors=interceptors.filter(function(interceptorId,pos){return id!=interceptorId});if(interceptors.length){t.fullurl[target][url]=interceptors;}
else{delete t.fullurl[target][url];}}});destroyTarget.find('[data-intercept="partialurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var target=t.getTarget(pageSection,interceptor);delete t.partialurl[target][id];});},getSettings:function(interceptor){var t=this;var settings=interceptor.data('intercept-settings')||'';settings=settings.split(M.SEPARATOR);return settings;},getTarget:function(pageSection,interceptor){var t=this;return interceptor.attr('target')||popManager.getFrameTarget(pageSection);},getUrl:function(interceptor){var t=this;return interceptor.data('intercept-url');},getFullUrlInterceptors:function(url,options){var t=this;var ret=[];options=options||{};var target=options.target||M.URLPARAM_TARGET_MAIN;var interceptors=t.fullurl;if(interceptors[target]){if(interceptors[target][url]){ret.push($('#'+interceptors[target][url].join(', #')));}
else{var noParamsUrl=removeParams(url);if(url!=noParamsUrl){if(interceptors[target][noParamsUrl]){var maybeInterceptors=$('#'+interceptors[target][noParamsUrl].join(', #')).filter('.pop-interceptor');if(maybeInterceptors.length){ret.push(maybeInterceptors);}}}}}
return ret;},getPartialUrlInterceptor:function(interceptUrl,options){var t=this;var interceptor=null;options=options||{};var target=options.target||M.URLPARAM_TARGET_MAIN;var interceptors=t.partialurl;if(target){var targetInterceptors=interceptors[target];if(targetInterceptors){$.each(targetInterceptors,function(id,url){if(interceptUrl.startsWith(url)){interceptor=$('#'+id);return false;}});}}
return interceptor;},getURLInterceptors:function(interceptUrl,options){var t=this;var ret=t.getFullUrlInterceptors(interceptUrl,options);var partialurl=t.getPartialUrlInterceptor(interceptUrl,options);if(partialurl){ret.push(partialurl);}
return ret;},getInterceptors:function(interceptUrl,options){var t=this;var ret=t.getURLInterceptors(interceptUrl,options);if(ret.length){return ret;}
var noMarkerUrl=removeMarker(interceptUrl);if(noMarkerUrl!=interceptUrl){ret=t.getURLInterceptors(noMarkerUrl,options);}
return ret;},intercept:function(interceptUrl,options){var t=this;var interceptor;options=options||{};var interceptors=t.getInterceptors(interceptUrl,options);if(interceptors.length){if(options.event){options.event.stopImmediatePropagation();}
$.each(interceptors,function(index,interceptor){var skip_state_update=interceptor.data('intercept-skipstateupdate')||options.skipstateupdate;if(!skip_state_update){if(!options.skipPushState){popBrowserHistory.pushState(interceptUrl);}
var title=interceptor.data('title');if(title){t.documentTitle=unescapeHtml(title);document.title=popManager.documentTitle;}
return-1;}});var interceptor_atts=options['interceptor-atts']||{};$.each(interceptors,function(index,interceptor){$.each(interceptor_atts,function(key,value){interceptor.data(key,value);});var relatedTarget=options.relatedTarget;interceptor.data('interceptedTarget',relatedTarget);var settings=t.getSettings(interceptor.parent());interceptor.data('original-url',interceptUrl);interceptor.data('post-data',getParams(interceptUrl));interceptor.trigger('click');});return true;}
return false;}};})(jQuery);popJSLibraryManager.register(popURLInterceptors,['destroyTarget','pageSectionNewDOMsInitialized'],true);;(function($){popManager={mergingTemplatePromise:false,memory:{settings:{},runtimesettings:{},dataset:{},feedback:{block:{},pagesection:{},toplevel:{}},params:{}},initialBlockMemory:{},urlPointers:{},replicableMemory:{},runtimeMemory:{general:{},url:{}},database:{},userdatabase:{},firstLoad:{},documentTitle:null,getMemory:function(){var t=this;return t.memory;},getInitialBlockMemory:function(url){var t=this;if(url==M.INITIAL_URL){return t.initialBlockMemory[url];}
var storedUnder=t.urlPointers[url];if(storedUnder){return t.initialBlockMemory[storedUnder.url];}
return t.initialBlockMemory[url]||{};},addInitialBlockMemory:function(response){var t=this;var url=response.feedback.toplevel[M.URLPARAM_URL];if(!t.initialBlockMemory[url]){t.initialBlockMemory[url]={dataset:{},feedback:{block:{},},params:{},runtimesettings:{configuration:{}}};}
var initialMemory=t.initialBlockMemory[url];$.each(response.settings.configuration,function(pssId,rpsConfiguration){if(!initialMemory.params[pssId]){initialMemory.params[pssId]={};initialMemory.runtimesettings.configuration[pssId]={};initialMemory.dataset[pssId]={};initialMemory.feedback.block[pssId]={};}
$.extend(initialMemory.params[pssId],response.params[pssId]);$.extend(initialMemory.runtimesettings.configuration[pssId],response.runtimesettings.configuration[pssId]);$.extend(initialMemory.dataset[pssId],response.dataset[pssId]);$.extend(initialMemory.feedback.block[pssId],response.feedback.block[pssId]);});},getReplicableMemory:function(url,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var storedUnder=t.urlPointers[url];return t.replicableMemory[storedUnder.url][storedUnder.target];},saveUrlPointers:function(response,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var url=response.feedback.toplevel[M.URLPARAM_URL];$.each(response.feedback.pagesection,function(pssId,psFeedback){if(psFeedback['intercept-urls']){$.each(psFeedback['intercept-urls'],function(ipssId,iObject){$.each(iObject,function(ielemsId,iUrl){t.urlPointers[iUrl]={url:url,target:target};});});}});$.each(response.feedback.block,function(pssId,psFeedback){$.each(psFeedback,function(bsId,bFeedback){if(bFeedback['intercept-urls']){$.each(bFeedback['intercept-urls'],function(ibsId,iObject){$.each(iObject,function(ielemsId,iUrl){t.urlPointers[iUrl]={url:url,target:target};});});}});});},addReplicableMemory:function(response,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var hasreplicable=false;$.each(response.settings.configuration,function(pssId,psConfiguration){if(psConfiguration[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE].length){hasreplicable=true;return-1;}});if(hasreplicable){var url=response.feedback.toplevel[M.URLPARAM_URL];if(!t.replicableMemory[url]){t.replicableMemory[url]={};}
t.replicableMemory[url][target]={dataset:$.extend(true,{},response.dataset),feedback:$.extend(true,{},response.feedback),params:$.extend(true,{},response.params)}}},getRuntimeMemory:function(pageSection,target,options){var t=this;options=options||{};var pageSectionPage=t.getPageSectionPage(target);var scope=pageSectionPage.data('paramsscope');if(scope==M.SETTINGS_PARAMSSCOPE_URL){var url=options.url||''+window.location.href;if(!t.runtimeMemory.url[url]){t.runtimeMemory.url[url]={};}
target.data('paramsscope-url',url);return t.runtimeMemory.url[url];}
return t.runtimeMemory.general;},newRuntimeMemoryPage:function(pageSection,target,options){var t=this;options=options||{};if(!options.url){var tlFeedback=t.getTopLevelFeedback();options.url=tlFeedback[M.URLPARAM_URL];}
var mempage=t.getRuntimeMemory(pageSection,target,options);var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);if(!mempage[pssId]){mempage[pssId]={};}
mempage[pssId][targetId]={params:{},id:null};return mempage[pssId][targetId];},deleteRuntimeMemoryPage:function(pageSection,target,options){var t=this;var mempage=t.getRuntimeMemory(pageSection,target,options);var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);if(mempage[pssId]){delete mempage[pssId][targetId];if($.isEmptyObject(mempage[pssId])){delete mempage[pssId];}}},getRuntimeMemoryPage:function(pageSection,targetOrId,options){var t=this;options=options||{};var mempage,url;if(options.url){url=options.url;}
else if($.type(targetOrId)=='object'){var target=targetOrId;url=target.data('paramsscope-url');}
if(url){mempage=t.runtimeMemory.url[url];}
else{mempage=t.runtimeMemory.general;}
var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(targetOrId);if(!mempage[pssId]||!mempage[pssId][targetId]){var error="Mempage not available";if(url){error+=" for url "+url;}
throw new Error(error);}
return mempage[pssId][targetId];},isFirstLoad:function(pageSection){var t=this;return t.firstLoad[popManager.getSettingsId(pageSection)];},init:function(){var t=this;if($('#'+popPageSectionManager.getTopLevelSettingsId()).length){t.initDocument();t.initTopLevelJson();popUserAccount.initialLogin();var memory=t.getMemory();var pageSections=[];$.each(memory.settings.configuration,function(pssId,psConfiguration){var psId=psConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);pageSection.attr('data-settings-id',pssId);pageSection.addClass('pop-pagesection');t.initPageSectionSettings(pageSection,psConfiguration);t.addPageSectionIds(pageSection,psConfiguration[M.JS_TEMPLATE]);t.initPageSection(pageSection);pageSections.push(pageSection);});$.each(pageSections,function(index,pageSection){t.renderPageSection(pageSection);});$('body').removeClass('pop-loading-initial');$.each(pageSections,function(index,pageSection){t.pageSectionInitialized(pageSection);});popBrowserHistory.replaceState(t.getTopLevelFeedback()[M.URLPARAM_URL]);t.updateDocument();t.documentInitialized();t.backgroundLoad(M.BACKGROUND_LOAD);t.backgroundLoad(t.getTopLevelFeedback()[M.URLPARAM_BACKGROUNDLOADURLS]);}},expandJSKeys:function(context){var t=this;if(context&&M.COMPACT_JS_KEYS){if(context[M.JS_MODULES]){context.modules=context[M.JS_MODULES];}
if(context[M.JS_TEMPLATE]){context.template=context[M.JS_TEMPLATE];}
if(context[M.JS_TEMPLATEIDS]){context['template-ids']=context[M.JS_TEMPLATEIDS];}
if(context[M.JS_SETTINGSID]){context['settings-id']=context[M.JS_SETTINGSID];}
if(context[M.JS_SETTINGSIDS]){context['settings-ids']=context[M.JS_SETTINGSIDS];if(context[M.JS_SETTINGSIDS][M.JS_BLOCKUNITS]){context['settings-ids']['blockunits']=context[M.JS_SETTINGSIDS][M.JS_BLOCKUNITS];}}
if(context[M.JS_INTERCEPT]){context.intercept=context[M.JS_INTERCEPT];}
if(context[M.JS_BLOCKSETTINGSIDS]){context['block-settings-ids']=context[M.JS_BLOCKSETTINGSIDS];if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITS]){context['block-settings-ids']['blockunits']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITS];}
if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE]){context['block-settings-ids']['blockunits-replicable']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE];}
if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSFRAME]){context['block-settings-ids']['blockunits-frame']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSFRAME];}}
if(context[M.JS_REPLICATEBLOCKSETTINGSIDS]){context['replicate-blocksettingsids']=context[M.JS_REPLICATEBLOCKSETTINGSIDS];if(context[M.JS_INTERCEPTSKIPSTATEUPDATE]){context['intercept-skipstateupdate']=context[M.JS_INTERCEPTSKIPSTATEUPDATE];}
if(context[M.JS_UNIQUEURLS]){context['unique-urls']=context[M.JS_UNIQUEURLS];}
if(context[M.JS_REPLICATETYPES]){context['replicate-types']=context[M.JS_REPLICATETYPES];}}
if(context[M.JS_PARAMS]){context.params=context[M.JS_PARAMS];}
if(context[M.JS_ITEMOBJECTPARAMS]){context['itemobject-params']=context[M.JS_ITEMOBJECTPARAMS];}
if(context[M.JS_PREVIOUSTEMPLATESIDS]){context['previoustemplates-ids']=context[M.JS_PREVIOUSTEMPLATESIDS];}
if(context[M.JS_BLOCKFEEDBACKPARAMS]){context['blockfeedback-params']=context[M.JS_BLOCKFEEDBACKPARAMS];}
if(context[M.JS_APPENDABLE]){context.appendable=context[M.JS_APPENDABLE];}
if(context[M.JS_CLASS]){context.class=context[M.JS_CLASS];}
if(context[M.JS_CLASSES]){context.classes=context[M.JS_CLASSES];if(context[M.JS_CLASSES][M.JS_APPENDABLE]){context.classes.appendable=context[M.JS_CLASSES][M.JS_APPENDABLE];}}
if(context[M.JS_TITLES]){context.titles=context[M.JS_TITLES];}
popJSLibraryManager.execute('expandJSKeys',{context:context});}},addPageSectionIds:function(pageSection,template){var t=this;var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');popJSRuntimeManager.addPageSectionId(pssId,template,psId);var args={pageSection:pageSection,template:template}
popJSLibraryManager.execute('addPageSectionIds',args);},initDocument:function(){var t=this;$(document).on('user:loggedout',function(e,source){t.clearUserDatabase();});popJSLibraryManager.execute('initDocument');$(document).triggerHandler('initialize.pop.document');},documentInitialized:function(){var t=this;popJSLibraryManager.execute('documentInitialized');$(document).triggerHandler('initialized.pop.document');},backgroundLoad:function(urls){var t=this;var options={'loadingmsg-target':null,silentDocument:true,};$.each(urls,function(url,targets){$.each(targets,function(index,target){popManager.fetch(url,$.extend({target:target},options));});});},initPageSection:function(pageSection){var t=this;t.firstLoad[t.getSettingsId(pageSection)]=true;popJSLibraryManager.execute('initPageSection',{pageSection:pageSection});pageSection.triggerHandler('initialize');$(document).triggerHandler('initialize.pop.pagesection',[pageSection]);},pageSectionInitialized:function(pageSection){var t=this;t.initPageSectionRuntimeMemory(pageSection);popJSLibraryManager.execute('pageSectionInitialized',{pageSection:pageSection});pageSection.triggerHandler('initialized');pageSection.triggerHandler('completed');t.firstLoad[popManager.getSettingsId(pageSection)]=false;},pageSectionNewDOMsInitialized:function(pageSection,newDOMs,options){var t=this;if(newDOMs.filter('.pop-pagesection-page').length){var openmode=popPageSectionManager.getOpenMode(pageSection);var firstLoad=t.isFirstLoad(pageSection);if(openmode=='automatic'||(firstLoad&&openmode=='initial')){popPageSectionManager.open(pageSection);}}
var args={pageSection:pageSection,newDOMs:newDOMs};t.extendArgs(args,options);popJSLibraryManager.execute('pageSectionNewDOMsBeforeInitialize',args);t.initPageSectionBranches(pageSection,newDOMs,options);popJSLibraryManager.execute('pageSectionNewDOMsInitialized',args);},initPageSectionBranches:function(pageSection,newDOMs,options){var t=this;t.runPageSectionJSMethods(pageSection,options);var jsSettings=popManager.getPageSectionJsSettings(pageSection);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.initBlockBranches(pageSection,$(blockBranches.join(',')).not('.'+M.JS_INITIALIZED),options);}
popJSRuntimeManager.deletePageSectionLastSessionIds(pageSection);},triggerDestroyTarget:function(url,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;popURLInterceptors.intercept(t.getDestroyUrl(url),{target:target});},destroyTarget:function(pageSection,target){var t=this;var args={pageSection:pageSection,destroyTarget:target}
popJSLibraryManager.execute('destroyTarget',args);target.triggerHandler('destroy');var blocks=target.find('.pop-block.'+M.JS_INITIALIZED).addBack('.pop-block.'+M.JS_INITIALIZED);blocks.each(function(){var block=$(this);t.deleteRuntimeMemoryPage(pageSection,block,{url:block.data('paramsscope-url')});})
target.remove();},destroyPageSectionPage:function(pageSection,pageSectionPage){var t=this;var target=pageSectionPage||pageSection;if(!pageSectionPage.siblings('.pop-pagesection-page').length){popPageSectionManager.close(pageSection);popPageSectionManager.close(pageSection,'xs');}
t.destroyTarget(pageSection,target);},pageSectionRendered:function(pageSection,newDOMs,options){var t=this;t.pageSectionNewDOMsInitialized(pageSection,newDOMs,options);var args={pageSection:pageSection,newDOMs:newDOMs}
t.extendArgs(args,options);popJSLibraryManager.execute('pageSectionRendered',args);pageSection.triggerHandler('pageSectionRendered');},runScriptsBefore:function(pageSection,newDOMs){var t=this;var args={pageSection:pageSection,newDOMs:newDOMs};popJSLibraryManager.execute('runScriptsBefore',args);},jsInitialized:function(block){var t=this;return block.hasClass(M.JS_INITIALIZED);},jsLazy:function(block){var t=this;return block.hasClass(M.CLASS_LAZYJS);},setJsInitialized:function(block){var t=this;block.addClass(M.JS_INITIALIZED).removeClass(M.CLASS_LAZYJS);},initBlockBranches:function(pageSection,blocks,options){var t=this;if(!blocks.length){return;}
blocks.each(function(){var block=$(this);var proceed=!t.jsInitialized(block);if(!options['force-init']){proceed=proceed&&!t.jsLazy(block);}
if(proceed){t.setJsInitialized(block);t.initBlock(pageSection,block,options);var jsSettings=popManager.getJsSettings(pageSection,block);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.initBlockBranches(pageSection,$(blockBranches.join(', ')).not('.'+M.JS_INITIALIZED),options);}
var blockChildren=jsSettings['initjs-blockchildren'];if(blockChildren){var target=block;$.each(blockChildren,function(index,selectors){$.each(selectors,function(index,selector){target=target.children(selector).not('.'+M.JS_INITIALIZED);});});t.initBlockBranches(pageSection,target,options);}}});},initBlock:function(pageSection,block,options){var t=this;options=options||{};t.initBlockRuntimeMemory(pageSection,block,options);t.initializeBlock(pageSection,block,options);t.runScriptsBefore(pageSection,block);t.runBlockJSMethods(pageSection,block,options);block.on('rendered',function(e,newDOMs){var block=$(this);t.runScriptsBefore(pageSection,newDOMs);t.runBlockJSMethods(pageSection,block,null,options);});t.blockInitialized(pageSection,block,options);t.loadBlockContent(pageSection,block);},initializeBlock:function(pageSection,block,options){var t=this;var args={pageSection:pageSection,block:block};t.extendArgs(args,options);popJSLibraryManager.execute('initBlock',args);block.triggerHandler('initialize');},extendArgs:function(args,options){var t=this;options=options||{};if(options['js-args']){$.extend(args,options['js-args']);}},blockInitialized:function(pageSection,block,options){var t=this;var args={pageSection:pageSection,block:block};t.extendArgs(args,options);popJSLibraryManager.execute('blockInitialized',args);block.triggerHandler('js:initialized');},loadBlockContent:function(pageSection,block){var t=this;if(!t.isContentLoaded(pageSection,block)){t.setContentLoaded(pageSection,block);var options={action:M.CBACTION_LOADCONTENT,'post-data':block.data('post-data')};var jsSettings=t.getJsSettings(pageSection,block);if(jsSettings['loadcontent-showdisabledlayer']){options['show-disabled-layer']=true;}
$(document).ready(function($){t.fetchBlock(pageSection,block,options);});}},runPageSectionJSMethods:function(pageSection,options){var t=this;var sessionIds=popJSRuntimeManager.getPageSectionSessionIds(pageSection);if(!sessionIds)return;var executedTemplates=[];var templateMethods=popManager.getPageSectionJsMethods(pageSection);$.each(templateMethods,function(template,groupMethods){if(executedTemplates.indexOf(template)==-1){executedTemplates.push(template);if(sessionIds[template]&&groupMethods){$.each(groupMethods,function(group,methods){var ids=sessionIds[template][group];if(ids){var selector='#'+ids.join(', #');var targets=$(selector);if(targets.length){$.each(methods,function(index,method){var args={pageSection:pageSection,targets:targets};t.extendArgs(args,options);popJSLibraryManager.execute(method,args);});}}});}}});},runBlockJSMethods:function(pageSection,block,options){var t=this;t.runJSMethods(pageSection,block,null,null,options);popJSRuntimeManager.deleteBlockLastSessionIds(pageSection,block);},runJSMethods:function(pageSection,block,templateFrom,session,options){var t=this;var sessionIds=popJSRuntimeManager.getBlockSessionIds(pageSection,block,session);if(!sessionIds)return;var templateMethods=t.getTemplateJSMethods(pageSection,block,templateFrom);t.runJSMethodsInner(pageSection,block,templateMethods,sessionIds,[],options);},runJSMethodsInner:function(pageSection,block,templateMethods,sessionIds,executedTemplates,options){var t=this;options=options||{};var template=templateMethods[M.JS_TEMPLATE];var groupMethods=templateMethods[M.JS_METHODS];if(executedTemplates.indexOf(template)==-1){executedTemplates.push(template);if(sessionIds[template]&&groupMethods){$.each(groupMethods,function(group,methods){var ids=sessionIds[template][group];if(ids){var selector='#'+ids.join(', #');var targets=$(selector);if(targets.length){$.each(methods,function(index,method){var args={pageSection:pageSection,block:block,targets:targets};t.extendArgs(args,options);popJSLibraryManager.execute(method,args);});}}});}}
if(templateMethods[M.JS_NEXT]){$.each(templateMethods[M.JS_NEXT],function(index,next){t.runJSMethodsInner(pageSection,block,next,sessionIds,executedTemplates,options);})}},getTemplateJSMethods:function(pageSection,block,templateFrom){var t=this;var templateMethods=popManager.getBlockJsMethods(pageSection,block);if(!templateFrom){return templateMethods;}
return t.getTemplateJSMethodsInner(pageSection,block,templateFrom,templateMethods);},getTemplateJSMethodsInner:function(pageSection,block,templateFrom,templateMethods){var t=this;if(templateMethods[M.JS_TEMPLATE]==templateFrom){return templateMethods;}
var found;if(templateMethods[M.JS_NEXT]){$.each(templateMethods[M.JS_NEXT],function(index,next){found=t.getTemplateJSMethodsInner(pageSection,block,templateFrom,next);if(found){return false;}});}
return found;},maybeRedirect:function(feedback){var t=this;if(feedback.redirect&&feedback.redirect.url){if(feedback.redirect.fetch){t.click(feedback.redirect.url)}
else{window.location=feedback.redirect.url;return true;}}
return false;},historyReplaceState:function(elem,options){var t=this;var url=elem.data('historystate-url');var title=elem.data('historystate-title');var thumb=elem.data('historystate-thumb');popBrowserHistory.replaceState(url);if(title){t.documentTitle=unescapeHtml(title);document.title=t.documentTitle;}},hideIfEmpty:function(pageSection,block){var t=this;var feedback=popManager.getBlockFeedback(pageSection,block);return feedback[M.URLPARAM_HIDEBLOCK];},isHidden:function(elem){var t=this;if(elem.hasClass('hidden'))return true;var elem_id=elem.attr('id');if(elem_id){if(!($('#'+elem_id).length)){return true;}}
var tabPanes=elem.parents('.tab-pane');var activeTabPanes=tabPanes.filter('.active');if(tabPanes.length>activeTabPanes.length){return true;}
var executed=popJSLibraryManager.execute('isHidden',{targets:elem});var ret=false;$.each(executed,function(index,value){if(value){ret=true;return-1;}});return ret;},isContentLoaded:function(pageSection,block){var t=this;var blockParams=t.getBlockParams(pageSection,block);return blockParams[M.DATALOAD_CONTENTLOADED]||false;},setContentLoaded:function(pageSection,block){var t=this;var blockParams=t.getBlockParams(pageSection,block);blockParams[M.DATALOAD_CONTENTLOADED]=true;},getSettingsTemplate:function(elem){var t=this;if(elem.data('templateid')){return elem;}
return elem.closest('data-templateid');},updateDocument:function(){var t=this;var feedback=t.getTopLevelFeedback();t.documentTitle=unescapeHtml(feedback[M.URLPARAM_TITLE]);document.title=t.documentTitle;},hideMessages:function(pageSection){var t=this;var status=popPageSectionManager.getPageSectionStatus(pageSection);var loading=status.find('.pop-loading');var error=status.find('.pop-error');loading.addClass('hidden');error.addClass('hidden');},executeSetFilterBlockParams:function(pageSection,block,filter){var t=this;var blockParams=t.getBlockParams(pageSection,block);blockParams.filter=filter.find('.'+M.FILTER_INPUT).filter(function(){return $.trim(this.value);}).serialize();if(blockParams.filter){blockParams.filter+='&'+filter.find('.'+M.FILTER_NAME_INPUT).serialize();}},setFilterBlockParams:function(pageSection,block,filter){var t=this;if(t.jsInitialized(block)){t.executeSetFilterBlockParams(pageSection,block,filter);}
else{block.one('js:initialized',function(){t.executeSetFilterBlockParams(pageSection,block,filter);});}},filter:function(pageSection,block,filter){var t=this;t.setFilterBlockParams(pageSection,block,filter);t.reload(pageSection,block);t.blockScrollTop(pageSection,block);},blockScrollTop:function(pageSection,block){var t=this;var modal=block.closest('.modal');if(modal.length==0){t.scrollToElem(pageSection,block.children('.blocksection-status').first(),true);}
else{modal.animate({scrollTop:0},'fast');}},setReloadBlockParams:function(pageSection,block){var t=this;var blockParams=t.getBlockParams(pageSection,block);if(blockParams[M.DATALOAD_PARAMS]&&blockParams[M.DATALOAD_PARAMS][M.URLPARAM_PAGED]){blockParams[M.DATALOAD_PARAMS][M.URLPARAM_PAGED]='';}
if(blockParams[M.URLPARAM_STOPFETCHING]){blockParams[M.URLPARAM_STOPFETCHING]=false;}},refetch:function(pageSection,block,options){var t=this;options=options||{};options.action=M.CBACTION_REFETCH;block.triggerHandler('beforeRefetch');popManager.reload(pageSection,block,options);},reset:function(pageSection,block,options){var t=this;options=options||{};if(!options['skip-restore']){t.restoreInitialBlockMemory(pageSection,block);}
t.processBlock(pageSection,block,{operation:M.URLPARAM_OPERATION_REPLACE,action:M.CBACTION_RESET,reset:true});},reload:function(pageSection,block,options){var t=this;options=options||{};options.operation=M.URLPARAM_OPERATION_REPLACE;options.reload=true;options['hide-latestcount']=true;t.setReloadBlockParams(pageSection,block);block.triggerHandler('beforeReload');t.fetchBlock(pageSection,block,options);},loadLatest:function(pageSection,block,options){var t=this;options=options||{};var blockParams=t.getBlockParams(pageSection,block);options.operation=M.URLPARAM_OPERATION_PREPEND;options['skip-stopfetching-check']=true;options['hide-latestcount']=true;var post_data={};post_data[M.URLPARAM_ACTION]=M.URLPARAM_ACTION_LATEST;post_data[M.URLPARAM_TIMESTAMP]=blockParams[M.URLPARAM_TIMESTAMP];options['onetime-post-data']=$.param(post_data);block.triggerHandler('beforeLoadLatest');t.fetchBlock(pageSection,block,options);},handleLoadingStatus:function(pageSection,operation,options){var t=this;var loading;options=options||{};if(typeof options['loadingmsg-target']!='undefined'){if(!options['loadingmsg-target']){return;}
loading=$(options['loadingmsg-target']);}
else{var status=popPageSectionManager.getPageSectionStatus(pageSection);loading=status.find('.pop-loading');var error=status.find('.pop-error');error.addClass('hidden');}
var num=loading.data('num')||0;if(operation=='add'){num+=1;}
else if(operation=='remove'){num-=1;}
loading.data('num',num);if(num){loading.removeClass('hidden');}
else{loading.addClass('hidden');}
if(num>=2){loading.find('.pop-box').text('x'+num);}
else{loading.find('.pop-box').text('');}},fetch:function(url,options){var t=this;options=options||{};var pageSection=t.getFetchTargetPageSection(options.target);var params=t.getPageSectionParams(pageSection);if(!params){if(options['noparams-reload-url']){window.location=url;}
return;}
t.fetchPageSection(pageSection,url,options);},getStoredData:function(localStorageKey){if(M.USELOCALSTORAGE&&Modernizr.localstorage){var stored=localStorage[localStorageKey];if(stored){stored=$.parseJSON(stored);if((stored.version==M.VERSION)&&(typeof stored.expires=='undefined'||stored.expires>Date.now())){return stored.value;}
delete localStorage[localStorageKey];}}
return null;},storeData:function(localStorageKey,value,expires){if(M.USELOCALSTORAGE&&Modernizr.localstorage){var stored={version:M.VERSION,value:value}
if(expires){stored.expires=Date.now()+expires;}
try{localStorage[localStorageKey]=JSON.stringify(stored);}
catch(err){}}},fetchPageSection:function(pageSection,url,options){var t=this;var params=t.getPageSectionParams(pageSection);if(!params){return;}
if(params.loading.indexOf(url)>-1){return;}
options=options||{};var target=t.getTarget(pageSection);var fetchUrl=add_query_arg(M.URLPARAM_TARGET,target,url);fetchUrl=add_query_arg(M.URLPARAM_MODULE,M.URLPARAM_MODULE_SETTINGSDATA,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_OUTPUT,M.URLPARAM_OUTPUT_JSON,fetchUrl);var topLevelFeedback=t.getTopLevelFeedback();var paramsData=$.extend({},topLevelFeedback[M.DATALOAD_PARAMS],params[M.DATALOAD_PARAMS]);if(options.params){$.extend(paramsData,options.params);}
var postData=$.param(paramsData);var localStorageKey;localStorageKey=fetchUrl+'|'+postData;var stored=t.getStoredData(localStorageKey);if(stored){t.processPageSectionResponse(pageSection,stored,options);t.triggerURLFetched(url);return;}
var status=popPageSectionManager.getPageSectionStatus(pageSection);var error=status.find('.pop-error');if(options['disable-layer']){options['disable-layer'].children('.pop-disabledlayer').removeClass('hidden');}
var crossdomain=t.getCrossDomainOptions(fetchUrl);$.ajax($.extend(crossdomain,{dataType:"json",url:fetchUrl,data:postData,beforeSend:function(jqXHR,settings){jqXHR.url=settings.url;params.url[jqXHR.url]=url;params.loading.push(url);t.handleLoadingStatus(pageSection,'add',options);},complete:function(jqXHR){var fetchedUrl=params.url[jqXHR.url];delete params.url[jqXHR.url];params.loading.splice(params.loading.indexOf(fetchedUrl),1);t.handleLoadingStatus(pageSection,'remove',options);if(options['urlfetched-callbacks']){var handler='urlfetched:'+escape(fetchedUrl);$.each(options['urlfetched-callbacks'],function(index,callback){$(document).one(handler,callback);});}
t.triggerURLFetched(fetchedUrl);if(options['disable-layer']){options['disable-layer'].children('.pop-disabledlayer').addClass('hidden');}},success:function(response){t.backgroundLoad(response.feedback.toplevel[M.URLPARAM_BACKGROUNDLOADURLS]);error.addClass('hidden');if(response.feedback.toplevel[M.URLPARAM_STORELOCAL]){t.storeData(localStorageKey,response);}
t.processPageSectionResponse(pageSection,response,options);},error:function(jqXHR,textStatus,errorThrown){var fetchedUrl=params.url[jqXHR.url];t.showError(pageSection,t.getError(fetchedUrl,jqXHR,textStatus,errorThrown));pageSection.triggerHandler('fetchFailed');}}));},getCrossDomainOptions:function(url){var t=this;var options={};if(!url.startsWith(M.HOME_URL)){$.each(M.ALLOWED_URLS,function(index,allowed){if(url.startsWith(allowed)){options.xhrFields={withCredentials:true};options.crossDomain=true;return-1;}});}
return options;},showError:function(pageSection,message){var t=this;var status=popPageSectionManager.getPageSectionStatus(pageSection);var error=status.find('.pop-error');error.children('div.pop-box').html(message);error.removeClass('hidden');t.scrollTop(error);},triggerURLFetched:function(url){var t=this;$(document).triggerHandler('urlfetched:'+escape(url));$(document).triggerHandler('urlfetched',[url]);},processPageSectionResponse:function(pageSection,response,options){var t=this;var target=t.getTarget(pageSection);t.saveUrlPointers(response,target);t.addReplicableMemory(response,target);t.addInitialBlockMemory(response);t.integrateDatabases(response);var dfd=$.Deferred();var lastPromise=t.mergingTemplatePromise;t.mergingTemplatePromise=dfd.promise();if(lastPromise){lastPromise.done(function(){t.processPageSection(pageSection,response,options);});}
else{t.processPageSection(pageSection,response,options);}
dfd.resolve();},maybeUpdateDocument:function(pageSection,options){var t=this;options=options||{};if(options.silentDocument){return;}
var settings=t.getFetchPageSectionSettings(pageSection);if(settings.updateDocument){if(!options.skipPushState){var topLevelFeedback=t.getTopLevelFeedback();popBrowserHistory.pushState(topLevelFeedback[M.URLPARAM_URL]);}
t.updateDocument();}},processPageSection:function(pageSection,response,options){var t=this;var target=t.getTarget(pageSection);t.integrateTopLevelFeedback(response);var topLevelFeedback=t.getTopLevelFeedback();var errorMessage=topLevelFeedback[M.URLPARAM_ERROR];if(errorMessage){t.showError(pageSection,errorMessage);}
var url=topLevelFeedback[M.URLPARAM_URL];if(options.reloadurl){t.triggerDestroyTarget(url,target);}
if(topLevelFeedback[M.URLPARAM_SILENTDOCUMENT]){options.silentDocument=true;}
t.maybeUpdateDocument(pageSection,options);if(options.maybeRedirect){if(t.maybeRedirect(topLevelFeedback))return;}
t.integratePageSection(response);$.each(response.settings.configuration,function(rpssId,rpsConfiguration){var psId=rpsConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);t.renderPageSection(pageSection,options);pageSection.triggerHandler('fetched',[options,url]);pageSection.triggerHandler('completed');});},scrollToElem:function(elem,position,animate){var t=this;if(popPerfectScrollbar.scrollToElem(elem,position,animate)){return;}},scrollTop:function(elem,top,animate){var t=this;if(popPerfectScrollbar.scrollTop(elem,top,animate)){return;}
if(popBootstrap.scrollTop(elem)){return;}},getPosition:function(elem){var t=this;return popPerfectScrollbar.getPosition(elem);},getSettingsId:function(objectOrId){var t=this;if($.type(objectOrId)=='object'){var object=objectOrId;return object.attr('data-settings-id');}
return objectOrId;},getError:function(url,jqXHR,textStatus,errorThrown){var t=this;if(jqXHR.status==404){return M.ERROR_404;}
return M.ERROR_MSG.format(url);},closeMessageFeedback:function(elem){var t=this;$(document).ready(function($){elem.find('.pop-messagefeedback').removeClass('fade').alert('close');});},closeMessageFeedbacks:function(pageSection){var t=this;$(document).ready(function($){pageSection.find('.pop-messagefeedback').removeClass('fade').alert('close');});},processBlock:function(pageSection,block,options){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var memory=t.getMemory();options.extendContext={items:memory.dataset[pssId][bsId]};t.renderTarget(pageSection,block,options);},fetchBlock:function(pageSection,block,options){var t=this;options=options||{};if(!options['skip-stopfetching-check']){var blockParams=t.getBlockParams(pageSection,block);if(blockParams[M.URLPARAM_STOPFETCHING]){return;}}
t.executeFetchBlock(pageSection,block,options);},getBlockPostData:function(pageSection,block,options){var t=this;options=options||{};var paramsGroup=options.paramsGroup||'all';var blockParams=t.getBlockParams(pageSection,block);var params={};if(paramsGroup=='all'){$.extend(params,blockParams[M.DATALOAD_PARAMS]);}
var visibleparams=blockParams[M.DATALOAD_VISIBLEPARAMS];if(visibleparams){$.extend(params,visibleparams);}
$.each(params,function(key,value){if(!value)delete params[key];});var post_data=$.param(params);if(blockParams.filter){if(post_data){post_data+='&';}
post_data+=blockParams.filter;}
return post_data;},executeFetchBlock:function(pageSection,block,options){var t=this;options=options||{};var fetchUrl=t.getQueryUrl(pageSection,block);if(!fetchUrl){return;}
var params=t.getBlockParams(pageSection,block);if(options['post-data']){params['post-data']=options['post-data'];}
var topLevelFeedback=t.getTopLevelFeedback();var pageSectionFeedback=t.getPageSectionFeedback(pageSection);var blockFeedback=t.getBlockFeedback(pageSection,block);var paramsData=$.extend({},topLevelFeedback[M.DATALOAD_PARAMS],pageSectionFeedback[M.DATALOAD_PARAMS],blockFeedback[M.DATALOAD_PARAMS]);var post_data=$.param(paramsData);if(params['post-data']){if(post_data){post_data+='&';}
post_data+=params['post-data'];}
if(options['onetime-post-data']){if(post_data){post_data+='&';}
post_data+=options['onetime-post-data'];}
var block_post_data=t.getBlockPostData(pageSection,block);if(post_data&&block_post_data){post_data+='&';}
post_data+=block_post_data;var target=t.getTarget(pageSection);fetchUrl=add_query_arg(M.URLPARAM_TARGET,target,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_MODULE,M.URLPARAM_MODULE_DATA,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_OUTPUT,M.URLPARAM_OUTPUT_JSON,fetchUrl);var loadingUrl=fetchUrl+post_data;if(params.loading.indexOf(loadingUrl)>-1){return;}
var loading=block.find('.pop-loading');var error=block.find('.pop-error');if(!options['skip-status']){loading.removeClass('hidden');error.addClass('hidden');t.closeMessageFeedback(block);}
t.triggerEvent(pageSection,block,'beforeFetch',[options]);var type=options.type||'GET';if(options['show-disabled-layer']){block.children('.pop-disabledlayer').removeClass('hidden');}
var crossdomain=t.getCrossDomainOptions(fetchUrl);$.ajax($.extend(crossdomain,{dataType:"json",url:fetchUrl,data:post_data,type:type,beforeSend:function(jqXHR,settings){jqXHR.url=settings.url;params.url[jqXHR.url]=loadingUrl;params.loading.push(loadingUrl);params.operation[loadingUrl]=options.operation;params.action[loadingUrl]=options.action;params['paramsscope-url'][loadingUrl]=block.data('paramsscope-url');if(options.reload){params.reload.push(loadingUrl);}},success:function(response,textStatus,jqXHR){t.backgroundLoad(response.feedback.toplevel[M.URLPARAM_BACKGROUNDLOADURLS]);if(options['hide-latestcount']){block.children('.blocksection-latestcount').find('.pop-latestcount').addClass('hidden').find('.pop-count').text('0');}
var lastPromise=t.mergingTemplatePromise;var dfd=$.Deferred();var thisPromise=dfd.promise();t.mergingTemplatePromise=thisPromise;if(lastPromise){lastPromise.done(function(){t.executeFetchBlockSuccess(pageSection,block,params,response,jqXHR);});}
else{t.executeFetchBlockSuccess(pageSection,block,params,response,jqXHR);}
dfd.resolve();},error:function(jqXHR,textStatus,errorThrown){if(!options['skip-status']){error.removeClass('hidden');t.scrollTop(error);}
t.triggerEvent(pageSection,block,'fetchFailed');},complete:function(jqXHR){var status={};var loadingUrl=params.url[jqXHR.url];delete params.url[jqXHR.url];params.loading.splice(params.loading.indexOf(loadingUrl),1);delete params.operation[loadingUrl];delete params.action[loadingUrl];delete params['paramsscope-url'][loadingUrl];var index=params.reload.indexOf(loadingUrl);if(index>-1){status.reload=true;params.reload.splice(index,1);}
var lastPromise=t.mergingTemplatePromise;var dfd=$.Deferred();var thisPromise=dfd.promise();t.mergingTemplatePromise=thisPromise;if(lastPromise){lastPromise.done(function(){t.fetchBlockComplete(pageSection,block,params,status,options);});}
else{t.fetchBlockComplete(pageSection,block,params,status,options);}
dfd.resolve();}}));},fetchBlockComplete:function(pageSection,block,params,status,options){var t=this;block.children('.pop-disabledlayer').addClass('hidden');if(options['datasetcount-target']){t.displayDatasetCount(pageSection,block,$(options['datasetcount-target']),options['datasetcount-updatetitle']);}
if(!params.loading.length){var loading=block.find('.pop-loading');loading.addClass('hidden');}
var blockParams=t.getBlockParams(pageSection,block);if(blockParams[M.URLPARAM_STOPFETCHING]){block.addClass('pop-stopfetching');}
else{block.removeClass('pop-stopfetching');}
t.triggerEvent(pageSection,block,'fetchCompleted',[status]);},displayDatasetCount:function(pageSection,block,target,updateTitle){var t=this;var dataset=t.getBlockDataset(pageSection,block);if(dataset.length){var mode=target.data('datasetcount-mode')||'add';var count=dataset.length;if(mode=='add'){count+=target.text()?parseInt(target.text()):0;}
if(count){target.removeClass('hidden').text(count);if(updateTitle){document.title='('+count+') '+t.documentTitle;}}}},executeFetchBlockSuccess:function(pageSection,block,params,response,jqXHR){var t=this;var loadingUrl=params.url[jqXHR.url];var action=params.action[loadingUrl];var runtimeOptions={url:params['paramsscope-url'][loadingUrl]};var processOptions={operation:params.operation[loadingUrl],action:params.action[loadingUrl]};var memory=t.getMemory();var restoreinitial_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH,M.CBACTION_RESET];var restoreinitial=restoreinitial_actions.indexOf(action)>-1;if(restoreinitial){var initialMemory=t.getInitialBlockMemory(runtimeOptions.url);$.each(response.params,function(rpssId,rpsParams){$.each(rpsParams,function(rbsId,rbParams){memory.runtimesettings.configuration[rpssId][rbsId]=initialMemory.runtimesettings.configuration[rpssId][rbsId];});});}
t.integrateTopLevelFeedback(response);t.integrateDatabases(response);$.each(response.params,function(rpssId,rpsParams){var rPageSection=$('#'+memory.settings.configuration[rpssId].id);if(!memory.feedback.block[rpssId]){memory.feedback.block[rpssId]={};}
$.extend(memory.feedback.block[rpssId],response.feedback.block[rpssId]);if(!memory.dataset[rpssId]){memory.dataset[rpssId]={};}
$.extend(memory.dataset[rpssId],response.dataset[rpssId]);if(!memory.params[rpssId]){memory.params[rpssId]={};}
$.extend(memory.params[rpssId]);$.each(rpsParams,function(rbsId,rbParams){try{var rBlock=$('#'+t.getBlockId(rpssId,rbsId,runtimeOptions));$.extend(t.getBlockParams(rPageSection,rBlock,runtimeOptions),rbParams);var process_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH];if(process_actions.indexOf(action)>-1){var jsSettings=t.getJsSettings(rPageSection,rBlock);if(jsSettings['processblock-ifhasdata']&&!response.dataset[rpssId][rbsId].length){return;}}
t.processBlock(rPageSection,rBlock,processOptions);}
catch(err){}});});block.triggerHandler('fetched',[response,action]);},triggerEvent:function(pageSection,block,event,args){var t=this;block.triggerHandler(event,args);},integrateTopLevelFeedback:function(response){var t=this;var tlFeedback=t.getMemory().feedback.toplevel;$.each(response.feedback.toplevel,function(key,value){if($.type(value)=='array'&&value.length==0){}
else if($.type(value)=='object'){if(!tlFeedback[key]){tlFeedback[key]={};}
$.extend(tlFeedback[key],value);}
else{tlFeedback[key]=value;}});},clearUserDatabase:function(){var t=this;t.userdatabase={};},integrateDatabase:function(database,responsedb){var t=this;$.each(responsedb,function(dbKey,dbItems){database[dbKey]=database[dbKey]||{};if($.type(dbItems)=='array'){return;}
$.each(dbItems,function(key,value){if(!database[dbKey][key]){database[dbKey][key]={};}
$.extend(database[dbKey][key],value);});});},integrateDatabases:function(response){var t=this;t.integrateDatabase(t.database,response.database);t.integrateDatabase(t.userdatabase,response.userdatabase);},getMergeTargetContainer:function(target){var t=this;if(target.data('merge-container')){return $(target.data('merge-container'));}
return target;},getMergeTarget:function(target,templateName,options){var t=this;options=options||{};var selector='.pop-merge.'+templateName;var mergeTarget=options['merge-target']?$(options['merge-target']):target.find(selector).addBack(selector);return t.getMergeTargetContainer(mergeTarget);},generateUniqueId:function(){var t=this;var unique=Date.now();var tlFeedback=t.getTopLevelFeedback();tlFeedback[M.UNIQUEID]=unique;return unique;},getUniqueId:function(){var t=this;var tlFeedback=t.getTopLevelFeedback();return tlFeedback[M.UNIQUEID];},addUniqueId:function(url){var t=this;var unique=t.getUniqueId();return url+'#'+unique;},mergeTargetTemplate:function(pageSection,target,templateName,options){var t=this;options=options||{};var rerender_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH,M.CBACTION_RESET];var rerender=rerender_actions.indexOf(options.action)>-1;if(rerender){t.generateUniqueId();}
var html=t.getTemplateHtml(pageSection,target,templateName,options);var targetContainer=t.getMergeTarget(target,templateName,options);var operation=options.operation||M.URLPARAM_OPERATION_REPLACE;if(operation==M.URLPARAM_OPERATION_REPLACE){target.triggerHandler('replace',[options.action]);if(rerender){target.triggerHandler('rerender',[options.action]);}
targetContainer.empty();}
var merged=t.mergeHtml(html,targetContainer,operation);target.triggerHandler('merged',[merged.newDOMs]);return merged;},mergeHtml:function(html,container,operation){var t=this;var newDOMs=$(html);if(operation==M.URLPARAM_OPERATION_PREPEND){container.prepend(newDOMs);}
else if(operation==M.URLPARAM_OPERATION_REPLACEINLINE){container.replaceWith(newDOMs);container=newDOMs;}
else{container.append(newDOMs);}
t.triggerHTMLMerged();return{targetContainer:container,newDOMs:newDOMs};},triggerHTMLMerged:function(){var t=this;$(document).triggerHandler('template:merged');},renderPageSection:function(pageSection,options){var t=this;options=options||{};$.extend(options,t.getFetchPageSectionSettings(pageSection));var newDOMs=t.renderTarget(pageSection,pageSection,options);if(newDOMs.length){t.pageSectionRendered(pageSection,newDOMs,options);}},renderTarget:function(pageSection,target,options){var t=this;options=options||{};target.triggerHandler('beforeMerge',[options]);var templates_cbs=t.getTemplatesCbs(pageSection,target,options.action);var targetContainers=$();var newDOMs=$();$.each(templates_cbs,function(index,templateName){var merged=t.mergeTargetTemplate(pageSection,target,templateName,options);targetContainers=targetContainers.add(merged.targetContainer);newDOMs=newDOMs.add(merged.newDOMs);});t.triggerRendered(target,newDOMs,targetContainers);return newDOMs;},triggerRendered:function(target,newDOMs,targetContainers){var t=this;target.triggerHandler('rendered',[newDOMs,targetContainers]);$(document).triggerHandler('rendered',[target,newDOMs,targetContainers]);},getPageSectionConfiguration:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getMemory().settings.configuration[pssId];},getTargetConfiguration:function(pageSection,target,template){var t=this;var templatePath=t.getTemplatePath(pageSection,target,template);var targetConfiguration=t.getPageSectionConfiguration(pageSection);$.each(templatePath,function(index,pathLevel){targetConfiguration=targetConfiguration[pathLevel];});return targetConfiguration;},overrideFromItemObject:function(itemObject,override,overrideFields){var t=this;if(itemObject){$.each(overrideFields,function(index,overrideFromItemObject){override[overrideFromItemObject.key]=itemObject[overrideFromItemObject.field];});}},replaceFromItemObject:function(pssId,bsId,template,itemObject,override,strReplace){var t=this;var feedback=t.getTopLevelFeedback();var targetConfiguration=t.getTargetConfiguration(pssId,bsId,template);$.each(strReplace,function(index,replace){var replaceWhereField=replace['replace-where-field'];var replaceWherePath=replace['replace-where-path'];var replaceFromField=replace['replace-from-field']||replaceWhereField;var replacements=replace['replacements'];var replaceFrom=targetConfiguration[replaceFromField];$.each(replacements,function(index,replacement){var replaceStr=replacement['replace-str'];if(itemObject){var replaceWithField=replacement['replace-with-field'];if(replaceWithField&&replaceStr!=itemObject[replaceWithField]){var replaceWith=itemObject[replaceWithField];if(replacement['encode-uri-component']){replaceWith=encodeURIComponent(replaceWith);}
else if(replacement['encode-uri']){replaceWith=encodeURI(replaceWith);}
replaceFrom=replaceFrom.replace(new RegExp(replaceStr,'g'),replaceWith);}}
var replaceFromFeedback=replacement['replace-from-feedback'];if(replaceFromFeedback&&replaceStr!=feedback[replaceFromFeedback]){replaceFrom=replaceFrom.replace(new RegExp(replaceStr,'g'),feedback[replaceFromFeedback]);}});var overrideWhere=override;if(replaceWherePath){$.each(replaceWherePath,function(index,pathlevel){overrideWhere[pathlevel]={};overrideWhere=overrideWhere[pathlevel];});}
overrideWhere[replaceWhereField]=replaceFrom;});},getTemplateHtml:function(pageSection,target,templateName,options,itemDBKey,itemObjectId){var t=this;var targetConfiguration=t.getTargetConfiguration(pageSection,target,templateName);options=options||{};targetContext=targetConfiguration;var templatePath=t.getTemplatePath(pageSection,target,templateName);if(templatePath.length){var block=t.getBlock(target);t.initContextSettings(pageSection,block,targetContext);t.extendContext(targetContext,itemDBKey,itemObjectId);}
var extendContext=options.extendContext;if(extendContext){targetContext=$.extend({},targetContext,extendContext);}
return t.getHtml(templateName,targetContext);},extendContext:function(context,itemDBKey,itemObjectId,override){var t=this;override=override||{};$.extend(context,override);if(itemDBKey){$.extend(context,{itemDBKey:itemDBKey});if(itemObjectId){var itemObject=t.getItemObject(itemDBKey,itemObjectId);$.extend(context,{itemObject:itemObject});}}},initTopLevelJson:function(){var t=this;var jsonHtml=$('#'+popPageSectionManager.getTopLevelSettingsId());var json=$.parseJSON(jsonHtml.html());t.database=json.database;t.userdatabase=json.userdatabase;var memory=t.getMemory();memory.settings=json.settings;memory.runtimesettings=json.runtimesettings;memory.dataset=json.dataset;memory.feedback=json.feedback;memory.params=json.params;$.each(memory.dataset,function(pssId,psDataset){if($.type(psDataset)=='array'){memory.dataset[pssId]={};}});$.each(memory.params,function(pssId,psParams){if($.type(psParams)=='array'){memory.params[pssId]={};}});$.each(memory.feedback.pagesection,function(pssId,psFeedback){if($.type(psFeedback)=='array'){memory.feedback.pagesection[pssId]={};}});$.each(memory.feedback.block,function(pssId,bFeedback){if($.type(bFeedback)=='array'){memory.feedback.block[pssId]={};}});t.saveUrlPointers(json);t.addReplicableMemory(json);t.addInitialBlockMemory(json);},getBlockDefaultParams:function(){var t=this;return{url:[],loading:[],reload:[],operation:{},action:{},'paramsscope-url':{},'post-data':'',filter:''};},getPageSectionDefaultParams:function(){var t=this;return{url:[],loading:[]};},initPageSectionRuntimeMemory:function(pageSection,options){var t=this;var runtimeMempage=t.newRuntimeMemoryPage(pageSection,pageSection,options);var pssId=t.getSettingsId(pageSection);runtimeMempage.params=t.getPageSectionDefaultParams();var args={pageSection:pageSection,runtimeMempage:runtimeMempage};popJSLibraryManager.execute('initPageSectionRuntimeMemory',args);},initBlockRuntimeMemory:function(pageSection,block,options){var t=this;var runtimeMempage=t.newRuntimeMemoryPage(pageSection,block,options);var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);runtimeMempage.params=$.extend(t.getBlockDefaultParams(),t.getMemory().params[pssId][bsId]);runtimeMempage['query-url']=t.getRuntimeSettings(pageSection,block,'query-url');runtimeMempage.id=block.attr('id');var args={pageSection:pageSection,block:block,runtimeMempage:runtimeMempage};popJSLibraryManager.execute('initBlockRuntimeMemory',args);},getViewport:function(pageSection,el){var t=this;var viewport=el.closest('.pop-viewport');if(viewport.length){return viewport;}
return pageSection;},getDOMContainer:function(pageSection,el){var t=this;if(M.DOMCONTAINER_ID){return $('#'+M.DOMCONTAINER_ID);}
return t.getViewport(pageSection,el);},getBlock:function(el){var t=this;if(el.hasClass('pop-block')){return el;}
if(el.closest('.pop-block').length){return el.closest('.pop-block');}
if(el.closest('[data-block]').length){return $(el.closest('[data-block]').data('block'));}
return null;},isBlockGroup:function(block){var t=this;return block.hasClass('pop-blockgroup');},getBlockGroupActiveBlock:function(blockGroup){var t=this;return blockGroup.find('.tab-pane.active .pop-block, .collapse.in .pop-block');},getBlockGroupBlocks:function(blockGroup){var t=this;return blockGroup.find('.pop-block');},getTemplateSource:function(template){var t=this;return t.getMemory().settings['template-sources'][template]||template;},initPageSectionSettings:function(pageSection,psConfiguration){var t=this;var tls=t.getTopLevelSettings();$.extend(psConfiguration,{tls:tls});var pss=t.getPageSectionSettings(pageSection);var pssId=t.getSettingsId(pageSection);var psId=psConfiguration[M.JS_FRONTENDID];$.extend(psConfiguration,{pss:pss});t.expandJSKeys(psConfiguration);if(psConfiguration[M.JS_MODULES]){$.each(psConfiguration[M.JS_MODULES],function(bsId,bConfiguration){var bId=bConfiguration[M.JS_FRONTENDID];var bs=t.getBlockSettings(pssId,bsId,psId,bId);$.extend(bConfiguration,{tls:tls,pss:pss,bs:bs});t.expandJSKeys(bConfiguration);});}},initContextSettings:function(pageSection,block,context){var t=this;var tls=t.getTopLevelSettings();$.extend(context,{tls:tls});var pss=t.getPageSectionSettings(pageSection);$.extend(context,{pss:pss});var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');var bsId=t.getSettingsId(block);var bId=block.attr('id');var bs=t.getBlockSettings(pssId,bsId,psId,bId);$.extend(context,{pss:pss,bs:bs});t.expandJSKeys(context);if(!context.itemDBKey){context.itemDBKey=bs['db-keys']['db-key'];}},integratePageSection:function(response){var t=this;var memory=t.getMemory();$.extend(memory.settings['template-sources'],response.settings['template-sources']);$.each(response.settings.configuration,function(pssId,rpsConfiguration){$.extend(memory.params[pssId],response.params[pssId]);$.extend(memory.dataset[pssId],response.dataset[pssId]);$.extend(memory.feedback.pagesection[pssId],response.feedback.pagesection[pssId]);$.extend(memory.feedback.block[pssId],response.feedback.block[pssId]);$.extend(memory.runtimesettings['query-url'][pssId],response.runtimesettings['query-url'][pssId]);$.extend(memory.runtimesettings.configuration[pssId],response.runtimesettings.configuration[pssId]);$.extend(memory.settings['js-settings'][pssId],response.settings['js-settings'][pssId]);$.extend(memory.settings.jsmethods.pagesection[pssId],response.settings.jsmethods.pagesection[pssId]);$.extend(memory.settings.jsmethods.block[pssId],response.settings.jsmethods.block[pssId]);$.extend(memory.settings['templates-cbs'][pssId],response.settings['templates-cbs'][pssId]);$.extend(memory.settings['templates-paths'][pssId],response.settings['templates-paths'][pssId]);$.extend(memory.settings['db-keys'][pssId],response.settings['db-keys'][pssId]);if(!memory.settings.configuration[pssId]){memory.settings.configuration[pssId]={};}
var psConfiguration=memory.settings.configuration[pssId];$.each(rpsConfiguration,function(key,value){if($.type(value)=='array'){psConfiguration[key]={};}
else if($.type(value)=='object'){if(!psConfiguration[key]){psConfiguration[key]={};}
$.extend(psConfiguration[key],value);}
else{psConfiguration[key]=value;}});var psId=rpsConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);t.initPageSectionSettings(pageSection,psConfiguration);});},getTopLevelSettings:function(){var t=this;return{feedback:t.getTopLevelFeedback()};},getPageSectionSettings:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');var pageSectionSettings={feedback:t.getPageSectionFeedback(pageSection),pssId:pssId,psId:psId};return pageSectionSettings;},getBlockSettings:function(pssId,bsId,psId,bId){var t=this;var blockSettings={"db-keys":t.getDatabaseKeys(pssId,bsId),dataset:t.getBlockDataset(pssId,bsId),feedback:t.getBlockFeedback(pssId,bsId),bsId:bsId,bId:bId,};t.expandBlockSettingsJSKeys(blockSettings);return blockSettings;},expandBlockSettingsJSKeys:function(blockSettings){var t=this;if(blockSettings&&M.COMPACT_JS_KEYS){if(blockSettings['db-keys']&&blockSettings['db-keys'][M.JS_SUBCOMPONENTS]){blockSettings['db-keys'].subcomponents=blockSettings['db-keys'][M.JS_SUBCOMPONENTS];}}},getBlockDataset:function(pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);return t.getMemory().dataset[pssId][bsId];},getBlockFeedback:function(pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);return t.getMemory().feedback.block[pssId][bsId];},getPageSectionFeedback:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getMemory().feedback.pagesection[pssId];},getTopLevelFeedback:function(){var t=this;return t.getMemory().feedback.toplevel;},getSettings:function(pageSection,target,item){var t=this;var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);var memory=t.getMemory();return memory.settings[item][pssId][targetId];},getRuntimeSettings:function(pageSection,target,item){var t=this;var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);var memory=t.getMemory();return memory.runtimesettings[item][pssId][targetId];},getQueryUrl:function(pageSection,block){var t=this;return t.getRuntimeMemoryPage(pageSection,block)['query-url'];},getRuntimeConfiguration:function(pageSection,block,el){var t=this;el=el||block;var elsId=t.getTemplateOrObjectSettingsId(el);var configuration=t.getRuntimeSettings(pageSection,block,'configuration');return configuration[elsId]||{};},getDatabaseKeys:function(pageSection,block){var t=this;return t.getSettings(pageSection,block,'db-keys');},getBlockFilteringUrl:function(pageSection,block,use_pageurl){var t=this;var url=t.getQueryUrl(pageSection,block);if(!url&&use_pageurl){url=window.location.href;}
var post_data=t.getBlockPostData(pageSection,block,{paramsGroup:'visible'});if(post_data){if(url.indexOf('?')>-1){url+='&';}
else{url+='?';}
url+=post_data;}
return url;},click:function(url,container){var t=this;container=container||$('body');var linkHtml='<a href="'+url+'" class="hidden"></a>';var link=$(linkHtml).appendTo(container);link.trigger('click');},getUnembedUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getUnembedUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getEmbedUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getEmbedUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getPrintUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getPrintUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getDestroyUrl:function(url){var t=this;var domain=M.HOME_URL;$.each(M.ALLOWED_URLS,function(index,allowed){if(url.startsWith(allowed)){domain=allowed;return-1;}});return url.replace(domain,domain+'/destroy');},getTemplateOrObjectSettingsId:function(el){var t=this;if($.type(el)=='object'){return el.data('templateid');}
return el;},getPageSectionJsSettings:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getSettings(pageSection,pageSection,'js-settings')||{};},getJsSettings:function(pageSection,block,el){var t=this;el=el||block;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var jsSettingsId=t.getTemplateOrObjectSettingsId(el);var settings=t.getSettings(pageSection,block,'js-settings');return settings[jsSettingsId]||{};},getPageSectionJsMethods:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);var memory=t.getMemory();return memory.settings['jsmethods']['pagesection'][pssId]||{};},getBlockJsMethods:function(pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var memory=t.getMemory();return memory.settings['jsmethods']['block'][pssId][bsId]||{};},restoreInitialBlockMemory:function(pageSection,block,options){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var url=block.data('paramsscope-url');var initialMemory=t.getInitialBlockMemory(url);t.getRuntimeMemoryPage(pageSection,block,options).params=$.extend(t.getBlockDefaultParams(),initialMemory.params[pssId][bsId]);t.getMemory().runtimesettings.configuration[pssId][bsId]=$.extend({},initialMemory.runtimesettings.configuration[pssId][bsId]);t.getMemory().feedback.block[pssId][bsId]=$.extend({},initialMemory.feedback.block[pssId][bsId]);var dataset=initialMemory.dataset[pssId][bsId];if(dataset.length){$.extend(t.getMemory().dataset[pssId][bsId],dataset);}
else{t.getMemory().dataset[pssId][bsId]=[];}},getBlockParams:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options).params;},getPageSectionParams:function(pageSection,options){var t=this;return t.getRuntimeMemoryPage(pageSection,pageSection,options).params;},getTarget:function(pageSection){var t=this;var id=pageSection.attr('id');var ret=M.URLPARAM_TARGET_MAIN;$.each(M.FETCHTARGET_SETTINGS,function(target,psId){if(psId==id){ret=target;return-1;}});return ret;},targetExists:function(target){var t=this;return M.FETCHTARGET_SETTINGS[target];},getFetchTargetPageSection:function(target){var t=this;if(!target||target=='_self'||!M.FETCHTARGET_SETTINGS[target]){target=M.URLPARAM_TARGET_MAIN;}
return $('#'+M.FETCHTARGET_SETTINGS[target]);},getFetchPageSectionSettings:function(pageSection){var t=this;var psId=pageSection.attr('id');return M.FETCHPAGESECTION_SETTINGS[psId]||{};},getTemplatesCbs:function(pageSection,target,action){var t=this;action=action||'main';var templatesCbs=t.getSettings(pageSection,target,'templates-cbs');var cbs=templatesCbs.cbs;var actions=templatesCbs.actions;if($.isArray(actions)&&!actions.length){return cbs;}
var allowed=[];$.each(cbs,function(index,cb){if(!actions[cb]||actions[cb].indexOf(action)>-1){allowed.push(cb);}});return allowed;},getTemplatePath:function(pageSection,target,template){var t=this;var templatePaths=t.getSettings(pageSection,target,'templates-paths');return templatePaths[template];},getScriptTemplate:function(templateName){var t=this;var templateSource=t.getTemplateSource(templateName);return Handlebars.templates[templateSource];},getPageSectionGroup:function(elem){var t=this;return elem.closest('.pop-pagesection-group').addBack('.pop-pagesection-group');},getPageSection:function(elem){var t=this;return elem.closest('.pop-pagesection').addBack('.pop-pagesection');},getPageSectionPage:function(elem){var t=this;var page=elem.closest('.pop-pagesection-page').addBack('.pop-pagesection-page');if(page.length){return page;}
return t.getPageSection(elem);},getBlockId:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options).id;},getHtml:function(templateName,context){var t=this;var template=t.getScriptTemplate(templateName);if(typeof template=='undefined'){console.error('No template for '+templateName);return'';}
return template(context);},getItemObject:function(itemDBKey,itemObjectId){var t=this;var userItem={},item={};if(t.userdatabase[itemDBKey]&&t.userdatabase[itemDBKey][itemObjectId]){userItem=t.userdatabase[itemDBKey][itemObjectId];}
if(t.database[itemDBKey]&&t.database[itemDBKey][itemObjectId]){item=t.database[itemDBKey][itemObjectId];}
return $.extend({},userItem,item);},getFrameTarget:function(pageSection){var t=this;return pageSection.data('frametarget')||M.URLPARAM_TARGET_MAIN;},getClickFrameTarget:function(pageSection){var t=this;return pageSection.data('clickframetarget')||t.getFrameTarget(pageSection);},getOriginalLink:function(link){var t=this;var intercepted=link.data('interceptedTarget');if(intercepted){return t.getOriginalLink(intercepted);}
return link;},};})(jQuery);