Handlebars.registerHelper('showmore',function(str,options){var len=options.hash.len||0;if(len>0&&str.length>len+100){var delim="</p>";var total_len=len;var morelink='<a href="#" class="pop-showmore-more">'+M.STRING_MORE+'</a>';var lesslink='<a href="#" class="pop-showmore-less hidden">'+M.STRING_LESS+'</a>';var moreless=false,add_morelink=true;if((str.length>total_len)&&(str.substr(len).indexOf(delim)>-1)){moreless=true;add_morelink=false;str=str.substr(0,len)+'<span class="pop-showmore-more-full hidden">'+
str.substr(len,str.substr(len).indexOf(delim))+'</span> '+
morelink+
str.substr(len+str.substr(len).indexOf(delim));total_len=len+str.substr(len).indexOf(delim)+delim.length;}
if(moreless||(str.length>total_len)){var str_end=str.substr(total_len);var has_endstr=str_end.trim().length;if(moreless||has_endstr){var str_beg=str.substr(0,total_len);var str_new='<span class="pop-showmore-more-teaser">'+str_beg+'</span>'+
(has_endstr?'<span class="pop-showmore-more-full hidden">'+str_end+'</span> ':' ')+
(add_morelink?morelink:'')+
lesslink;return new Handlebars.SafeString(str_new);}}}
return str;});Handlebars.registerHelper('ondate',function(date,options){return new Handlebars.SafeString(M.ONDATE.format(date));});Handlebars.registerHelper('addParam',function(url,param,value,options){if(!jQuery.isArray(value)){value=[value];}
jQuery.each(value,function(index,val){url=add_query_arg(param,val,url);});return url;});Handlebars.registerHelper('destroyUrl',function(url,options){return new Handlebars.SafeString(popManager.getDestroyUrl(url));});Handlebars.registerHelper('statusLabel',function(status,options){var ret='<span class="label '+M.STATUS.class[status]+' label-'+status+'">'+M.STATUS.text[status]+'</span>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('labelize',function(strings,label,options){var ret='',extra_class='';if(strings){for(var i=0;i<strings.length;i++){extra_class=M.LABELIZE_CLASSES[strings[i]]?M.LABELIZE_CLASSES[strings[i]]:'';ret+='<span class="label '+label+' '+extra_class+'">'+strings[i]+'</span> ';}}
return new Handlebars.SafeString(ret);});Handlebars.registerHelper('mod',function(lvalue,rvalue,options){if(arguments.length<3)
throw new Error("Handlebars Helper equal needs 2 parameters");offset=options.hash.offset||0;if((lvalue+offset)%rvalue===0){return options.fn(this);}else{return options.inverse(this);}});Handlebars.registerHelper('compare',function(lvalue,rvalue,options){if(arguments.length<3)
throw new Error("Handlerbars Helper 'compare' needs 2 parameters");var operator=options.hash.operator||"==";var operators={'eq':function(l,r){return l==r||l.toString()==r.toString();},'==':function(l,r){return l==r;},'===':function(l,r){return l===r;},'!=':function(l,r){return l!=r;},'<':function(l,r){return l<r;},'>':function(l,r){return l>r;},'<=':function(l,r){return l<=r;},'>=':function(l,r){return l>=r;},'typeof':function(l,r){return typeof l==r;},'in':function(l,r){return r.indexOf(l)>=0;},'notin':function(l,r){return r.indexOf(l)==-1;}}
if(!operators[operator])
throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);var result=operators[operator](lvalue,rvalue);if(result){return options.fn(this);}else{return options.inverse(this);}});Handlebars.registerHelper('get',function(db,index,options){if(typeof db=='undefined'||typeof db[index]=='undefined'){return'';}
return db[index];});Handlebars.registerHelper('ifget',function(db,index,options){if(typeof db=='undefined'){return'';}
var context=options.hash.context||this;var condition=false;if(options.hash.method){var executed=popJSLibraryManager.execute(options.hash.method,{domain:context.tls.domain,input:db[index]});jQuery.each(executed,function(index,value){if(value){condition=true;return-1;}});}
else{condition=db[index];}
if(condition){return options.fn(this);}
else{return options.inverse(this);}});Handlebars.registerHelper('withget',function(db,index,options){if(typeof db=='undefined'||typeof db[index]=='undefined'){return'';}
var context=db[index];if(jQuery.type(context)==='object'){popManager.expandJSKeys(context);}
return options.fn(context);});Handlebars.registerHelper('interceptAttr',function(options){var context=options.hash.context||this;var intercept=context[M.JS_INTERCEPT]||{};return new Handlebars.SafeString((intercept[M.JS_TYPE]?' data-intercept="'+intercept[M.JS_TYPE]+'"':'')+(intercept.settings?' data-intercept-settings="'+intercept[M.JS_SETTINGS]+'"':'')+(intercept[M.JS_TARGET]?' target="'+intercept[M.JS_TARGET]+'"':'')+(intercept[M.JS_SKIPSTATEUPDATE]?' data-intercept-skipstateupdate="true"':'')+' style="display: none;"');});Handlebars.registerHelper('generateId',function(options){var context=options.hash.context||this;var pssId=options.hash.pssId||context.pss.pssId;var targetId=options.hash.targetId||context.bs.bsId;var template=options.hash.template||context[M.JS_TEMPLATE];var fixed=options.hash.fixed||context[M.JS_FIXEDID];var isIdUnique=options.hash.idUnique||context[M.JS_ISIDUNIQUE];var group=options.hash.group;var id=options.fn(this);var ignorePSRuntimeId=context.ignorePSRuntimeId;var domain=context.tls.domain;var url=options.hash.addURL?context.tls.feedback[M.URLPARAM_URL]:'';if(url){popJSRuntimeManager.setBlockURL(url);}
var generatedId=popJSRuntimeManager.addTemplateId(domain,pssId,targetId,template,id,group,fixed,isIdUnique,ignorePSRuntimeId);var items=[];items.push('id="'+generatedId+'"');items.push('data-templateid="'+template+'"');if(url){items.push('data-'+M.PARAMS_TOPLEVEL_URL+'="'+url+'"');items.push('data-'+M.PARAMS_TOPLEVEL_DOMAIN+'="'+getDomain(url)+'"');}
return new Handlebars.SafeString(items.join(' '));});Handlebars.registerHelper('lastGeneratedId',function(options){var context=options.hash.context||this;var pssId=options.hash.pssId||context.pss.pssId;var targetId=options.hash.targetId||context.bs.bsId;var template=options.hash.template||context[M.JS_TEMPLATE];var domain=options.hash.domain||context.tls.domain;var group=options.hash.group;return popJSRuntimeManager.getLastGeneratedId(domain,pssId,targetId,template,group);});Handlebars.registerHelper('applyLightTemplate',function(template,options){var context=options.hash.context||this;var response=popManager.getHtml(template,context);return new Handlebars.SafeString(response);});Handlebars.registerHelper('json',function(context){return JSON.stringify(context);});Handlebars.registerHelper('enterModule',function(prevContext,options){var context=options.hash.context||this;var templateName=options.hash.template||context[M.JS_TEMPLATE];var tls=prevContext.tls;var pss=prevContext.pss;var bs=prevContext.bs;var itemObject=prevContext.itemObject;var itemObjectDBKey=prevContext.itemObjectDBKey;var ignorePSRuntimeId=prevContext.ignorePSRuntimeId;var itemDBKey=(typeof options.hash.itemDBKey!='undefined')?options.hash.itemDBKey:prevContext.itemDBKey;var items=(typeof options.hash.items!='undefined')?options.hash.items:prevContext.items;var extend={itemObject:itemObject,itemObjectDBKey:itemObjectDBKey,itemDBKey:itemDBKey,items:items,tls:tls,pss:pss,bs:bs,ignorePSRuntimeId:ignorePSRuntimeId};var domain=tls.domain;var pssId=pss.pssId;var psId=pss.psId;var bsId=bs.bsId;var bId=bs.bId;jQuery.extend(context,popManager.getRuntimeConfiguration(domain,pssId,bsId,templateName));popManager.expandJSKeys(context);var itemObjectId=options.hash.itemObjectId;if(jQuery.type(itemObjectId)==="array"){if(itemObjectId.length){itemObjectId=itemObjectId[0];}
else{itemObjectId=null;itemObject=null;extend.itemObject=itemObject;}}
if(options.hash.itemDBKey&&itemObjectId){itemDBKey=options.hash.itemDBKey;itemObject=popManager.getItemObject(domain,itemDBKey,itemObjectId);extend.itemObject=itemObject;extend.itemObjectDBKey=itemDBKey;extend.itemDBKey=itemDBKey;extend.items=[itemObjectId];}
else if(options.hash.itemDBKey&&options.hash.items){extend.itemDBKey=options.hash.itemDBKey;extend.items=options.hash.items;}
else if(options.hash.subcomponent&&itemObjectId){itemDBKey=bs['db-keys'][M.JS_SUBCOMPONENTS][options.hash.subcomponent]['db-key'];itemObject=popManager.getItemObject(domain,itemDBKey,itemObjectId);extend.itemObject=itemObject;extend.itemObjectDBKey=itemDBKey;extend.itemDBKey=itemDBKey;extend.items=[itemObjectId];}
else if(options.hash.subcomponent&&options.hash.items){itemDBKey=bs['db-keys'][M.JS_SUBCOMPONENTS][options.hash.subcomponent]['db-key'];extend.itemDBKey=itemDBKey;extend.items=options.hash.items;}
else if(options.hash.items){extend.items=options.hash.items;}
else if(options.hash.itemDBKey){extend.itemDBKey=options.hash.itemDBKey;extend.itemObject=null;extend.itemObjectDBKey=null;extend.items=null;}
if(extend.items){if(jQuery.type(extend.items)!=="array"){extend.items=[extend.items];}}
if(options.hash['feedback-msg']){extend['feedback-msg']=options.hash['feedback-msg'];}
var overrideFields=[],staticStrReplace=[],runtimeStrReplace=[];if(context[M.JS_MODULEOPTIONS]){overrideFields=context[M.JS_MODULEOPTIONS][M.JS_OVERRIDEFROMITEMOBJECT]||[];staticStrReplace=context[M.JS_MODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[];}
if(context[M.JS_RUNTIMEMODULEOPTIONS]){runtimeStrReplace=context[M.JS_RUNTIMEMODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[];}
if(overrideFields.length){popManager.overrideFromItemObject(itemObject,extend,overrideFields);}
var strReplace=staticStrReplace.concat(runtimeStrReplace);if(strReplace.length){popManager.replaceFromItemObject(domain,pssId,bsId,templateName,itemObject,extend,strReplace);}
var parentContext=options.hash.parentContext||{};if(parentContext){extend['parent-context']=parentContext;var rootContext=parentContext;while(rootContext['parent-context']){rootContext=rootContext['parent-context'];}
extend['root-context']=rootContext;}
jQuery.extend(context,extend);var response=popManager.getHtml(templateName,context);if(options.hash.unsafe){return response;}
return new Handlebars.SafeString(response);});function getMultiLayoutKey(itemDBKey,itemObject){var keyFields=M.MULTILAYOUT_KEYFIELDS[itemDBKey]||[];if(!keyFields.length){return'default';}
var keyParts=[];jQuery.each(keyFields,function(index,field){keyParts.push(itemObject[field]);});return keyParts.join('-');}
Handlebars.registerHelper('withLayout',function(itemDBKey,itemObjectId,multipleLayouts,context,options){var tls=context.tls;var domain=tls.domain;var itemObject=popManager.getItemObject(domain,itemDBKey,itemObjectId);var key=getMultiLayoutKey(itemDBKey,itemObject);var layout=multipleLayouts[key];if(!layout){layout=multipleLayouts['default'];}
if(!layout){return'';}
var layoutContext=context[M.JS_MODULES][layout];jQuery.extend(layoutContext,{itemDBKey:itemDBKey,itemObjectId:itemObjectId});popManager.expandJSKeys(layoutContext);return options.fn(layoutContext);});Handlebars.registerHelper('layoutLabel',function(itemDBKey,itemObject,options){var key=getMultiLayoutKey(itemDBKey,itemObject);return M.MULTILAYOUT_LABELS[key]||'';});Handlebars.registerHelper('withBlock',function(context,blockSettingsId,options){if(typeof context=='undefined'||typeof context[M.JS_MODULES]=='undefined'||typeof context[M.JS_MODULES][blockSettingsId]=='undefined'){return;}
context=context[M.JS_MODULES][blockSettingsId];popManager.expandJSKeys(context);return options.fn(context);});Handlebars.registerHelper('withModule',function(context,module,options){if(typeof context=='undefined'||typeof context[M.JS_SETTINGSIDS]=='undefined'||typeof context[M.JS_SETTINGSIDS][module]=='undefined'){return;}
var moduleSettingsId=context[M.JS_SETTINGSIDS][module];if(typeof context[M.JS_MODULES]=='undefined'||typeof context[M.JS_MODULES][moduleSettingsId]=='undefined'){return;}
context=context[M.JS_MODULES][moduleSettingsId];popManager.expandJSKeys(context);jQuery.extend(context,options.hash);return options.fn(context);});Handlebars.registerHelper('withSublevel',function(sublevel,options){var context=options.hash.context||this;if(jQuery.type(context)==='object'){popManager.expandJSKeys(context);}
return options.fn(context[sublevel]);});Handlebars.registerHelper('withItemObject',function(itemDBKey,itemObjectId,options){var context=options.hash.context||this;var tls=context.tls;var domain=tls.domain;var context=popManager.getItemObject(domain,itemDBKey,itemObjectId);return options.fn(context);});Handlebars.registerHelper('join',function(items,block){var delimiter=block.hash.delimiter||",",start=start=block.hash.start||0,len=items?items.length:0,end=block.hash.end||len,out="";if(end>len)end=len;if('function'===typeof block){for(i=start;i<end;i++){if(i>start)out+=delimiter;if('string'===typeof items[i])
out+=items[i];else
out+=block(items[i]);}
return out;}else{return[].concat(items).slice(start,end).join(delimiter);}});;function getDomain(url){var arr=url.split("/");return arr[0]+"//"+arr[2];}
function removeScheme(domain){var arr=domain.split("//");return arr.length==1?arr[0]:arr[1];}
function getDomainId(domain){return removeScheme(domain).replace(/\./g,'-');}
function unescapeHtml(unsafe){var d=document.createElement("div");d.innerHTML=unsafe;return d.innerText||d.text||d.textContent;}
function add_query_arg(key,value,url){url+=(url.split('?')[1]?'&':'?')+key+'='+value;return url;}
var removeQueryFields=function(url,args){if(!args.length){return url;}
var fields=args.join('|'),parts=url.split(new RegExp('[&?]('+fields+')=[^&]*')),length=parts.length-1;return parts[0]+(length?parts[length].slice(1):'');}
function removeParams(url){if(url.indexOf('?')>-1){return url.substr(0,url.indexOf('?'));}
return url;}
function getParams(url){if(url.indexOf('?')>-1){var params=url.substr(url.indexOf('?')+1);if(params.indexOf('#')>-1){params=params.substr(0,params.indexOf('#'));}
return params;}
return'';}
var urlParams={};function getParam(key,url){var params;if(url){params=getParams(url);}
else{params=window.location.search.substring(1);}
var paramsObj=splitUrlParams(params);return paramsObj[key];}
function splitUrlParams(params){if(typeof urlParams[params]!='undefined'){return urlParams[params];}
urlParams[params]=jQuery.extend({},splitParams(params));return urlParams[params];}
function splitParams(params){var splitParams={};var e,d=function(s){return decodeURIComponent(s).replace(/\+/g," ");},q=decodeURI(params),r=/([^&=]+)=?([^&]*)/g;while(e=r.exec(q)){if(e[1].indexOf("[")=="-1")
splitParams[d(e[1])]=d(e[2]);else{var b1=e[1].indexOf("["),aN=e[1].slice(b1+1,e[1].indexOf("]",b1)),pN=d(e[1].slice(0,b1));if(typeof splitParams[pN]!="object"){splitParams[d(pN)]={};}
if(aN)
splitParams[d(pN)][d(aN)]=d(e[2]);else
Array.prototype.push.call(splitParams[d(pN)],d(e[2]));}}
return splitParams;}
function searchInObject(obj,value){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){if(obj[key]==value){return true;}}}
return false;};function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1)+min);}
function doScroll(elem,animate){animate=animate||false;var top=elem.offset().top-20;if(animate){jQuery('html, body').animate({scrollTop:top});}
else{window.scrollTo(0,top);}}
function removeMarker(url){if(url.indexOf('#')>-1){return url.substr(0,url.indexOf('#'));}
return url;}
var counter=0;function counterNext(){counter++;return counter;}
function windowResize(){var evt=document.createEvent('UIEvents');evt.initUIEvent('resize',true,false,window,0);window.dispatchEvent(evt);}
function isUrlValid(url){return /^(https?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);}
function beep(){var snd=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");snd.play();}
function supports_html5_storage(){try{return'localStorage'in window&&window['localStorage']!==null;}catch(e){return false;}};if(!String.prototype.format){String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});};}
if(typeof String.prototype.startsWith!='function'){String.prototype.startsWith=function(str){return this.indexOf(str)==0;};}
if(!Array.prototype.some)
{Array.prototype.some=function(fun)
{var len=this.length;if(typeof fun!="function")
throw new TypeError();var thisp=arguments[1];for(var i=0;i<len;i++)
{if(i in this&&fun.call(thisp,this[i],i,this))
return true;}
return false;};}
if(!Array.prototype.filter)
{Array.prototype.filter=function(fun)
{var len=this.length;if(typeof fun!="function")
throw new TypeError();var res=new Array();var thisp=arguments[1];for(var i=0;i<len;i++)
{if(i in this)
{var val=this[i];if(fun.call(thisp,val,i,this))
res.push(val);}}
return res;};}
if(!Date.now){Date.now=function(){return new Date().getTime();}};(function($){popJSLibraryManager={libraries:[],methods:{},register:function(library,methods,highPriority,override){var t=this;t.libraries.push(library);$.each(methods,function(index,method){if(!t.methods[method]||override){t.methods[method]=[];}
if(highPriority){t.methods[method].unshift(library);}
else{t.methods[method].push(library);}})},getLibraries:function(method){var t=this;return t.methods[method]||[];},execute:function(method,args){var t=this;var ret={};var libraries=t.methods[method];if(libraries){$.each(libraries,function(index,library){ret['l'+index]=library[method](args);});}
return ret;}};})(jQuery);;(function($){popJSRuntimeManager={'full-session-ids':{},'last-session-ids':{},blockURL:null,pageSectionURL:'general',setBlockURL:function(blockOrURL){var t=this;var url='';if($.type(blockOrURL)=='object'){var block=blockOrURL;url=popManager.getBlockTopLevelURL(block);}
else{url=blockOrURL;}
t.blockURL=url;},initBlockVarPaths:function(vars,url,domain,pssId,targetId,template,group){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;if(!vars[url]){vars[url]={};}
if(!vars[url][domain]){vars[url][domain]={};}
if(!vars[url][domain][pssId]){vars[url][domain][pssId]={};}
if(!vars[url][domain][pssId][targetId]){vars[url][domain][pssId][targetId]={};}
if(!vars[url][domain][pssId][targetId][template]){vars[url][domain][pssId][targetId][template]={};}
if(!vars[url][domain][pssId][targetId][template][group]){vars[url][domain][pssId][targetId][template][group]=[];}},initVars:function(url,domain,pssId,targetId,template,group){var t=this;t.initBlockVarPaths(t['full-session-ids'],url,domain,pssId,targetId,template,group);t.initBlockVarPaths(t['last-session-ids'],url,domain,pssId,targetId,template,group);},addGroup:function(id,group){var t=this;if(group){id+=M.ID_SEPARATOR+group;}
return id;},addPageSectionId:function(domain,pssId,template,id,group){var t=this;return t.addTemplateId(domain,pssId,pssId,template,id,group,true,true);},addTemplateId:function(domain,pssId,targetId,template,id,group,fixed,isIdUnique,ignorePSRuntimeId){var t=this;if(!isIdUnique){id+=popManager.getUniqueId(domain);}
if(!fixed){id+=M.ID_SEPARATOR+counterNext();}
id=t.addGroup(id,group);if(!ignorePSRuntimeId){t.addTargetId(t.pageSectionURL,domain,pssId,pssId,template,group,id);}
if(pssId!=targetId){t.addTargetId(t.blockURL,domain,pssId,targetId,template,group,id);}
return id;},addTargetId:function(url,domain,pssId,targetId,template,group,id){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;t.initVars(url,domain,pssId,targetId,template,group);t['full-session-ids'][url][domain][pssId][targetId][template][group].push(id);t['last-session-ids'][url][domain][pssId][targetId][template][group].push(id);return id;},getLastGeneratedId:function(domain,pssId,targetId,template,group){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;var url=(pssId==targetId)?t.pageSectionURL:t.blockURL;var ids=t['full-session-ids'][url][domain][pssId][targetId][template][group];return ids[ids.length-1];},getPageSectionSessionIds:function(domain,pageSection,session){var t=this;var url=t.pageSectionURL;return t.getTargetSessionIds(url,domain,pageSection,pageSection,session);},getBlockSessionIds:function(domain,pageSection,block,session){var t=this;var url=popManager.getBlockTopLevelURL(block);return t.getTargetSessionIds(url,domain,pageSection,block,session);},getTargetSessionIds:function(url,domain,pageSection,target,session){var t=this;var pssId=popManager.getSettingsId(pageSection);var targetId=popManager.getSettingsId(target);session=session||'last';if(t[session+'-session-ids'][url]&&t[session+'-session-ids'][url][domain]&&t[session+'-session-ids'][url][domain][pssId]){return t[session+'-session-ids'][url][domain][pssId][targetId];}
return null;},deletePageSectionLastSessionIds:function(domain,pageSection){var t=this;var pssId=popManager.getSettingsId(pageSection);var url=t.pageSectionURL;delete t['last-session-ids'][url][domain][pssId][pssId];if($.isEmptyObject(t['last-session-ids'][url][domain][pssId])){delete t['last-session-ids'][url][domain][pssId];if($.isEmptyObject(t['last-session-ids'][url][domain])){delete t['last-session-ids'][url][domain];if($.isEmptyObject(t['last-session-ids'][url])){delete t['last-session-ids'][url];}}}},deleteBlockLastSessionIds:function(domain,pageSection,block){var t=this;var pssId=popManager.getSettingsId(pageSection);var targetId=popManager.getSettingsId(block);var url=popManager.getBlockTopLevelURL(block);if(t['last-session-ids'][url]&&t['last-session-ids'][url][domain]&&t['last-session-ids'][url][domain][pssId]&&t['last-session-ids'][url][domain][pssId][targetId]){delete t['last-session-ids'][url][domain][pssId][targetId];if($.isEmptyObject(t['last-session-ids'][url][domain][pssId])){delete t['last-session-ids'][url][domain][pssId];if($.isEmptyObject(t['last-session-ids'][url][domain])){delete t['last-session-ids'][url][domain];if($.isEmptyObject(t['last-session-ids'][url])){delete t['last-session-ids'][url];}}}}},};})(jQuery);;function showTopNav(){popPageSectionManager.open(popPageSectionManager.getTopNav());}
function hideTopNav(){popPageSectionManager.close(popPageSectionManager.getTopNav());}
(function($){popPageSectionManager={offcanvasToggle:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var control=$(this);var mode=control.data('mode');var target=$(control.data('target'));var action=control.data('toggle');if(action=='offcanvas-open'){t.open(target,mode);}
else if(action=='offcanvas-close'){t.close(target,mode);}
else if(action=='offcanvas-toggle'){t.toggle(target,mode);}});},isHidden:function(args){var t=this;var targets=args.targets;var offcanvas=targets.closest('.offcanvas');return t.execIsHidden(offcanvas);},execIsHidden:function(offcanvas){var t=this;if(offcanvas.length){var classs=t.getOffcanvasActiveClass(offcanvas);return!t.getGroup(offcanvas).hasClass(classs);}
return false;},getOffcanvasActiveClass:function(offcanvas,mode){var t=this;var section=offcanvas.data('offcanvas');var ret='active-'+section;if(mode=='xs'){ret+='-xs';}
return ret;},open:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);group.addClass(classs);t.triggerStatus(offcanvas,mode,'opened');},close:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);group.removeClass(classs);t.triggerStatus(offcanvas,mode,'closed');},toggle:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);if(group.hasClass(classs)){t.close(offcanvas,mode);}
else{t.open(offcanvas,mode);}},triggerStatus:function(offcanvas,mode,status){var t=this;var group=t.getGroup(offcanvas);group.triggerHandler('on.bs.pagesection-group:pagesection-'+offcanvas.attr('id')+':'+status,[offcanvas,mode]);},getTopLevelSettingsId:function(){var t=this;return M.TEMPLATE_TOPLEVEL_SETTINGS_ID;},getPageSectionStatus:function(pageSection){var t=this;return $('#'+pageSection.attr('id')+'-status');},getGroup:function(offcanvas){var t=this;if(offcanvas){return offcanvas.closest('.pop-pagesection-group');}
return $('#'+M.TEMPLATE_PAGESECTIONGROUP_ID);},theater:function(theater){var t=this;var group=t.getGroup();t.transitionEndResize();if(theater){group.addClass('theater');group.triggerHandler('on.bs.pagesection:theater');}
else{group.removeClass('theater');group.triggerHandler('off.bs.pagesection:theater');}},isTheater:function(){var t=this;var group=t.getGroup();return group.hasClass('theater');},transitionEndResize:function(){var t=this;var offCanvasGroup=t.getGroup();offCanvasGroup.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){windowResize();});},enableShowHideTopNav:function(){var t=this;$(window).on('scroll:down',hideTopNav);$(window).on('scroll:up',showTopNav);},disableShowHideTopNav:function(){var t=this;$(window).off('scroll:down',hideTopNav);$(window).off('scroll:up',showTopNav);},getTopNav:function(){var t=this;var offCanvasGroup=t.getGroup();return offCanvasGroup.find('.offcanvas-topnav');},getOpenMode:function(pageSection){return pageSection.data('pagesection-openmode')||'automatic';}};})(jQuery);popJSLibraryManager.register(popPageSectionManager,['isHidden','offcanvasToggle'],true);;(function($){popBrowserHistory={loaded:false,documentInitialized:function(){var t=this;$(window).on("popstate",function(e){if(t.loaded){var url=t.removePushURLAtts(window.location.href);url=t.getApplicationURL(url);var options={skipPushState:true};if(popURLInterceptors.getInterceptors(url).length){popURLInterceptors.intercept(url,options);}
else{popManager.fetch(url,options);}}
else{t.loaded=true;}});},getApplicationURL:function(url){var t=this;var args={url:url};popJSLibraryManager.execute('modifyApplicationURL',args);url=args.url;return url;},addPushURLAtts:function(url){var t=this;var tlFeedback=popManager.getTopLevelFeedback(getDomain(url));$.each(tlFeedback[M.DATALOAD_PUSHURLATTS],function(key,value){url=add_query_arg(key,value,url);});return url;},removePushURLAtts:function(url){var t=this;var tlFeedback=popManager.getTopLevelFeedback(getDomain(url)),args=[];$.each(tlFeedback[M.DATALOAD_PUSHURLATTS],function(key,value){args.push(key);});return removeQueryFields(url,args);},pushState:function(url){var t=this;url=t.addPushURLAtts(url);var args={url:url};popJSLibraryManager.execute('modifyPushStateURL',args);url=args.url;history.pushState({url:url},'',url);t.loaded=true;},replaceState:function(url){var t=this;if(window.location.url==url){return;}
url=t.addPushURLAtts(url);history.replaceState({url:url},'',url);t.loaded=true;}};})(jQuery);popJSLibraryManager.register(popBrowserHistory,['documentInitialized'],true);;(function($){popURLInterceptors={'fullurl':{},'partialurl':{},pageSectionNewDOMsInitialized:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;newDOMs.find('[data-intercept="fullurl"]').addBack('[data-intercept="fullurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);if(!t.fullurl[target]){t.fullurl[target]={};}
if(!t.fullurl[target][url]){t.fullurl[target][url]=[];}
t.fullurl[target][url].push(id);});newDOMs.find('[data-intercept="partialurl"]').addBack('[data-intercept="partialurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);if(!t.partialurl[target]){t.partialurl[target]={};}
t.partialurl[target][id]=url;});},destroyTarget:function(args){var t=this;var pageSection=args.pageSection,destroyTarget=args.destroyTarget;destroyTarget.find('[data-intercept="fullurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);var interceptors=t.fullurl[target][url];if(interceptors){interceptors=interceptors.filter(function(interceptorId,pos){return id!=interceptorId});if(interceptors.length){t.fullurl[target][url]=interceptors;}
else{delete t.fullurl[target][url];}}});destroyTarget.find('[data-intercept="partialurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var target=t.getTarget(pageSection,interceptor);delete t.partialurl[target][id];});},getSettings:function(interceptor){var t=this;var settings=interceptor.data('intercept-settings')||'';settings=settings.split(M.SEPARATOR);return settings;},getTarget:function(pageSection,interceptor){var t=this;return interceptor.attr('target')||popManager.getFrameTarget(pageSection);},getUrl:function(interceptor){var t=this;return interceptor.data('intercept-url');},getFullUrlInterceptors:function(url,options){var t=this;var ret=[];options=options||{};var target=options.target||M.URLPARAM_TARGET_MAIN;var interceptors=t.fullurl;if(interceptors[target]){if(interceptors[target][url]){ret.push($('#'+interceptors[target][url].join(', #')));}
else{var noParamsUrl=removeParams(url);if(url!=noParamsUrl){if(interceptors[target][noParamsUrl]){var maybeInterceptors=$('#'+interceptors[target][noParamsUrl].join(', #')).filter('.pop-interceptor');if(maybeInterceptors.length){ret.push(maybeInterceptors);}}}}}
return ret;},getPartialUrlInterceptor:function(interceptUrl,options){var t=this;var interceptor=null;options=options||{};var target=options.target||M.URLPARAM_TARGET_MAIN;var interceptors=t.partialurl;if(target){var targetInterceptors=interceptors[target];if(targetInterceptors){$.each(targetInterceptors,function(id,url){if(interceptUrl.startsWith(url)){interceptor=$('#'+id);return false;}});}}
return interceptor;},getURLInterceptors:function(interceptUrl,options){var t=this;var ret=t.getFullUrlInterceptors(interceptUrl,options);var partialurl=t.getPartialUrlInterceptor(interceptUrl,options);if(partialurl){ret.push(partialurl);}
return ret;},getInterceptors:function(interceptUrl,options){var t=this;var ret=t.getURLInterceptors(interceptUrl,options);if(ret.length){return ret;}
var noMarkerUrl=removeMarker(interceptUrl);if(noMarkerUrl!=interceptUrl){ret=t.getURLInterceptors(noMarkerUrl,options);}
return ret;},intercept:function(interceptUrl,options){var t=this;var interceptor;options=options||{};var interceptors=t.getInterceptors(interceptUrl,options);if(interceptors.length){if(options.event){options.event.stopImmediatePropagation();}
$.each(interceptors,function(index,interceptor){var skip_state_update=interceptor.data('intercept-skipstateupdate')||options.skipstateupdate;if(!skip_state_update){if(!options.skipPushState){popBrowserHistory.pushState(interceptUrl);}
popManager.updateTitle(interceptor.data('title'));return-1;}});var interceptor_atts=options['interceptor-atts']||{};$.each(interceptors,function(index,interceptor){$.each(interceptor_atts,function(key,value){interceptor.data(key,value);});var relatedTarget=options.relatedTarget;interceptor.data('interceptedTarget',relatedTarget);var settings=t.getSettings(interceptor.parent());interceptor.data('original-url',interceptUrl);interceptor.data('post-data',getParams(interceptUrl));interceptor.trigger('click');});return true;}
return false;}};})(jQuery);popJSLibraryManager.register(popURLInterceptors,['destroyTarget','pageSectionNewDOMsInitialized'],true);;(function($){popManager={mergingTemplatePromise:false,state:{},sitemapping:{},runtimeMemory:{general:{},url:{}},initialBlockMemory:{},urlPointers:{},replicableMemory:{},firstLoad:{},documentTitle:null,domains:{},getMemory:function(domain){var t=this;return t.state[domain].memory;},getDatabase:function(domain){var t=this;return t.state[domain].database;},getUserDatabase:function(domain){var t=this;return t.state[domain].userdatabase;},getInitialBlockMemory:function(url){var t=this;if(url==M.INITIAL_URL){return t.initialBlockMemory[url];}
var storedUnder=t.urlPointers[url];if(storedUnder){return t.initialBlockMemory[storedUnder.url];}
return t.initialBlockMemory[url]||{};},addInitialBlockMemory:function(response){var t=this;var url=response.feedback.toplevel[M.URLPARAM_URL];if(!t.initialBlockMemory[url]){t.initialBlockMemory[url]={dataset:{},feedback:{block:{},},'query-state':{general:{},domain:{},},runtimesettings:{configuration:{}}};}
var initialMemory=t.initialBlockMemory[url];$.each(response.settings.configuration,function(pssId,rpsConfiguration){if(!initialMemory['query-state'].general[pssId]){initialMemory['query-state'].general[pssId]={};initialMemory['query-state'].domain[pssId]={};initialMemory.runtimesettings.configuration[pssId]={};initialMemory.dataset[pssId]={};initialMemory.feedback.block[pssId]={};}
$.extend(initialMemory['query-state'].general[pssId],response['query-state'].general[pssId]);$.extend(initialMemory['query-state'].domain[pssId],response['query-state'].domain[pssId]);$.extend(initialMemory.runtimesettings.configuration[pssId],response.runtimesettings.configuration[pssId]);$.extend(initialMemory.dataset[pssId],response.dataset[pssId]);$.extend(initialMemory.feedback.block[pssId],response.feedback.block[pssId]);});},getReplicableMemory:function(url,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var storedUnder=t.urlPointers[url];return t.replicableMemory[storedUnder.url][storedUnder.target];},saveUrlPointers:function(response,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var url=response.feedback.toplevel[M.URLPARAM_URL];$.each(response.feedback.pagesection,function(pssId,psFeedback){if(psFeedback['intercept-urls']){$.each(psFeedback['intercept-urls'],function(ipssId,iObject){$.each(iObject,function(ielemsId,iUrl){t.urlPointers[iUrl]={url:url,target:target};});});}});$.each(response.feedback.block,function(pssId,psFeedback){$.each(psFeedback,function(bsId,bFeedback){if(bFeedback['intercept-urls']){$.each(bFeedback['intercept-urls'],function(ibsId,iObject){$.each(iObject,function(ielemsId,iUrl){t.urlPointers[iUrl]={url:url,target:target};});});}});});},addReplicableMemory:function(response,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var hasreplicable=false;$.each(response.settings.configuration,function(pssId,psConfiguration){if(psConfiguration[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE].length){hasreplicable=true;return-1;}});if(hasreplicable){var url=response.feedback.toplevel[M.URLPARAM_URL];if(!t.replicableMemory[url]){t.replicableMemory[url]={};}
t.replicableMemory[url][target]={dataset:$.extend(true,{},response.dataset),feedback:$.extend(true,{},response.feedback),'query-state':$.extend(true,{},response['query-state'])}}},getRuntimeMemory:function(domain,pageSection,target,options){var t=this;options=options||{};var pageSectionPage=t.getPageSectionPage(target);var scope=pageSectionPage.data('paramsscope');if(scope==M.SETTINGS_PARAMSSCOPE_URL){var url=options.url||t.getTopLevelFeedback(domain)[M.URLPARAM_URL];if(!t.runtimeMemory.url[url]){t.runtimeMemory.url[url]={};}
target.data(M.PARAMS_PARAMSSCOPE_URL,url);return t.runtimeMemory.url[url];}
return t.runtimeMemory.general;},newRuntimeMemoryPage:function(domain,pageSection,target,options){var t=this;options=options||{};if(!options.url){var tlFeedback=t.getTopLevelFeedback(domain);options.url=tlFeedback[M.URLPARAM_URL];}
var mempage=t.getRuntimeMemory(domain,pageSection,target,options);var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);if(!mempage[pssId]){mempage[pssId]={};}
mempage[pssId][targetId]={'query-state':{general:{},domain:{},},id:null};return mempage[pssId][targetId];},deleteRuntimeMemoryPage:function(domain,pageSection,target,options){var t=this;var mempage=t.getRuntimeMemory(domain,pageSection,target,options);var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);if(mempage[pssId]){delete mempage[pssId][targetId];if($.isEmptyObject(mempage[pssId])){delete mempage[pssId];}}},getRuntimeMemoryPage:function(pageSection,targetOrId,options){var t=this;options=options||{};var mempage,url;if(options.url){url=options.url;}
else if($.type(targetOrId)=='object'){var target=targetOrId;url=t.getTargetParamsScopeURL(target);}
if(url){mempage=t.runtimeMemory.url[url];}
else{mempage=t.runtimeMemory.general;}
var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(targetOrId);if(!mempage[pssId]||!mempage[pssId][targetId]){var error="Mempage not available";if(url){error+=" for url "+url;}
throw new Error(error);}
return mempage[pssId][targetId];},isFirstLoad:function(pageSection){var t=this;return t.firstLoad[popManager.getSettingsId(pageSection)];},initDomainVars:function(domain){var t=this;t.state[domain]={memory:{settings:{'js-settings':{},jsmethods:{pagesection:{},block:{},},'templates-cbs':{},'templates-paths':{},'db-keys':{},configuration:{},},runtimesettings:{'query-url':{},'query-multidomain-urls':{},configuration:{},'js-settings':{},},dataset:{},feedback:{block:{},pagesection:{},toplevel:{}},'query-state':{general:{},domain:{},}},database:{},userdatabase:{},};},init:function(){var t=this;if($('#'+popPageSectionManager.getTopLevelSettingsId()).length){var domain=M.HOME_DOMAIN;t.initDocument(domain);t.initDomain(domain);t.initTopLevelJson(domain);t.initLocalStorage();popUserAccount.initialLogin(domain);var memory=t.getMemory(domain);var pageSections=[];$.each(memory.settings.configuration,function(pssId,psConfiguration){var psId=psConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);pageSection.attr('data-settings-id',pssId);pageSection.addClass('pop-pagesection');t.initPageSectionSettings(domain,pageSection,psConfiguration);t.addPageSectionIds(domain,pageSection,psConfiguration[M.JS_TEMPLATE]);t.initPageSection(pageSection);pageSections.push(pageSection);});var options={'serverside-rendering':M.USESERVERSIDERENDERING}
$.each(pageSections,function(index,pageSection){t.renderPageSection(domain,pageSection,options);});$(document.body).removeClass('pop-loadingframe');$.each(pageSections,function(index,pageSection){t.pageSectionInitialized(domain,pageSection);});$(document.body).removeClass('pop-loadingjs');var topLevelFeedback=t.getTopLevelFeedback(domain);var url=topLevelFeedback[M.URLPARAM_URL];if(!topLevelFeedback[M.URLPARAM_SILENTDOCUMENT]){popBrowserHistory.replaceState(url);t.updateDocument(domain);}
t.documentInitialized(domain);t.backgroundLoad(M.BACKGROUND_LOAD);t.backgroundLoad(topLevelFeedback[M.URLPARAM_BACKGROUNDLOADURLS]);}},expandJSKeys:function(context){var t=this;if(context&&M.COMPACT_JS_KEYS){if(context[M.JS_MODULES]){context.modules=context[M.JS_MODULES];}
if(context['bs']&&context['bs']['db-keys']&&context['bs']['db-keys'][M.JS_SUBCOMPONENTS]){context['bs']['db-keys'].subcomponents=context['bs']['db-keys'][M.JS_SUBCOMPONENTS];}
if(context[M.JS_TEMPLATE]){context.template=context[M.JS_TEMPLATE];}
if(context[M.JS_TEMPLATEIDS]){context['template-ids']=context[M.JS_TEMPLATEIDS];}
if(context[M.JS_SETTINGSID]){context['settings-id']=context[M.JS_SETTINGSID];}
if(context[M.JS_SETTINGSIDS]){context['settings-ids']=context[M.JS_SETTINGSIDS];if(context[M.JS_SETTINGSIDS][M.JS_BLOCKUNITS]){context['settings-ids']['blockunits']=context[M.JS_SETTINGSIDS][M.JS_BLOCKUNITS];}}
if(context[M.JS_INTERCEPT]){context.intercept=context[M.JS_INTERCEPT];}
if(context[M.JS_BLOCKSETTINGSIDS]){context['block-settings-ids']=context[M.JS_BLOCKSETTINGSIDS];if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITS]){context['block-settings-ids']['blockunits']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITS];}
if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE]){context['block-settings-ids']['blockunits-replicable']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE];}
if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSFRAME]){context['block-settings-ids']['blockunits-frame']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSFRAME];}}
if(context[M.JS_REPLICATEBLOCKSETTINGSIDS]){context['replicate-blocksettingsids']=context[M.JS_REPLICATEBLOCKSETTINGSIDS];if(context[M.JS_INTERCEPTSKIPSTATEUPDATE]){context['intercept-skipstateupdate']=context[M.JS_INTERCEPTSKIPSTATEUPDATE];}
if(context[M.JS_UNIQUEURLS]){context['unique-urls']=context[M.JS_UNIQUEURLS];}
if(context[M.JS_REPLICATETYPES]){context['replicate-types']=context[M.JS_REPLICATETYPES];}}
if(context[M.JS_PARAMS]){context.params=context[M.JS_PARAMS];}
if(context[M.JS_ITEMOBJECTPARAMS]){context['itemobject-params']=context[M.JS_ITEMOBJECTPARAMS];}
if(context[M.JS_PREVIOUSTEMPLATESIDS]){context['previoustemplates-ids']=context[M.JS_PREVIOUSTEMPLATESIDS];}
if(context[M.JS_BLOCKFEEDBACKPARAMS]){context['blockfeedback-params']=context[M.JS_BLOCKFEEDBACKPARAMS];}
if(context[M.JS_APPENDABLE]){context.appendable=context[M.JS_APPENDABLE];}
if(context[M.JS_CLASS]){context.class=context[M.JS_CLASS];}
if(context[M.JS_CLASSES]){context.classes=context[M.JS_CLASSES];if(context[M.JS_CLASSES][M.JS_APPENDABLE]){context.classes.appendable=context[M.JS_CLASSES][M.JS_APPENDABLE];}}
if(context[M.JS_STYLE]){context.style=context[M.JS_STYLE];}
if(context[M.JS_STYLES]){context.styles=context[M.JS_STYLES];}
if(context[M.JS_TITLES]){context.titles=context[M.JS_TITLES];}
popJSLibraryManager.execute('expandJSKeys',{context:context});}},addPageSectionIds:function(domain,pageSection,template){var t=this;var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');popJSRuntimeManager.addPageSectionId(domain,pssId,template,psId);var args={domain:domain,pageSection:pageSection,template:template}
popJSLibraryManager.execute('addPageSectionIds',args);},initDocument:function(domain){var t=this;$(document).on('user:loggedout',function(e,source,domain){t.clearUserDatabase(domain);});var args={domain:domain,}
popJSLibraryManager.execute('initDocument',args);$(document).triggerHandler('initialize.pop.document',[domain]);},initDomain:function(domain){var t=this;t.domains[domain]={initialized:true};t.initDomainVars(domain);var args={domain:domain,}
popJSLibraryManager.execute('initDomain',args);$(document).triggerHandler('initialize.pop.domain',[domain]);},maybeInitializeDomain:function(domain){var t=this;if(!t.domains[domain]||!t.domains[domain].initialized){t.initDomain(domain);}},documentInitialized:function(domain){var t=this;var args={domain:domain,};popJSLibraryManager.execute('documentInitialized',args);$(document).triggerHandler('initialized.pop.document');},pageSectionFetchSuccess:function(pageSection,response){var t=this;popJSLibraryManager.execute('pageSectionFetchSuccess',{pageSection:pageSection,response:response});pageSection.triggerHandler('fetched.pop.pageSection');},blockFetchSuccess:function(pageSection,block,response){var t=this;popJSLibraryManager.execute('blockFetchSuccess',{pageSection:pageSection,block:block,response:response});block.triggerHandler('fetched.pop.block');},backgroundLoad:function(urls){var t=this;var options={'loadingmsg-target':null,silentDocument:true,};$.each(urls,function(url,targets){$.each(targets,function(index,target){t.fetch(url,$.extend({target:target},options));});});},initPageSection:function(pageSection){var t=this;t.firstLoad[t.getSettingsId(pageSection)]=true;popJSLibraryManager.execute('initPageSection',{pageSection:pageSection});pageSection.triggerHandler('initialize');$(document).triggerHandler('initialize.pop.pagesection',[pageSection]);},pageSectionInitialized:function(domain,pageSection){var t=this;t.initPageSectionRuntimeMemory(domain,pageSection);popJSLibraryManager.execute('pageSectionInitialized',{domain:domain,pageSection:pageSection});pageSection.triggerHandler('initialized');pageSection.triggerHandler('completed');t.firstLoad[popManager.getSettingsId(pageSection)]=false;},pageSectionNewDOMsInitialized:function(domain,pageSection,newDOMs,options){var t=this;var pageSectionPage=newDOMs.filter('.pop-pagesection-page');if(pageSectionPage.length){if(options['fetch-params']){$.each(options['fetch-params'],function(key,value){pageSectionPage.data(key,value);});}
var openmode=popPageSectionManager.getOpenMode(pageSection);var firstLoad=t.isFirstLoad(pageSection);if(openmode=='automatic'||(firstLoad&&openmode=='initial')){popPageSectionManager.open(pageSection);}}
var args={domain:domain,pageSection:pageSection,newDOMs:newDOMs};t.extendArgs(args,options);popJSLibraryManager.execute('pageSectionNewDOMsBeforeInitialize',args);t.initPageSectionBranches(domain,pageSection,newDOMs,options);popJSLibraryManager.execute('pageSectionNewDOMsInitialized',args);},initPageSectionBranches:function(domain,pageSection,newDOMs,options){var t=this;t.runPageSectionJSMethods(domain,pageSection,options);var jsSettings=popManager.getPageSectionJsSettings(domain,pageSection);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){var branches=$(blockBranches.join(',')).not('.'+M.JS_INITIALIZED);t.initBlockBranches(domain,pageSection,branches,options);}
popJSRuntimeManager.deletePageSectionLastSessionIds(domain,pageSection);},triggerDestroyTarget:function(url,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;t.removeOpenTab(url,target);popURLInterceptors.intercept(t.getDestroyUrl(url),{target:target});},destroyTarget:function(domain,pageSection,target){var t=this;var args={domain:domain,pageSection:pageSection,destroyTarget:target}
popJSLibraryManager.execute('destroyTarget',args);target.triggerHandler('destroy');var blocks=target.find('.pop-block.'+M.JS_INITIALIZED).addBack('.pop-block.'+M.JS_INITIALIZED);blocks.each(function(){var block=$(this);t.deleteRuntimeMemoryPage(domain,pageSection,block,{url:t.getTargetParamsScopeURL(block)});})
target.remove();},destroyPageSectionPage:function(domain,pageSection,pageSectionPage){var t=this;var target=pageSectionPage||pageSection;if(!pageSectionPage.siblings('.pop-pagesection-page').length){popPageSectionManager.close(pageSection);popPageSectionManager.close(pageSection,'xs');}
t.destroyTarget(domain,pageSection,target);},pageSectionRendered:function(domain,pageSection,newDOMs,options){var t=this;t.pageSectionNewDOMsInitialized(domain,pageSection,newDOMs,options);var args={domain:domain,pageSection:pageSection,newDOMs:newDOMs}
t.extendArgs(args,options);popJSLibraryManager.execute('pageSectionRendered',args);pageSection.triggerHandler('pageSectionRendered');},runScriptsBefore:function(pageSection,newDOMs){var t=this;var args={pageSection:pageSection,newDOMs:newDOMs};popJSLibraryManager.execute('runScriptsBefore',args);},jsInitialized:function(block){var t=this;return block.hasClass(M.JS_INITIALIZED);},jsLazy:function(block){var t=this;return block.hasClass(M.CLASS_LAZYJS);},setJsInitialized:function(block){var t=this;block.addClass(M.JS_INITIALIZED).removeClass(M.CLASS_LAZYJS);},initBlockBranches:function(domain,pageSection,blocks,options){var t=this;if(!blocks.length){return;}
blocks.each(function(){var block=$(this);var proceed=!t.jsInitialized(block);if(!options['force-init']){proceed=proceed&&!t.jsLazy(block);}
if(proceed){t.setJsInitialized(block);t.initBlock(domain,pageSection,block,options);var jsSettings=popManager.getJsSettings(domain,pageSection,block);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.initBlockBranches(domain,pageSection,$(blockBranches.join(', ')).not('.'+M.JS_INITIALIZED),options);}
var blockChildren=jsSettings['initjs-blockchildren'];if(blockChildren){var target=block;$.each(blockChildren,function(index,selectors){$.each(selectors,function(index,selector){target=target.children(selector).not('.'+M.JS_INITIALIZED);});});t.initBlockBranches(domain,pageSection,target,options);}}});},initBlock:function(domain,pageSection,block,options){var t=this;options=options||{};t.initBlockRuntimeMemory(domain,pageSection,block,$.extend({},options));t.initializeBlock(pageSection,block,options);t.runScriptsBefore(pageSection,block);t.runBlockJSMethods(domain,pageSection,block,options);block.on('rendered',function(e,newDOMs,targetContainers,renderedDomain){var block=$(this);popJSRuntimeManager.setBlockURL(block);t.runScriptsBefore(pageSection,newDOMs);t.runBlockJSMethods(renderedDomain,pageSection,block,null,options);});t.blockInitialized(domain,pageSection,block,options);t.loadBlockContent(domain,pageSection,block);},initializeBlock:function(pageSection,block,options){var t=this;var args={pageSection:pageSection,block:block};t.extendArgs(args,options);popJSLibraryManager.execute('initBlock',args);block.triggerHandler('initialize');},extendArgs:function(args,options){var t=this;options=options||{};if(options['js-args']){$.extend(args,options['js-args']);}},blockInitialized:function(domain,pageSection,block,options){var t=this;var args={domain:domain,pageSection:pageSection,block:block};t.extendArgs(args,options);popJSLibraryManager.execute('blockInitialized',args);block.triggerHandler('js:initialized');},loadBlockContent:function(domain,pageSection,block){var t=this;if(!t.isContentLoaded(pageSection,block)){t.setContentLoaded(pageSection,block);var options={action:M.CBACTION_LOADCONTENT,'post-data':block.data('post-data')};var jsSettings=t.getJsSettings(domain,pageSection,block);if(jsSettings['loadcontent-showdisabledlayer']){options['show-disabled-layer']=true;}
$(document).ready(function($){t.fetchBlock(pageSection,block,options);});}},runPageSectionJSMethods:function(domain,pageSection,options){var t=this;var sessionIds=popJSRuntimeManager.getPageSectionSessionIds(domain,pageSection);if(!sessionIds)return;var executedTemplates=[];var templateMethods=popManager.getPageSectionJsMethods(domain,pageSection);$.each(templateMethods,function(template,groupMethods){if(executedTemplates.indexOf(template)==-1){executedTemplates.push(template);if(sessionIds[template]&&groupMethods){$.each(groupMethods,function(group,methods){var ids=sessionIds[template][group];if(ids){var selector='#'+ids.join(', #');var targets=$(selector);if(targets.length){$.each(methods,function(index,method){var args={domain:domain,pageSection:pageSection,targets:targets,};t.extendArgs(args,options);popJSLibraryManager.execute(method,args);});}}});}}});},runBlockJSMethods:function(domain,pageSection,block,options){var t=this;t.runJSMethods(domain,pageSection,block,null,null,options);popJSRuntimeManager.deleteBlockLastSessionIds(domain,pageSection,block);},runJSMethods:function(domain,pageSection,block,templateFrom,session,options){var t=this;var sessionIds=popJSRuntimeManager.getBlockSessionIds(domain,pageSection,block,session);if(!sessionIds)return;var templateMethods=t.getTemplateJSMethods(domain,pageSection,block,templateFrom);t.runJSMethodsInner(domain,pageSection,block,templateMethods,sessionIds,[],options);},runJSMethodsInner:function(domain,pageSection,block,templateMethods,sessionIds,executedTemplates,options){var t=this;options=options||{};var template=templateMethods[M.JS_TEMPLATE];var groupMethods=templateMethods[M.JS_METHODS];if(executedTemplates.indexOf(template)==-1){executedTemplates.push(template);if(sessionIds[template]&&groupMethods){$.each(groupMethods,function(group,methods){var ids=sessionIds[template][group];if(ids){var selector='#'+ids.join(', #');var targets=$(selector);if(targets.length){$.each(methods,function(index,method){var args={domain:domain,pageSection:pageSection,block:block,targets:targets,};t.extendArgs(args,options);popJSLibraryManager.execute(method,args);});}}});}}
if(templateMethods[M.JS_NEXT]){$.each(templateMethods[M.JS_NEXT],function(index,next){t.runJSMethodsInner(domain,pageSection,block,next,sessionIds,executedTemplates,options);})}},getTemplateJSMethods:function(domain,pageSection,block,templateFrom){var t=this;var templateMethods=t.getBlockJsMethods(domain,pageSection,block);if(!templateFrom){return templateMethods;}
return t.getTemplateJSMethodsInner(pageSection,block,templateFrom,templateMethods);},getTemplateJSMethodsInner:function(pageSection,block,templateFrom,templateMethods){var t=this;if(templateMethods[M.JS_TEMPLATE]==templateFrom){return templateMethods;}
var found;if(templateMethods[M.JS_NEXT]){$.each(templateMethods[M.JS_NEXT],function(index,next){found=t.getTemplateJSMethodsInner(pageSection,block,templateFrom,next);if(found){return false;}});}
return found;},maybeRedirect:function(feedback){var t=this;if(feedback.redirect&&feedback.redirect.url){if(feedback.redirect.fetch){t.click(feedback.redirect.url)}
else{window.location=feedback.redirect.url;return true;}}
return false;},historyReplaceState:function(elem,options){var t=this;var url=elem.data('historystate-url');var title=elem.data('historystate-title');var thumb=elem.data('historystate-thumb');popBrowserHistory.replaceState(url);if(title){t.documentTitle=unescapeHtml(title);document.title=t.documentTitle;}},hideIfEmpty:function(domain,pageSection,block){var t=this;var feedback=popManager.getBlockFeedback(domain,pageSection,block);return feedback[M.URLPARAM_HIDEBLOCK];},isHidden:function(elem){var t=this;if(elem.hasClass('hidden'))return true;var elem_id=elem.attr('id');if(elem_id){if(!($('#'+elem_id).length)){return true;}}
var tabPanes=elem.parents('.tab-pane');var activeTabPanes=tabPanes.filter('.active');if(tabPanes.length>activeTabPanes.length){return true;}
var executed=popJSLibraryManager.execute('isHidden',{targets:elem});var ret=false;$.each(executed,function(index,value){if(value){ret=true;return-1;}});return ret;},isActive:function(elem){var t=this;var executed=popJSLibraryManager.execute('isActive',{targets:elem});var ret=true;$.each(executed,function(index,value){if(!value){ret=false;return-1;}});return ret;},isContentLoaded:function(pageSection,block){var t=this;var blockQueryState=t.getBlockQueryState(pageSection,block);return blockQueryState[M.DATALOAD_CONTENTLOADED]||false;},setContentLoaded:function(pageSection,block){var t=this;var blockQueryState=t.getBlockQueryState(pageSection,block);blockQueryState[M.DATALOAD_CONTENTLOADED]=true;},updateDocument:function(domain){var t=this;t.updateTitle(t.getTopLevelFeedback(domain)[M.URLPARAM_TITLE]);},updateTitle:function(title){var t=this;if(title){t.documentTitle=unescapeHtml(title);document.title=t.documentTitle;}},executeSetFilterBlockParams:function(pageSection,block,filter){var t=this;var blockQueryState=t.getBlockQueryState(pageSection,block);blockQueryState.filter=filter.find('.'+M.FILTER_INPUT).filter(function(){return $.trim(this.value);}).serialize();if(blockQueryState.filter){blockQueryState.filter+='&'+filter.find('.'+M.FILTER_NAME_INPUT).serialize();}},setFilterBlockParams:function(pageSection,block,filter){var t=this;if(t.jsInitialized(block)){t.executeSetFilterBlockParams(pageSection,block,filter);}
else{block.one('js:initialized',function(){t.executeSetFilterBlockParams(pageSection,block,filter);});}},filter:function(pageSection,block,filter){var t=this;t.setFilterBlockParams(pageSection,block,filter);t.reload(pageSection,block);t.blockScrollTop(pageSection,block);},blockScrollTop:function(pageSection,block){var t=this;var modal=block.closest('.modal');if(modal.length==0){t.scrollToElem(pageSection,block.children('.blocksection-status').first(),true);}
else{modal.animate({scrollTop:0},'fast');}},setReloadBlockParams:function(pageSection,block){var t=this;var queryState=t.getBlockMultiDomainQueryState(pageSection,block);$.each(queryState,function(domain,blockDomainQueryState){if(blockDomainQueryState[M.DATALOAD_PARAMS]&&blockDomainQueryState[M.DATALOAD_PARAMS][M.URLPARAM_PAGED]){blockDomainQueryState[M.DATALOAD_PARAMS][M.URLPARAM_PAGED]='';}
if(blockDomainQueryState[M.URLPARAM_STOPFETCHING]){blockDomainQueryState[M.URLPARAM_STOPFETCHING]=false;}});},refetch:function(pageSection,block,options){var t=this;options=options||{};options.action=M.CBACTION_REFETCH;block.triggerHandler('beforeRefetch');popManager.reload(pageSection,block,options);},reset:function(domain,pageSection,block,options){var t=this;options=options||{};if(!options['skip-restore']){t.restoreInitialBlockMemory(pageSection,block);}
t.processBlock(domain,pageSection,block,{operation:M.URLPARAM_OPERATION_REPLACE,action:M.CBACTION_RESET,reset:true});},reload:function(pageSection,block,options){var t=this;options=options||{};options.operation=M.URLPARAM_OPERATION_REPLACE;options.reload=true;options['hide-latestcount']=true;t.setReloadBlockParams(pageSection,block);block.triggerHandler('beforeReload');t.fetchBlock(pageSection,block,options);},loadLatest:function(domain,pageSection,block,options){var t=this;options=options||{};var blockDomainQueryState=t.getBlockDomainQueryState(domain,pageSection,block);options.operation=M.URLPARAM_OPERATION_PREPEND;options['skip-stopfetching-check']=true;options['hide-latestcount']=true;var post_data={};post_data[M.URLPARAM_ACTION]=M.URLPARAM_ACTION_LATEST;post_data[M.URLPARAM_TIMESTAMP]=blockDomainQueryState[M.URLPARAM_TIMESTAMP];options['onetime-post-data']=$.param(post_data);block.triggerHandler('beforeLoadLatest');t.fetchBlock(pageSection,block,options);},handlePageSectionLoadingStatus:function(pageSection,operation,options){var t=this;var loading;options=options||{};if(typeof options['loadingmsg-target']!='undefined'){if(!options['loadingmsg-target']){return;}
loading=$(options['loadingmsg-target']);}
else{var status=popPageSectionManager.getPageSectionStatus(pageSection);loading=status.find('.pop-loading');var error=status.find('.pop-error');error.addClass('hidden');}
t.handleLoadingStatus(loading,operation,options)},handleLoadingStatus:function(loading,operation){var t=this;var num=loading.data('num')||0;if(operation=='add'){num+=1;}
else if(operation=='remove'){num-=1;}
loading.data('num',num);if(num){loading.removeClass('hidden');}
else{loading.addClass('hidden');}
if(num>=2){loading.find('.pop-box').text('x'+num);}
else{loading.find('.pop-box').text('');}},fetch:function(url,options){var t=this;options=options||{};var pageSection=t.getFetchTargetPageSection(options.target);var params=t.getPageSectionParams(pageSection);if(!params){if(options['noparams-reload-url']){window.location=url;}
return;}
t.fetchPageSection(pageSection,url,options);},removeLocalStorageItem:function(path,key){var t=this;var args={result:key.startsWith(path),key:key,path:path};popJSLibraryManager.execute('removeLocalStorageItem',args);return args.result;},initLocalStorage:function(){var t=this;if(M.USELOCALSTORAGE&&supports_html5_storage()){var latest=localStorage['PoP:version'];if(!latest||(latest!=M.VERSION)){Object.keys(localStorage).forEach(function(key){M.ALLOWED_DOMAINS.forEach(function(path){if(t.removeLocalStorageItem(path,key)){localStorage.removeItem(key);return-1;}});});localStorage['PoP:version']=M.VERSION;}}},openTabs:function(){var t=this;if(!M.KEEP_OPEN_TABS)return;var options={silentDocument:true,'js-args':{inactivePane:true,addOpenTab:false}};var currentURL=t.getTabsCurrentURL();var tabs=t.getScreenOpenTabs();$.each(tabs,function(target,urls){options.target=target;if(target==M.URLPARAM_TARGET_MAIN){var pos=urls.indexOf(currentURL);if(pos!==-1){urls.splice(pos,1);}}
$.each(urls,function(index,url){t.fetch(url,options);});});},getTabsCurrentURL:function(){var t=this;var currentURL=window.location.href;if(currentURL==M.HOME_DOMAIN){currentURL=M.HOME_DOMAIN+'/';}
if(currentURL==M.HOME_DOMAIN+'/'&&M.HOMELOCALE_URL){currentURL=M.HOMELOCALE_URL+'/';}
return currentURL;},getOpenTabsKey:function(){var t=this;var key=M.LOCALE;var domain=M.HOME_DOMAIN;var params=t.getTopLevelFeedback(domain)[M.DATALOAD_PARAMS];$.each(params,function(param,value){key+='|'+param+'='+value;});return key;},getScreenOpenTabs:function(){var t=this;var tabs=t.getOpenTabs();var key=t.getOpenTabsKey();return tabs[key]||{};},keepScreenOpenTab:function(url,target){var t=this;var tabs=t.getOpenTabs();var key=t.getOpenTabsKey();tabs[key]={};tabs[key][target]=[url];t.storeData('PoP:openTabs',tabs);},getOpenTabs:function(){var t=this;if(!M.KEEP_OPEN_TABS)return{};return t.getStoredData('PoP:openTabs')||{};},addOpenTab:function(url,target){var t=this;if(!M.KEEP_OPEN_TABS)return false;var tabs=t.getOpenTabs();var key=t.getOpenTabsKey();tabs[key]=tabs[key]||{};tabs[key][target]=tabs[key][target]||[];if(tabs[key][target].indexOf(url)>-1){return false;}
tabs[key][target].push(url);t.storeData('PoP:openTabs',tabs);return true;},removeOpenTab:function(url,target){var t=this;if(!M.KEEP_OPEN_TABS)return false;var tabs=t.getOpenTabs();var key=t.getOpenTabsKey();tabs[key]=tabs[key]||{};tabs[key][target]=tabs[key][target]||[];var pos=tabs[key][target].indexOf(url);if(pos===-1){return false;}
tabs[key][target].splice(pos,1);if(!tabs[key][target].length){delete tabs[key][target];if(!tabs[key].length){delete tabs[key];}}
t.storeData('PoP:openTabs',tabs);return true;},replaceOpenTab:function(fromURL,toURL,target){var t=this;if(!M.KEEP_OPEN_TABS)return;if(t.removeOpenTab(fromURL,target)){t.addOpenTab(toURL,target);}},getStoredData:function(localStorageKey,use_version){var t=this;if(M.USELOCALSTORAGE&&supports_html5_storage()){var stored=localStorage[localStorageKey];if(stored){stored=$.parseJSON(stored);if(use_version){if((stored.version==M.VERSION)&&(typeof stored.expires=='undefined'||stored.expires>Date.now())){return stored.value;}
delete localStorage[localStorageKey];return null;}
else{return stored.value;}}}
return null;},storeData:function(localStorageKey,value,expires){var t=this;if(M.USELOCALSTORAGE&&supports_html5_storage()){var stored={version:M.VERSION,value:value}
if(expires){stored.expires=Date.now()+expires;}
try{localStorage[localStorageKey]=JSON.stringify(stored);}
catch(err){console.log('Error: '+err.message);}}},fetchPageSection:function(pageSection,url,options){var t=this;var params=t.getPageSectionParams(pageSection);if(!params){return;}
if(params.loading.indexOf(url)>-1){return;}
options=options||{};var target=t.getTarget(pageSection);var domain=getDomain(url);t.maybeInitializeDomain(domain);var args={domain:domain,options:options,url:url};popJSLibraryManager.execute('modifyFetchArgs',args);var fetchUrl=args.url;if(fetchUrl.indexOf('#')>-1){fetchUrl=fetchUrl.substr(0,fetchUrl.indexOf('#'));}
fetchUrl=add_query_arg(M.URLPARAM_TARGET,target,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_MODULE,M.URLPARAM_MODULE_SETTINGSDATA,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_OUTPUT,M.URLPARAM_OUTPUT_JSON,fetchUrl);var topLevelFeedback=t.getTopLevelFeedback(domain);var paramsData=$.extend({},topLevelFeedback[M.DATALOAD_PARAMS],params[M.DATALOAD_PARAMS]);if(options.params){$.extend(paramsData,options.params);}
var postData=$.param(paramsData);var localStorageKey;localStorageKey=fetchUrl+'|'+postData;var stored=t.getStoredData(localStorageKey);if(stored){t.prePageSectionSuccess(pageSection,stored,options);t.processPageSectionResponse(domain,pageSection,stored,options);t.triggerURLFetched(url);return;}
var status=popPageSectionManager.getPageSectionStatus(pageSection);var error=status.find('.pop-error');if(options['disable-layer']){options['disable-layer'].children('.pop-disabledlayer').removeClass('hidden');}
var crossdomain=t.getCrossDomainOptions(fetchUrl);$.ajax($.extend(crossdomain,{dataType:"json",url:fetchUrl,data:postData,beforeSend:function(jqXHR,settings){jqXHR.url=url;params.url[jqXHR.url]=url;params.target[jqXHR.url]=target;params['fetch-url'][jqXHR.url]=settings.url;params.loading.push(url);t.handlePageSectionLoadingStatus(pageSection,'add',options);},complete:function(jqXHR){var url=params.url[jqXHR.url];delete params.url[jqXHR.url];delete params.target[jqXHR.url];delete params['fetch-url'][jqXHR.url];params.loading.splice(params.loading.indexOf(url),1);t.handlePageSectionLoadingStatus(pageSection,'remove',options);if(options['urlfetched-callbacks']){var handler='urlfetched:'+escape(url);$.each(options['urlfetched-callbacks'],function(index,callback){$(document).one(handler,callback);});}
t.triggerURLFetched(url);if(options['disable-layer']){options['disable-layer'].children('.pop-disabledlayer').addClass('hidden');}},success:function(response,textStatus,jqXHR){t.prePageSectionSuccess(pageSection,response,options);error.addClass('hidden');var url=params.url[jqXHR.url];var feedbackURL=response.feedback.toplevel[M.URLPARAM_URL];var target=params.target[jqXHR.url];if(url!=feedbackURL){t.replaceOpenTab(url,feedbackURL,target);}
options['fetch-params']={url:url,target:target,'fetch-url':params['fetch-url'][jqXHR.url]};if(response.feedback.toplevel[M.URLPARAM_STORELOCAL]){t.storeData(localStorageKey,response);}
t.processPageSectionResponse(domain,pageSection,response,options);},error:function(jqXHR,textStatus,errorThrown){var fetchedUrl=params.url[jqXHR.url];if(!options.silentDocument){t.showError(pageSection,t.getError(fetchedUrl,jqXHR,textStatus,errorThrown));}
pageSection.triggerHandler('fetchFailed');}}));},prePageSectionSuccess:function(pageSection,response,options){var t=this;t.pageSectionFetchSuccess(pageSection,response);t.backgroundLoad(response.feedback.toplevel[M.URLPARAM_BACKGROUNDLOADURLS]);},getCrossDomainOptions:function(url){var t=this;var options={};if(!url.startsWith(M.HOME_DOMAIN)){$.each(M.ALLOWED_DOMAINS,function(index,allowed){if(url.startsWith(allowed)){options.xhrFields={withCredentials:true};options.crossDomain=true;return-1;}});}
return options;},showError:function(pageSection,message){var t=this;var status=popPageSectionManager.getPageSectionStatus(pageSection);var error=status.find('.pop-error');error.children('div.pop-box').html(message);error.removeClass('hidden');t.scrollTop(error);},triggerURLFetched:function(url){var t=this;$(document).triggerHandler('urlfetched:'+escape(url));$(document).triggerHandler('urlfetched',[url]);},processPageSectionResponse:function(domain,pageSection,response,options){var t=this;var target=t.getTarget(pageSection);t.saveUrlPointers(response,target);t.addReplicableMemory(response,target);t.addInitialBlockMemory(response);t.integrateDatabases(domain,response);var dfd=$.Deferred();var lastPromise=t.mergingTemplatePromise;t.mergingTemplatePromise=dfd.promise();if(lastPromise){lastPromise.done(function(){try{t.processPageSection(domain,pageSection,response,options);}
catch(err){console.log('Error: '+err.message);}});}
else{try{t.processPageSection(domain,pageSection,response,options);}
catch(err){console.log('Error: '+err.message);}}
dfd.resolve();},maybeUpdateDocument:function(domain,pageSection,options){var t=this;options=options||{};if(options.silentDocument){return;}
var settings=t.getFetchPageSectionSettings(pageSection);if(settings.updateDocument){if(!options.skipPushState){var topLevelFeedback=t.getTopLevelFeedback(domain);popBrowserHistory.pushState(topLevelFeedback[M.URLPARAM_URL]);}
t.updateDocument(domain);}},processPageSection:function(domain,pageSection,response,options){var t=this;var target=t.getTarget(pageSection);t.integrateTopLevelFeedback(domain,response);var topLevelFeedback=t.getTopLevelFeedback(domain);var errorMessage=topLevelFeedback[M.URLPARAM_ERROR];if(errorMessage){t.showError(pageSection,errorMessage);}
var url=topLevelFeedback[M.URLPARAM_URL];if(options.reloadurl){t.triggerDestroyTarget(url,target);}
if(topLevelFeedback[M.URLPARAM_SILENTDOCUMENT]){options.silentDocument=true;}
t.maybeUpdateDocument(domain,pageSection,options);if(options.maybeRedirect){if(t.maybeRedirect(topLevelFeedback))return;}
t.integratePageSection(domain,response);$.each(response.settings.configuration,function(rpssId,rpsConfiguration){var psId=rpsConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);t.renderPageSection(domain,pageSection,options);pageSection.triggerHandler('fetched',[options,url,domain]);pageSection.triggerHandler('completed');});},scrollToElem:function(elem,position,animate){var t=this;popJSLibraryManager.execute('scrollToElem',{elem:elem,position:position,animate:animate});},scrollTop:function(elem,top,animate){var t=this;popJSLibraryManager.execute('scrollTop',{elem:elem,top:top,animate:animate});},getPosition:function(elem){var t=this;var executed=popJSLibraryManager.execute('getPosition',{elem:elem});var ret=0;$.each(executed,function(index,value){if(value){ret=value;return-1;}});return ret;},getSettingsId:function(objectOrId){var t=this;if($.type(objectOrId)=='object'){var object=objectOrId;return object.attr('data-settings-id');}
return objectOrId;},getError:function(url,jqXHR,textStatus,errorThrown){var t=this;if(jqXHR.status===0){return M.ERROR_OFFLINE.format(url);}
else if(jqXHR.status==404){return M.ERROR_404;}
return M.ERROR_MSG.format(url);},closeMessageFeedback:function(elem){var t=this;$(document).ready(function($){elem.find('.pop-messagefeedback').removeClass('fade').alert('close');});},closeMessageFeedbacks:function(pageSection){var t=this;$(document).ready(function($){pageSection.find('.pop-messagefeedback').removeClass('fade').alert('close');});},processBlock:function(domain,pageSection,block,options){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var memory=t.getMemory(domain);options.extendContext={items:memory.dataset[pssId][bsId],ignorePSRuntimeId:true};popJSRuntimeManager.setBlockURL(block);t.renderTarget(domain,pageSection,block,options);},fetchBlock:function(pageSection,block,options){var t=this;options=options||{};if(!options['skip-stopfetching-check']){if(t.stopFetchingBlock(pageSection,block)){return;}}
t.executeFetchBlock(pageSection,block,options);},getBlockPostData:function(domain,pageSection,block,options){var t=this;options=options||{};var paramsGroup=options.paramsGroup||'all';var blockQueryState=t.getBlockQueryState(pageSection,block);var blockDomainQueryState=t.getBlockDomainQueryState(domain,pageSection,block);var params={};if(paramsGroup=='all'){$.extend(params,blockQueryState[M.DATALOAD_PARAMS]);if(blockDomainQueryState[M.DATALOAD_PARAMS]){$.extend(params,blockDomainQueryState[M.DATALOAD_PARAMS]);}}
if(blockQueryState[M.DATALOAD_VISIBLEPARAMS]){$.extend(params,blockQueryState[M.DATALOAD_VISIBLEPARAMS]);}
if(blockDomainQueryState[M.DATALOAD_VISIBLEPARAMS]){$.extend(params,blockDomainQueryState[M.DATALOAD_VISIBLEPARAMS]);}
$.each(params,function(key,value){if(!value)delete params[key];});var post_data=$.param(params);if(blockQueryState.filter){if(post_data){post_data+='&';}
post_data+=blockQueryState.filter;}
return post_data;},handleBlockError:function(error,jqXHR,options){var t=this;var msgSelectors=['.errormsg.status-'+jqXHR.status,'.errormsg.general'];$.each(msgSelectors,function(index,msgSelector){var msg=error.find(msgSelector);if(msg.length){msg.removeClass('hidden').siblings('.errormsg').addClass('hidden');return false;}});if(!options['skip-status']){error.removeClass('hidden');t.scrollTop(error);}},getMultiDomainBlockStatus:function(blockQueryState,fetch_urls,timestamp){var status={timestamp:timestamp,isFirst:(blockQueryState.timestamps[timestamp].length===Object.keys(fetch_urls).length),isLast:(blockQueryState.timestamps[timestamp].length===1)};return status;},executeFetchBlock:function(pageSection,block,options){var t=this;options=options||{};var type=options.type||'GET';var blockQueryState=t.getBlockQueryState(pageSection,block);if(options['post-data']){blockQueryState['post-data']=options['post-data'];}
var fetch_urls={};var query_urls=t.getQueryMultiDomainUrls(pageSection,block);$.each(query_urls,function(domain,fetchUrl){if(!fetchUrl){return;}
if(!options['skip-stopfetching-check']){if(t.stopFetchingDomainBlock(domain,pageSection,block)){return;}}
t.maybeInitializeDomain(domain);t.initMultiDomainFeedback(domain,pageSection,block);var args={domain:domain,options:options,url:fetchUrl,type:type};popJSLibraryManager.execute('modifyFetchBlockArgs',args);fetchUrl=args.url;var topLevelFeedback=t.getTopLevelFeedback(domain);var pageSectionFeedback=t.getPageSectionFeedback(domain,pageSection);var blockFeedback=t.getBlockFeedback(domain,pageSection,block);var blockQueryStateData=$.extend({},topLevelFeedback[M.DATALOAD_PARAMS],pageSectionFeedback[M.DATALOAD_PARAMS],blockFeedback[M.DATALOAD_PARAMS]);var post_data=$.param(blockQueryStateData);if(blockQueryState['post-data']){if(post_data){post_data+='&';}
post_data+=blockQueryState['post-data'];}
if(options['onetime-post-data']){if(post_data){post_data+='&';}
post_data+=options['onetime-post-data'];}
var block_post_data=t.getBlockPostData(domain,pageSection,block);if(post_data&&block_post_data){post_data+='&';}
post_data+=block_post_data;var target=t.getTarget(pageSection);fetchUrl=add_query_arg(M.URLPARAM_TARGET,target,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_MODULE,M.URLPARAM_MODULE_DATA,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_OUTPUT,M.URLPARAM_OUTPUT_JSON,fetchUrl);var loadingUrl=fetchUrl+post_data;if(blockQueryState.loading.indexOf(loadingUrl)>-1){return;}
fetch_urls[domain]={url:fetchUrl,loading:loadingUrl,data:post_data,};});if(!$.isEmptyObject(fetch_urls)){var loading=block.find('.pop-loading');var error=block.find('.pop-error');if(!options['skip-status']){loading.removeClass('hidden');error.addClass('hidden');t.closeMessageFeedback(block);}
t.triggerEvent(pageSection,block,'beforeFetch',[options]);if(options['show-disabled-layer']){block.children('.pop-disabledlayer').removeClass('hidden');}
var timestamp=Date.now();$.each(fetch_urls,function(domain,fetchInfo){var fetchUrl=fetchInfo.url;var loadingUrl=fetchInfo.loading;var post_data=fetchInfo.data;var crossdomain=t.getCrossDomainOptions(fetchUrl);$.ajax($.extend(crossdomain,{dataType:"json",url:fetchUrl,data:post_data,type:type,beforeSend:function(jqXHR,settings){jqXHR.url=settings.url;blockQueryState.url[jqXHR.url]=loadingUrl;blockQueryState.loading.push(loadingUrl);blockQueryState.timestamps[timestamp]=blockQueryState.timestamps[timestamp]||[];blockQueryState.timestamps[timestamp].push(loadingUrl);blockQueryState.operation[loadingUrl]=options.operation;blockQueryState.action[loadingUrl]=options.action;blockQueryState.domain[loadingUrl]=domain;blockQueryState['paramsscope-url'][loadingUrl]=t.getTargetParamsScopeURL(block);if(options.reload){blockQueryState.reload.push(loadingUrl);}
if(!options['skip-status']){t.handleLoadingStatus(loading,'add');}},success:function(response,textStatus,jqXHR){t.blockFetchSuccess(pageSection,block,response);t.backgroundLoad(response.feedback.toplevel[M.URLPARAM_BACKGROUNDLOADURLS]);if(options['hide-latestcount']){block.children('.blocksection-latestcount').find('.pop-latestcount').addClass('hidden').find('.pop-count').text('0');}
var status=t.getMultiDomainBlockStatus(blockQueryState,fetch_urls,timestamp);var lastPromise=t.mergingTemplatePromise;var dfd=$.Deferred();var thisPromise=dfd.promise();t.mergingTemplatePromise=thisPromise;if(lastPromise){lastPromise.done(function(){try{t.executeFetchBlockSuccess(pageSection,block,response,status,jqXHR);}
catch(err){console.log('Error: '+err.message);}});}
else{try{t.executeFetchBlockSuccess(pageSection,block,response,status,jqXHR);}
catch(err){console.log('Error: '+err.message);}}
dfd.resolve();},error:function(jqXHR,textStatus,errorThrown){t.handleBlockError(error,jqXHR,options);t.triggerEvent(pageSection,block,'fetchFailed');},complete:function(jqXHR){var status=t.getMultiDomainBlockStatus(blockQueryState,fetch_urls,timestamp);var loadingUrl=blockQueryState.url[jqXHR.url];delete blockQueryState.url[jqXHR.url];var domain=blockQueryState.domain[loadingUrl];blockQueryState.loading.splice(blockQueryState.loading.indexOf(loadingUrl),1);delete blockQueryState.operation[loadingUrl];delete blockQueryState.action[loadingUrl];delete blockQueryState.domain[loadingUrl];delete blockQueryState['paramsscope-url'][loadingUrl];blockQueryState.timestamps[timestamp].splice(blockQueryState.timestamps[timestamp].indexOf(loadingUrl),1);if(!blockQueryState.timestamps[timestamp].length){delete blockQueryState.timestamps[timestamp];}
var index=blockQueryState.reload.indexOf(loadingUrl);if(index>-1){status.reload=true;blockQueryState.reload.splice(index,1);}
if(!options['skip-status']){t.handleLoadingStatus(loading,'remove');}
var lastPromise=t.mergingTemplatePromise;var dfd=$.Deferred();var thisPromise=dfd.promise();t.mergingTemplatePromise=thisPromise;if(lastPromise){lastPromise.done(function(){try{t.fetchBlockComplete(domain,pageSection,block,status,options);}
catch(err){console.log('Error: '+err.message);}});}
else{try{t.fetchBlockComplete(domain,pageSection,block,status,options);}
catch(err){console.log('Error: '+err.message);}}
dfd.resolve();}}));});}},fetchBlockComplete:function(domain,pageSection,block,status,options){var t=this;var blockQueryState=t.getBlockQueryState(pageSection,block);block.children('.pop-disabledlayer').addClass('hidden');if(options['datasetcount-target']){t.displayDatasetCount(domain,pageSection,block,$(options['datasetcount-target']),options['datasetcount-updatetitle']);}
if(!blockQueryState.loading.length){var loading=block.find('.pop-loading');loading.addClass('hidden');}
if(t.stopFetchingBlock(pageSection,block)){block.addClass('pop-stopfetching');}
else{block.removeClass('pop-stopfetching');}
t.triggerEvent(pageSection,block,'fetchDomainCompleted',[status,domain]);if(status.isLast){t.triggerEvent(pageSection,block,'fetchCompleted',[status]);}},stopFetchingBlock:function(pageSection,block){var t=this;var ret=true;var query_urls=t.getQueryMultiDomainUrls(pageSection,block);$.each(query_urls,function(domain,query_url){var blockQueryDomainState=t.getBlockDomainQueryState(domain,pageSection,block);if(!blockQueryDomainState[M.URLPARAM_STOPFETCHING]){ret=false;return-1;}});return ret;},stopFetchingDomainBlock:function(domain,pageSection,block){var t=this;var blockQueryDomainState=t.getBlockDomainQueryState(domain,pageSection,block);return blockQueryDomainState[M.URLPARAM_STOPFETCHING];},displayDatasetCount:function(domain,pageSection,block,target,updateTitle){var t=this;var dataset=t.getBlockDataset(domain,pageSection,block);if(dataset.length){var mode=target.data('datasetcount-mode')||'add';var count=dataset.length;if(mode=='add'){count+=target.text()?parseInt(target.text()):0;}
if(count){target.removeClass('hidden').text(count);if(updateTitle){document.title='('+count+') '+t.documentTitle;}}}},initMultiDomainFeedback:function(domain,pageSection,block){var t=this;var memory=t.getMemory(domain);var localDomain=t.getBlockTopLevelDomain(block);if(domain!=localDomain){var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var localMemory=t.getMemory(localDomain);if($.isEmptyObject(memory.feedback.toplevel)){memory.feedback.toplevel=$.extend(true,{},localMemory.feedback.toplevel);if(typeof memory.feedback.toplevel[M.DATALOAD_USER]!='undefined'){delete memory.feedback.toplevel[M.DATALOAD_USER];}}
if($.isEmptyObject(memory.feedback.pagesection[pssId])){memory.feedback.pagesection[pssId]=$.extend(true,{},localMemory.feedback.pagesection[pssId]);memory.feedback.block[pssId]={};}
if($.isEmptyObject(memory.feedback.block[pssId][bsId])){memory.feedback.block[pssId][bsId]=$.extend(true,{},localMemory.feedback.block[pssId][bsId]);}}},initMultiDomainMemory:function(domain,pageSection,block,response){var t=this;var memory=t.getMemory(domain);var localDomain=popManager.getBlockTopLevelDomain(block);if(domain!=localDomain){var localMemory=t.getMemory(localDomain);$.each(response['query-state'].general,function(rpssId,rpsParams){if($.isEmptyObject(memory['query-state'].general[rpssId])){memory['query-state'].general[rpssId]={};memory['query-state'].domain[rpssId]={};memory.dataset[rpssId]={};memory.runtimesettings.configuration[rpssId]={};memory.runtimesettings['query-url'][rpssId]={};memory.runtimesettings['query-multidomain-urls'][rpssId]={};memory.runtimesettings.configuration[rpssId]={}
memory.runtimesettings['js-settings'][rpssId]={};memory.settings['js-settings'][rpssId]={};memory.settings.jsmethods.pagesection[rpssId]=$.extend({},localMemory.settings.jsmethods.pagesection[rpssId]);memory.settings.jsmethods.block[rpssId]={};memory.settings['templates-cbs'][rpssId]={};memory.settings['templates-paths'][rpssId]={};memory.settings['db-keys'][rpssId]={};memory.settings.configuration[rpssId]={};memory.settings.configuration[rpssId][M.JS_MODULES]={};var rpsConfiguration=memory.settings.configuration[rpssId];var lpsConfiguration=localMemory.settings.configuration[rpssId];$.each(lpsConfiguration,function(key,value){if(key==M.JS_MODULES||key=='modules')return;t.copyToConfiguration(key,value,rpsConfiguration);});}
$.each(rpsParams,function(rbsId,rbParams){if($.isEmptyObject(memory['query-state'].general[rpssId][rbsId])){memory['query-state'].general[rpssId][rbsId]=$.extend({},localMemory['query-state'].general[rpssId][rbsId]);memory['query-state'].domain[rpssId][rbsId]=$.extend({},localMemory['query-state'].domain[rpssId][rbsId]);memory.dataset[rpssId][rbsId]=$.extend({},localMemory.dataset[rpssId][rbsId]);memory.runtimesettings.configuration[rpssId][rbsId]={};memory.runtimesettings['query-url'][rpssId][rbsId]=$.extend({},localMemory.runtimesettings['query-url'][rpssId][rbsId]);memory.runtimesettings['query-multidomain-urls'][rpssId][rbsId]=$.extend({},localMemory.runtimesettings['query-multidomain-urls'][rpssId][rbsId]);memory.runtimesettings.configuration[rpssId][rbsId]=$.extend({},localMemory.runtimesettings.configuration[rpssId][rbsId]);memory.runtimesettings['js-settings'][rpssId][rbsId]=$.extend({},localMemory.runtimesettings['js-settings'][rpssId][rbsId]);memory.settings['js-settings'][rpssId][rbsId]=$.extend({},localMemory.settings['js-settings'][rpssId][rbsId]);memory.settings.jsmethods.block[rpssId][rbsId]=$.extend({},localMemory.settings.jsmethods.block[rpssId][rbsId]);memory.settings['templates-cbs'][rpssId][rbsId]=$.extend({},localMemory.settings['templates-cbs'][rpssId][rbsId]);memory.settings['templates-paths'][rpssId][rbsId]=$.extend({},localMemory.settings['templates-paths'][rpssId][rbsId]);memory.settings['db-keys'][rpssId][rbsId]=$.extend({},localMemory.settings['db-keys'][rpssId][rbsId]);memory.settings.configuration[rpssId][M.JS_MODULES][rbsId]=$.extend({},localMemory.settings.configuration[rpssId][M.JS_MODULES][rbsId]);}});});}},executeFetchBlockSuccess:function(pageSection,block,response,status,jqXHR){var t=this;var blockQueryState=t.getBlockQueryState(pageSection,block);var loadingUrl=blockQueryState.url[jqXHR.url];var action=blockQueryState.action[loadingUrl];var runtimeOptions={url:blockQueryState['paramsscope-url'][loadingUrl]};var processOptions={operation:blockQueryState.operation[loadingUrl],action:blockQueryState.action[loadingUrl],'fetch-status':status};var domain=blockQueryState.domain[loadingUrl];t.initMultiDomainMemory(domain,pageSection,block,response);var memory=t.getMemory(domain);var restoreinitial_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH,M.CBACTION_RESET];var restoreinitial=restoreinitial_actions.indexOf(action)>-1;if(restoreinitial){var initialMemory=t.getInitialBlockMemory(runtimeOptions.url);$.each(response['query-state'].general,function(rpssId,rpsParams){$.each(rpsParams,function(rbsId,rbParams){memory.runtimesettings.configuration[rpssId][rbsId]=initialMemory.runtimesettings.configuration[rpssId][rbsId];});});}
t.integrateTopLevelFeedback(domain,response);t.integrateDatabases(domain,response);$.each(response['query-state'].general,function(rpssId,rpsParams){var rPageSection=$('#'+memory.settings.configuration[rpssId].id);if(!memory.feedback.block[rpssId]){memory.feedback.block[rpssId]={};}
$.extend(memory.feedback.block[rpssId],response.feedback.block[rpssId]);if(!memory.dataset[rpssId]){memory.dataset[rpssId]={};}
$.extend(memory.dataset[rpssId],response.dataset[rpssId]);if(!memory['query-state'].general[rpssId]){memory['query-state'].general[rpssId]={};}
if(!memory['query-state'].domain[rpssId]){memory['query-state'].domain[rpssId]={};}
$.each(rpsParams,function(rbsId,rbParams){try{var rBlock=$('#'+t.getBlockId(rpssId,rbsId,runtimeOptions));$.extend(t.getBlockQueryState(rPageSection,rBlock,runtimeOptions),rbParams);$.extend(t.getBlockDomainQueryState(domain,rPageSection,rBlock,runtimeOptions),response['query-state'].domain[rpssId][rbsId]);var process_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH];if(process_actions.indexOf(action)>-1){var jsSettings=t.getJsSettings(domain,rPageSection,rBlock);if(jsSettings['processblock-ifhasdata']&&!response.dataset[rpssId][rbsId].length){return;}}
t.processBlock(domain,rPageSection,rBlock,processOptions);}
catch(err){console.log('Error: '+err.message);}});});block.triggerHandler('fetched',[response,action,domain]);},triggerEvent:function(pageSection,block,event,args){var t=this;block.triggerHandler(event,args);},integrateTopLevelFeedback:function(domain,response){var t=this;var tlFeedback=t.getMemory(domain).feedback.toplevel;$.each(response.feedback.toplevel,function(key,value){if($.type(value)=='array'&&value.length==0){}
else if($.type(value)=='object'){if(!tlFeedback[key]){tlFeedback[key]={};}
$.extend(tlFeedback[key],value);}
else{tlFeedback[key]=value;}});},clearUserDatabase:function(domain){var t=this;t.state[domain].userdatabase={};},integrateDatabase:function(database,responsedb){var t=this;$.each(responsedb,function(dbKey,dbItems){database[dbKey]=database[dbKey]||{};if($.type(dbItems)=='array'){return;}
$.each(dbItems,function(key,value){if(!database[dbKey][key]){database[dbKey][key]={};}
$.extend(database[dbKey][key],value);});});},integrateDatabases:function(domain,response){var t=this;t.integrateDatabase(t.getDatabase(domain),response.database);t.integrateDatabase(t.getUserDatabase(domain),response.userdatabase);},getMergeTargetContainer:function(target){var t=this;if(target.data('merge-container')){return $(target.data('merge-container'));}
return target;},getMergeTarget:function(target,templateName,options){var t=this;options=options||{};var selector='.pop-merge.'+templateName;var mergeTarget=options['merge-target']?$(options['merge-target']):target.find(selector).addBack(selector);return t.getMergeTargetContainer(mergeTarget);},generateUniqueId:function(domain){var t=this;var unique=Date.now();var tlFeedback=t.getTopLevelFeedback(domain);tlFeedback[M.UNIQUEID]=unique;return unique;},getUniqueId:function(domain){var t=this;var tlFeedback=t.getTopLevelFeedback(domain);return tlFeedback[M.UNIQUEID];},addUniqueId:function(url){var t=this;var domain=getDomain(url);var unique=t.getUniqueId(domain);return url+'#'+unique;},mergeTargetTemplate:function(domain,pageSection,target,templateName,options){var t=this;options=options||{};var rerender_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH,M.CBACTION_RESET];var rerender=rerender_actions.indexOf(options.action)>-1;if(rerender){t.generateUniqueId(domain);}
var html=t.getTemplateHtml(domain,pageSection,target,templateName,options);var targetContainer=t.getMergeTarget(target,templateName,options);var fetchStatus=options['fetch-status']||{isFirst:true,isLast:true};var operation=options.operation||(fetchStatus.isFirst?M.URLPARAM_OPERATION_REPLACE:M.URLPARAM_OPERATION_APPEND);if(operation==M.URLPARAM_OPERATION_REPLACE&&!fetchStatus.isFirst){operation=M.URLPARAM_OPERATION_APPEND;}
if(operation==M.URLPARAM_OPERATION_REPLACE){target.triggerHandler('replace',[options.action]);if(rerender){target.triggerHandler('rerender',[options.action]);}
targetContainer.empty();}
var merged=t.mergeHtml(html,targetContainer,operation);target.triggerHandler('merged',[merged.newDOMs]);return merged;},mergeHtml:function(html,container,operation){var t=this;var newDOMs=$(html);if(operation==M.URLPARAM_OPERATION_PREPEND){container.prepend(newDOMs);}
else if(operation==M.URLPARAM_OPERATION_REPLACEINLINE){container.replaceWith(newDOMs);container=newDOMs;}
else{container.append(newDOMs);}
t.triggerHTMLMerged();return{targetContainer:container,newDOMs:newDOMs};},triggerHTMLMerged:function(){var t=this;$(document).triggerHandler('template:merged');},renderPageSection:function(domain,pageSection,options){var t=this;options=options||{};$.extend(options,t.getFetchPageSectionSettings(pageSection));var newDOMs;if(options['serverside-rendering']){t.triggerHTMLMerged();newDOMs=t.getPageSectionDOMs(domain,pageSection);}
else{newDOMs=t.renderTarget(domain,pageSection,pageSection,options);}
if(newDOMs.length){t.pageSectionRendered(domain,pageSection,newDOMs,options);}},getPageSectionDOMs:function(domain,pageSection){var t=this;var templates_cbs=t.getTemplatesCbs(domain,pageSection,pageSection);var targetContainers=$();var newDOMs=$();$.each(templates_cbs,function(index,templateName){var targetContainer=t.getMergeTarget(pageSection,templateName);targetContainers.add(targetContainer);newDOMs=newDOMs.add(targetContainer.children());});t.triggerRendered(domain,pageSection,newDOMs,targetContainers);return newDOMs;},renderTarget:function(domain,pageSection,target,options){var t=this;options=options||{};target.triggerHandler('beforeMerge',[options]);var templates_cbs=t.getTemplatesCbs(domain,pageSection,target,options.action);var targetContainers=$();var newDOMs=$();$.each(templates_cbs,function(index,templateName){var merged=t.mergeTargetTemplate(domain,pageSection,target,templateName,options);targetContainers=targetContainers.add(merged.targetContainer);newDOMs=newDOMs.add(merged.newDOMs);});t.triggerRendered(domain,target,newDOMs,targetContainers);return newDOMs;},triggerRendered:function(domain,target,newDOMs,targetContainers){var t=this;target.triggerHandler('rendered',[newDOMs,targetContainers,domain]);$(document).triggerHandler('rendered',[target,newDOMs,targetContainers,domain]);},getPageSectionConfiguration:function(domain,pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getMemory(domain).settings.configuration[pssId];},getTargetConfiguration:function(domain,pageSection,target,template){var t=this;var templatePath=t.getTemplatePath(domain,pageSection,target,template);var targetConfiguration=t.getPageSectionConfiguration(domain,pageSection);if(templatePath){$.each(templatePath,function(index,pathLevel){targetConfiguration=targetConfiguration[pathLevel];});}
return targetConfiguration;},overrideFromItemObject:function(itemObject,override,overrideFields){var t=this;if(itemObject){$.each(overrideFields,function(index,overrideFromItemObject){override[overrideFromItemObject.key]=itemObject[overrideFromItemObject.field];});}},replaceFromItemObject:function(domain,pssId,bsId,template,itemObject,override,strReplace){var t=this;var feedback=t.getTopLevelFeedback(domain);var targetConfiguration=t.getTargetConfiguration(domain,pssId,bsId,template);$.each(strReplace,function(index,replace){var replaceWhereField=replace['replace-where-field'];var replaceWherePath=replace['replace-where-path'];var replaceFromField=replace['replace-from-field']||replaceWhereField;var replacements=replace['replacements'];var replaceFrom=targetConfiguration[replaceFromField];$.each(replacements,function(index,replacement){var replaceStr=replacement['replace-str'];if(itemObject){var replaceWithField=replacement['replace-with-field'];if(replaceWithField&&replaceStr!=itemObject[replaceWithField]){var replaceWith=itemObject[replaceWithField];if(replacement['encode-uri-component']){replaceWith=encodeURIComponent(replaceWith);}
else if(replacement['encode-uri']){replaceWith=encodeURI(replaceWith);}
replaceFrom=replaceFrom.replace(new RegExp(replaceStr,'g'),replaceWith);}}
var replaceFromFeedback=replacement['replace-from-feedback'];if(replaceFromFeedback&&replaceStr!=feedback[replaceFromFeedback]){replaceFrom=replaceFrom.replace(new RegExp(replaceStr,'g'),feedback[replaceFromFeedback]);}});var overrideWhere=override;if(replaceWherePath){$.each(replaceWherePath,function(index,pathlevel){overrideWhere[pathlevel]={};overrideWhere=overrideWhere[pathlevel];});}
overrideWhere[replaceWhereField]=replaceFrom;});},getTemplateHtml:function(domain,pageSection,target,templateName,options,itemDBKey,itemObjectId){var t=this;var targetConfiguration=t.getTargetConfiguration(domain,pageSection,target,templateName);options=options||{};targetContext=targetConfiguration;var templatePath=t.getTemplatePath(domain,pageSection,target,templateName);if(templatePath.length){var block=t.getBlock(target);t.initContextSettings(domain,pageSection,block,targetContext);t.extendContext(targetContext,domain,itemDBKey,itemObjectId);}
var extendContext=options.extendContext;if(extendContext){targetContext=$.extend({},targetContext,extendContext);}
return t.getHtml(templateName,targetContext);},extendContext:function(context,domain,itemDBKey,itemObjectId,override){var t=this;override=override||{};$.extend(context,override);if(itemDBKey){$.extend(context,{itemDBKey:itemDBKey});if(itemObjectId){var itemObject=t.getItemObject(domain,itemDBKey,itemObjectId);$.extend(context,{itemObject:itemObject,itemObjectDBKey:itemDBKey});}}},initTopLevelJson:function(domain){var t=this;var jsonHtml=$('#'+popPageSectionManager.getTopLevelSettingsId());var json=$.parseJSON(jsonHtml.html());t.sitemapping=json.sitemapping;t.state[domain].database=json.database;t.state[domain].userdatabase=json.userdatabase;var memory=t.getMemory(domain);memory.settings=json.settings;memory.runtimesettings=json.runtimesettings;memory.dataset=json.dataset;memory.feedback=json.feedback;memory['query-state']=json['query-state'];$.each(memory.dataset,function(pssId,psDataset){if($.type(psDataset)=='array'){memory.dataset[pssId]={};}});$.each(memory['query-state'].general,function(pssId,psParams){if($.type(psParams)=='array'){memory['query-state'].general[pssId]={};}});$.each(memory['query-state'].domain,function(pssId,psParams){if($.type(psParams)=='array'){memory['query-state'].domain[pssId]={};}});$.each(memory.feedback.pagesection,function(pssId,psFeedback){if($.type(psFeedback)=='array'){memory.feedback.pagesection[pssId]={};}});$.each(memory.feedback.block,function(pssId,bFeedback){if($.type(bFeedback)=='array'){memory.feedback.block[pssId]={};}});t.saveUrlPointers(json);t.addReplicableMemory(json);t.addInitialBlockMemory(json);},getBlockDefaultParams:function(){var t=this;return{url:{},loading:[],reload:[],operation:{},action:{},domain:{},timestamps:{},'paramsscope-url':{},'post-data':'',filter:''};},getBlockDefaultMultiDomainParams:function(){var t=this;return{};},getPageSectionDefaultParams:function(){var t=this;return{url:{},target:{},'fetch-url':{},loading:[]};},initPageSectionRuntimeMemory:function(domain,pageSection,options){var t=this;var runtimeMempage=t.newRuntimeMemoryPage(domain,pageSection,pageSection,options);var pssId=t.getSettingsId(pageSection);runtimeMempage['query-state']=t.getPageSectionDefaultParams();var args={domain:domain,pageSection:pageSection,runtimeMempage:runtimeMempage};popJSLibraryManager.execute('initPageSectionRuntimeMemory',args);},initBlockRuntimeMemory:function(domain,pageSection,block,options){var t=this;var runtimeMempage=t.newRuntimeMemoryPage(domain,pageSection,block,options);var memory=t.getMemory(domain);var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);runtimeMempage.id=block.attr('id');runtimeMempage['query-url']=t.getRuntimeSettings(domain,pageSection,block,'query-url');runtimeMempage['query-multidomain-urls']={};runtimeMempage['query-state']={general:$.extend(t.getBlockDefaultParams(),memory['query-state'].general[pssId][bsId]),domain:{},};var multidomain_urls=t.getRuntimeSettings(domain,pageSection,block,'query-multidomain-urls');$.each(multidomain_urls,function(index,query_url){query_url_domain=getDomain(query_url);runtimeMempage['query-multidomain-urls'][query_url_domain]=query_url;runtimeMempage['query-state'].domain[query_url_domain]=$.extend(t.getBlockDefaultMultiDomainParams(),memory['query-state'].domain[pssId][bsId]);})
var args={domain:domain,pageSection:pageSection,block:block,runtimeMempage:runtimeMempage};popJSLibraryManager.execute('initBlockRuntimeMemory',args);},getViewport:function(pageSection,el){var t=this;var viewport=el.closest('.pop-viewport');if(viewport.length){return viewport;}
return pageSection;},getDOMContainer:function(pageSection,el){var t=this;if(M.DOMCONTAINER_ID){return $('#'+M.DOMCONTAINER_ID);}
return t.getViewport(pageSection,el);},getBlock:function(el){var t=this;if(el.hasClass('pop-block')){return el;}
if(el.closest('.pop-block').length){return el.closest('.pop-block');}
if(el.closest('[data-block]').length){return $(el.closest('[data-block]').data('block'));}
return null;},getTargetParamsScopeURL:function(target){var t=this;return target.data(M.PARAMS_PARAMSSCOPE_URL);},getBlockTopLevelURL:function(block){var t=this;return block.data(M.PARAMS_TOPLEVEL_URL);},getBlockTopLevelDomain:function(block){var t=this;return block.data(M.PARAMS_TOPLEVEL_DOMAIN);},isBlockGroup:function(block){var t=this;return block.hasClass('pop-blockgroup');},getBlockGroupActiveBlock:function(blockGroup){var t=this;return blockGroup.find('.tab-pane.active .pop-block, .collapse.in .pop-block');},getBlockGroupBlocks:function(blockGroup){var t=this;return blockGroup.find('.pop-block');},getTemplateSource:function(template){var t=this;return t.sitemapping['template-sources'][template]||template;},initPageSectionSettings:function(domain,pageSection,psConfiguration){var t=this;var tls=t.getTopLevelSettings(domain);$.extend(psConfiguration,{tls:tls});var pss=t.getPageSectionSettings(domain,pageSection);var pssId=t.getSettingsId(pageSection);var psId=psConfiguration[M.JS_FRONTENDID];$.extend(psConfiguration,{pss:pss});t.expandJSKeys(psConfiguration);if(psConfiguration[M.JS_MODULES]){$.each(psConfiguration[M.JS_MODULES],function(bsId,bConfiguration){var bId=bConfiguration[M.JS_FRONTENDID];var bs=t.getBlockSettings(domain,domain,pssId,bsId,psId,bId);$.extend(bConfiguration,{tls:tls,pss:pss,bs:bs});t.expandJSKeys(bConfiguration);});}},initContextSettings:function(domain,pageSection,block,context){var t=this;var tls=t.getTopLevelSettings(domain);$.extend(context,{tls:tls});var pss=t.getPageSectionSettings(domain,pageSection);$.extend(context,{pss:pss});var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');var bsId=t.getSettingsId(block);var bId=block.attr('id');var bs=t.getBlockSettings(domain,t.getBlockTopLevelDomain(block),pssId,bsId,psId,bId);$.extend(context,{pss:pss,bs:bs});t.expandJSKeys(context);if(!context.itemDBKey){context.itemDBKey=bs['db-keys']['db-key'];}},copyToConfiguration:function(key,value,configuration){var t=this;if($.type(value)=='array'){configuration[key]={};}
else if($.type(value)=='object'){if(!configuration[key]){configuration[key]={};}
$.extend(configuration[key],value);}
else{configuration[key]=value;}},integratePageSection:function(domain,response){var t=this;$.extend(t.sitemapping['template-sources'],response.sitemapping['template-sources']);var memory=t.getMemory(domain);$.each(response.settings.configuration,function(pssId,rpsConfiguration){memory['query-state'].general[pssId]=memory['query-state'].general[pssId]||{};memory['query-state'].domain[pssId]=memory['query-state'].domain[pssId]||{};memory.dataset[pssId]=memory.dataset[pssId]||{};memory.feedback.pagesection[pssId]=memory.feedback.pagesection[pssId]||{};memory.feedback.block[pssId]=memory.feedback.block[pssId]||{};memory.runtimesettings['query-url'][pssId]=memory.runtimesettings['query-url'][pssId]||{};memory.runtimesettings['query-multidomain-urls'][pssId]=memory.runtimesettings['query-multidomain-urls'][pssId]||{};memory.runtimesettings.configuration[pssId]=memory.runtimesettings.configuration[pssId]||{};memory.runtimesettings['js-settings'][pssId]=memory.runtimesettings['js-settings'][pssId]||{};memory.settings['js-settings'][pssId]=memory.settings['js-settings'][pssId]||{};memory.settings.jsmethods.pagesection[pssId]=memory.settings.jsmethods.pagesection[pssId]||{};memory.settings.jsmethods.block[pssId]=memory.settings.jsmethods.block[pssId]||{};memory.settings['templates-cbs'][pssId]=memory.settings['templates-cbs'][pssId]||{};memory.settings['templates-paths'][pssId]=memory.settings['templates-paths'][pssId]||{};memory.settings['db-keys'][pssId]=memory.settings['db-keys'][pssId]||{};memory.settings.configuration[pssId]=memory.settings.configuration[pssId]||{};$.extend(memory['query-state'].general[pssId],response['query-state'].general[pssId]);$.extend(memory['query-state'].domain[pssId],response['query-state'].domain[pssId]);$.extend(memory.dataset[pssId],response.dataset[pssId]);$.extend(memory.feedback.pagesection[pssId],response.feedback.pagesection[pssId]);$.extend(memory.feedback.block[pssId],response.feedback.block[pssId]);$.extend(memory.runtimesettings['query-url'][pssId],response.runtimesettings['query-url'][pssId]);$.extend(memory.runtimesettings['query-multidomain-urls'][pssId],response.runtimesettings['query-multidomain-urls'][pssId]);$.extend(memory.runtimesettings.configuration[pssId],response.runtimesettings.configuration[pssId]);$.extend(memory.runtimesettings['js-settings'][pssId],response.runtimesettings['js-settings'][pssId]);$.extend(memory.settings['js-settings'][pssId],response.settings['js-settings'][pssId]);$.extend(memory.settings.jsmethods.pagesection[pssId],response.settings.jsmethods.pagesection[pssId]);$.extend(memory.settings.jsmethods.block[pssId],response.settings.jsmethods.block[pssId]);$.extend(memory.settings['templates-cbs'][pssId],response.settings['templates-cbs'][pssId]);$.extend(memory.settings['templates-paths'][pssId],response.settings['templates-paths'][pssId]);$.extend(memory.settings['db-keys'][pssId],response.settings['db-keys'][pssId]);var psConfiguration=memory.settings.configuration[pssId];$.each(rpsConfiguration,function(key,value){t.copyToConfiguration(key,value,psConfiguration);});var psId=rpsConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);t.initPageSectionSettings(domain,pageSection,psConfiguration);});},getTopLevelSettings:function(domain){var t=this;return{domain:domain,'domain-id':getDomainId(domain),feedback:t.getTopLevelFeedback(domain),};},getPageSectionSettings:function(domain,pageSection){var t=this;var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');var pageSectionSettings={feedback:t.getPageSectionFeedback(domain,pageSection),pssId:pssId,psId:psId};return pageSectionSettings;},isMultiDomain:function(blockTLDomain,pssId,bsId){var t=this;var multidomain_urls=t.getRuntimeSettings(blockTLDomain,pssId,bsId,'query-multidomain-urls');return(multidomain_urls&&multidomain_urls.length>=2);},getBlockSettings:function(domain,blockTLDomain,pssId,bsId,psId,bId){var t=this;var blockSettings={"db-keys":t.getDatabaseKeys(domain,pssId,bsId),dataset:t.getBlockDataset(domain,pssId,bsId),feedback:t.getBlockFeedback(domain,pssId,bsId),bsId:bsId,bId:bId,'toplevel-domain':blockTLDomain,'is-multidomain':t.isMultiDomain(blockTLDomain,pssId,bsId)};t.expandBlockSettingsJSKeys(blockSettings);return blockSettings;},expandBlockSettingsJSKeys:function(blockSettings){var t=this;if(blockSettings&&M.COMPACT_JS_KEYS){if(blockSettings['db-keys']&&blockSettings['db-keys'][M.JS_SUBCOMPONENTS]){blockSettings['db-keys'].subcomponents=blockSettings['db-keys'][M.JS_SUBCOMPONENTS];}}},getBlockDataset:function(domain,pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);return t.getMemory(domain).dataset[pssId][bsId];},getBlockFeedback:function(domain,pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);return t.getMemory(domain).feedback.block[pssId][bsId];},getPageSectionFeedback:function(domain,pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getMemory(domain).feedback.pagesection[pssId];},getTopLevelFeedback:function(domain){var t=this;return t.getMemory(domain).feedback.toplevel;},getSettings:function(domain,pageSection,target,item){var t=this;var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);var memory=t.getMemory(domain);return memory.settings[item][pssId][targetId];},getRuntimeSettings:function(domain,pageSection,target,item){var t=this;var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);var memory=t.getMemory(domain);return memory.runtimesettings[item][pssId][targetId];},getQueryUrl:function(pageSection,block){var t=this;return t.getRuntimeMemoryPage(pageSection,block)['query-url'];},getQueryMultiDomainUrls:function(pageSection,block){var t=this;return t.getRuntimeMemoryPage(pageSection,block)['query-multidomain-urls'];},getRuntimeConfiguration:function(domain,pageSection,block,el){var t=this;el=el||block;var elsId=t.getTemplateOrObjectSettingsId(el);var configuration=t.getRuntimeSettings(domain,pageSection,block,'configuration');return configuration[elsId]||{};},getDatabaseKeys:function(domain,pageSection,block){var t=this;return t.getSettings(domain,pageSection,block,'db-keys');},getBlockFilteringUrl:function(domain,pageSection,block,use_pageurl){var t=this;var url=t.getQueryUrl(pageSection,block);if(!url&&use_pageurl){url=t.getTopLevelFeedback(domain)[M.URLPARAM_URL];}
var post_data=t.getBlockPostData(domain,pageSection,block,{paramsGroup:'visible'});if(post_data){if(url.indexOf('?')>-1){url+='&';}
else{url+='?';}
url+=post_data;}
return url;},click:function(url,target,container){var t=this;target=target||'';container=container||$(document.body);var linkHtml='<a href="'+url+'" target="'+target+'" class="hidden"></a>';var link=$(linkHtml).appendTo(container);link.trigger('click');},getUnembedUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getUnembedUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getEmbedUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getEmbedUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getAPIUrl:function(url){var t=this;$.each(M.API_URLPARAMS,function(param,value){url=add_query_arg(param,value,url);});return url;},getPrintUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getPrintUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getDestroyUrl:function(url){var t=this;var domain=getDomain(url);return domain+'/destroy'+url.substr(domain.length);},getTemplateOrObjectSettingsId:function(el){var t=this;if($.type(el)=='object'){return el.data('templateid');}
return el;},getPageSectionJsSettings:function(domain,pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getSettings(domain,pageSection,pageSection,'js-settings')||{};},getJsSettings:function(domain,pageSection,block,el){var t=this;el=el||block;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var jsSettingsId=t.getTemplateOrObjectSettingsId(el);var settings=t.getSettings(domain,pageSection,block,'js-settings');var runtimeSettings=t.getRuntimeSettings(domain,pageSection,block,'js-settings');var jsSettings={};if(settings[jsSettingsId]){$.extend(jsSettings,settings[jsSettingsId]);}
if(runtimeSettings[jsSettingsId]){$.extend(true,jsSettings,runtimeSettings[jsSettingsId]);}
return jsSettings;},getPageSectionJsMethods:function(domain,pageSection){var t=this;var pssId=t.getSettingsId(pageSection);var memory=t.getMemory(domain);return memory.settings['jsmethods']['pagesection'][pssId]||{};},getBlockJsMethods:function(domain,pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var memory=t.getMemory(domain);return memory.settings['jsmethods']['block'][pssId][bsId]||{};},restoreInitialBlockMemory:function(pageSection,block,options){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var url=t.getTargetParamsScopeURL(block);var initialMemory=t.getInitialBlockMemory(url);var queryState=t.getRuntimeMemoryPage(pageSection,block,options)['query-state'];queryState.general=$.extend(t.getBlockDefaultParams(),initialMemory['query-state'].general[pssId][bsId]);var dataset=initialMemory.dataset[pssId][bsId];var query_urls=t.getQueryMultiDomainUrls(pageSection,block);$.each(query_urls,function(domain,query_url){queryState.domain[domain]=$.extend(t.getBlockDefaultMultiDomainParams(),initialMemory['query-state'].domain[pssId][bsId]);var memory=t.getMemory(domain);memory.runtimesettings.configuration[pssId][bsId]=$.extend({},initialMemory.runtimesettings.configuration[pssId][bsId]);memory.feedback.block[pssId][bsId]=$.extend({},initialMemory.feedback.block[pssId][bsId]);if(dataset.length){$.extend(memory.dataset[pssId][bsId],dataset);}
else{memory.dataset[pssId][bsId]=[];}});},getBlockQueryState:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options)['query-state'].general;},getBlockMultiDomainQueryState:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options)['query-state'].domain;},getBlockDomainQueryState:function(domain,pageSection,block,options){var t=this;return t.getBlockMultiDomainQueryState(pageSection,block,options)[domain]||{};},getPageSectionParams:function(pageSection,options){var t=this;return t.getRuntimeMemoryPage(pageSection,pageSection,options)['query-state'];},getTarget:function(pageSection){var t=this;var id=pageSection.attr('id');var ret=M.URLPARAM_TARGET_MAIN;$.each(M.FETCHTARGET_SETTINGS,function(target,psId){if(psId==id){ret=target;return-1;}});return ret;},targetExists:function(target){var t=this;return M.FETCHTARGET_SETTINGS[target];},getFetchTargetPageSection:function(target){var t=this;if(!target||target=='_self'||!M.FETCHTARGET_SETTINGS[target]){target=M.URLPARAM_TARGET_MAIN;}
return $('#'+M.FETCHTARGET_SETTINGS[target]);},getFetchPageSectionSettings:function(pageSection){var t=this;var psId=pageSection.attr('id');return M.FETCHPAGESECTION_SETTINGS[psId]||{};},getTemplatesCbs:function(domain,pageSection,target,action){var t=this;action=action||'main';var templatesCbs=t.getSettings(domain,pageSection,target,'templates-cbs');var cbs=templatesCbs.cbs;var actions=templatesCbs.actions;if($.isArray(actions)&&!actions.length){return cbs;}
var allowed=[];$.each(cbs,function(index,cb){if(!actions[cb]||actions[cb].indexOf(action)>-1){allowed.push(cb);}});return allowed;},getTemplatePath:function(domain,pageSection,target,template){var t=this;var templatePaths=t.getSettings(domain,pageSection,target,'templates-paths');return templatePaths[template];},getScriptTemplate:function(templateName){var t=this;var templateSource=t.getTemplateSource(templateName);return Handlebars.templates[templateSource];},getPageSectionGroup:function(elem){var t=this;return elem.closest('.pop-pagesection-group').addBack('.pop-pagesection-group');},getPageSection:function(elem){var t=this;return elem.closest('.pop-pagesection').addBack('.pop-pagesection');},getPageSectionPage:function(elem){var t=this;var page=elem.closest('.pop-pagesection-page').addBack('.pop-pagesection-page');if(page.length){return page;}
return t.getPageSection(elem);},getBlockId:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options).id;},getHtml:function(templateName,context){var t=this;var template=t.getScriptTemplate(templateName);if(typeof template=='undefined'){console.error('No template for '+templateName);return'';}
try{return template(context);}
catch(err){console.log('Error in '+templateName+': '+err.message);}
return'';},getItemObject:function(domain,itemDBKey,itemObjectId){var t=this;var userItem={},item={};var userdatabase=t.getUserDatabase(domain);var database=t.getDatabase(domain);if(userdatabase[itemDBKey]&&userdatabase[itemDBKey][itemObjectId]){userItem=userdatabase[itemDBKey][itemObjectId];}
if(database[itemDBKey]&&database[itemDBKey][itemObjectId]){item=database[itemDBKey][itemObjectId];}
return $.extend({},userItem,item);},getFrameTarget:function(pageSection){var t=this;return pageSection.data('frametarget')||M.URLPARAM_TARGET_MAIN;},getClickFrameTarget:function(pageSection){var t=this;return pageSection.data('clickframetarget')||t.getFrameTarget(pageSection);},getOriginalLink:function(link){var t=this;var intercepted=link.data('interceptedTarget');if(intercepted){return t.getOriginalLink(intercepted);}
return link;},};})(jQuery);