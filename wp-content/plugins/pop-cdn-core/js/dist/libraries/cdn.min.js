"use strict";!function(t){window.popCDN={localStorageKey:"PoP:cdn-thumbprints",thumbprintValues:{},documentInitialized:function(e){var r=this,a=e.domain,n=popManager.getTopLevelFeedback(a)[M.CDN_THUMBPRINTVALUES];r.thumbprintValues=popManager.getStoredData(r.localStorageKey,!1),r.thumbprintValues?r.updateThumbprintValues(n):(r.thumbprintValues=t.extend({},n),r.storeData())},pageSectionFetchSuccess:function(t){var e=this,r=t.response;e.fetchSuccess(r)},blockFetchSuccess:function(t){var e=this,r=t.response;e.fetchSuccess(r)},modifyFetchArgs:function(t){var e=this,r=t.options,a=t.url;if(e.useCDN(a)){t.url=e.getCDNUrl(a);var n=e.getThumbprintValue(a);n&&(r.params=r.params||{},r.params[M.CDN_URLPARAM_THUMBPRINT]=n)}},modifyFetchBlockArgs:function(t){var e=this,r=t.options,a=t.url;if("GET"==t.type&&e.useCDN(a)){t.url=e.getCDNUrl(a);var n=e.getThumbprintValue(a);n&&(r["onetime-post-data"]=r["onetime-post-data"]?r["onetime-post-data"]+"&":"",r["onetime-post-data"]+=M.CDN_URLPARAM_THUMBPRINT+"="+n)}},fetchSuccess:function(t){this.updateThumbprintValues(t.feedback.toplevel[M.CDN_THUMBPRINTVALUES])},updateThumbprintValues:function(t){var e=this,r=!1;for(var a in t)t[a]>e.thumbprintValues[a]&&(e.thumbprintValues[a]=t[a],r=!0);r&&e.storeData()},storeData:function(){var t=this;popManager.storeData(t.localStorageKey,t.thumbprintValues)},useCDN:function(t){return M.CDN_CONTENT_URI&&t.startsWith(M.HOME_DOMAIN)&&popCDNThumbprints.canUseCDN(t)},getCDNUrl:function(t){return M.CDN_CONTENT_URI+t.substr(M.HOME_DOMAIN.length)},getThumbprintValue:function(e){var r=this,a=popCDNThumbprints.getThumbprints(e),n=[];return t.each(a,function(t,e){n.push(r.thumbprintValues[e])}),n.join(M.CDN_SEPARATOR_THUMBPRINT)},convertURL:function(t){var e=this;if(e.useCDN(t)){var r=e.getThumbprintValue(t);t=e.getCDNUrl(t),r&&(t=add_query_arg(M.CDN_URLPARAM_THUMBPRINT,r,t))}return t}}}(jQuery),popJSLibraryManager.register(popCDN,["documentInitialized","pageSectionFetchSuccess","blockFetchSuccess"],!0),popJSLibraryManager.register(popCDN,["modifyFetchArgs","modifyFetchBlockArgs"]);