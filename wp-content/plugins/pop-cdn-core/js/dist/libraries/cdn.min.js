!function(t){popCDN={localStorageKey:"PoP:cdn-thumbprints",thumbprintValues:{},documentInitialized:function(e){var a=this,r=e.domain,n=popManager.getTopLevelFeedback(r)[M.CDN_THUMBPRINTVALUES];a.thumbprintValues=popManager.getStoredData(a.localStorageKey,!1),a.thumbprintValues?a.updateThumbprintValues(n):(a.thumbprintValues=t.extend({},n),a.storeData())},pageSectionFetchSuccess:function(t){var e=this,a=t.response;e.fetchSuccess(a)},blockFetchSuccess:function(t){var e=this,a=t.response;e.fetchSuccess(a)},modifyFetchArgs:function(t){var e=this,a=t.options,r=t.url;if(e.useCDN(r)){t.url=e.getCDNUrl(r);var n=e.getThumbprintValue(r);n&&(a.params=a.params||{},a.params[M.CDN_URLPARAM_THUMBPRINT]=n)}},modifyFetchBlockArgs:function(t){var e=this,a=t.options,r=t.url;if("GET"==t.type&&e.useCDN(r)){t.url=e.getCDNUrl(r);var n=e.getThumbprintValue(r);n&&(a["onetime-post-data"]=a["onetime-post-data"]?a["onetime-post-data"]+"&":"",a["onetime-post-data"]+=M.CDN_URLPARAM_THUMBPRINT+"="+n)}},fetchSuccess:function(t){this.updateThumbprintValues(t.feedback.toplevel[M.CDN_THUMBPRINTVALUES])},updateThumbprintValues:function(t){var e=this,a=!1;for(var r in t)t[r]>e.thumbprintValues[r]&&(e.thumbprintValues[r]=t[r],a=!0);a&&e.storeData()},storeData:function(){var t=this;popManager.storeData(t.localStorageKey,t.thumbprintValues)},useCDN:function(t){return M.CDN_CONTENT_URI&&t.startsWith(M.HOME_DOMAIN)&&popCDNThumbprints.canUseCDN(t)},getCDNUrl:function(t){return M.CDN_CONTENT_URI+t.substr(M.HOME_DOMAIN.length)},getThumbprintValue:function(e){var a=this,r=popCDNThumbprints.getThumbprints(e),n=[];return t.each(r,function(t,e){n.push(a.thumbprintValues[e])}),n.join(M.CDN_SEPARATOR_THUMBPRINT)},convertURL:function(t){var e=this;if(e.useCDN(t)){var a=e.getThumbprintValue(t);t=e.getCDNUrl(t),a&&(t=add_query_arg(M.CDN_URLPARAM_THUMBPRINT,a,t))}return t}}}(jQuery),popJSLibraryManager.register(popCDN,["documentInitialized","pageSectionFetchSuccess","blockFetchSuccess"],!0),popJSLibraryManager.register(popCDN,["modifyFetchArgs","modifyFetchBlockArgs"]);