(function($){popCDN={localStorageKey:'PoP:cdn-thumbprints',thumbprintValues:{},documentInitialized:function(){var t=this;var tlValues=popManager.getTopLevelFeedback()[M.CDN_THUMBPRINTVALUES];t.thumbprintValues=popManager.getStoredData(t.localStorageKey,false);if(t.thumbprintValues){t.updateThumbprintValues(tlValues);}
else{t.thumbprintValues=$.extend({},tlValues);t.storeData();}},pageSectionFetchSuccess:function(args){var t=this;var response=args.response;t.fetchSuccess(response);},blockFetchSuccess:function(args){var t=this;var response=args.response;t.fetchSuccess(response);},modifyFetchArgs:function(args){var t=this;var options=args.options,url=args.url;if(t.useCDN(url)){args.url=t.getCDNUrl(url);var thumbprint=t.getThumbprintValue(url);if(thumbprint){options.params=options.params||{};options.params[M.CDN_URLPARAM_THUMBPRINT]=thumbprint;}}},modifyFetchBlockArgs:function(args){var t=this;var options=args.options,url=args.url,type=args.type;if(type=='GET'&&t.useCDN(url)){args.url=t.getCDNUrl(url);var thumbprint=t.getThumbprintValue(url);if(thumbprint){options['onetime-post-data']=options['onetime-post-data']?options['onetime-post-data']+'&':'';options['onetime-post-data']+=M.CDN_URLPARAM_THUMBPRINT+'='+thumbprint;}}},fetchSuccess:function(response){var t=this;t.updateThumbprintValues(response.feedback.toplevel[M.CDN_THUMBPRINTVALUES]);},updateThumbprintValues:function(newValues){var t=this;var save=false;for(var key in newValues){if(newValues[key]>t.thumbprintValues[key]){t.thumbprintValues[key]=newValues[key];save=true;}}
if(save){t.storeData();}},storeData:function(){var t=this;popManager.storeData(t.localStorageKey,t.thumbprintValues);},useCDN:function(url){var t=this;return M.CDN_CONTENT_URI&&url.startsWith(M.HOME_URL)&&popCDNThumbprints.canUseCDN(url);},getCDNUrl:function(url){var t=this;return M.CDN_CONTENT_URI+url.substr(M.HOME_URL.length);},getThumbprintValue:function(url){var t=this;var thumbprints=popCDNThumbprints.getThumbprints(url);var value=[];$.each(thumbprints,function(index,thumbprint){value.push(t.thumbprintValues[thumbprint]);});return value.join(M.CDN_SEPARATOR_THUMBPRINT);},convertURL:function(url){var t=this;if(t.useCDN(url)){var thumbprint=t.getThumbprintValue(url);url=t.getCDNUrl(url);if(thumbprint){url=add_query_arg(M.CDN_URLPARAM_THUMBPRINT,thumbprint,url);}}
return url;},};})(jQuery);popJSLibraryManager.register(popCDN,['documentInitialized','pageSectionFetchSuccess','blockFetchSuccess'],true);popJSLibraryManager.register(popCDN,['modifyFetchArgs','modifyFetchBlockArgs']);;(function($){popCDNThumbprints={canUseCDN:function(url){var t=this;if(!popCDNConfig)return false;return!t.evalCriteria(url,popCDNConfig.criteria.rejected);},getThumbprints:function(url){var t=this;if(!popCDNConfig)return[];var thumbprints=[];$.each(popCDNConfig.thumbprints,function(index,thumbprint){if(t.evalCriteria(url,popCDNConfig.criteria.thumbprints[thumbprint])){thumbprints.push(thumbprint);}});return thumbprints;},isHome:function(url){var path=removeParams(url);var possible=[M.HOME_URL,M.HOME_URL+'/',M.HOMELOCALE_URL,M.HOMELOCALE_URL+'/'];return possible.indexOf(path)>-1;},evalCriteria:function(url,entries){var t=this;var evalParam=function(elem){var key=elem[0],value=elem[1];var paramValue=getParam(key,url);if(typeof paramValue=="object"){return searchInObject(paramValue,value);}
return paramValue==value;};var criterias=[{isHome:entries.isHome&&t.isHome(url),startsWith:entries.startsWith.full.some(function(path){return url.startsWith(path);}),pageStartsWith:entries.startsWith.partial.some(function(path){return url.startsWith(M.HOMELOCALE_URL+'/'+path);}),hasParamValues:entries.hasParamValues.some(evalParam)},{noParamValues:!entries.noParamValues.some(evalParam)}];var successCounter=0;$.each(criterias,function(index,criteria){var successCriteria=Object.keys(criteria).filter(function(criteriaKey){return criteria[criteriaKey];});if(successCriteria.length){successCounter++;}});return(successCounter==criterias.length);}};})(jQuery);;(function($){popCDNCoreHooks={mentionsSource:function(args){var t=this;args.url=popCDN.convertURL(args.url);},typeaheadPrefetchURL:function(args){var t=this;args.url=popCDN.convertURL(args.url);},typeaheadRemoteURL:function(args){var t=this;args.url=popCDN.convertURL(args.url);},};})(jQuery);popJSLibraryManager.register(popCDNCoreHooks,['mentionsSource','typeaheadPrefetchURL','typeaheadRemoteURL']);