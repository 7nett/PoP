<?php
/**---------------------------------------------------------------------------------------------------------------
 *
 * Template Manager (Handlebars)
 *
 * ---------------------------------------------------------------------------------------------------------------*/

/*********************************************
 * My Content Tables
 *********************************************/
define ('GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT', PoP_ServerUtils::get_template_definition('block-myevents-table-edit'));
define ('GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT', PoP_ServerUtils::get_template_definition('block-mypastevents-table-edit'));

/*--------------------------------------------
 * My Content Full Post Preview
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW', PoP_ServerUtils::get_template_definition('block-myevents-scroll-simpleviewpreview'));
define ('GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW', PoP_ServerUtils::get_template_definition('block-mypastevents-scroll-simpleviewpreview'));
define ('GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW', PoP_ServerUtils::get_template_definition('block-myevents-scroll-fullviewpreview'));
define ('GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW', PoP_ServerUtils::get_template_definition('block-mypastevents-scroll-fullviewpreview'));

/*********************************************
 * Typeaheads
 *********************************************/
define ('GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD', PoP_ServerUtils::get_template_definition('block-events-typeahead'));
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_TYPEAHEAD', PoP_ServerUtils::get_template_definition('block-pastevents-typeahead'));
define ('GD_TEMPLATE_BLOCK_LOCATIONS_TYPEAHEAD', PoP_ServerUtils::get_template_definition('block-locations-typeahead'));

/*********************************************
 * Scrolls
 *********************************************/
define ('GD_TEMPLATE_BLOCK_LOCATIONS_SCROLL', PoP_ServerUtils::get_template_definition('block-locations-scroll'));

/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
 * Common blocks (Home/Page/Author/Single)
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/
/*--------------------------------------------
 * Navigator
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-navigator'));
define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR', PoP_ServerUtils::get_template_definition('block-events-scroll-navigator'));
define ('GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR', PoP_ServerUtils::get_template_definition('block-eventscalendar-calendar-navigator'));

/*--------------------------------------------
 * Addons
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-addons'));
define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS', PoP_ServerUtils::get_template_definition('block-events-scroll-addons'));
define ('GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS', PoP_ServerUtils::get_template_definition('block-eventscalendar-calendar-addons'));

/*--------------------------------------------
 * Details: Thumb, title and excerpt
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS', PoP_ServerUtils::get_template_definition('block-events-scroll-details'));
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-details'));

define ('GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS', PoP_ServerUtils::get_template_definition('block-authorevents-scroll-details'));
define ('GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS', PoP_ServerUtils::get_template_definition('block-authorpastevents-scroll-details'));

define ('GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS', PoP_ServerUtils::get_template_definition('block-tagevents-scroll-details'));
define ('GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS', PoP_ServerUtils::get_template_definition('block-tagpastevents-scroll-details'));

/*--------------------------------------------
 * Full Post
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW', PoP_ServerUtils::get_template_definition('block-events-scroll-simpleview'));
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-simpleview'));

define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW', PoP_ServerUtils::get_template_definition('block-events-scroll-fullview'));
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-fullview'));

define ('GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW', PoP_ServerUtils::get_template_definition('block-authorevents-scroll-simpleview'));
define ('GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW', PoP_ServerUtils::get_template_definition('block-authorpastevents-scroll-simpleview'));

define ('GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW', PoP_ServerUtils::get_template_definition('block-authorevents-scroll-fullview'));
define ('GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW', PoP_ServerUtils::get_template_definition('block-authorpastevents-scroll-fullview'));

define ('GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW', PoP_ServerUtils::get_template_definition('block-tagevents-scroll-simpleview'));
define ('GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW', PoP_ServerUtils::get_template_definition('block-tagpastevents-scroll-simpleview'));

define ('GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW', PoP_ServerUtils::get_template_definition('block-tagevents-scroll-fullview'));
define ('GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW', PoP_ServerUtils::get_template_definition('block-tagpastevents-scroll-fullview'));

/*--------------------------------------------
 * Thumbnail
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL', PoP_ServerUtils::get_template_definition('block-events-scroll-thumbnail'));
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-thumbnail'));

define ('GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL', PoP_ServerUtils::get_template_definition('block-authorevents-scroll-thumbnail'));
define ('GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL', PoP_ServerUtils::get_template_definition('block-authorpastevents-scroll-thumbnail'));

define ('GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL', PoP_ServerUtils::get_template_definition('block-tagevents-scroll-thumbnail'));
define ('GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL', PoP_ServerUtils::get_template_definition('block-tagpastevents-scroll-thumbnail'));

/*--------------------------------------------
 * List
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST', PoP_ServerUtils::get_template_definition('block-events-scroll-list'));
define ('GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST', PoP_ServerUtils::get_template_definition('block-pastevents-scroll-list'));

define ('GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST', PoP_ServerUtils::get_template_definition('block-authorevents-scroll-list'));
define ('GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST', PoP_ServerUtils::get_template_definition('block-authorpastevents-scroll-list'));

define ('GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST', PoP_ServerUtils::get_template_definition('block-tagevents-scroll-list'));
define ('GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST', PoP_ServerUtils::get_template_definition('block-tagpastevents-scroll-list'));

/*--------------------------------------------
 * Map
 --------------------------------------------*/

define ('GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP', PoP_ServerUtils::get_template_definition('block-eventscalendar-calendarmap'));
define ('GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP', PoP_ServerUtils::get_template_definition('block-authoreventscalendar-calendarmap'));
define ('GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP', PoP_ServerUtils::get_template_definition('block-tageventscalendar-calendarmap'));

/*--------------------------------------------
 * Calendar
 --------------------------------------------*/
define ('GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR', PoP_ServerUtils::get_template_definition('block-eventscalendar-calendar'));
define ('GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR', PoP_ServerUtils::get_template_definition('block-authoreventscalendar-calendar'));
define ('GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR', PoP_ServerUtils::get_template_definition('block-tageventscalendar-calendar'));

/*********************************************
 * Post Carousels
 *********************************************/

define ('GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL', PoP_ServerUtils::get_template_definition('block-events-carousel'));
define ('GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL', PoP_ServerUtils::get_template_definition('block-authorevents-carousel'));
define ('GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL', PoP_ServerUtils::get_template_definition('block-tagevents-carousel'));

class GD_EM_Template_Processor_CustomSectionBlocks extends GD_Template_Processor_SectionBlocksBase {

	function get_templates_to_process() {
	
		return array(
			GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD,
			GD_TEMPLATE_BLOCK_PASTEVENTS_TYPEAHEAD,
			GD_TEMPLATE_BLOCK_LOCATIONS_TYPEAHEAD,
			GD_TEMPLATE_BLOCK_LOCATIONS_SCROLL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR,
			
			GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL,
		);
	}

	protected function get_block_inner_templates($template_id) {

		global $gd_template_processor_manager;

		$ret = parent::get_block_inner_templates($template_id);

		// if it's a map, add the Map block. Do it before adding the Scroll, because otherwise there's an error:
		// The map is not created yet, however the links in the elements are already trying to add the markers
		if ($mapblock_inner_template = $this->get_postmapblock_inner_template($template_id)) {

			$ret[] = GD_EM_TEMPLATE_MAP_POST;
			$ret[] = $mapblock_inner_template;
		}
		// Code below already done in the parent
		// else if ($block_inner_template = $this->get_block_inner_template($template_id)) {

		// 	$ret[] = $block_inner_template;
		// }

		return $ret;
	}

	protected function get_postmapblock_inner_template($template_id) {

		$inner_templates = array(

			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP => GD_TEMPLATE_CALENDAR_EVENTSMAP,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP => GD_TEMPLATE_CALENDAR_EVENTSMAP,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP => GD_TEMPLATE_CALENDAR_EVENTSMAP,
		);

		return $inner_templates[$template_id];
	}

	protected function get_block_inner_template($template_id) {

		$inner_templates = array(

			/*********************************************
			 * Typeaheads
			 *********************************************/
			// Straight to the layout
			GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD => GD_TEMPLATE_LAYOUTPOST_TYPEAHEAD_COMPONENT,
			GD_TEMPLATE_BLOCK_PASTEVENTS_TYPEAHEAD => GD_TEMPLATE_LAYOUTPOST_TYPEAHEAD_COMPONENT,
			GD_TEMPLATE_BLOCK_LOCATIONS_TYPEAHEAD => GD_TEMPLATE_LAYOUTLOCATION_TYPEAHEAD_COMPONENT,
			
			/*********************************************
			 * Scrolls
			 *********************************************/
			GD_TEMPLATE_BLOCK_LOCATIONS_SCROLL => GD_TEMPLATE_SCROLL_LOCATIONS,
			
			/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
			 * Common blocks (Home/Page/Author/Single)
			 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/

			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR => GD_TEMPLATE_SCROLL_PASTEVENTS_NAVIGATOR,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR => GD_TEMPLATE_SCROLL_EVENTS_NAVIGATOR,
			
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR => GD_TEMPLATE_CALENDAR_EVENTS_NAVIGATOR,

			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS => GD_TEMPLATE_SCROLL_PASTEVENTS_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS => GD_TEMPLATE_SCROLL_EVENTS_ADDONS,
			
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS => GD_TEMPLATE_CALENDAR_EVENTS_ADDONS,

			/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
			 * Home/Page blocks
			 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/
			
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS => GD_TEMPLATE_SCROLL_EVENTS_DETAILS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS => GD_TEMPLATE_SCROLL_PASTEVENTS_DETAILS,
			
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW => GD_TEMPLATE_SCROLL_EVENTS_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW => GD_TEMPLATE_SCROLL_PASTEVENTS_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW => GD_TEMPLATE_SCROLL_EVENTS_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW => GD_TEMPLATE_SCROLL_PASTEVENTS_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL => GD_TEMPLATE_SCROLL_EVENTS_THUMBNAIL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL => GD_TEMPLATE_SCROLL_PASTEVENTS_THUMBNAIL,
			
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST => GD_TEMPLATE_SCROLL_EVENTS_LIST,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST => GD_TEMPLATE_SCROLL_PASTEVENTS_LIST,
			
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR => GD_TEMPLATE_CALENDAR_EVENTS_MAIN,	

			/*********************************************
			 * My Content Tables
			 *********************************************/
			GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT => GD_TEMPLATE_TABLE_MYEVENTS,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT => GD_TEMPLATE_TABLE_MYPASTEVENTS,
			
			/*********************************************
			 * My Content Full Post Previews
			 *********************************************/
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW => GD_TEMPLATE_SCROLL_MYEVENTS_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW => GD_TEMPLATE_SCROLL_MYPASTEVENTS_SIMPLEVIEWPREVIEW,

			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW => GD_TEMPLATE_SCROLL_MYEVENTS_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW => GD_TEMPLATE_SCROLL_MYPASTEVENTS_FULLVIEWPREVIEW,
			
			/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
			 * Author blocks
			 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/

			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS => GD_TEMPLATE_SCROLL_EVENTS_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS => GD_TEMPLATE_SCROLL_PASTEVENTS_DETAILS,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW => GD_TEMPLATE_SCROLL_EVENTS_SIMPLEVIEW,//GD_TEMPLATE_SCROLL_AUTHOREVENTS_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW => GD_TEMPLATE_SCROLL_PASTEVENTS_SIMPLEVIEW,//GD_TEMPLATE_SCROLL_AUTHORPASTEVENTS_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW => GD_TEMPLATE_SCROLL_AUTHOREVENTS_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW => GD_TEMPLATE_SCROLL_AUTHORPASTEVENTS_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL => GD_TEMPLATE_SCROLL_EVENTS_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL => GD_TEMPLATE_SCROLL_PASTEVENTS_THUMBNAIL,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST => GD_TEMPLATE_SCROLL_EVENTS_LIST,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST => GD_TEMPLATE_SCROLL_PASTEVENTS_LIST,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR => GD_TEMPLATE_CALENDAR_EVENTS_MAIN,

			/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
			 * Tag blocks
			 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/

			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS => GD_TEMPLATE_SCROLL_EVENTS_DETAILS,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS => GD_TEMPLATE_SCROLL_PASTEVENTS_DETAILS,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW => GD_TEMPLATE_SCROLL_EVENTS_SIMPLEVIEW,//GD_TEMPLATE_SCROLL_AUTHOREVENTS_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW => GD_TEMPLATE_SCROLL_PASTEVENTS_SIMPLEVIEW,//GD_TEMPLATE_SCROLL_AUTHORPASTEVENTS_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW => GD_TEMPLATE_SCROLL_EVENTS_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW => GD_TEMPLATE_SCROLL_PASTEVENTS_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL => GD_TEMPLATE_SCROLL_EVENTS_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL => GD_TEMPLATE_SCROLL_PASTEVENTS_THUMBNAIL,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST => GD_TEMPLATE_SCROLL_EVENTS_LIST,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST => GD_TEMPLATE_SCROLL_PASTEVENTS_LIST,
			
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR => GD_TEMPLATE_CALENDAR_EVENTS_MAIN,

			/*********************************************
			 * Post Carousels
			 *********************************************/

			GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL => GD_TEMPLATE_CAROUSEL_EVENTS,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL => GD_TEMPLATE_CAROUSEL_AUTHOREVENTS,
			GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL => GD_TEMPLATE_CAROUSEL_TAGEVENTS,
		);

		return $inner_templates[$template_id];
	}

	function get_submenu($template_id) {

		// Do not add for the quickview
		$vars = GD_TemplateManager_Utils::get_vars();
		if (!$vars['fetching-json-quickview']) {

			switch ($template_id) {

				case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
				case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
				case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
				case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
				case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
				case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
				case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
				case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
				case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
				case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
				case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
				case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
				// case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:

					return GD_TEMPLATE_SUBMENU_AUTHOR;

				case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
				case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
				case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
				case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
				case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
				case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
				case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
				case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
				case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
				case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
				case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
				case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
				// case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:

					return GD_TEMPLATE_SUBMENU_TAG;
			}
		}
		
		return parent::get_submenu($template_id);
	}

	protected function show_fetchmore($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_LOCATIONS_SCROLL:

			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
			
				return true;
		}

		return parent::show_fetchmore($template_id);
	}

	function get_filter_template($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_LOCATIONS_TYPEAHEAD:

				return GD_TEMPLATE_FILTER_LOCATIONS;

			case GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD:

			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST:

				return GD_TEMPLATE_FILTER_EVENTS;

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:

				return GD_TEMPLATE_FILTER_AUTHOREVENTS;

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:

				return GD_TEMPLATE_FILTER_TAGEVENTS;

			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR:

				return GD_TEMPLATE_FILTER_EVENTSCALENDAR;

			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:

				return GD_TEMPLATE_FILTER_AUTHOREVENTSCALENDAR;

			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:

				return GD_TEMPLATE_FILTER_TAGEVENTSCALENDAR;

			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:
				
				return GD_TEMPLATE_FILTER_MYEVENTS;
		}
		
		return parent::get_filter_template($template_id);
	}

	function get_dataload_source($template_id, $atts) {

		global $gd_template_settingsmanager;
		
		switch ($template_id) {

			// These are the Profile Blocks, they will always be used inside an is_author() page
			// Then, point them not the is_page() page, but to the author url (mesym.com/p/mesym) and
			// an attr "tab" indicating this page through its path. This way, users can go straight to their 
			// information by typing their url: mesym.com/p/mesym?tab=events. Also good for future API
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
			
				$ret = GD_Template_Processor_CustomSectionBlocksUtils::get_author_dataloadsource($template_id);
				break;

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:

				$ret = GD_Template_Processor_CustomSectionBlocksUtils::get_tag_dataloadsource($template_id);
				// $vars = GD_TemplateManager_Utils::get_vars();
				// $ret = get_tag_link($vars['global-state']['queried-object-id']/*get_queried_object_id()*/);
				break;

			default:

				$ret = parent::get_dataload_source($template_id, $atts);
				break;
		}

		// Add the format attr
		$tables = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT,
		);
		$details = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS,

			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS,

			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS,
		);
		$simpleviews = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW,

			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW,

			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW,

			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW,
		);
		$fullviews = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW,

			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW,

			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW,

			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW,
		);
		$thumbnails = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL,

			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL,

			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL,
		);
		$lists = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST,

			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST,

			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST,
		);
		$maps = array(
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP,
		);
		$calendars = array(
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR,
		);		
		$typeaheads = array(
			GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD,
			GD_TEMPLATE_BLOCK_PASTEVENTS_TYPEAHEAD,
		);
		$carousels = array(
			GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL,
		);
		if (in_array($template_id, $tables)) {
			
			$format = GD_TEMPLATEFORMAT_TABLE;
		}
		elseif (in_array($template_id, $details)) {
			
			$format = GD_TEMPLATEFORMAT_DETAILS;
		}
		elseif (in_array($template_id, $simpleviews)) {
			
			$format = GD_TEMPLATEFORMAT_SIMPLEVIEW;
		}
		elseif (in_array($template_id, $fullviews)) {
			
			$format = GD_TEMPLATEFORMAT_FULLVIEW;
		}
		elseif (in_array($template_id, $thumbnails)) {
			
			$format = GD_TEMPLATEFORMAT_THUMBNAIL;
		}
		elseif (in_array($template_id, $lists)) {
			
			$format = GD_TEMPLATEFORMAT_LIST;
		}
		elseif (in_array($template_id, $maps)) {
			
			$format = GD_TEMPLATEFORMAT_MAP;
		}
		elseif (in_array($template_id, $calendars)) {
			
			$format = GD_TEMPLATEFORMAT_CALENDAR;
		}
		elseif (in_array($template_id, $typeaheads)) {
			
			$format = GD_TEMPLATEFORMAT_TYPEAHEAD;
		}
		elseif (in_array($template_id, $carousels)) {
			
			$format = GD_TEMPLATEFORMAT_CAROUSEL;
		}

		if ($format) {

			$ret = add_query_arg(GD_URLPARAM_FORMAT, $format, $ret);
		}
	
		return $ret;
	}

	// protected function get_block_page($template_id) {

	// 	global $gd_template_settingsmanager;

	// 	switch ($template_id) {

	// 		case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS:
	// 		case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS:
	// 		case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS:

	// 			// Make explicit that it is "page" hierarchy, since the Events Calendar is embedded everywhere in the sideinfo
	// 			if ($page = $gd_template_settingsmanager->get_block_page($template_id, GD_SETTINGS_HIERARCHY_PAGE)) {

	// 				return $page;
	// 			}
	// 			break;

	// 		// These are the Profile Blocks, they will always be used inside an is_author() page
	// 		// Then, point them not the is_page() page, but to the author url (mesym.com/p/mesym) and
	// 		// an attr "tab" indicating this page through its path. This way, users can go straight to their 
	// 		// information by typing their url: mesym.com/p/mesym?tab=events. Also good for future API
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
	// 		case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
	// 		case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
	// 		case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
	// 		case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
	// 		case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:

	// 		case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:

	// 			if ($page = $gd_template_settingsmanager->get_block_page($template_id, GD_SETTINGS_HIERARCHY_AUTHOR)) {

	// 				return $page;
	// 			}
	// 			break;

	// 		case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
	// 		case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
	// 		case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
	// 		case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
	// 		case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
	// 		case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
	// 		case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
	// 		case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
	// 		case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
	// 		case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
	// 		case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
	// 		case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:

	// 		case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:

	// 			if ($page = $gd_template_settingsmanager->get_block_page($template_id, GD_SETTINGS_HIERARCHY_TAG)) {

	// 				return $page;
	// 			}
	// 			break;
	// 	}
	
	// 	return parent::get_block_page($template_id);
	// }
	protected function get_block_hierarchy($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
				
				return GD_SETTINGS_HIERARCHY_AUTHOR;
				
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:
				
				return GD_SETTINGS_HIERARCHY_TAG;
		}
		
		return parent::get_block_hierarchy($template_id);
	}


	protected function get_dataload_query_args($template_id, $atts) {

		$ret = parent::get_dataload_query_args($template_id, $atts);
		
		$simpleviews = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
		);
		$fullviews = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW,
		);
		$carousels = array(
			GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL,
		);

		if (in_array($template_id, $simpleviews) || in_array($template_id, $fullviews) || in_array($template_id, $carousels)) {
			
			$ret['limit'] = 6;
		}

		// Allow to override the limit by $atts (eg: for the Website Features, Filter section)
		if ($limit = $this->get_att($template_id, $atts, 'limit')) {
			$ret['limit'] = $limit;
		}

		return $ret;
	}

	protected function get_runtime_dataload_query_args($template_id, $atts) {

		$ret = parent::get_runtime_dataload_query_args($template_id, $atts);
		
		$vars = GD_TemplateManager_Utils::get_vars();
		$myevents_query_args = array(
			'author' => $vars['global-state']['current-user-id']/*get_current_user_id()*/,
			'status' => 'all' // Any post type
		);

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
				
				$ret = array_merge(
					$ret,
					$myevents_query_args
				);
				break;

			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:
				
				$ret = array_merge(
					$ret,
					$myevents_query_args
				);
				break;
		}

		switch ($template_id) {

			// Filter by the Profile/Community
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:

				GD_Template_Processor_CustomSectionBlocksUtils::add_dataloadqueryargs_authorcontent($ret);
				break;

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:

				GD_Template_Processor_CustomSectionBlocksUtils::add_dataloadqueryargs_tagcontent($ret);
				// PoPCore_Template_Processor_SectionBlocksUtils::add_dataloadqueryargs_allcontent_bysingletag($ret);
				break;
		}

		return $ret;
	}

	protected function get_controlgroup_top($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS:

				return GD_TEMPLATE_CONTROLGROUP_SUBMENUSHARE;

			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:
			
				return GD_TEMPLATE_CONTROLGROUP_BLOCKEVENTLIST;

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			
				return GD_TEMPLATE_CONTROLGROUP_BLOCKAUTHOREVENTLIST;

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:

				return GD_TEMPLATE_CONTROLGROUP_BLOCKTAGEVENTLIST;

			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:

					// Allow URE to add the ContentSource switch
				return GD_TEMPLATE_CONTROLGROUP_BLOCKAUTHORPOSTLIST;

			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:

				return GD_TEMPLATE_CONTROLGROUP_BLOCKPOSTLIST;

			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
					
				return GD_TEMPLATE_CONTROLGROUP_MYBLOCKEVENTLIST;
			
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:
			
				return GD_TEMPLATE_CONTROLGROUP_MYBLOCKPOSTLIST;
		}

		return parent::get_controlgroup_top($template_id);
	}

	// Comment Leo 23/10/2016: Events Manager does not accept "loading_latest()" since it does not handle query_arg "date_query" and can't query by post's published date either...
	// So then no need for the latestcount template
	/*
	function get_latestcount_template($template_id) {
	
		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:

				return GD_TEMPLATE_LATESTCOUNT_EVENTS;

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:

				return GD_TEMPLATE_LATESTCOUNT_AUTHOR_EVENTS;

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:

				return GD_TEMPLATE_LATESTCOUNT_TAG_EVENTS;
		}

		return parent::get_latestcount_template($template_id);
	}
	*/

	protected function get_messagefeedback($template_id) {
	
		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR:

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:

			case GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:

				return GD_TEMPLATE_MESSAGEFEEDBACK_EVENTS;

			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS:
			
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:

				return GD_TEMPLATE_MESSAGEFEEDBACK_PASTEVENTS;

			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
			
				return GD_TEMPLATE_MESSAGEFEEDBACK_MYEVENTS;

			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:
			
				return GD_TEMPLATE_MESSAGEFEEDBACK_MYPASTEVENTS;
		}

		return parent::get_messagefeedback($template_id);
	}

	protected function get_messagefeedback_position($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:
			
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR:
			
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL:
			
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
			
			case GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:
			
				return 'bottom';
		}

		return parent::get_messagefeedback_position($template_id);
	}

	function get_title($template_id) {
	
		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:

				return GD_Template_Processor_CustomSectionBlocksUtils::get_author_title();

			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:

				return GD_Template_Processor_CustomSectionBlocksUtils::get_tag_title();

			case GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:
			
				return '';
		}
		
		return parent::get_title($template_id);
	}

	protected function get_iohandler($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			
				// return GD_DATALOAD_IOHANDLER_CALENDAR_NOLIMIT;
				return GD_DATALOAD_IOHANDLER_CALENDAR;
		}
		
		return GD_DATALOAD_IOHANDLER_LIST;
	}

	function get_dataloader($template_id) {

		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_LOCATIONS_SCROLL:
			case GD_TEMPLATE_BLOCK_LOCATIONS_TYPEAHEAD:

				return GD_DATALOADER_LOCATIONLIST;
					
			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:

			case GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:

			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR:

			case GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:
			
				return GD_DATALOADER_EVENTLIST;

			case GD_TEMPLATE_BLOCK_PASTEVENTS_TYPEAHEAD:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL:
			case GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST:

			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:

				return GD_DATALOADER_PASTEVENTLIST;
		}

		return parent::get_dataloader($template_id);
	}



	function get_data_setting($template_id, $atts) {

		$ret = parent::get_data_setting($template_id, $atts);

		// Set the display configuration
		$calendars = array(
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR,
		);
		$navigators = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR,
		);
		$addons = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS,
		);
		$details = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS,
		);
		$simpleviews = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW,
			
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
		);
		$fullviews = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW,
			
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW,
		);
		$thumbnails = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL,
		);
		$lists = array(
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST,
		);
		$maps = array(
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP,
		);
		$tables = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT,
		);
		$typeaheads = array(
			GD_TEMPLATE_BLOCK_EVENTS_TYPEAHEAD,
			GD_TEMPLATE_BLOCK_PASTEVENTS_TYPEAHEAD,
		);
		$carousels = array(
			GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL,
		);
		// Important: set always this value, because the IOHandler used by all different blocks is the same!
		// So if not restarting, the display will be the same as the previous one, and sometimes it doesn't need the display
		// (Eg: tables)
		// $ret[GD_URLPARAM_FORMAT] = '';
		if (in_array($template_id, $calendars)) {
			
			$format = GD_TEMPLATEFORMAT_CALENDAR;
		}
		elseif (in_array($template_id, $navigators)) {
			
			$format = GD_TEMPLATEFORMAT_NAVIGATOR;
		}
		elseif (in_array($template_id, $addons)) {
			
			$format = GD_TEMPLATEFORMAT_ADDONS;
		}
		elseif (in_array($template_id, $details)) {
			
			$format = GD_TEMPLATEFORMAT_DETAILS;
		}
		elseif (in_array($template_id, $simpleviews)) {
			
			$format = GD_TEMPLATEFORMAT_SIMPLEVIEW;
		}
		elseif (in_array($template_id, $fullviews)) {
			
			$format = GD_TEMPLATEFORMAT_FULLVIEW;
		}
		elseif (in_array($template_id, $thumbnails)) {
			
			$format = GD_TEMPLATEFORMAT_THUMBNAIL;
		}
		elseif (in_array($template_id, $lists)) {
			
			$format = GD_TEMPLATEFORMAT_LIST;
		}
		elseif (in_array($template_id, $maps)) {
			
			$format = GD_TEMPLATEFORMAT_MAP;
		}
		elseif (in_array($template_id, $tables)) {
			
			$format = GD_TEMPLATEFORMAT_TABLE;
		}
		elseif (in_array($template_id, $typeaheads)) {
			
			$format = GD_TEMPLATEFORMAT_TYPEAHEAD;
		}
		elseif (in_array($template_id, $carousels)) {
			
			$format = GD_TEMPLATEFORMAT_CAROUSEL;
		}

		if ($format) {
			$ret['iohandler-atts'][GD_URLPARAM_FORMAT] = $format;
		}
		
		return $ret;
	}

	function block_requires_user_state($template_id, $atts) {

		switch ($template_id) {
		
			case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
			case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:

				return true;
		}

		return parent::block_requires_user_state($template_id, $atts);
	}
	// function get_block_jsmethod($template_id, $atts) {

	// 	$ret = parent::get_block_jsmethod($template_id, $atts);
		
	// 	switch ($template_id) {
		
	// 		case GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT:
	// 		case GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT:
	// 		case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
	// 		case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW:
	// 		case GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW:
	// 		case GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW:

	// 			// Only reload/destroy if these are main blocks
	// 			if ($this->get_att($template_id, $atts, 'is-mainblock')) {
	// 				$this->add_jsmethod($ret, 'destroyPageOnUserLoggedOut');
	// 				$this->add_jsmethod($ret, 'refetchBlockOnUserLoggedIn');
	// 			}
	// 			break;
	// 	}

	// 	return $ret;
	// }

	function init_atts($template_id, &$atts) {

		global $gd_template_processor_manager;

		// pop-block-map class: allows to place map on the side of the scroll
		// waypoint template-fix: Fix the maps, resize to full window
		$calendarmaps = array(
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP,
		);
		if (in_array($template_id, $calendarmaps)) {

			$this->append_att($template_id, $atts, 'class', 'pop-block-map');
			$this->append_att($template_id, $atts, 'class', 'pop-block-calendarmap');
		}
			
		switch ($template_id) {

			case GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL:
			case GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL:

				$this->append_att($template_id, $atts, 'class', 'pop-block-carousel block-posts-carousel block-events-carousel');
				break;

			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDARMAP:
			case GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR:
				
				// Allow for the controls to be aligned to the right, using css
				$this->append_att($template_id, $atts, 'class', 'pop-block-calendar');
				break;
		}

		// Events: choose to only select past/future
		$past = array(
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST,
		);
		$future = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST,
			// GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL,
			// GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL,
			// GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL,
		);
		if (in_array($template_id, $past)) {
			$daterange_class = 'daterange-past opens-right';
		}
		elseif (in_array($template_id, $future)) {
			$daterange_class = 'daterange-future opens-right';
		}
		if ($daterange_class) {
			$this->add_att(GD_TEMPLATE_FILTERFORMCOMPONENT_DATERANGEPICKER, $atts, 'daterange-class', $daterange_class);
		}

		// Needed for restraining to 600px together with class pop-outerblock
		$tables = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_TABLE_EDIT,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_TABLE_EDIT,
		);
		$feeds = array(
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_SIMPLEVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_MYPASTEVENTS_SCROLL_FULLVIEWPREVIEW,
			GD_TEMPLATE_BLOCK_LOCATIONS_SCROLL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_NAVIGATOR,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_NAVIGATOR,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_NAVIGATOR,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR_ADDONS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_EVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_PASTEVENTS_SCROLL_LIST,
			
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_AUTHORPASTEVENTS_SCROLL_LIST,
			
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_DETAILS,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_SIMPLEVIEW,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_FULLVIEW,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_THUMBNAIL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_SCROLL_LIST,
			GD_TEMPLATE_BLOCK_TAGPASTEVENTS_SCROLL_LIST,
		);
		$calendars = array(
			GD_TEMPLATE_BLOCK_EVENTSCALENDAR_CALENDAR,
			GD_TEMPLATE_BLOCK_AUTHOREVENTSCALENDAR_CALENDAR,
			GD_TEMPLATE_BLOCK_TAGEVENTSCALENDAR_CALENDAR,
		);
		$carousels = array(
			GD_TEMPLATE_BLOCK_EVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_AUTHOREVENTS_CAROUSEL,
			GD_TEMPLATE_BLOCK_TAGEVENTS_CAROUSEL,
		);
		if (in_array($template_id, $tables)) {
			$class = 'tableblock';
		}
		elseif (in_array($template_id, $feeds)) {
			$class = 'feed';
		}
		elseif (in_array($template_id, $carousels)) {
			$class = 'carousel';
		}
		elseif (in_array($template_id, $calendars)) {
			$class = 'calendar';
		}
		elseif (in_array($template_id, $calendarmaps)) {
			$class = 'calendarmap';
		}
		if ($class) {
			$this->append_att($template_id, $atts, 'class', $class);
		}
		
		
		return parent::init_atts($template_id, $atts);
	}
}


/**---------------------------------------------------------------------------------------------------------------
 * Initialization
 * ---------------------------------------------------------------------------------------------------------------*/
new GD_EM_Template_Processor_CustomSectionBlocks();