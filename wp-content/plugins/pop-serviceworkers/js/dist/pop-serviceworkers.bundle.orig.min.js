(function($){popServiceWorkers={pages:{},documentInitialized:function(args){var t=this;if('serviceWorker'in navigator){navigator.serviceWorker.onmessage=function(event){var message=JSON.parse(event.data);if(message.type==='refresh'){if(t.pages[message.url]){var pageSectionPage=$('#'+t.pages[message.url]);if(pageSectionPage&&pageSectionPage.data('fetch-url')){t.showRefreshMessage(pageSectionPage);delete t.pages[message.url];}}}};navigator.serviceWorker.addEventListener('controllerchange',function(){var status=$('#'+M.IDS_APPSTATUS);status.prepend(M.SW_MESSAGES_WEBSITEUPDATED.format(window.location.href));});}},pageSectionNewDOMsBeforeInitialize:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;var psId=pageSection.attr('id');if(M.SW_MAIN_PAGESECTIONS&&(M.SW_MAIN_PAGESECTIONS.indexOf(psId)>-1)){var pageSectionPage=newDOMs.filter('.pop-pagesection-page');if(pageSectionPage.length){var url=pageSectionPage.data('fetch-url');if(url){t.pages[url]=pageSectionPage.attr('id');pageSectionPage.one('destroy',function(){delete t.pages[url];});}}}},modifyOptions:function(args){var t=this;var options=args.options,url=args.url,anchor=args.anchor;if(anchor.data('sw-networkfirst')){options.params=options.params||{};options.params[M.SW_URLPARAM_NETWORKFIRST]='true';}},modifyFetchBlockOptions:function(args){var t=this;var options=args.options,url=args.url;if(options.reload){options['onetime-post-data']=options['onetime-post-data']?options['onetime-post-data']+'&':'';options['onetime-post-data']+=M.SW_URLPARAM_NETWORKFIRST+'=true';}},fetchBrowserURL:function(args){var t=this;$(document).on('initialized.pop.document',function(){var options={skipPushState:true,};popManager.fetch(window.location.href,options);});},reopenTabs:function(args){var t=this;if('serviceWorker'in navigator){$(document).on('initialized.pop.document',function(){var show=false;var currentURL=popManager.getTabsCurrentURL();var tabs=popManager.getScreenOpenTabs();$.each(tabs,function(target,urls){if((urls.length>1)||(target!=M.URLPARAM_TARGET_MAIN&&urls.length)||(target==M.URLPARAM_TARGET_MAIN&&urls[0]!=currentURL)){show=true;return-1;}});if(show){if($.cookie('opentabs')){if($.cookie('opentabs')=="true"){popManager.openTabs();}
else{popManager.keepScreenOpenTab(window.location.href,M.URLPARAM_TARGET_MAIN);}}
else{var status=$('#'+M.IDS_APPSTATUS);var param1='popServiceWorkers.openTabs()';var param2='popServiceWorkers.keepScreenOpenTab(\'{0}\', \'{1}\')'.format(window.location.href,M.URLPARAM_TARGET_MAIN);status.prepend(M.SW_MESSAGES_REOPENTABS.format(param1,param2));}}});}},saveCookie:function(value){var t=this;if($('#'+M.SW_IDS_CHECKBOX_REMEMBER).attr('checked')){console.log('adentro');$.cookie('opentabs',value,{expires:365,path:"/"});}},openTabs:function(){var t=this;t.saveCookie("true");popManager.openTabs();},keepScreenOpenTab:function(url,target){var t=this;t.saveCookie("false");popManager.keepScreenOpenTab(url,target);},showRefreshMessage:function(pageSectionPage){var t=this;var url=pageSectionPage.data('url');var target=pageSectionPage.data('target');pageSectionPage.prepend(M.SW_MESSAGES_PAGEUPDATED.format(url,target));},};})(jQuery);popJSLibraryManager.register(popServiceWorkers,['documentInitialized','pageSectionNewDOMsBeforeInitialize','modifyOptions','modifyFetchBlockOptions','fetchBrowserURL','reopenTabs']);