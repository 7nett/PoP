(function($){popServiceWorkers={pages:{},documentInitialized:function(args){var t=this;if('serviceWorker'in navigator){navigator.serviceWorker.onmessage=function(event){var message=JSON.parse(event.data);if(message.type==='refresh'){if(t.pages[message.url]){var pageSectionPage=$('#'+t.pages[message.url]);if(pageSectionPage&&pageSectionPage.data('fetch-url')){t.showRefreshMessage(pageSectionPage);delete t.pages[message.url];}}}};navigator.serviceWorker.addEventListener('controllerchange',function(){var status=$('#'+M.IDS_APPSTATUS);status.prepend(M.SW_MESSAGES_WEBSITEUPDATED.format(window.location.href));});}},pageSectionNewDOMsBeforeInitialize:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;var psId=pageSection.attr('id');if(M.SW_MAIN_PAGESECTIONS&&(M.SW_MAIN_PAGESECTIONS.indexOf(psId)>-1)){var pageSectionPage=newDOMs.filter('.pop-pagesection-page');if(pageSectionPage.length){var url=pageSectionPage.data('fetch-url');if(url){t.pages[url]=pageSectionPage.attr('id');pageSectionPage.one('destroy',function(){delete t.pages[url];});}}}},modifyOptions:function(args){var t=this;var options=args.options,url=args.url,anchor=args.anchor;if(anchor.data('sw-networkfirst')){options.params=options.params||{};options.params[M.SW_URLPARAM_NETWORKFIRST]='true';}},modifyFetchBlockOptions:function(args){var t=this;var options=args.options,url=args.url;if(options.reload){options['onetime-post-data']=options['onetime-post-data']?options['onetime-post-data']+'&':'';options['onetime-post-data']+=M.SW_URLPARAM_NETWORKFIRST+'=true';}},fetchBrowserURL:function(args){var t=this;$(document).on('initialized.pop.document',function(){var options={skipPushState:true,};popManager.fetch(window.location.href,options);});},resetTimestamp:function(args){var t=this;var pageSection=args.pageSection,block=args.block;if('serviceWorker'in navigator){var blockParams=popManager.getBlockParams(pageSection,block);blockParams[M.URLPARAM_TIMESTAMP]=Math.floor(Date.now()/1000);}},showRefreshMessage:function(pageSectionPage){var t=this;var url=pageSectionPage.data('url');var target=pageSectionPage.data('target');pageSectionPage.prepend(M.SW_MESSAGES_PAGEUPDATED.format(url,target));},};})(jQuery);popJSLibraryManager.register(popServiceWorkers,['documentInitialized','pageSectionNewDOMsBeforeInitialize','modifyOptions','modifyFetchBlockOptions','fetchBrowserURL','resetTimestamp']);