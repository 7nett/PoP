"use strict";!function(e){window.popServiceWorkers={pages:{},init:function(){var r=this;"serviceWorker"in navigator&&(navigator.serviceWorker.onmessage=function(e){r.processEvent(e)},navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",function(){e("#"+M.IDS_APPSTATUS).prepend(M.SW_MESSAGES_WEBSITEUPDATED.format(window.location.href))}))},pageSectionNewDOMsBeforeInitialize:function(e){var r=this,t=e.pageSection,a=e.newDOMs,o=t.attr("id");if(M.SW_MAIN_PAGESECTIONS&&M.SW_MAIN_PAGESECTIONS.indexOf(o)>-1){var i=a.filter(".pop-pagesection-page");if(i.length){var n=i.data("fetch-url");n&&(r.pages[n]=i.attr("id"),i.one("destroy",function(){delete r.pages[n]}))}}},modifyFetchArgs:function(e){var r=e.options;if(r["js-args"]){var t=r["js-args"].relatedTarget;t&&t.data("sw-networkfirst")&&(r.params=r.params||{},r.params[M.SW_URLPARAM_NETWORKFIRST]="true")}},modifyFetchBlockArgs:function(e){var r=e.options;e.url;r.reload&&(r["onetime-post-data"]=r["onetime-post-data"]?r["onetime-post-data"]+"&":"",r["onetime-post-data"]+=M.SW_URLPARAM_NETWORKFIRST+"=true")},resetTimestamp:function(e){var r=e.pageSection,t=e.block;"serviceWorker"in navigator&&(popManager.getBlockQueryState(r,t)[M.URLPARAM_TIMESTAMP]=Math.floor(Date.now()/1e3)+60*M.GMT_OFFSET*60)},processEvent:function(r){var t=this,a=JSON.parse(r.data);if("refresh"===a.type&&t.pages[a.url]){var o=e("#"+t.pages[a.url]);o&&o.data("fetch-url")&&(t.showRefreshMessage(o),delete t.pages[a.url])}},showRefreshMessage:function(e){var r=e.data("url"),t=e.data("target");e.prepend(M.SW_MESSAGES_PAGEUPDATED.format(r,t))}}}(jQuery),M.USE_SW&&(popJSLibraryManager.register(popServiceWorkers,["pageSectionNewDOMsBeforeInitialize","modifyFetchArgs","modifyFetchBlockArgs","resetTimestamp"]),popServiceWorkers.init());