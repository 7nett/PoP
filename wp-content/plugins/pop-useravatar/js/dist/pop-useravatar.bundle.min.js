(function($){popFileUpload={fileUpload:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var that=this;var fileupload=$(this);var action=fileupload.data('action');var block=popManager.getBlock(fileupload);fileupload.fileupload({url:action,autoUpload:true,maxNumberOfFiles:1,maxFileSize:2000000,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,uploadTemplateId:null,downloadTemplateId:null,uploadTemplate:function(o){var templateName=fileupload.data('template-upload');var rows=$();var data={o:o,locale:locale};var html=popManager.getHtml(templateName,data);var row=$(html);rows=rows.add(row);return rows;},downloadTemplate:function(o){var templateName=fileupload.data('template-download');var rows=$();var targetConfiguration=popManager.getTargetConfiguration(pageSection,block,templateName);popManager.expandJSKeys(targetConfiguration);var data=$.extend({},targetConfiguration,{o:o,locale:locale});var html=popManager.getHtml(templateName,data);var row=$(html);$(document).triggerHandler('gd-fileupload:rendered',[row]);rows=rows.add(row);return rows;},completed:function(e,data){fileupload.find('.pop-fileuploaded-hide').hide();},destroyed:function(e,data){fileupload.find('.pop-fileuploaded-hide').show();}});if(fileupload.hasClass('pop-fileupload-loadfromserver')){$.getJSON(action,function(result){if(result&&result.files&&result.files.length){fileupload.fileupload('option','done').call(that,$.Event('done'),{result:result});}});}});}};})(jQuery);popJSLibraryManager.register(popFileUpload,['fileUpload']);