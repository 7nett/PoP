!function(e){popCreateLocation={createLocationModal:function(e){var a=this,t=e.pageSection,n=e.targets;a.execCreateLocationModal(t,n)},createLocationModalBlock:function(e){var a=this,t=e.pageSection,n=e.targets,r=e.relatedTarget;a.transferAttributes(n.closest(".modal"),r),a.execCreateLocationModal(t,n.closest(".modal"))},maybeCloseLocationModal:function(a){var t=a.pageSection,n=a.targets,r=popManager.getSettingsId(t);n.on("fetched",function(a,t){var n=e(this),o=popManager.getSettingsId(n);!0===t.feedback.block[r][o].result&&n.closest(".modal").modal("hide")})},transferAttributes:function(e,a){a=popManager.getOriginalLink(a),e.data("typeahead-target",a.data("typeahead-target"))},execCreateLocationModal:function(a,t){var n=this;t.addClass("pop-createlocation"),t.on("show.bs.modal",function(a){var t=e(this),r=e(a.relatedTarget);n.transferAttributes(t,r)})}}}(jQuery),popJSLibraryManager.register(popCreateLocation,["createLocationModal","createLocationModalBlock","maybeCloseLocationModal"]),function(e){popMap={initBlockRuntimeMemory:function(e){var a=this,t=e.pageSection,n=e.block;e.runtimeMempage.map={},a.resetBlockRuntimeMemory(t,n)},map:function(a){var t=this,n=a.domain,r=a.pageSection,o=a.block,i=a.targets;o.one("rerender",function(e){t.destroy(r,o,i)}),i.each(function(){var a=e(this);t.triggerShowMap(n,r,o,a)})},mapModal:function(a){var t=this,n=a.domain,r=a.pageSection;a.targets.on("shown.bs.modal",function(){var a=e(this);e.each(a.find(".pop-map"),function(){var a=e(this),o=popManager.getBlock(a);popManager.jsInitialized(o)&&t.triggerShowMap(n,r,o,a)})})},mapStandalone:function(a){var t=this,n=a.pageSection,r=a.block,o=a.targets;popPageSectionManager.getGroup(n).on("on.bs.pagesection:theater off.bs.pagesection:theater",function(a){o.each(function(){var a=e(this);popManager.isHidden(a)||t.refresh(n,r,a)})}),r.on("fetchDomainCompleted",function(a,i,s){popJSRuntimeManager.setBlockURL(r),o.each(function(){var a=e(this);t.triggerAddMarkers(s,n,r,a,i)})}),o.each(function(){var a=e(this);t.hoverBlockElems(n,r,a)})},getRuntimeMemoryPage:function(e,a){return popManager.getRuntimeMemoryPage(e,a).map},resetBlockRuntimeMemory:function(a,t){var n=this.getRuntimeMemoryPage(a,t),r={markers:{},markersPos:{},markersOpen:{},maps:{}};e.extend(n,r)},destroy:function(a,t,n){var r=this.getRuntimeMemoryPage(a,t);n.each(function(){var a=e(this).attr("id");delete r.maps[a]})},triggerShowMap:function(e,a,t,n){var r=this;popManager.isHidden(n)?r.pendingTriggerMap("showmap",e,a,t,n):r.execTriggerShowMap(e,a,t,n)},triggerAddMarkers:function(e,a,t,n,r){var o=this;if(popManager.isHidden(n))o.pendingTriggerMap("addmarkers",e,a,t,n,r);else{var i=r.reload&&r.isFirst;o.addMarkers(e,a,t,n,i)}},triggerFunction:function(e,a,t,n,r,o){var i=this;"showmap"==e?i.triggerShowMap(a,t,n,r):"addmarkers"==e&&i.triggerAddMarkers(a,t,n,r,o)},pendingTriggerMap:function(a,t,n,r,o,i){var s=this,c=popManager.getPageSectionPage(r);popPageSectionManager.execIsHidden(n)?popPageSectionManager.getGroup(n).one("on.bs.pagesection-group:pagesection-"+n.attr("id")+":opened",function(){(r=e("#"+r.attr("id"))).length&&s.triggerFunction(a,t,n,r,o,i)}):o.parents(".collapse").not(".in").length?o.parents(".collapse").not(".in").one("shown.bs.collapse",function(){s.triggerFunction(a,t,n,r,o,i)}):c.hasClass("tab-pane")&&!popManager.isActive(c)&&c.one("shown.bs.tabpane",function(){s.triggerFunction(a,t,n,r,o,i)})},execTriggerShowMap:function(e,a,t,n){this.addMarkers(e,a,t,n,n.data("markers-removecurrent")),windowResize()},refresh:function(e,a,t){var n=this.getGMap(e,a,t);n&&n.refresh()},hoverBlockElems:function(a,t,n){var r=this;t.on("mouseenter",".pop-openmapmarkers",function(){var o,i=e(this);if(i.hasClass("make-popover")){var s=i.attr("aria-describedby");s&&(o=e("#"+s).find("a.pop-modalmap-link"))}else o=i.find("a.pop-modalmap-link");r.openMapMarkers(a,t,n,o)})},openMapMarkers:function(e,a,t,n){var r=this;popManager.isHidden(t)||(r.closeMarkers(e,a,t),n.length&&r.openMarkers(e,a,t,n))},closeMarkers:function(a,t,n){var r=this,o=r.getGMap(a,t,n);if(o){var i=r.getMarkersInfo(a,t,n);o.hideInfoWindows(),e.each(i.markersOpen,function(e,a){markerPos=i.markersPos[a],o.markers[markerPos]&&o.markers[markerPos].setIcon("https://maps.google.com/mapfiles/ms/icons/red-dot.png")})}},getMarkerIdsFromLinkURLs:function(a){var t=[];return a.each(function(){var a=e(this),n=(a=popManager.getOriginalLink(a)).attr("href"),r=getParam(M.LOCATIONSID_FIELDNAME,n);r&&e.each(r,function(e,a){t.push(a)})}),t},openMarkers:function(a,t,n,r){var o=this,i=o.getMarkerIdsFromLinkURLs(r);if(i.length){i=i.filter(function(e,a){return i.indexOf(e)==a});var s=o.getGMap(a,t,n);if(s){var c=o.getMarkersInfo(a,t,n);e.each(i,function(e,a){markerPos=c.markersPos[a],s.markers[markerPos]&&s.markers[markerPos].setIcon("https://maps.google.com/mapfiles/ms/icons/green-dot.png")}),1==i.length?(markerPos=c.markersPos[i[0]],s.markers[markerPos]&&"undefined"!=typeof google&&google.maps.event.trigger(s.markers[markerPos],"click")):s.fitZoom(),o.setMarkersOpen(a,t,n,i,!0)}}},initMarker:function(e,a,t,n){var r=this.getRuntimeMemoryPage(e,a),o=r.markers[t];if(o){if(o.title.split(" | ").indexOf(n.title)>-1)return;n.title=o.title+" | "+n.title,n.infoWindow.content=n.infoWindow.content+"<hr/>"+o.infoWindow.content,n.icon="https://maps.google.com/mapfiles/ms/icons/red-dot.png"}r.markers[t]=n},hasMarker:function(e,a,t){return this.getRuntimeMemoryPage(e,a).markers[t]},getGMap:function(e,a,t){var n=this;if("undefined"!=typeof google&&"undefined"!=typeof GMaps){var r=n.getRuntimeMemoryPage(e,a),o=t.attr("id"),i=r.maps[o];return i||(i=r.maps[o]=new GMaps({div:"#"+o,lat:M.LOCATIONSMAP_LAT,lng:M.LOCATIONSMAP_LNG,zoom:parseInt(M.LOCATIONSMAP_ZOOM)})),i}},getMarkersInfo:function(e,a,t){var n=this,r=t.data("markers-pagesection")||e,o=t.data("markers-block")||a,i=n.getRuntimeMemoryPage(r,o),s=t.attr("id");return{markers:i.markers||{},markersPos:i.markersPos[s]||{},markersOpen:i.markersOpen[s]||[]}},setMarkersOpen:function(e,a,t,n,r){var o=this.getRuntimeMemoryPage(e,a),i=t.attr("id");!r&&o.markersOpen[i]||(o.markersOpen[i]=[]),n&&(o.markersOpen[i]=o.markersOpen[i].concat(n))},setMarkersPos:function(a,t,n,r,o){var i=this.getRuntimeMemoryPage(a,t),s=n.attr("id");!o&&i.markersPos[s]||(i.markersPos[s]={}),r&&e.extend(i.markersPos[s],r)},removeMarker:function(e,a,t,n){var r=this,o=r.getGMap(e,a,t);if(o){var i=r.getMarkersInfo(e,a,t);markerPos=i.markersPos[n],o.markers[markerPos]&&o.markers[markerPos].setMap(null),r.zoom(e,a,t)}},zoom:function(e,a,t){var n=this.getGMap(e,a,t);if(n)if(n.markers.length>1)n.fitZoom();else if(1==n.markers.length){var r=n.markers[0].getPosition();n.setCenter(r.lat(),r.lng()),n.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM))}},addMarkers:function(a,t,n,r,o){var i=this,s=i.getGMap(t,n,r);if(s){o&&(s.removeMarkers(),i.setMarkersOpen(t,n,r,null,!0),i.setMarkersPos(t,n,r,null,!0));var c=r.data("marker-ids-"+removeScheme(a));if(c&&c.length){r.data("marker-ids-"+removeScheme(a),null);var p,d,g,l=i.getMarkersInfo(t,n,r),m={};e.each(c,function(e,a){var t={content:(p=l.markers[a]).infoWindow.header+"<br/>"+p.infoWindow.content},n={lat:p.coordinates.lat,lng:p.coordinates.lng,title:p.title,infoWindow:t,icon:p.icon};"undefined"!=typeof google&&(n.animation=google.maps.Animation.DROP),d=s.addMarker(n),g=s.markers.length-1,m[a]=g}),i.setMarkersPos(t,n,r,m);var u=r.data("open-onemarker-infowindow");1==c.length&&u&&(s.hideInfoWindows(),"undefined"!=typeof google&&google.maps.event.trigger(d,"click")),i.zoom(t,n,r)}}},geocode:function(e,a,t,n,r,o){var i=this.getGMap(e,a,t);i&&GMaps.geocode({address:n,callback:function(e,a){if("OK"==a){i.removeMarkers();var t=e[0].geometry.location;i.setCenter(t.lat(),t.lng()),i.addMarker({lat:t.lat(),lng:t.lng(),draggable:!0}),i.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM)),r.val(t.lat()),o.val(t.lng());var n=i.markers[0];"undefined"!=typeof google&&google.maps.event.addListener(n,"dragend",function(){var e=n.getPosition();r.val(e.lat()),o.val(e.lng())})}}})}}}(jQuery),function(e){popMapRuntime={initBlockRuntimeMemory:function(e){var a=this,t=e.pageSection,n=e.block;e.runtimeMempage.mapRuntime={},a.resetBlockRuntimeMemory(t,n)},getRuntimeMemoryPage:function(e,a){return popManager.getRuntimeMemoryPage(e,a).mapRuntime},resetBlockRuntimeMemory:function(a,t){var n=this.getRuntimeMemoryPage(a,t),r={content:"",title:"",marker_ids:[]};e.extend(n,r)},drawMarkers:function(e,a,t,n){var r=this;popManager.jsInitialized(t)?r.execDrawMarkers(e,a,t,n):t.one("initialize",function(){r.execDrawMarkers(e,a,t,n)})},execDrawMarkers:function(e,a,t,n){var r=this.getRuntimeMemoryPage(a,t);n.data("marker-ids-"+removeScheme(e),r.marker_ids)},resetMarkerIds:function(e,a){var t=this;popManager.jsInitialized(a)?t.execResetMarkerIds(e,a):a.one("initialize",function(){t.execResetMarkerIds(e,a)})},execResetMarkerIds:function(e,a){this.getRuntimeMemoryPage(e,a).marker_ids=[]},setMarkerData:function(e,a,t,n){var r=this;popManager.jsInitialized(a)?r.execSetMarkerData(e,a,t,n):a.one("initialize",function(){r.execSetMarkerData(e,a,t,n)})},execSetMarkerData:function(e,a,t,n){var r=this.getRuntimeMemoryPage(e,a);r.title||(r.title=t),r.content||(r.content=n)},initMarker:function(e,a,t,n,r,o,i){var s=this;popManager.jsInitialized(a)?s.execInitMarker(e,a,t,n,r,o,i):a.one("initialize",function(){s.execInitMarker(e,a,t,n,r,o,i)})},execInitMarker:function(e,a,t,n,r,o,i){var s=this,c=s.getRuntimeMemoryPage(e,a);s.setMarkerData(e,a,o,i);var p=c.title,d={coordinates:{lat:n,lng:r},title:p,infoWindow:{header:"<strong>"+p+"</strong>",content:c.content},icon:"https://maps.google.com/mapfiles/ms/icons/red-dot.png"};c.marker_ids.push(t),popMap.initMarker(e,a,t,d),c.content="",c.title=""}}}(jQuery),popJSLibraryManager.register(popMap,["initBlockRuntimeMemory","map","mapModal","mapStandalone"]),popJSLibraryManager.register(popMapRuntime,["initBlockRuntimeMemory"]),function(e){popTypeaheadMap={typeaheadMap:function(a){var t=a.domain,n=a.pageSection,r=a.block;a.targets.each(function(){var a=e(this),o=a.find(".pop-typeahead"),i=a.find(".pop-map"),s=a.data("addmarker-template");o.on("selected",function(o,c){if(!popMap.hasMarker(n,r,c.id)){var p=popManager.getTargetConfiguration(t,n,r,s);e.extend(p,{itemObject:c}),popJSRuntimeManager.setBlockURL(r);var d=popManager.getTemplateHtml(t,n,r,s);popManager.mergeHtml(d,a),popManager.runJSMethods(t,n,r,s,"last"),popJSRuntimeManager.deleteBlockLastSessionIds(t,n,r,s)}i.data("marker-ids-"+removeScheme(t),[c.id]),popMap.addMarkers(t,n,r,i)}),o.on("close",function(e,a,t){popMap.removeMarker(n,r,i,t)})})}}}(jQuery),popJSLibraryManager.register(popTypeaheadMap,["typeaheadMap"]),function(e){popMapCollection={formMapLocationGeocode:function(a){var t=a.pageSection,n=a.block;a.targets.find("input.address-input").change(function(){var a=e(this).closest("div.pop-map-locationgeocode"),r=[];a.find("input.address-input").each(function(){var a=e(this);a.val()&&r.push(a.val())});var o=a.find("div.pop-map"),i=a.find("input.address-lat"),s=a.find("input.address-lng");popMap.geocode(t,n,o,r.join(", "),i,s)})},modalMap:function(a){var t=this,n=a.domain;a.targets.on("show.bs.modal",function(a){var r=e(this),o=e(a.relatedTarget);t.execModalMap(n,r,o)})},modalMapBlock:function(e){var a=this,t=e.domain,n=(e.pageSection,e.block,e.targets),r=e.relatedTarget,o=n.closest(".modal");a.execModalMap(t,o,r)},execModalMap:function(e,a,t){t=popManager.getOriginalLink(t);var n=popManager.getBlock(t),r=popManager.getPageSection(n),o=a.find(".pop-map");o.data("markers-pagesection",r),o.data("markers-block",n),o.data("markers-removecurrent",!0);var i=popMap.getMarkerIdsFromLinkURLs(t);o.data("marker-ids-"+removeScheme(e),i)}}}(jQuery),popJSLibraryManager.register(popMapCollection,["formMapLocationGeocode","modalMap","modalMapBlock"]),function(e){popFullCalendar={initBlockRuntimeMemory:function(e){var a=this,t=e.pageSection,n=e.block;e.runtimeMempage.fullCalendar={},a.resetBlockRuntimeMemory(t,n)},calendar:function(a){var t=this,n=a.domain,r=a.pageSection,o=a.block,i=a.targets,s=popManager.getPageSectionPage(o);s.one("destroy",function(){i.fullCalendar("destroy")}),s.hasClass("tab-pane")&&!popManager.isActive(s)&&s.one("shown.bs.tabpane",function(){i.fullCalendar("render")}),o.on("beforeRender",function(a,n){var o=e(this);n.operation==M.URLPARAM_OPERATION_REPLACE&&t.resetBlockRuntimeMemory(r,o)}),o.on("rendered",function(a,n,r,o){var s=e(this),c=popManager.getPageSection(s);t.execCalendar(o,c,s,i,"update"),windowResize()}),t.execCalendar(n,r,o,i,"new")},getRuntimeMemoryPage:function(e,a){return popManager.getRuntimeMemoryPage(e,a).fullCalendar},resetBlockRuntimeMemory:function(a,t){var n=this.getRuntimeMemoryPage(a,t),r={eventsHtml:{},runJS:!1,events:[],loadedEventIds:{},loadedDates:{}};e.extend(n,r)},addEvents:function(e,a,t){var n=this;t.length&&(popManager.jsInitialized(a)?n.execAddEvents(e,a,t):a.one("initialize",function(){n.execAddEvents(e,a,t)}))},execAddEvents:function(a,t,n){var r=this,o=r.getRuntimeMemoryPage(a,t),i=[];e.each(n,function(e,n){r.isEventLoaded(a,t,n.domain,n.id)||(i.push(n),r.setEventLoaded(a,t,n.domain,n.id))}),e.merge(o.events,i)},execCalendar:function(a,t,n,r,o){var i,s=this,c=s.getRuntimeMemoryPage(t,n),p=s.getDate(t,n);"new"==o&&(i={header:{left:"title",center:"",right:""},events:function(e,a,t,n){n(c.events)},defaultDate:p,fixedWeekCount:!1,height:"auto",contentHeight:"auto",dayNamesShort:M.DATERANGE_DAYSOFWEEK}),r.each(function(){var r=e(this);s.execFullCalendar(a,t,n,r,o,i)}),s.setDateLoaded(t,n,p)},execFullCalendar:function(a,t,n,r,o,i){var s=this;if("new"==o){var c=popManager.getJsSettings(a,t,n,r),p=c.options||{},d=e.extend({},i,p),g=c.layouts;d.eventRender=function(e,a){s.renderEvent(t,n,g,e,a)},d.eventAfterAllRender=function(e){s.renderEventAfterAll(t,n,g)},r.fullCalendar(d)}else"update"==o&&r.fullCalendar("refetchEvents")},setDateLoaded:function(e,a,t){this.getRuntimeMemoryPage(e,a).loadedDates[t.year()+"-"+(t.month()+1)]=!0},isDateLoaded:function(e,a,t){return!0===this.getRuntimeMemoryPage(e,a).loadedDates[t.year()+"-"+(t.month()+1)]},setEventLoaded:function(e,a,t,n){var r=this.getRuntimeMemoryPage(e,a);r.loadedEventIds[t]=r.loadedEventIds[t]||{},r.loadedEventIds[t][n]=!0},isEventLoaded:function(e,a,t,n){var r=this.getRuntimeMemoryPage(e,a);return r.loadedEventIds[t]&&!0===r.loadedEventIds[t][n]},getDate:function(e,a){var t=popManager.getBlockQueryState(e,a),n=parseInt(t[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]),r=parseInt(t[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]);return moment(n+"-"+r+"-01","YYYY-M-DD")},renderEvent:function(a,t,n,r,o){var i=this.getRuntimeMemoryPage(a,t),s=r.domain,c=r.id;i.eventsHtml[s]=i.eventsHtml[s]||{};var p=i.eventsHtml[s][c];if(p)i.runJS=!0;else{var d={},g=popManager.getDatabaseKeys(s,a,t)["db-key"];p="",popJSRuntimeManager.setBlockURL(t),e.each(n,function(e,n){p+=popManager.getTemplateHtml(s,a,t,n,d,g,c)}),i.eventsHtml[s][c]=p}o.html(p)},renderEventAfterAll:function(a,t,n){var r=this.getRuntimeMemoryPage(a,t);if(popManager.triggerHTMLMerged(),r.runJS){r.runJS=!1;var o=popManager.getQueryMultiDomainUrls(a,t);e.each(o,function(r,o){e.each(n,function(e,n){popManager.runJSMethods(r,a,t,n,"full")})})}},fetch:function(e,a,t){var n=this,r=n.getDate(e,a);t.fullCalendar("gotoDate",r),n.isDateLoaded(e,a,r)||popManager.fetchBlock(e,a,{operation:M.URLPARAM_OPERATION_APPEND})}}}(jQuery),function(e){popFullCalendarControls={controlCalendarPrev:function(a){var t=this,n=a.pageSection,r=a.block;a.targets.click(function(a){var o=e(this);t.execute(n,r,o,"prev")})},controlCalendarNext:function(a){var t=this,n=a.pageSection,r=a.block;a.targets.click(function(a){var o=e(this);t.execute(n,r,o,"next")})},setCalendarBlockParams:function(e,a,t){var n=popManager.getBlockQueryState(e,a);n[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]=t.year(),n[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]=t.month()+1},execute:function(a,t,n,r){var o=this,i=e(n.closest(".pop-calendar-controls").data("target")),s=i.fullCalendar("getDate");"next"==r?s.add(1,"months"):s=s.subtract(1,"months"),o.setCalendarBlockParams(a,t,s),popManager.closeMessageFeedback(t),popFullCalendar.fetch(a,t,i)}}}(jQuery),popJSLibraryManager.register(popFullCalendar,["initBlockRuntimeMemory","calendar"]),popJSLibraryManager.register(popFullCalendarControls,["controlCalendarPrev","controlCalendarNext"]);