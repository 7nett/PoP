!function(e){popCreateLocation={createLocationModal:function(e){var a=this,t=e.pageSection,r=e.targets;a.execCreateLocationModal(t,r)},createLocationModalBlock:function(e){var a=this,t=e.pageSection,r=e.targets,n=e.relatedTarget;a.transferAttributes(r.closest(".modal"),n),a.execCreateLocationModal(t,r.closest(".modal"))},maybeCloseLocationModal:function(a){var t=a.pageSection,r=a.targets,n=popManager.getSettingsId(t);r.on("fetched",function(a,t){var r=e(this),o=popManager.getSettingsId(r),i=t.feedback.block[n][o];i.result===!0&&r.closest(".modal").modal("hide")})},transferAttributes:function(e,a){a=popManager.getOriginalLink(a),e.data("typeahead-target",a.data("typeahead-target"))},execCreateLocationModal:function(a,t){var r=this;t.addClass("pop-createlocation"),t.on("show.bs.modal",function(a){var t=e(this),n=e(a.relatedTarget);r.transferAttributes(t,n)})}}}(jQuery),popJSLibraryManager.register(popCreateLocation,["createLocationModal","createLocationModalBlock","maybeCloseLocationModal"]),function(e){popMap={initBlockRuntimeMemory:function(e){var a=this,t=e.pageSection,r=e.block,n=e.runtimeMempage;n.map={},a.resetBlockRuntimeMemory(t,r)},map:function(a){var t=this,r=a.pageSection,n=a.block,o=a.targets;n.one("rerender",function(e){t.destroy(r,n,o)}),o.each(function(){var a=e(this);t.triggerShowMap(r,n,a)})},mapModal:function(a){var t=this,r=a.pageSection,n=a.targets;n.on("shown.bs.modal",function(){var a=e(this);e.each(a.find(".pop-map"),function(){var a=e(this),n=popManager.getBlock(a);popManager.jsInitialized(n)&&t.triggerShowMap(r,n,a)})})},mapStandalone:function(a){var t=this,r=a.pageSection,n=a.block,o=a.targets;popPageSectionManager.getGroup(r).on("on.bs.pagesection:theater off.bs.pagesection:theater",function(a){o.each(function(){var a=e(this);popManager.isHidden(a)||t.refresh(r,n,a)})}),n.on("fetchCompleted",function(a,i){o.each(function(){var a=e(this);t.functionHiddenMap("addmarkers",r,n,a,i)})}),o.each(function(){var a=e(this);t.hoverBlockElems(r,n,a)})},getRuntimeMemoryPage:function(e,a){return popManager.getRuntimeMemoryPage(e,a).map},resetBlockRuntimeMemory:function(a,t){var r=this,n=r.getRuntimeMemoryPage(a,t),o={markers:{},markersPos:{},markersOpen:{},maps:{}};e.extend(n,o)},destroy:function(a,t,r){var n=this,o=n.getRuntimeMemoryPage(a,t);r.each(function(){var a=e(this),t=a.attr("id");delete o.maps[t]})},triggerShowMap:function(e,a,t){var r=this;popManager.isHidden(t)?r.functionHiddenMap("trigger",e,a,t):r.execTriggerShowMap(e,a,t)},functionHiddenMap:function(a,t,r,n,o){var i=this,s=popManager.getPageSectionPage(r);if(popPageSectionManager.execIsHidden(t))popPageSectionManager.getGroup(t).one("on.bs.pagesection-group:pagesection-"+t.attr("id")+":opened",function(){r=e("#"+r.attr("id")),r.length&&("trigger"==a?i.triggerShowMap(t,r,n):"addmarkers"==a&&i.addMarkers(t,r,n,o.reload))});else if(n.parents(".collapse").not(".in").length){var c=n.parents(".collapse").not(".in");c.one("shown.bs.collapse",function(){"trigger"==a?i.triggerShowMap(t,r,n):"addmarkers"==a&&i.addMarkers(t,r,n,o.reload)})}else s.hasClass("tab-pane")&&!popManager.isActive(s)&&s.one("shown.bs.tabpane",function(){"trigger"==a?i.triggerShowMap(t,r,n):"addmarkers"==a&&i.addMarkers(t,r,n,o.reload)})},execTriggerShowMap:function(e,a,t){var r=this;r.addMarkers(e,a,t,t.data("markers-removecurrent")),windowResize()},refresh:function(e,a,t){var r=this,n=r.getGMap(e,a,t);n&&n.refresh()},hoverBlockElems:function(a,t,r){var n=this;t.on("mouseenter",".pop-openmapmarkers",function(){var o,i=e(this);if(i.hasClass("make-popover")){var s=i.attr("aria-describedby");s&&(o=e("#"+s).find("a.pop-modalmap-link"))}else o=i.find("a.pop-modalmap-link");n.openMapMarkers(a,t,r,o)})},openMapMarkers:function(e,a,t,r){var n=this;popManager.isHidden(t)||(n.closeMarkers(e,a,t),r.length&&n.openMarkers(e,a,t,r))},closeMarkers:function(a,t,r){var n=this,o=n.getGMap(a,t,r);if(o){var i=n.getMarkersInfo(a,t,r);o.hideInfoWindows(),e.each(i.markersOpen,function(e,a){markerPos=i.markersPos[a],o.markers[markerPos].setIcon("https://maps.google.com/mapfiles/ms/icons/red-dot.png")})}},getMarkerIdsFromLinkURLs:function(a){var t=[];return a.each(function(){var a=e(this);a=popManager.getOriginalLink(a);var r=a.attr("href"),n=getParam(M.LOCATIONSID_FIELDNAME,r);n&&e.each(n,function(e,a){t.push(a)})}),t},openMarkers:function(a,t,r,n){var o=this,i=o.getMarkerIdsFromLinkURLs(n);if(i.length){i=i.filter(function(e,a){return i.indexOf(e)==a});var s=o.getGMap(a,t,r);if(s){var c=o.getMarkersInfo(a,t,r);e.each(i,function(e,a){markerPos=c.markersPos[a],s.markers[markerPos]&&s.markers[markerPos].setIcon("https://maps.google.com/mapfiles/ms/icons/green-dot.png")}),1==i.length?(markerPos=c.markersPos[i[0]],s.markers[markerPos]&&google.maps.event.trigger(s.markers[markerPos],"click")):s.fitZoom(),o.setMarkersOpen(a,t,r,i,!0)}}},initMarker:function(e,a,t,r){var n=this,o=n.getRuntimeMemoryPage(e,a),i=o.markers[t];if(i){if(i.title.split(" | ").indexOf(r.title)>-1)return;r.title=i.title+" | "+r.title,r.infoWindow.content=r.infoWindow.content+"<hr/>"+i.infoWindow.content,r.icon="https://maps.google.com/mapfiles/ms/icons/red-dot.png"}o.markers[t]=r},hasMarker:function(e,a,t){var r=this,n=r.getRuntimeMemoryPage(e,a);return n.markers[t]},getGMap:function(e,a,t){var r=this;if("undefined"!=typeof GMaps){var n=r.getRuntimeMemoryPage(e,a),o=t.attr("id"),i=n.maps[o];return i||(i=n.maps[o]=new GMaps({div:"#"+o,lat:M.LOCATIONSMAP_LAT,lng:M.LOCATIONSMAP_LNG,zoom:parseInt(M.LOCATIONSMAP_ZOOM)})),i}},getMarkersInfo:function(e,a,t){var r=this,n=t.data("markers-pagesection")||e,o=t.data("markers-block")||a,i=r.getRuntimeMemoryPage(n,o),s=t.attr("id");return{markers:i.markers||{},markersPos:i.markersPos[s]||{},markersOpen:i.markersOpen[s]||[]}},setMarkersOpen:function(e,a,t,r,n){var o=this,i=o.getRuntimeMemoryPage(e,a),s=t.attr("id");!n&&i.markersOpen[s]||(i.markersOpen[s]=[]),r&&(i.markersOpen[s]=i.markersOpen[s].concat(r))},setMarkersPos:function(a,t,r,n,o){var i=this,s=i.getRuntimeMemoryPage(a,t),c=r.attr("id");!o&&s.markersPos[c]||(s.markersPos[c]={}),n&&e.extend(s.markersPos[c],n)},removeMarker:function(e,a,t,r){var n=this,o=n.getGMap(e,a,t);if(o){var i=n.getMarkersInfo(e,a,t);markerPos=i.markersPos[r],o.markers[markerPos].setMap(null),n.zoom(e,a,t)}},zoom:function(e,a,t){var r=this,n=r.getGMap(e,a,t);if(n)if(n.markers.length>1)n.fitZoom();else if(1==n.markers.length){var o=n.markers[0].getPosition();n.setCenter(o.lat(),o.lng()),n.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM))}},addMarkers:function(a,t,r,n){var o=this,i=o.getGMap(a,t,r);if(i){n&&(i.removeMarkers(),o.setMarkersOpen(a,t,r,null,!0),o.setMarkersPos(a,t,r,null,!0));var s=r.data("marker-ids");if(s&&s.length){r.data("marker-ids",null);var c,p,d,g=o.getMarkersInfo(a,t,r),l={};e.each(s,function(e,a){c=g.markers[a];var t={content:c.infoWindow.header+"<br/>"+c.infoWindow.content},r={lat:c.coordinates.lat,lng:c.coordinates.lng,title:c.title,infoWindow:t,icon:c.icon,animation:google.maps.Animation.DROP};p=i.addMarker(r),d=i.markers.length-1,l[a]=d}),o.setMarkersPos(a,t,r,l);var m=r.data("open-onemarker-infowindow");1==s.length&&m&&(i.hideInfoWindows(),google.maps.event.trigger(p,"click")),o.zoom(a,t,r)}}},geocode:function(e,a,t,r,n,o){var i=this,s=i.getGMap(e,a,t);s&&GMaps.geocode({address:r,callback:function(e,a){if("OK"==a){s.removeMarkers();var t=e[0].geometry.location;s.setCenter(t.lat(),t.lng()),s.addMarker({lat:t.lat(),lng:t.lng(),draggable:!0}),s.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM)),n.val(t.lat()),o.val(t.lng());var r=s.markers[0];google.maps.event.addListener(r,"dragend",function(){var e=r.getPosition();n.val(e.lat()),o.val(e.lng())})}}})}}}(jQuery),function(e){popMapRuntime={initBlockRuntimeMemory:function(e){var a=this,t=e.pageSection,r=e.block,n=e.runtimeMempage;n.mapRuntime={},a.resetBlockRuntimeMemory(t,r)},getRuntimeMemoryPage:function(e,a){return popManager.getRuntimeMemoryPage(e,a).mapRuntime},resetBlockRuntimeMemory:function(a,t){var r=this,n=r.getRuntimeMemoryPage(a,t),o={content:"",title:"",marker_ids:[]};e.extend(n,o)},drawMarkers:function(e,a,t){var r=this;popManager.jsInitialized(a)?r.execDrawMarkers(e,a,t):a.one("initialize",function(){r.execDrawMarkers(e,a,t)})},execDrawMarkers:function(e,a,t){var r=this,n=r.getRuntimeMemoryPage(e,a);t.data("marker-ids",n.marker_ids)},resetMarkerIds:function(e,a){var t=this;popManager.jsInitialized(a)?t.execResetMarkerIds(e,a):a.one("initialize",function(){t.execResetMarkerIds(e,a)})},execResetMarkerIds:function(e,a){var t=this,r=t.getRuntimeMemoryPage(e,a);r.marker_ids=[]},setMarkerData:function(e,a,t,r){var n=this;popManager.jsInitialized(a)?n.execSetMarkerData(e,a,t,r):a.one("initialize",function(){n.execSetMarkerData(e,a,t,r)})},execSetMarkerData:function(e,a,t,r){var n=this,o=n.getRuntimeMemoryPage(e,a);o.title||(o.title=t),o.content||(o.content=r)},initMarker:function(e,a,t,r,n,o,i){var s=this;popManager.jsInitialized(a)?s.execInitMarker(e,a,t,r,n,o,i):a.one("initialize",function(){s.execInitMarker(e,a,t,r,n,o,i)})},execInitMarker:function(e,a,t,r,n,o,i){var s=this,c=s.getRuntimeMemoryPage(e,a);s.setMarkerData(e,a,o,i);var p=c.title,d=c.content,g={coordinates:{lat:r,lng:n},title:p,infoWindow:{header:"<strong>"+p+"</strong>",content:d},icon:"https://maps.google.com/mapfiles/ms/icons/red-dot.png"};c.marker_ids.push(t),popMap.initMarker(e,a,t,g),c.content="",c.title=""}}}(jQuery),popJSLibraryManager.register(popMap,["initBlockRuntimeMemory","map","mapModal","mapStandalone"]),popJSLibraryManager.register(popMapRuntime,["initBlockRuntimeMemory"]),function(e){popTypeaheadMap={typeaheadMap:function(a){var t=a.pageSection,r=a.block,n=a.targets;n.each(function(){var a=e(this),n=a.find(".pop-typeahead"),o=a.find(".pop-map"),i=a.data("addmarker-template");n.on("selected",function(n,s){if(!popMap.hasMarker(t,r,s.id)){var c=popManager.getTargetConfiguration(t,r,i);e.extend(c,{itemObject:s});var p=popManager.getTemplateHtml(t,r,i);popManager.mergeHtml(p,a),popManager.runJSMethods(t,r,i,"last"),popJSRuntimeManager.deleteBlockLastSessionIds(t,r,i)}o.data("marker-ids",[s.id]),popMap.addMarkers(t,r,o)}),n.on("close",function(e,a,n){popMap.removeMarker(t,r,o,n)})})}}}(jQuery),popJSLibraryManager.register(popTypeaheadMap,["typeaheadMap"]),function(e){popMapCollection={formMapLocationGeocode:function(a){var t=a.pageSection,r=a.block,n=a.targets;n.find("input.address-input").change(function(){var a=e(this),n=a.closest("div.pop-map-locationgeocode"),o=[];n.find("input.address-input").each(function(){var a=e(this);a.val()&&o.push(a.val())});var i=n.find("div.pop-map"),s=n.find("input.address-lat"),c=n.find("input.address-lng");popMap.geocode(t,r,i,o.join(", "),s,c)})},modalMap:function(a){var t=this,r=a.targets;r.on("show.bs.modal",function(a){var r=e(this),n=e(a.relatedTarget);t.execModalMap(r,n)})},modalMapBlock:function(e){var a=this,t=(e.pageSection,e.block,e.targets),r=e.relatedTarget,n=t.closest(".modal");a.execModalMap(n,r)},execModalMap:function(e,a){a=popManager.getOriginalLink(a);var t=popManager.getBlock(a),r=popManager.getPageSection(t),n=e.find(".pop-map");n.data("markers-pagesection",r),n.data("markers-block",t),n.data("markers-removecurrent",!0);var o=popMap.getMarkerIdsFromLinkURLs(a);n.data("marker-ids",o)}}}(jQuery),popJSLibraryManager.register(popMapCollection,["formMapLocationGeocode","modalMap","modalMapBlock"]),function(e){popFullCalendar={initBlockRuntimeMemory:function(e){var a=this,t=e.pageSection,r=e.block,n=e.runtimeMempage;n.fullCalendar={},a.resetBlockRuntimeMemory(t,r)},calendar:function(a){var t=this,r=a.pageSection,n=a.block,o=a.targets,i=popManager.getPageSectionPage(n);i.one("destroy",function(){o.fullCalendar("destroy")}),i.hasClass("tab-pane")&&!popManager.isActive(i)&&i.one("shown.bs.tabpane",function(){o.fullCalendar("render")}),n.on("beforeMerge",function(a,n){var o=e(this);n.operation==M.URLPARAM_OPERATION_REPLACE&&t.resetBlockRuntimeMemory(r,o)}),n.on("rendered",function(a){var r=e(this),n=popManager.getPageSection(r);t.execCalendar(n,r,o,"update"),windowResize()}),t.execCalendar(r,n,o,"new")},getRuntimeMemoryPage:function(e,a){return popManager.getRuntimeMemoryPage(e,a).fullCalendar},resetBlockRuntimeMemory:function(a,t){var r=this,n=r.getRuntimeMemoryPage(a,t),o={eventsHtml:{},runJS:!1,events:[],loadedEventIds:{},loadedDates:{}};e.extend(n,o)},addEvents:function(e,a,t){var r=this;t.length&&(popManager.jsInitialized(a)?r.execAddEvents(e,a,t):a.one("initialize",function(){r.execAddEvents(e,a,t)}))},execAddEvents:function(a,t,r){var n=this,o=n.getRuntimeMemoryPage(a,t),i=[];e.each(r,function(e,r){n.isEventLoaded(a,t,r.id)||(i.push(r),n.setEventLoaded(a,t,r.id))}),e.merge(o.events,i)},execCalendar:function(a,t,r,n){var o,i=this,s=i.getRuntimeMemoryPage(a,t),c=i.getDate(a,t);"new"==n&&(o={header:{left:"title",center:"",right:""},events:function(e,a,t,r){var n;n=s.events,r(n)},defaultDate:c,fixedWeekCount:!1,height:"auto",contentHeight:"auto",dayNamesShort:M.DATERANGE_DAYSOFWEEK}),r.each(function(){var r=e(this);if("new"==n){var s=popManager.getJsSettings(a,t,r),c=s.options||{},p=e.extend({},o,c),d=s.layouts;p.eventRender=function(e,r){i.renderEvent(a,t,d,e,r)},p.eventAfterAllRender=function(e){i.renderEventAfterAll(a,t,d)},r.fullCalendar(p)}else"update"==n&&r.fullCalendar("refetchEvents")}),i.setDateLoaded(a,t,c)},setDateLoaded:function(e,a,t){var r=this,n=r.getRuntimeMemoryPage(e,a);n.loadedDates[t.year()+"-"+(t.month()+1)]=!0},isDateLoaded:function(e,a,t){var r=this,n=r.getRuntimeMemoryPage(e,a);return n.loadedDates[t.year()+"-"+(t.month()+1)]===!0},setEventLoaded:function(e,a,t){var r=this,n=r.getRuntimeMemoryPage(e,a);n.loadedEventIds[t]=!0},isEventLoaded:function(e,a,t){var r=this,n=r.getRuntimeMemoryPage(e,a);return n.loadedEventIds[t]===!0},getDate:function(e,a){var t=popManager.getBlockParams(e,a),r=parseInt(t[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]),n=parseInt(t[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]);return moment(r+"-"+n+"-01","YYYY-M-DD")},renderEvent:function(a,t,r,n,o){var i=this,s=i.getRuntimeMemoryPage(a,t),c=n.id,p=s.eventsHtml[c];if(p)s.runJS=!0;else{var d={},g=popManager.getDatabaseKeys(a,t),l=g["db-key"];p="",e.each(r,function(e,r){p+=popManager.getTemplateHtml(a,t,r,d,l,c)}),s.eventsHtml[c]=p}o.html(p)},renderEventAfterAll:function(a,t,r){var n=this,o=n.getRuntimeMemoryPage(a,t);popManager.triggerHTMLMerged(),o.runJS&&(o.runJS=!1,e.each(r,function(e,r){popManager.runJSMethods(a,t,r,"full")}))},fetch:function(e,a,t){var r=this,n=r.getDate(e,a);t.fullCalendar("gotoDate",n),r.isDateLoaded(e,a,n)||popManager.fetchBlock(e,a,{operation:M.URLPARAM_OPERATION_APPEND})}}}(jQuery),function(e){popFullCalendarControls={controlCalendarPrev:function(a){var t=this,r=a.pageSection,n=a.block,o=a.targets;o.click(function(a){var o=e(this);t.execute(r,n,o,"prev")})},controlCalendarNext:function(a){var t=this,r=a.pageSection,n=a.block,o=a.targets;o.click(function(a){var o=e(this);t.execute(r,n,o,"next")})},setCalendarBlockParams:function(e,a,t){var r=popManager.getBlockParams(e,a);r[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]=t.year(),r[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]=t.month()+1},execute:function(a,t,r,n){var o=this,i=e(r.closest(".pop-calendar-controls").data("target")),s=i.fullCalendar("getDate");"next"==n?s.add(1,"months"):s=s.subtract(1,"months"),o.setCalendarBlockParams(a,t,s),popManager.closeMessageFeedback(t),popFullCalendar.fetch(a,t,i)}}}(jQuery),popJSLibraryManager.register(popFullCalendar,["initBlockRuntimeMemory","calendar"]),popJSLibraryManager.register(popFullCalendarControls,["controlCalendarPrev","controlCalendarNext"]);