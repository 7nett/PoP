"use strict";!function(e){window.popMap={initBlockRuntimeMemory:function(e){var r=this,t=e.pageSection,n=e.block;e.runtimeMempage.map={},r.resetBlockRuntimeMemory(t,n)},map:function(r){var t=this,n=r.domain,a=r.pageSection,i=r.block,o=r.targets;i.one("rerender",function(e){t.destroy(a,i,o)}),e(document).ready(function(e){o.each(function(){var r=e(this);t.triggerShowMap(n,a,i,r)}),M.USE_PROGRESSIVEBOOTING&&!popManager.jsInitialized(i)&&i.one("initialize",function(){o.each(function(){var r=e(this);t.triggerAddMarkers(n,a,i,r)})})})},mapModal:function(r){var t=this,n=r.domain,a=r.pageSection;r.targets.on("shown.bs.modal",function(){var r=e(this);e.each(r.find(".pop-map"),function(){var r=e(this),i=popManager.getBlock(r);popManager.jsInitialized(i)&&t.triggerShowMap(n,a,i,r)})})},mapStandalone:function(r){var t=this,n=r.pageSection,a=r.block,i=r.targets;popPageSectionManager.getGroup(n).on("on.bs.pagesection:theater off.bs.pagesection:theater",function(r){i.each(function(){var r=e(this);popManager.isHidden(r)||t.refresh(n,a,r)})}),a.on("fetchDomainCompleted",function(r,o,s){popJSRuntimeManager.setBlockURL(a),i.each(function(){var r=e(this);t.triggerAddMarkers(s,n,a,r,o)})}),i.each(function(){var r=e(this);t.hoverBlockElems(n,a,r)})},getRuntimeMemoryPage:function(e,r){return popManager.getRuntimeMemoryPage(e,r).map},resetBlockRuntimeMemory:function(r,t){var n=this,a=n.getRuntimeMemoryPage(r,t),i=n.getEmtpyBlockRuntimeMemory();e.extend(a,i)},getEmtpyBlockRuntimeMemory:function(){return{markers:{},markersPos:{},markersOpen:{},maps:{}}},destroy:function(r,t,n){var a=this.getRuntimeMemoryPage(r,t);n.each(function(){var r=e(this).attr("id");delete a.maps[r]})},triggerShowMap:function(e,r,t,n){var a=this;popManager.isHidden(n)?a.pendingTriggerMap("showmap",e,r,t,n):a.execTriggerShowMap(e,r,t,n)},triggerAddMarkers:function(e,r,t,n,a){var i=this;if(a=a||{},popManager.isHidden(n))i.pendingTriggerMap("addmarkers",e,r,t,n,a);else{var o=a.reload&&a.isFirst;i.addMarkers(e,r,t,n,o)}},triggerFunction:function(e,r,t,n,a,i){var o=this;"showmap"==e?o.triggerShowMap(r,t,n,a):"addmarkers"==e&&o.triggerAddMarkers(r,t,n,a,i)},pendingTriggerMap:function(r,t,n,a,i,o){var s=this,g=popManager.getPageSectionPage(a);popPageSectionManager.execIsHidden(n)?popPageSectionManager.getGroup(n).one("on.bs.pagesection-group:pagesection-"+n.attr("id")+":opened",function(){(a=e("#"+a.attr("id"))).length&&s.triggerFunction(r,t,n,a,i,o)}):i.parents(".collapse").not(".in").length?i.parents(".collapse").not(".in").one("shown.bs.collapse",function(){s.triggerFunction(r,t,n,a,i,o)}):g.hasClass("tab-pane")&&!popManager.isActive(g)&&g.one("shown.bs.tabpane",function(){s.triggerFunction(r,t,n,a,i,o)})},execTriggerShowMap:function(e,r,t,n){this.addMarkers(e,r,t,n,n.data("markers-removecurrent")),windowResize()},refresh:function(e,r,t){var n=this.getGMap(e,r,t);n&&n.refresh()},hoverBlockElems:function(r,t,n){var a=this;t.on("mouseenter",".pop-openmapmarkers",function(){var i,o=e(this);if(o.hasClass("make-popover")){var s=o.attr("aria-describedby");s&&(i=e("#"+s).find("a.pop-modalmap-link"))}else i=o.find("a.pop-modalmap-link");a.openMapMarkers(r,t,n,i)})},openMapMarkers:function(e,r,t,n){var a=this;popManager.isHidden(t)||(a.closeMarkers(e,r,t),n.length&&a.openMarkers(e,r,t,n))},closeMarkers:function(r,t,n){var a=this,i=a.getGMap(r,t,n);if(i){var o=a.getMarkersInfo(r,t,n);i.hideInfoWindows(),e.each(o.markersOpen,function(e,r){var t=o.markersPos[r];i.markers[t]&&i.markers[t].setIcon("https://maps.google.com/mapfiles/ms/icons/red-dot.png")})}},getMarkerIdsFromLinkURLs:function(r){var t=[];return r.each(function(){var r=e(this),n=(r=popManager.getOriginalLink(r)).attr("href"),a=getParam(M.LOCATIONSID_FIELDNAME,n);a&&e.each(a,function(e,r){t.push(r)})}),t},openMarkers:function(r,t,n,a){var i=this,o=i.getMarkerIdsFromLinkURLs(a);if(o.length){o=o.filter(function(e,r){return o.indexOf(e)==r});var s=i.getGMap(r,t,n);if(s){var g=i.getMarkersInfo(r,t,n);if(e.each(o,function(e,r){var t=g.markersPos[r];s.markers[t]&&s.markers[t].setIcon("https://maps.google.com/mapfiles/ms/icons/green-dot.png")}),1==o.length){var m=g.markersPos[o[0]];s.markers[m]&&"undefined"!=typeof google&&google.maps.event.trigger(s.markers[m],"click")}else s.fitZoom();i.setMarkersOpen(r,t,n,o,!0)}}},initMarker:function(e,r,t,n){var a=this.getRuntimeMemoryPage(e,r),i=a.markers[t];if(i){if(i.title.split(" | ").indexOf(n.title)>-1)return;n.title=i.title+" | "+n.title,n.infoWindow.content=n.infoWindow.content+"<hr/>"+i.infoWindow.content,n.icon="https://maps.google.com/mapfiles/ms/icons/red-dot.png"}a.markers[t]=n},hasMarker:function(e,r,t){return this.getRuntimeMemoryPage(e,r).markers[t]},getGMap:function(e,r,t){var n=this;if("undefined"!=typeof google&&"undefined"!=typeof GMaps){var a=n.getRuntimeMemoryPage(e,r),i=t.attr("id"),o=a.maps[i];return o||(o=new GMaps({div:"#"+i,lat:M.LOCATIONSMAP_LAT,lng:M.LOCATIONSMAP_LNG,zoom:parseInt(M.LOCATIONSMAP_ZOOM)}),a.maps[i]=o),o}},getMarkersInfo:function(e,r,t){var n=this,a=t.data("markers-pagesection")||e,i=t.data("markers-block")||r,o=n.getEmtpyBlockRuntimeMemory();try{o=n.getRuntimeMemoryPage(a,i)}catch(e){console.log("Error: "+e.message)}var s=t.attr("id");return{markers:o.markers||{},markersPos:o.markersPos[s]||{},markersOpen:o.markersOpen[s]||[]}},setMarkersOpen:function(e,r,t,n,a){var i=this.getRuntimeMemoryPage(e,r),o=t.attr("id");!a&&i.markersOpen[o]||(i.markersOpen[o]=[]),n&&(i.markersOpen[o]=i.markersOpen[o].concat(n))},setMarkersPos:function(r,t,n,a,i){var o=this.getRuntimeMemoryPage(r,t),s=n.attr("id");!i&&o.markersPos[s]||(o.markersPos[s]={}),a&&e.extend(o.markersPos[s],a)},removeMarker:function(e,r,t,n){var a=this,i=a.getGMap(e,r,t);if(i){var o=a.getMarkersInfo(e,r,t).markersPos[n];i.markers[o]&&i.markers[o].setMap(null),a.zoom(e,r,t)}},zoom:function(e,r,t){var n=this.getGMap(e,r,t);if(n)if(n.markers.length>1)n.fitZoom();else if(1==n.markers.length){var a=n.markers[0].getPosition();n.setCenter(a.lat(),a.lng()),n.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM))}},addMarkers:function(r,t,n,a,i){var o=this,s=o.getGMap(t,n,a);if(s){i&&(s.removeMarkers(),o.setMarkersOpen(t,n,a,null,!0),o.setMarkersPos(t,n,a,null,!0));var g=a.data("marker-ids-"+removeScheme(r));if(g&&g.length){a.data("marker-ids-"+removeScheme(r),null);var m,c,p,M=o.getMarkersInfo(t,n,a),d={};e.each(g,function(e,r){if(m=M.markers[r]){var t={content:m.infoWindow.header+"<br/>"+m.infoWindow.content},n={lat:m.coordinates.lat,lng:m.coordinates.lng,title:m.title,infoWindow:t,icon:m.icon};"undefined"!=typeof google&&(n.animation=google.maps.Animation.DROP),c=s.addMarker(n),p=s.markers.length-1,d[r]=p}}),o.setMarkersPos(t,n,a,d);var l=a.data("open-onemarker-infowindow");1==g.length&&l&&(s.hideInfoWindows(),"undefined"!=typeof google&&google.maps.event.trigger(c,"click")),o.zoom(t,n,a)}}},geocode:function(e,r,t,n,a,i){var o=this.getGMap(e,r,t);o&&GMaps.geocode({address:n,callback:function(e,r){if("OK"==r){o.removeMarkers();var t=e[0].geometry.location;o.setCenter(t.lat(),t.lng()),o.addMarker({lat:t.lat(),lng:t.lng(),draggable:!0}),o.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM)),a.val(t.lat()),i.val(t.lng());var n=o.markers[0];"undefined"!=typeof google&&google.maps.event.addListener(n,"dragend",function(){var e=n.getPosition();a.val(e.lat()),i.val(e.lng())})}}})}}}(jQuery),function(e){window.popMapRuntime={initBlockRuntimeMemory:function(e){var r=this,t=e.pageSection,n=e.block;e.runtimeMempage.mapRuntime={},r.resetBlockRuntimeMemory(t,n)},getRuntimeMemoryPage:function(e,r){return popManager.getRuntimeMemoryPage(e,r).mapRuntime},resetBlockRuntimeMemory:function(r,t){var n=this.getRuntimeMemoryPage(r,t),a={content:"",title:"",marker_ids:[]};e.extend(n,a)},drawMarkers:function(e,r,t,n){var a=this;popManager.jsInitialized(t)?a.execDrawMarkers(e,r,t,n):t.one("initialize",function(){a.execDrawMarkers(e,r,t,n)})},execDrawMarkers:function(e,r,t,n){var a=this.getRuntimeMemoryPage(r,t);n.data("marker-ids-"+removeScheme(e),a.marker_ids)},resetMarkerIds:function(e,r){var t=this;popManager.jsInitialized(r)?t.execResetMarkerIds(e,r):r.one("initialize",function(){t.execResetMarkerIds(e,r)})},execResetMarkerIds:function(e,r){this.getRuntimeMemoryPage(e,r).marker_ids=[]},setMarkerData:function(e,r,t,n){var a=this;popManager.jsInitialized(r)?a.execSetMarkerData(e,r,t,n):r.one("initialize",function(){a.execSetMarkerData(e,r,t,n)})},execSetMarkerData:function(e,r,t,n){var a=this.getRuntimeMemoryPage(e,r);a.title||(a.title=t),a.content||(a.content=n)},initMarker:function(e,r,t,n,a,i,o){var s=this;popManager.jsInitialized(r)?s.execInitMarker(e,r,t,n,a,i,o):r.one("initialize",function(){s.execInitMarker(e,r,t,n,a,i,o)})},execInitMarker:function(e,r,t,n,a,i,o){var s=this,g=s.getRuntimeMemoryPage(e,r);s.setMarkerData(e,r,i,o);var m=g.title,c={coordinates:{lat:n,lng:a},title:m,infoWindow:{header:"<strong>"+m+"</strong>",content:g.content},icon:"https://maps.google.com/mapfiles/ms/icons/red-dot.png"};g.marker_ids.push(t),popMap.initMarker(e,r,t,c),g.content="",g.title=""}}}(jQuery),popJSLibraryManager.register(popMap,["initBlockRuntimeMemory","map","mapModal","mapStandalone"]),popJSLibraryManager.register(popMapRuntime,["initBlockRuntimeMemory"]);