"use strict";!function(e){window.popMap={map:function(a){var r=this,n=a.domain,o=a.pageSection,t=a.block,i=a.targets;t.one("rerender",function(e){r.destroy(o,t,i)}),e(document).ready(function(e){i.each(function(){var a=e(this);r.triggerShowMap(n,o,t,a);var i=a.data("domains")||[];i.indexOf(n)>=0&&i.splice(i.indexOf(n),1),e.each(i,function(e,n){r.triggerShowMap(n,o,t,a)}),a.data("domains",null)})})},mapModal:function(a){var r=this,n=a.domain,o=a.pageSection;a.targets.on("shown.bs.modal",function(){var a=e(this);e.each(a.find(".pop-map"),function(){var a=e(this),t=popManager.getBlock(a);popManager.jsInitialized(t)&&r.triggerShowMap(n,o,t,a)})})},mapStandalone:function(a){var r=this,n=a.pageSection,o=a.block,t=a.targets;popPageSectionManager.getGroup(n).on("on.bs.pagesection:theater off.bs.pagesection:theater",function(a){t.each(function(){var a=e(this);popManager.isHidden(a)||r.refresh(n,o,a)})}),o.on("fetchDomainCompleted",function(a,i,s){popJSRuntimeManager.setBlockURL(o),t.each(function(){var a=e(this);r.triggerAddMarkers(s,n,o,a,i)})}),t.each(function(){var a=e(this);r.hoverBlockElems(n,o,a)})},destroy:function(a,r,n){var o=popMapMemory.getRuntimeMemoryPage(a,r);n.each(function(){var a=e(this).attr("id");delete o.maps[a]})},triggerShowMap:function(e,a,r,n){var o=this;popManager.isHidden(n)?o.pendingTriggerMap("showmap",e,a,r,n):o.execTriggerShowMap(e,a,r,n)},triggerAddMarkers:function(e,a,r,n,o){var t=this;if(o=o||{},popManager.isHidden(n))t.pendingTriggerMap("addmarkers",e,a,r,n,o);else{var i=(o.reload||o.action==M.CBACTION_LOADCONTENT)&&o.isFirst;t.addMarkers(e,a,r,n,i)}},triggerFunction:function(e,a,r,n,o,t){var i=this;"showmap"==e?i.triggerShowMap(a,r,n,o):"addmarkers"==e&&i.triggerAddMarkers(a,r,n,o,t)},pendingTriggerMap:function(a,r,n,o,t,i){var s=this,p=popManager.getPageSectionPage(o);popPageSectionManager.execIsHidden(n)?popPageSectionManager.getGroup(n).one("on.bs.pagesection-group:pagesection-"+n.attr("id")+":opened",function(){(o=e("#"+o.attr("id"))).length&&s.triggerFunction(a,r,n,o,t,i)}):t.parents(".collapse").not(".in").length?t.parents(".collapse").not(".in").one("shown.bs.collapse",function(){s.triggerFunction(a,r,n,o,t,i)}):p.hasClass("tab-pane")&&!popManager.isActive(p)&&p.one("shown.bs.tabpane",function(){s.triggerFunction(a,r,n,o,t,i)})},execTriggerShowMap:function(e,a,r,n){this.addMarkers(e,a,r,n,n.data("markers-removecurrent")),windowResize()},refresh:function(e,a,r){var n=this.getGMap(e,a,r);n&&n.refresh()},hoverBlockElems:function(a,r,n){var o=this;r.on("mouseenter",".pop-openmapmarkers",function(){var t,i=e(this);if(i.hasClass("make-popover")){var s=i.attr("aria-describedby");s&&(t=e("#"+s).find("a.pop-modalmap-link"))}else t=i.find("a.pop-modalmap-link");o.openMapMarkers(a,r,n,t)})},openMapMarkers:function(e,a,r,n){var o=this;popManager.isHidden(r)||(o.closeMarkers(e,a,r),n.length&&o.openMarkers(e,a,r,n))},closeMarkers:function(a,r,n){var o=this,t=o.getGMap(a,r,n);if(t){var i=o.getMarkersInfo(a,r,n);t.hideInfoWindows(),e.each(i.markersOpen,function(e,a){var r=i.markersPos[a];t.markers[r]&&t.markers[r].setIcon("https://maps.google.com/mapfiles/ms/icons/red-dot.png")})}},getMarkerIdsFromLinkURLs:function(a){var r=[];return a.each(function(){var a=e(this),n=(a=popManager.getOriginalLink(a)).attr("href"),o=getDomain(n),t=getParam(M.LOCATIONSID_FIELDNAME,n);t&&e.each(t,function(e,a){var n=popMapRuntime.getMarkerId(o,a);r.push(n)})}),r},openMarkers:function(a,r,n,o){var t=this,i=t.getMarkerIdsFromLinkURLs(o);if(i.length){i=i.filter(function(e,a){return i.indexOf(e)==a});var s=t.getGMap(a,r,n);if(s){var p=t.getMarkersInfo(a,r,n);if(e.each(i,function(e,a){var r=p.markersPos[a];s.markers[r]&&s.markers[r].setIcon("https://maps.google.com/mapfiles/ms/icons/green-dot.png")}),1==i.length){var g=p.markersPos[i[0]];s.markers[g]&&"undefined"!=typeof google&&google.maps.event.trigger(s.markers[g],"click")}else s.fitZoom();t.setMarkersOpen(a,r,n,i,!0)}}},hasMarker:function(e,a,r){return popMapMemory.getRuntimeMemoryPage(e,a).markers[r]},getGMap:function(e,a,r){if("undefined"!=typeof google&&"undefined"!=typeof GMaps){var n=popMapMemory.getRuntimeMemoryPage(e,a),o=r.attr("id"),t=n.maps[o];return t||(t=new GMaps({div:"#"+o,lat:M.LOCATIONSMAP_LAT,lng:M.LOCATIONSMAP_LNG,zoom:parseInt(M.LOCATIONSMAP_ZOOM)}),n.maps[o]=t),t}},getMarkersInfo:function(e,a,r){var n=r.data("markers-pagesection")||e,o=r.data("markers-block")||a,t=popMapMemory.getEmtpyBlockRuntimeMemory();try{t=popMapMemory.getRuntimeMemoryPage(n,o)}catch(e){console.log("Error: "+e.message)}var i=r.attr("id");return{markers:t.markers||{},markersPos:t.markersPos[i]||{},markersOpen:t.markersOpen[i]||[]}},setMarkersOpen:function(e,a,r,n,o){var t=popMapMemory.getRuntimeMemoryPage(e,a),i=r.attr("id");!o&&t.markersOpen[i]||(t.markersOpen[i]=[]),n&&(t.markersOpen[i]=t.markersOpen[i].concat(n))},setMarkersPos:function(a,r,n,o,t){var i=popMapMemory.getRuntimeMemoryPage(a,r),s=n.attr("id");!t&&i.markersPos[s]||(i.markersPos[s]={}),o&&e.extend(i.markersPos[s],o)},removeMarker:function(e,a,r,n){var o=this,t=o.getGMap(e,a,r);if(t){var i=o.getMarkersInfo(e,a,r).markersPos[n];t.markers[i]&&t.markers[i].setMap(null),o.zoom(e,a,r)}},zoom:function(e,a,r){var n=this.getGMap(e,a,r);if(n)if(n.markers.length>1)n.fitZoom();else if(1==n.markers.length){var o=n.markers[0].getPosition();n.setCenter(o.lat(),o.lng()),n.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM))}},addMarkers:function(a,r,n,o,t){var i=this,s=i.getGMap(r,n,o);if(s){t&&(s.removeMarkers(),i.setMarkersOpen(r,n,o,null,!0),i.setMarkersPos(r,n,o,null,!0));var p="marker-ids-"+removeScheme(a),g=o.data(p);if(g&&g.length){o.data(p,null);var c,m,d,M=i.getMarkersInfo(r,n,o),f={};e.each(g,function(e,a){if(c=M.markers[a]){var r={content:c.infoWindow.header+"<br/>"+c.infoWindow.content},n={lat:c.coordinates.lat,lng:c.coordinates.lng,title:c.title,infoWindow:r,icon:c.icon};"undefined"!=typeof google&&(n.animation=google.maps.Animation.DROP),m=s.addMarker(n),d=s.markers.length-1,f[a]=d}}),i.setMarkersPos(r,n,o,f);var l=o.data("open-onemarker-infowindow");1==g.length&&l&&(s.hideInfoWindows(),"undefined"!=typeof google&&google.maps.event.trigger(m,"click")),i.zoom(r,n,o)}}},geocode:function(e,a,r,n,o,t){var i=this.getGMap(e,a,r);i&&GMaps.geocode({address:n,callback:function(e,a){if("OK"==a){i.removeMarkers();var r=e[0].geometry.location;i.setCenter(r.lat(),r.lng()),i.addMarker({lat:r.lat(),lng:r.lng(),draggable:!0}),i.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM)),o.val(r.lat()),t.val(r.lng());var n=i.markers[0];"undefined"!=typeof google&&google.maps.event.addListener(n,"dragend",function(){var e=n.getPosition();o.val(e.lat()),t.val(e.lng())})}}})}}}(jQuery),popJSLibraryManager.register(popMap,["map","mapModal","mapStandalone"]);