!function(e){popFullCalendar={initBlockRuntimeMemory:function(e){var t=this,n=e.pageSection,a=e.block;e.runtimeMempage.fullCalendar={},t.resetBlockRuntimeMemory(n,a)},calendar:function(t){var n=this,a=t.domain,r=t.pageSection,o=t.block,i=t.targets,l=popManager.getPageSectionPage(o);l.one("destroy",function(){i.fullCalendar("destroy")}),l.hasClass("tab-pane")&&!popManager.isActive(l)&&l.one("shown.bs.tabpane",function(){i.fullCalendar("render")}),o.on("beforeRender",function(t,a){var o=e(this);a.operation==M.URLPARAM_OPERATION_REPLACE&&n.resetBlockRuntimeMemory(r,o)}),o.on("rendered",function(t,a,r,o){var l=e(this),d=popManager.getPageSection(l);n.execCalendar(o,d,l,i,"update"),windowResize()}),n.execCalendar(a,r,o,i,"new")},getRuntimeMemoryPage:function(e,t){return popManager.getRuntimeMemoryPage(e,t).fullCalendar},resetBlockRuntimeMemory:function(t,n){var a=this.getRuntimeMemoryPage(t,n),r={eventsHtml:{},runJS:!1,events:[],loadedEventIds:{},loadedDates:{}};e.extend(a,r)},addEvents:function(e,t,n){var a=this;n.length&&(popManager.jsInitialized(t)?a.execAddEvents(e,t,n):t.one("initialize",function(){a.execAddEvents(e,t,n)}))},execAddEvents:function(t,n,a){var r=this,o=r.getRuntimeMemoryPage(t,n),i=[];e.each(a,function(e,a){r.isEventLoaded(t,n,a.domain,a.id)||(i.push(a),r.setEventLoaded(t,n,a.domain,a.id))}),e.merge(o.events,i)},execCalendar:function(t,n,a,r,o){var i,l=this,d=l.getRuntimeMemoryPage(n,a),s=l.getDate(n,a);"new"==o&&(i={header:{left:"title",center:"",right:""},events:function(e,t,n,a){a(d.events)},defaultDate:s,fixedWeekCount:!1,height:"auto",contentHeight:"auto",dayNamesShort:M.DATERANGE_DAYSOFWEEK}),r.each(function(){var r=e(this);l.execFullCalendar(t,n,a,r,o,i)}),l.setDateLoaded(n,a,s)},execFullCalendar:function(t,n,a,r,o,i){var l=this;if("new"==o){var d=popManager.getJsSettings(t,n,a,r),s=d.options||{},u=e.extend({},i,s),c=d.layouts;u.eventRender=function(e,t){l.renderEvent(n,a,c,e,t)},u.eventAfterAllRender=function(e){l.renderEventAfterAll(n,a,c)},r.fullCalendar(u)}else"update"==o&&r.fullCalendar("refetchEvents")},setDateLoaded:function(e,t,n){this.getRuntimeMemoryPage(e,t).loadedDates[n.year()+"-"+(n.month()+1)]=!0},isDateLoaded:function(e,t,n){return!0===this.getRuntimeMemoryPage(e,t).loadedDates[n.year()+"-"+(n.month()+1)]},setEventLoaded:function(e,t,n,a){var r=this.getRuntimeMemoryPage(e,t);r.loadedEventIds[n]=r.loadedEventIds[n]||{},r.loadedEventIds[n][a]=!0},isEventLoaded:function(e,t,n,a){var r=this.getRuntimeMemoryPage(e,t);return r.loadedEventIds[n]&&!0===r.loadedEventIds[n][a]},getDate:function(e,t){var n=popManager.getBlockQueryState(e,t),a=parseInt(n[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]),r=parseInt(n[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]);return moment(a+"-"+r+"-01","YYYY-M-DD")},renderEvent:function(t,n,a,r,o){var i=this.getRuntimeMemoryPage(t,n),l=r.domain,d=r.id;i.eventsHtml[l]=i.eventsHtml[l]||{};var s=i.eventsHtml[l][d];if(s)i.runJS=!0;else{var u={},c=popManager.getDatabaseKeys(l,t,n)["db-key"];s="",popJSRuntimeManager.setBlockURL(n),e.each(a,function(e,a){s+=popManager.getTemplateHtml(l,t,n,a,u,c,d)}),i.eventsHtml[l][d]=s}o.html(s)},renderEventAfterAll:function(t,n,a){var r=this.getRuntimeMemoryPage(t,n);if(popManager.triggerHTMLMerged(),r.runJS){r.runJS=!1;var o=popManager.getQueryMultiDomainUrls(t,n);e.each(o,function(r,o){e.each(a,function(e,a){popManager.runJSMethods(r,t,n,a,"full")})})}},fetch:function(e,t,n){var a=this,r=a.getDate(e,t);n.fullCalendar("gotoDate",r),a.isDateLoaded(e,t,r)||popManager.fetchBlock(e,t,{operation:M.URLPARAM_OPERATION_APPEND})}}}(jQuery),function(e){popFullCalendarControls={controlCalendarPrev:function(t){var n=this,a=t.pageSection,r=t.block;t.targets.click(function(t){var o=e(this);n.execute(a,r,o,"prev")})},controlCalendarNext:function(t){var n=this,a=t.pageSection,r=t.block;t.targets.click(function(t){var o=e(this);n.execute(a,r,o,"next")})},setCalendarBlockParams:function(e,t,n){var a=popManager.getBlockQueryState(e,t);a[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]=n.year(),a[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]=n.month()+1},execute:function(t,n,a,r){var o=this,i=e(a.closest(".pop-calendar-controls").data("target")),l=i.fullCalendar("getDate");"next"==r?l.add(1,"months"):l=l.subtract(1,"months"),o.setCalendarBlockParams(t,n,l),popManager.closeMessageFeedback(n),popFullCalendar.fetch(t,n,i)}}}(jQuery),popJSLibraryManager.register(popFullCalendar,["initBlockRuntimeMemory","calendar"]),popJSLibraryManager.register(popFullCalendarControls,["controlCalendarPrev","controlCalendarNext"]);