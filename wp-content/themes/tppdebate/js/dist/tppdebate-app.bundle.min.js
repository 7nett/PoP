Handlebars.registerHelper('breaklines',function(text){text=Handlebars.Utils.escapeExpression(text);text=text.toString();text=text.replace(/(\r\n|\n|\r)/gm,'<br>');return new Handlebars.SafeString(text);});Handlebars.registerHelper('showmore',function(str,options){var len=options.hash.len||0;if(len>0&&str.length>len+100){var delim="</p>";var total_len=len;var morelink='<a href="#" class="pop-showmore-more">'+M.STRING_MORE+'</a>';var lesslink='<a href="#" class="pop-showmore-less hidden">'+M.STRING_LESS+'</a>';var moreless=false,add_morelink=true;if((str.length>total_len)&&(str.substr(len).indexOf(delim)>-1)){moreless=true;add_morelink=false;str=str.substr(0,len)+'<span class="pop-showmore-more-full hidden">'+
str.substr(len,str.substr(len).indexOf(delim))+'</span> '+
morelink+
str.substr(len+str.substr(len).indexOf(delim));total_len=len+str.substr(len).indexOf(delim)+delim.length;}
if(moreless||(str.length>total_len)){var str_end=str.substr(total_len);var has_endstr=str_end.trim().length;if(moreless||has_endstr){var str_beg=str.substr(0,total_len);var str_new='<span class="pop-showmore-more-teaser">'+str_beg+'</span>'+
(has_endstr?'<span class="pop-showmore-more-full hidden">'+str_end+'</span> ':' ')+
(add_morelink?morelink:'')+
lesslink;return new Handlebars.SafeString(str_new);}}}
return str;});Handlebars.registerHelper('ondate',function(date,options){return new Handlebars.SafeString(M.ONDATE.format(date));});Handlebars.registerHelper('img',function(imageData,options){var url=options.hash.url,title=options.hash.title||"",alt=options.hash.alt||"",classs=options.hash.class||"",ret="";if(url){ret+='<a href="'+url+'" title="'+title+'">';}
ret+='<img src="'+imageData.src+'" width="'+imageData.width+'" height="'+imageData.height+'" alt="'+alt+'" class="'+classs+'">';if(url){ret+='</a>';}
return new Handlebars.SafeString(ret);});Handlebars.registerHelper('addParam',function(url,param,value,options){if(!jQuery.isArray(value)){value=[value];}
jQuery.each(value,function(index,val){url=add_query_arg(param,val,url);});return url;});Handlebars.registerHelper('destroyUrl',function(url,options){return new Handlebars.SafeString(popManager.getDestroyUrl(url));});Handlebars.registerHelper('statusLabel',function(status,options){var ret='<span class="label '+M.STATUS.class[status]+' label-'+status+'">'+M.STATUS.text[status]+'</span>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('labelize',function(strings,label,options){var ret='',extra_class='';if(strings){for(var i=0;i<strings.length;i++){extra_class=M.LABELIZE_CLASSES[strings[i]]?M.LABELIZE_CLASSES[strings[i]]:'';ret+='<span class="label '+label+' '+extra_class+'">'+strings[i]+'</span>\n';}}
return new Handlebars.SafeString(ret);});Handlebars.registerHelper('infoButton',function(id,itemObjectId,options){var classs=options.hash.classs||'';var ret='<a class="'+classs+'" data-toggle="collapse" href="#'+id+'-'+itemObjectId+'" role="button"><span class="glyphicon glyphicon-info-sign"></span></a>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('infoCollapse',function(id,itemObjectId,options){var content=options.fn(this);var ret='<div class="collapse" id="'+id+'-'+itemObjectId+'">'+content+'</div>';return new Handlebars.SafeString(ret);});Handlebars.registerHelper('mod',function(lvalue,rvalue,options){if(arguments.length<3)
throw new Error("Handlebars Helper equal needs 2 parameters");offset=options.hash.offset||0;if((lvalue+offset)%rvalue===0){return options.fn(this);}else{return options.inverse(this);}});Handlebars.registerHelper('compare',function(lvalue,rvalue,options){if(arguments.length<3)
throw new Error("Handlerbars Helper 'compare' needs 2 parameters");operator=options.hash.operator||"==";var operators={'eq':function(l,r){return l==r||l.toString()==r.toString();},'==':function(l,r){return l==r;},'===':function(l,r){return l===r;},'!=':function(l,r){return l!=r;},'<':function(l,r){return l<r;},'>':function(l,r){return l>r;},'<=':function(l,r){return l<=r;},'>=':function(l,r){return l>=r;},'typeof':function(l,r){return typeof l==r;},'in':function(l,r){return r.indexOf(l)>=0;},'notin':function(l,r){return r.indexOf(l)==-1;}}
if(!operators[operator])
throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);var result=operators[operator](lvalue,rvalue);if(result){return options.fn(this);}else{return options.inverse(this);}});Handlebars.registerHelper('get',function(db,index,options){if(typeof db=='undefined'||typeof db[index]=='undefined'){return'';}
return db[index];});Handlebars.registerHelper('ifget',function(db,index,options){if(typeof db=='undefined'){return'';}
var condition=false;if(options.hash.method){var executed=popJSLibraryManager.execute(options.hash.method,{input:db[index]});jQuery.each(executed,function(index,value){if(value){condition=true;return-1;}});}
else{condition=db[index];}
if(condition){return options.fn(this);}
else{return options.inverse(this);}});Handlebars.registerHelper('withget',function(db,index,options){if(typeof db=='undefined'||typeof db[index]=='undefined'){return'';}
var context=db[index];popManager.expandJSKeys(context);return options.fn(context);});Handlebars.registerHelper('interceptAttr',function(options){var context=options.hash.context||this;var intercept=context[M.JS_INTERCEPT]||{};return new Handlebars.SafeString((intercept[M.JS_TYPE]?' data-intercept="'+intercept[M.JS_TYPE]+'"':'')+(intercept.settings?' data-intercept-settings="'+intercept[M.JS_SETTINGS]+'"':'')+(intercept[M.JS_TARGET]?' target="'+intercept[M.JS_TARGET]+'"':'')+(intercept[M.JS_SKIPSTATEUPDATE]?' data-intercept-skipstateupdate="true"':'')+' style="display: none;"');});Handlebars.registerHelper('generateId',function(options){var context=options.hash.context||this;var pssId=options.hash.pssId||context.pss.pssId;var targetId=options.hash.targetId||context.bs.bsId;var template=options.hash.template||context[M.JS_TEMPLATE];var fixed=options.hash.fixed||context[M.JS_FIXEDID];var isIdUnique=options.hash.idUnique||context[M.JS_ISIDUNIQUE];var group=options.hash.group;var id=options.fn(this);var generatedId=popJSRuntimeManager.addTemplateId(pssId,targetId,template,id,group,fixed,isIdUnique);return new Handlebars.SafeString('id="'+generatedId+'" data-templateid="'+template+'"');});Handlebars.registerHelper('lastGeneratedId',function(options){var context=options.hash.context||this;var pssId=options.hash.pssId||context.pss.pssId;var targetId=options.hash.targetId||context.bs.bsId;var template=options.hash.template||context[M.JS_TEMPLATE];var group=options.hash.group;return popJSRuntimeManager.getLastGeneratedId(pssId,targetId,template,group);});Handlebars.registerHelper('applyLightTemplate',function(template,options){var context=options.hash.context||this;var response=popManager.getHtml(template,context);return new Handlebars.SafeString(response);});Handlebars.registerHelper('json',function(context){return JSON.stringify(context);});Handlebars.registerHelper('enterModule',function(prevContext,options){var context=options.hash.context||this;var templateName=options.hash.template||context[M.JS_TEMPLATE];var tls=prevContext.tls;var pss=prevContext.pss;var bs=prevContext.bs;var itemObject=prevContext.itemObject;var itemObjectDBKey=prevContext.itemObjectDBKey;var itemDBKey=(typeof options.hash.itemDBKey!='undefined')?options.hash.itemDBKey:prevContext.itemDBKey;var items=(typeof options.hash.items!='undefined')?options.hash.items:prevContext.items;var extend={itemObject:itemObject,itemObjectDBKey:itemObjectDBKey,itemDBKey:itemDBKey,items:items,tls:tls,pss:pss,bs:bs};var pssId=pss.pssId;var psId=pss.psId;var bsId=bs.bsId;var bId=bs.bId;jQuery.extend(context,popManager.getRuntimeConfiguration(pssId,bsId,templateName));popManager.expandJSKeys(context);var itemObjectId=options.hash.itemObjectId;if(jQuery.type(itemObjectId)==="array"){if(itemObjectId.length){itemObjectId=itemObjectId[0];}
else{itemObjectId=null;itemObject=null;extend.itemObject=itemObject;}}
if(options.hash.itemDBKey&&itemObjectId){itemDBKey=options.hash.itemDBKey;itemObject=popManager.getItemObject(itemDBKey,itemObjectId);extend.itemObject=itemObject;extend.itemObjectDBKey=itemDBKey;extend.itemDBKey=itemDBKey;extend.items=[itemObjectId];}
else if(options.hash.itemDBKey&&options.hash.items){extend.itemDBKey=options.hash.itemDBKey;extend.items=options.hash.items;}
else if(options.hash.subcomponent&&itemObjectId){itemDBKey=bs['db-keys'][M.JS_SUBCOMPONENTS][options.hash.subcomponent]['db-key'];itemObject=popManager.getItemObject(itemDBKey,itemObjectId);extend.itemObject=itemObject;extend.itemObjectDBKey=itemDBKey;extend.itemDBKey=itemDBKey;extend.items=[itemObjectId];}
else if(options.hash.subcomponent&&options.hash.items){itemDBKey=bs['db-keys'][M.JS_SUBCOMPONENTS][options.hash.subcomponent]['db-key'];extend.itemDBKey=itemDBKey;extend.items=options.hash.items;}
else if(options.hash.items){extend.items=options.hash.items;}
else if(options.hash.itemDBKey){extend.itemDBKey=options.hash.itemDBKey;extend.itemObject=null;extend.itemObjectDBKey=null;extend.items=null;}
if(extend.items){if(jQuery.type(extend.items)!=="array"){extend.items=[extend.items];}}
if(options.hash['feedback-msg']){extend['feedback-msg']=options.hash['feedback-msg'];}
var overrideFields=[],staticStrReplace=[],runtimeStrReplace=[];if(context[M.JS_MODULEOPTIONS]){overrideFields=context[M.JS_MODULEOPTIONS][M.JS_OVERRIDEFROMITEMOBJECT]||[];staticStrReplace=context[M.JS_MODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[];}
if(context[M.JS_RUNTIMEMODULEOPTIONS]){runtimeStrReplace=context[M.JS_RUNTIMEMODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[];}
if(overrideFields.length){popManager.overrideFromItemObject(itemObject,extend,overrideFields);}
var strReplace=staticStrReplace.concat(runtimeStrReplace);if(strReplace.length){popManager.replaceFromItemObject(pssId,bsId,templateName,itemObject,extend,strReplace);}
var parentContext=options.hash.parentContext||{};if(parentContext){extend['parent-context']=parentContext;var rootContext=parentContext;while(rootContext['parent-context']){rootContext=rootContext['parent-context'];}
extend['root-context']=rootContext;}
jQuery.extend(context,extend);var response=popManager.getHtml(templateName,context);if(options.hash.unsafe){return response;}
return new Handlebars.SafeString(response);});function getMultiLayoutKey(itemDBKey,itemObject){var keyFields=M.MULTILAYOUT_KEYFIELDS[itemDBKey]||[];if(!keyFields.length){return'default';}
var keyParts=[];jQuery.each(keyFields,function(index,field){keyParts.push(itemObject[field]);});return keyParts.join('-');}
Handlebars.registerHelper('withLayout',function(itemDBKey,itemObjectId,multipleLayouts,context,options){var itemObject=popManager.getItemObject(itemDBKey,itemObjectId);var key=getMultiLayoutKey(itemDBKey,itemObject);var layout=multipleLayouts[key];if(!layout){layout=multipleLayouts['default'];}
if(!layout){return'';}
var layoutContext=context[M.JS_MODULES][layout];jQuery.extend(layoutContext,{itemDBKey:itemDBKey,itemObjectId:itemObjectId});popManager.expandJSKeys(layoutContext);return options.fn(layoutContext);});Handlebars.registerHelper('layoutLabel',function(itemDBKey,itemObject,options){var key=getMultiLayoutKey(itemDBKey,itemObject);return M.MULTILAYOUT_LABELS[key]||'';});Handlebars.registerHelper('withOptions',function(context,options){if(typeof context!='undefined'){jQuery.extend(context,options.hash);popManager.expandJSKeys(context);return options.fn(context);}});Handlebars.registerHelper('withBlock',function(context,blockSettingsId,options){if(typeof context=='undefined'||typeof context[M.JS_MODULES]=='undefined'||typeof context[M.JS_MODULES][blockSettingsId]=='undefined'){return;}
context=context[M.JS_MODULES][blockSettingsId];popManager.expandJSKeys(context);return options.fn(context);});Handlebars.registerHelper('withModule',function(context,module,options){if(typeof context=='undefined'||typeof context[M.JS_SETTINGSIDS]=='undefined'||typeof context[M.JS_SETTINGSIDS][module]=='undefined'){return;}
var moduleSettingsId=context[M.JS_SETTINGSIDS][module];if(typeof context[M.JS_MODULES]=='undefined'||typeof context[M.JS_MODULES][moduleSettingsId]=='undefined'){return;}
context=context[M.JS_MODULES][moduleSettingsId];popManager.expandJSKeys(context);jQuery.extend(context,options.hash);return options.fn(context);});Handlebars.registerHelper('withSublevel',function(sublevel,options){var context=options.hash.context||this;popManager.expandJSKeys(context);return options.fn(context[sublevel]);});Handlebars.registerHelper('withItemObject',function(itemDBKey,itemObjectId,options){var context=popManager.getItemObject(itemDBKey,itemObjectId);return options.fn(context);});Handlebars.registerHelper('join',function(items,block){var delimiter=block.hash.delimiter||",",start=start=block.hash.start||0,len=items?items.length:0,end=block.hash.end||len,out="";if(end>len)end=len;if('function'===typeof block){for(i=start;i<end;i++){if(i>start)out+=delimiter;if('string'===typeof items[i])
out+=items[i];else
out+=block(items[i]);}
return out;}else{return[].concat(items).slice(start,end).join(delimiter);}});;function unescapeHtml(unsafe){var d=document.createElement("div");d.innerHTML=unsafe;return d.innerText||d.text||d.textContent;}
function add_query_arg(key,value,url){url+=(url.split('?')[1]?'&':'?')+key+'='+value;return url;}
var removeQueryFields=function(url,args){if(!args.length){return url;}
var fields=args.join('|'),parts=url.split(new RegExp('[&?]('+fields+')=[^&]*')),length=parts.length-1;return parts[0]+(length?parts[length].slice(1):'');}
if(!String.prototype.format){String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});};}
if(typeof String.prototype.startsWith!='function'){String.prototype.startsWith=function(str){return this.indexOf(str)==0;};}
function removeParams(url){if(url.indexOf('?')>-1){return url.substr(0,url.indexOf('?'));}
return url;}
function getParams(url){if(url.indexOf('?')>-1){var params=url.substr(url.indexOf('?')+1);if(params.indexOf('#')>-1){params=params.substr(0,params.indexOf('#'));}
return params;}
return'';}
var urlParams={};function getParam(key,url){var params;if(url){params=getParams(url);}
else{params=window.location.search.substring(1);}
var paramsObj=splitUrlParams(params);return paramsObj[key];}
function splitUrlParams(params){if(typeof urlParams[params]!='undefined'){return urlParams[params];}
urlParams[params]=jQuery.extend({},splitParams(params));return urlParams[params];}
function splitParams(params){var splitParams={};var e,d=function(s){return decodeURIComponent(s).replace(/\+/g," ");},q=decodeURI(params),r=/([^&=]+)=?([^&]*)/g;while(e=r.exec(q)){if(e[1].indexOf("[")=="-1")
splitParams[d(e[1])]=d(e[2]);else{var b1=e[1].indexOf("["),aN=e[1].slice(b1+1,e[1].indexOf("]",b1)),pN=d(e[1].slice(0,b1));if(typeof splitParams[pN]!="object"){splitParams[d(pN)]={};}
if(aN)
splitParams[d(pN)][d(aN)]=d(e[2]);else
Array.prototype.push.call(splitParams[d(pN)],d(e[2]));}}
return splitParams;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1)+min);}
function doScroll(elem,animate){animate=animate||false;var top=elem.offset().top-20;if(animate){jQuery('html, body').animate({scrollTop:top});}
else{window.scrollTo(0,top);}}
function removeMarker(url){if(url.indexOf('#')>-1){return url.substr(0,url.indexOf('#'));}
return url;}
var counter=0;function counterNext(){counter++;return counter;}
function gd_clone(elems){var cloned={};jQuery.each(elems,function(key,value){if(jQuery.type(value)==="array"){cloned[key]=jQuery.extend({},value);}
else{cloned[key]=value;}});return cloned;}
function windowResize(){var evt=document.createEvent('UIEvents');evt.initUIEvent('resize',true,false,window,0);window.dispatchEvent(evt);jQuery(document).ready(function($){$(window).triggerHandler('resized');});}
if(!Date.now){Date.now=function(){return new Date().getTime();}}
function isUrlValid(url){return /^(https?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);}
function beep(){var snd=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");snd.play();};(function($){popJSLibraryManager={libraries:[],methods:{},register:function(library,methods,highPriority,override){var t=this;t.libraries.push(library);$.each(methods,function(index,method){if(!t.methods[method]||override){t.methods[method]=[];}
if(highPriority){t.methods[method].unshift(library);}
else{t.methods[method].push(library);}})},getLibraries:function(method){var t=this;return t.methods[method]||[];},execute:function(method,args){var t=this;var ret={};var libraries=t.methods[method];if(libraries){$.each(libraries,function(index,library){ret['l'+index]=library[method](args);});}
return ret;}};})(jQuery);;(function($){popJSRuntimeManager={'full-session-ids':{},'last-session-ids':{},initPageSectionVarPaths:function(vars,pssId,template,group){var t=this;if(!vars[pssId]){vars[pssId]={};}
if(!vars[pssId][template]){vars[pssId][template]={};}
if(!vars[pssId][template][group]){vars[pssId][template][group]=[];}},initBlockVarPaths:function(vars,pssId,targetId,template,group){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;if(!vars[pssId]){vars[pssId]={};}
if(!vars[pssId][targetId]){vars[pssId][targetId]={};}
if(!vars[pssId][targetId][template]){vars[pssId][targetId][template]={};}
if(!vars[pssId][targetId][template][group]){vars[pssId][targetId][template][group]=[];}},initVars:function(pssId,targetId,template,group){var t=this;t.initBlockVarPaths(t['full-session-ids'],pssId,targetId,template,group);t.initBlockVarPaths(t['last-session-ids'],pssId,targetId,template,group);},addGroup:function(id,group){var t=this;if(group){id+=M.ID_SEPARATOR+group;}
return id;},addPageSectionId:function(pssId,template,id,group){var t=this;id=t.addGroup(id,group);t.addTargetId(pssId,pssId,template,group,id);return id;},addTemplateId:function(pssId,targetId,template,id,group,fixed,isIdUnique){var t=this;id=t.addGroup(id,group);if(!isIdUnique){id+=popManager.getUniqueId();}
if(!fixed){id+=M.ID_SEPARATOR+counterNext();}
t.addTargetId(pssId,pssId,template,group,id);t.addTargetId(pssId,targetId,template,group,id);return id;},addTargetId:function(pssId,targetId,template,group,id){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;t.initVars(pssId,targetId,template,group);t['full-session-ids'][pssId][targetId][template][group].push(id);t['last-session-ids'][pssId][targetId][template][group].push(id);return id;},getLastGeneratedId:function(pssId,targetId,template,group){var t=this;group=group||M.JSMETHOD_GROUP_MAIN;var ids=t['full-session-ids'][pssId][targetId][template][group];return ids[ids.length-1];},getPageSectionSessionIds:function(pageSection,session){var t=this;return t.getTargetSessionIds(pageSection,pageSection,session);},getBlockSessionIds:function(pageSection,block,session){var t=this;return t.getTargetSessionIds(pageSection,block,session);},getTargetSessionIds:function(pageSection,target,session){var t=this;var pssId=popManager.getSettingsId(pageSection);var targetId=popManager.getSettingsId(target);session=session||'last';if(t[session+'-session-ids'][pssId]){return t[session+'-session-ids'][pssId][targetId];}
return null;},deletePageSectionLastSessionIds:function(pageSection){var t=this;var pssId=popManager.getSettingsId(pageSection);delete t['last-session-ids'][pssId][pssId];},deleteBlockLastSessionIds:function(pageSection,block){var t=this;var pssId=popManager.getSettingsId(pageSection);var targetId=popManager.getSettingsId(block);if(t['last-session-ids'][pssId]&&t['last-session-ids'][pssId][targetId]){delete t['last-session-ids'][pssId][targetId];}},};})(jQuery);;function showTopNav(){popPageSectionManager.open(popPageSectionManager.getTopNav());}
function hideTopNav(){popPageSectionManager.close(popPageSectionManager.getTopNav());}
(function($){popPageSectionManager={offcanvasToggle:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var control=$(this);var mode=control.data('mode');var target=$(control.data('target'));var action=control.data('toggle');if(action=='offcanvas-open'){t.open(target,mode);}
else if(action=='offcanvas-close'){t.close(target,mode);}
else if(action=='offcanvas-toggle'){t.toggle(target,mode);}});},isHidden:function(args){var t=this;var targets=args.targets;var offcanvas=targets.closest('.offcanvas');return t.execIsHidden(offcanvas);},execIsHidden:function(offcanvas){var t=this;if(offcanvas.length){var classs=t.getOffcanvasActiveClass(offcanvas);return!t.getGroup(offcanvas).hasClass(classs);}
return false;},getOffcanvasActiveClass:function(offcanvas,mode){var t=this;var section=offcanvas.data('offcanvas');var ret='active-'+section;if(mode=='xs'){ret+='-xs';}
return ret;},open:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);group.addClass(classs);t.triggerStatus(offcanvas,mode,'opened');},close:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);group.removeClass(classs);t.triggerStatus(offcanvas,mode,'closed');},toggle:function(offcanvas,mode){var t=this;var group=t.getGroup(offcanvas);var classs=t.getOffcanvasActiveClass(offcanvas,mode);if(group.hasClass(classs)){t.close(offcanvas,mode);}
else{t.open(offcanvas,mode);}},triggerStatus:function(offcanvas,mode,status){var t=this;var group=t.getGroup(offcanvas);group.triggerHandler('on.bs.pagesection-group:pagesection-'+offcanvas.attr('id')+':'+status,[offcanvas,mode]);},getTopLevelSettingsId:function(){var t=this;return M.TEMPLATE_TOPLEVEL_SETTINGS_ID;},getPageSectionStatus:function(pageSection){var t=this;return $('#'+pageSection.attr('id')+'-status');},getGroup:function(offcanvas){var t=this;if(offcanvas){return offcanvas.closest('.pop-pagesection-group');}
return $('#'+M.TEMPLATE_PAGESECTIONGROUP_ID);},theater:function(theater){var t=this;var group=t.getGroup();t.transitionEndResize();if(theater){group.addClass('theater');group.triggerHandler('on.bs.pagesection:theater');}
else{group.removeClass('theater');group.triggerHandler('off.bs.pagesection:theater');}},isTheater:function(){var t=this;var group=t.getGroup();return group.hasClass('theater');},transitionEndResize:function(){var t=this;var offCanvasGroup=t.getGroup();offCanvasGroup.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){windowResize();});},enableShowHideTopNav:function(){var t=this;$(window).on('scroll:down',hideTopNav);$(window).on('scroll:up',showTopNav);},disableShowHideTopNav:function(){var t=this;$(window).off('scroll:down',hideTopNav);$(window).off('scroll:up',showTopNav);},getTopNav:function(){var t=this;var offCanvasGroup=t.getGroup();return offCanvasGroup.find('.offcanvas-topnav');},getOpenMode:function(pageSection){return pageSection.data('pagesection-openmode')||'automatic';}};})(jQuery);popJSLibraryManager.register(popPageSectionManager,['isHidden','offcanvasToggle'],true);;(function($){popBrowserHistory={loaded:false,documentInitialized:function(args){var t=this;$(window).on("popstate",function(e){if(t.loaded){var url=t.removePushURLAtts(window.location.href);var options={skipPushState:true};if(popURLInterceptors.getInterceptors(url).length){popURLInterceptors.intercept(url,options);}
else{popManager.fetch(url,options);}}
else{t.loaded=true;}});},addPushURLAtts:function(url){var t=this;var tlFeedback=popManager.getTopLevelFeedback();$.each(tlFeedback[M.DATALOAD_PUSHURLATTS],function(key,value){url=add_query_arg(key,value,url);});return url;},removePushURLAtts:function(url){var t=this;var tlFeedback=popManager.getTopLevelFeedback(),args=[];$.each(tlFeedback[M.DATALOAD_PUSHURLATTS],function(key,value){args.push(key);});return removeQueryFields(url,args);},pushState:function(url){var t=this;url=t.addPushURLAtts(url);if(!url.startsWith(M.HOME_URL)){url=add_query_arg(M.URLPARAM_URL,encodeURIComponent(url),M.EXTERNAL_URL);}
history.pushState({url:url},'',url);t.loaded=true;},replaceState:function(url){var t=this;if(window.location.url==url){return;}
url=t.addPushURLAtts(url);history.replaceState({url:url},'',url);t.loaded=true;}};})(jQuery);popJSLibraryManager.register(popBrowserHistory,['documentInitialized'],true);;(function($){popURLInterceptors={'fullurl':{},'partialurl':{},pageSectionNewDOMsInitialized:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;newDOMs.find('[data-intercept="fullurl"]').addBack('[data-intercept="fullurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);if(!t.fullurl[target]){t.fullurl[target]={};}
if(!t.fullurl[target][url]){t.fullurl[target][url]=[];}
t.fullurl[target][url].push(id);});newDOMs.find('[data-intercept="partialurl"]').addBack('[data-intercept="partialurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);if(!t.partialurl[target]){t.partialurl[target]={};}
t.partialurl[target][id]=url;});},destroyTarget:function(args){var t=this;var pageSection=args.pageSection,destroyTarget=args.destroyTarget;destroyTarget.find('[data-intercept="fullurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var url=t.getUrl(interceptor);var settings=t.getSettings(interceptor);var target=t.getTarget(pageSection,interceptor);var interceptors=t.fullurl[target][url];if(interceptors){interceptors=interceptors.filter(function(interceptorId,pos){return id!=interceptorId});if(interceptors.length){t.fullurl[target][url]=interceptors;}
else{delete t.fullurl[target][url];}}});destroyTarget.find('[data-intercept="partialurl"]').each(function(){var interceptor=$(this);var id=interceptor.attr('id');var target=t.getTarget(pageSection,interceptor);delete t.partialurl[target][id];});},getSettings:function(interceptor){var t=this;var settings=interceptor.data('intercept-settings')||'';settings=settings.split(M.SEPARATOR);return settings;},getTarget:function(pageSection,interceptor){var t=this;return interceptor.attr('target')||popManager.getFrameTarget(pageSection);},getUrl:function(interceptor){var t=this;return interceptor.data('intercept-url');},getFullUrlInterceptors:function(url,options){var t=this;var ret=[];options=options||{};var target=options.target||M.URLPARAM_TARGET_MAIN;var interceptors=t.fullurl;if(interceptors[target]){if(interceptors[target][url]){ret.push($('#'+interceptors[target][url].join(', #')));}
else{var noParamsUrl=removeParams(url);if(url!=noParamsUrl){if(interceptors[target][noParamsUrl]){var maybeInterceptors=$('#'+interceptors[target][noParamsUrl].join(', #')).filter('.pop-interceptor');if(maybeInterceptors.length){ret.push(maybeInterceptors);}}}}}
return ret;},getPartialUrlInterceptor:function(interceptUrl,options){var t=this;var interceptor=null;options=options||{};var target=options.target||M.URLPARAM_TARGET_MAIN;var interceptors=t.partialurl;if(target){var targetInterceptors=interceptors[target];if(targetInterceptors){$.each(targetInterceptors,function(id,url){if(interceptUrl.startsWith(url)){interceptor=$('#'+id);return false;}});}}
return interceptor;},getURLInterceptors:function(interceptUrl,options){var t=this;var ret=t.getFullUrlInterceptors(interceptUrl,options);var partialurl=t.getPartialUrlInterceptor(interceptUrl,options);if(partialurl){ret.push(partialurl);}
return ret;},getInterceptors:function(interceptUrl,options){var t=this;var ret=t.getURLInterceptors(interceptUrl,options);if(ret.length){return ret;}
var noMarkerUrl=removeMarker(interceptUrl);if(noMarkerUrl!=interceptUrl){ret=t.getURLInterceptors(noMarkerUrl,options);}
return ret;},intercept:function(interceptUrl,options){var t=this;var interceptor;options=options||{};var interceptors=t.getInterceptors(interceptUrl,options);if(interceptors.length){if(options.event){options.event.stopImmediatePropagation();}
$.each(interceptors,function(index,interceptor){var skip_state_update=interceptor.data('intercept-skipstateupdate')||options.skipstateupdate;if(!skip_state_update){if(!options.skipPushState){popBrowserHistory.pushState(interceptUrl);}
var title=interceptor.data('title');if(title){t.documentTitle=unescapeHtml(title);document.title=popManager.documentTitle;}
return-1;}});var interceptor_atts=options['interceptor-atts']||{};$.each(interceptors,function(index,interceptor){$.each(interceptor_atts,function(key,value){interceptor.data(key,value);});var relatedTarget=options.relatedTarget;interceptor.data('interceptedTarget',relatedTarget);var settings=t.getSettings(interceptor.parent());interceptor.data('original-url',interceptUrl);interceptor.data('post-data',getParams(interceptUrl));interceptor.trigger('click');});return true;}
return false;}};})(jQuery);popJSLibraryManager.register(popURLInterceptors,['destroyTarget','pageSectionNewDOMsInitialized'],true);;(function($){popManager={mergingTemplatePromise:false,memory:{settings:{},runtimesettings:{},dataset:{},feedback:{block:{},pagesection:{},toplevel:{}},params:{}},initialBlockMemory:{},urlPointers:{},replicableMemory:{},runtimeMemory:{general:{},url:{}},database:{},userdatabase:{},firstLoad:{},documentTitle:null,getMemory:function(){var t=this;return t.memory;},getInitialBlockMemory:function(url){var t=this;if(url==M.INITIAL_URL){return t.initialBlockMemory[url];}
var storedUnder=t.urlPointers[url];if(storedUnder){return t.initialBlockMemory[storedUnder.url];}
return t.initialBlockMemory[url]||{};},addInitialBlockMemory:function(response){var t=this;var url=response.feedback.toplevel[M.URLPARAM_URL];if(!t.initialBlockMemory[url]){t.initialBlockMemory[url]={dataset:{},feedback:{block:{},},params:{},runtimesettings:{configuration:{}}};}
var initialMemory=t.initialBlockMemory[url];$.each(response.settings.configuration,function(pssId,rpsConfiguration){if(!initialMemory.params[pssId]){initialMemory.params[pssId]={};initialMemory.runtimesettings.configuration[pssId]={};initialMemory.dataset[pssId]={};initialMemory.feedback.block[pssId]={};}
$.extend(initialMemory.params[pssId],response.params[pssId]);$.extend(initialMemory.runtimesettings.configuration[pssId],response.runtimesettings.configuration[pssId]);$.extend(initialMemory.dataset[pssId],response.dataset[pssId]);$.extend(initialMemory.feedback.block[pssId],response.feedback.block[pssId]);});},getReplicableMemory:function(url,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var storedUnder=t.urlPointers[url];return t.replicableMemory[storedUnder.url][storedUnder.target];},saveUrlPointers:function(response,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var url=response.feedback.toplevel[M.URLPARAM_URL];$.each(response.feedback.pagesection,function(pssId,psFeedback){if(psFeedback['intercept-urls']){$.each(psFeedback['intercept-urls'],function(ipssId,iObject){$.each(iObject,function(ielemsId,iUrl){t.urlPointers[iUrl]={url:url,target:target};});});}});$.each(response.feedback.block,function(pssId,psFeedback){$.each(psFeedback,function(bsId,bFeedback){if(bFeedback['intercept-urls']){$.each(bFeedback['intercept-urls'],function(ibsId,iObject){$.each(iObject,function(ielemsId,iUrl){t.urlPointers[iUrl]={url:url,target:target};});});}});});},addReplicableMemory:function(response,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;var hasreplicable=false;$.each(response.settings.configuration,function(pssId,psConfiguration){if(psConfiguration[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE].length){hasreplicable=true;return-1;}});if(hasreplicable){var url=response.feedback.toplevel[M.URLPARAM_URL];if(!t.replicableMemory[url]){t.replicableMemory[url]={};}
t.replicableMemory[url][target]={dataset:$.extend(true,{},response.dataset),feedback:$.extend(true,{},response.feedback),params:$.extend(true,{},response.params)}}},getRuntimeMemory:function(pageSection,target,options){var t=this;options=options||{};var pageSectionPage=t.getPageSectionPage(target);var scope=pageSectionPage.data('paramsscope');if(scope==M.SETTINGS_PARAMSSCOPE_URL){var url=options.url||''+window.location.href;if(!t.runtimeMemory.url[url]){t.runtimeMemory.url[url]={};}
target.data('paramsscope-url',url);return t.runtimeMemory.url[url];}
return t.runtimeMemory.general;},newRuntimeMemoryPage:function(pageSection,target,options){var t=this;options=options||{};if(!options.url){var tlFeedback=t.getTopLevelFeedback();options.url=tlFeedback[M.URLPARAM_URL];}
var mempage=t.getRuntimeMemory(pageSection,target,options);var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);if(!mempage[pssId]){mempage[pssId]={};}
mempage[pssId][targetId]={params:{},id:null};return mempage[pssId][targetId];},deleteRuntimeMemoryPage:function(pageSection,target,options){var t=this;var mempage=t.getRuntimeMemory(pageSection,target,options);var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);if(mempage[pssId]){delete mempage[pssId][targetId];if($.isEmptyObject(mempage[pssId])){delete mempage[pssId];}}},getRuntimeMemoryPage:function(pageSection,targetOrId,options){var t=this;options=options||{};var mempage,url;if(options.url){url=options.url;}
else if($.type(targetOrId)=='object'){var target=targetOrId;url=target.data('paramsscope-url');}
if(url){mempage=t.runtimeMemory.url[url];}
else{mempage=t.runtimeMemory.general;}
var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(targetOrId);if(!mempage[pssId]||!mempage[pssId][targetId]){var error="Mempage not available";if(url){error+=" for url "+url;}
throw new Error(error);}
return mempage[pssId][targetId];},isFirstLoad:function(pageSection){var t=this;return t.firstLoad[popManager.getSettingsId(pageSection)];},init:function(){var t=this;if($('#'+popPageSectionManager.getTopLevelSettingsId()).length){t.initDocument();t.initTopLevelJson();popUserAccount.initialLogin();var memory=t.getMemory();var pageSections=[];$.each(memory.settings.configuration,function(pssId,psConfiguration){var psId=psConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);pageSection.attr('data-settings-id',pssId);pageSection.addClass('pop-pagesection');t.initPageSectionSettings(pageSection,psConfiguration);t.addPageSectionIds(pageSection,psConfiguration[M.JS_TEMPLATE]);t.initPageSection(pageSection);pageSections.push(pageSection);});$.each(pageSections,function(index,pageSection){t.renderPageSection(pageSection);});$('body').removeClass('pop-loading-initial');$.each(pageSections,function(index,pageSection){t.pageSectionInitialized(pageSection);});popBrowserHistory.replaceState(t.getTopLevelFeedback()[M.URLPARAM_URL]);t.updateDocument();t.documentInitialized();t.backgroundLoad(M.BACKGROUND_LOAD);t.backgroundLoad(t.getTopLevelFeedback()[M.URLPARAM_BACKGROUNDLOADURLS]);}},expandJSKeys:function(context){var t=this;if(context&&M.COMPACT_JS_KEYS){if(context[M.JS_MODULES]){context.modules=context[M.JS_MODULES];}
if(context[M.JS_TEMPLATE]){context.template=context[M.JS_TEMPLATE];}
if(context[M.JS_TEMPLATEIDS]){context['template-ids']=context[M.JS_TEMPLATEIDS];}
if(context[M.JS_SETTINGSID]){context['settings-id']=context[M.JS_SETTINGSID];}
if(context[M.JS_SETTINGSIDS]){context['settings-ids']=context[M.JS_SETTINGSIDS];if(context[M.JS_SETTINGSIDS][M.JS_BLOCKUNITS]){context['settings-ids']['blockunits']=context[M.JS_SETTINGSIDS][M.JS_BLOCKUNITS];}}
if(context[M.JS_INTERCEPT]){context.intercept=context[M.JS_INTERCEPT];}
if(context[M.JS_BLOCKSETTINGSIDS]){context['block-settings-ids']=context[M.JS_BLOCKSETTINGSIDS];if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITS]){context['block-settings-ids']['blockunits']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITS];}
if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE]){context['block-settings-ids']['blockunits-replicable']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSREPLICABLE];}
if(context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSFRAME]){context['block-settings-ids']['blockunits-frame']=context[M.JS_BLOCKSETTINGSIDS][M.JS_BLOCKUNITSFRAME];}}
if(context[M.JS_REPLICATEBLOCKSETTINGSIDS]){context['replicate-blocksettingsids']=context[M.JS_REPLICATEBLOCKSETTINGSIDS];if(context[M.JS_INTERCEPTSKIPSTATEUPDATE]){context['intercept-skipstateupdate']=context[M.JS_INTERCEPTSKIPSTATEUPDATE];}
if(context[M.JS_UNIQUEURLS]){context['unique-urls']=context[M.JS_UNIQUEURLS];}
if(context[M.JS_REPLICATETYPES]){context['replicate-types']=context[M.JS_REPLICATETYPES];}}
if(context[M.JS_PARAMS]){context.params=context[M.JS_PARAMS];}
if(context[M.JS_ITEMOBJECTPARAMS]){context['itemobject-params']=context[M.JS_ITEMOBJECTPARAMS];}
if(context[M.JS_PREVIOUSTEMPLATESIDS]){context['previoustemplates-ids']=context[M.JS_PREVIOUSTEMPLATESIDS];}
if(context[M.JS_BLOCKFEEDBACKPARAMS]){context['blockfeedback-params']=context[M.JS_BLOCKFEEDBACKPARAMS];}
if(context[M.JS_APPENDABLE]){context.appendable=context[M.JS_APPENDABLE];}
if(context[M.JS_CLASS]){context.class=context[M.JS_CLASS];}
if(context[M.JS_CLASSES]){context.classes=context[M.JS_CLASSES];if(context[M.JS_CLASSES][M.JS_APPENDABLE]){context.classes.appendable=context[M.JS_CLASSES][M.JS_APPENDABLE];}}
if(context[M.JS_TITLES]){context.titles=context[M.JS_TITLES];}
popJSLibraryManager.execute('expandJSKeys',{context:context});}},addPageSectionIds:function(pageSection,template){var t=this;var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');popJSRuntimeManager.addPageSectionId(pssId,template,psId);var args={pageSection:pageSection,template:template}
popJSLibraryManager.execute('addPageSectionIds',args);},initDocument:function(){var t=this;$(document).on('user:loggedout',function(e,source){t.clearUserDatabase();});popJSLibraryManager.execute('initDocument');$(document).triggerHandler('initialize.pop.document');},documentInitialized:function(){var t=this;popJSLibraryManager.execute('documentInitialized');$(document).triggerHandler('initialized.pop.document');},backgroundLoad:function(urls){var t=this;var options={'loadingmsg-target':null,silentDocument:true,};$.each(urls,function(url,targets){$.each(targets,function(index,target){popManager.fetch(url,$.extend({target:target},options));});});},initPageSection:function(pageSection){var t=this;t.firstLoad[t.getSettingsId(pageSection)]=true;popJSLibraryManager.execute('initPageSection',{pageSection:pageSection});pageSection.triggerHandler('initialize');$(document).triggerHandler('initialize.pop.pagesection',[pageSection]);},pageSectionInitialized:function(pageSection){var t=this;t.initPageSectionRuntimeMemory(pageSection);popJSLibraryManager.execute('pageSectionInitialized',{pageSection:pageSection});pageSection.triggerHandler('initialized');pageSection.triggerHandler('completed');t.firstLoad[popManager.getSettingsId(pageSection)]=false;},pageSectionNewDOMsInitialized:function(pageSection,newDOMs,options){var t=this;if(newDOMs.filter('.pop-pagesection-page').length){var openmode=popPageSectionManager.getOpenMode(pageSection);var firstLoad=t.isFirstLoad(pageSection);if(openmode=='automatic'||(firstLoad&&openmode=='initial')){popPageSectionManager.open(pageSection);}}
var args={pageSection:pageSection,newDOMs:newDOMs};t.extendArgs(args,options);popJSLibraryManager.execute('pageSectionNewDOMsBeforeInitialize',args);t.initPageSectionBranches(pageSection,newDOMs,options);popJSLibraryManager.execute('pageSectionNewDOMsInitialized',args);},initPageSectionBranches:function(pageSection,newDOMs,options){var t=this;t.runPageSectionJSMethods(pageSection,options);var jsSettings=popManager.getPageSectionJsSettings(pageSection);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.initBlockBranches(pageSection,$(blockBranches.join(',')).not('.'+M.JS_INITIALIZED),options);}
popJSRuntimeManager.deletePageSectionLastSessionIds(pageSection);},triggerDestroyTarget:function(url,target){var t=this;target=target||M.URLPARAM_TARGET_MAIN;popURLInterceptors.intercept(t.getDestroyUrl(url),{target:target});},destroyTarget:function(pageSection,target){var t=this;var args={pageSection:pageSection,destroyTarget:target}
popJSLibraryManager.execute('destroyTarget',args);target.triggerHandler('destroy');var blocks=target.find('.pop-block.'+M.JS_INITIALIZED).addBack('.pop-block.'+M.JS_INITIALIZED);blocks.each(function(){var block=$(this);t.deleteRuntimeMemoryPage(pageSection,block,{url:block.data('paramsscope-url')});})
target.remove();},destroyPageSectionPage:function(pageSection,pageSectionPage){var t=this;var target=pageSectionPage||pageSection;if(!pageSectionPage.siblings('.pop-pagesection-page').length){popPageSectionManager.close(pageSection);popPageSectionManager.close(pageSection,'xs');}
t.destroyTarget(pageSection,target);},pageSectionRendered:function(pageSection,newDOMs,options){var t=this;t.pageSectionNewDOMsInitialized(pageSection,newDOMs,options);var args={pageSection:pageSection,newDOMs:newDOMs}
t.extendArgs(args,options);popJSLibraryManager.execute('pageSectionRendered',args);pageSection.triggerHandler('pageSectionRendered');},runScriptsBefore:function(pageSection,newDOMs){var t=this;var args={pageSection:pageSection,newDOMs:newDOMs};popJSLibraryManager.execute('runScriptsBefore',args);},jsInitialized:function(block){var t=this;return block.hasClass(M.JS_INITIALIZED);},jsLazy:function(block){var t=this;return block.hasClass(M.CLASS_LAZYJS);},setJsInitialized:function(block){var t=this;block.addClass(M.JS_INITIALIZED).removeClass(M.CLASS_LAZYJS);},initBlockBranches:function(pageSection,blocks,options){var t=this;if(!blocks.length){return;}
blocks.each(function(){var block=$(this);var proceed=!t.jsInitialized(block);if(!options['force-init']){proceed=proceed&&!t.jsLazy(block);}
if(proceed){t.setJsInitialized(block);t.initBlock(pageSection,block,options);var jsSettings=popManager.getJsSettings(pageSection,block);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.initBlockBranches(pageSection,$(blockBranches.join(', ')).not('.'+M.JS_INITIALIZED),options);}
var blockChildren=jsSettings['initjs-blockchildren'];if(blockChildren){var target=block;$.each(blockChildren,function(index,selectors){$.each(selectors,function(index,selector){target=target.children(selector).not('.'+M.JS_INITIALIZED);});});t.initBlockBranches(pageSection,target,options);}}});},initBlock:function(pageSection,block,options){var t=this;options=options||{};t.initBlockRuntimeMemory(pageSection,block,options);t.initializeBlock(pageSection,block,options);t.runScriptsBefore(pageSection,block);t.runBlockJSMethods(pageSection,block,options);block.on('rendered',function(e,newDOMs){var block=$(this);t.runScriptsBefore(pageSection,newDOMs);t.runBlockJSMethods(pageSection,block,null,options);});t.blockInitialized(pageSection,block,options);t.loadBlockContent(pageSection,block);},initializeBlock:function(pageSection,block,options){var t=this;var args={pageSection:pageSection,block:block};t.extendArgs(args,options);popJSLibraryManager.execute('initBlock',args);block.triggerHandler('initialize');},extendArgs:function(args,options){var t=this;options=options||{};if(options['js-args']){$.extend(args,options['js-args']);}},blockInitialized:function(pageSection,block,options){var t=this;var args={pageSection:pageSection,block:block};t.extendArgs(args,options);popJSLibraryManager.execute('blockInitialized',args);block.triggerHandler('js:initialized');},loadBlockContent:function(pageSection,block){var t=this;if(!t.isContentLoaded(pageSection,block)){t.setContentLoaded(pageSection,block);var options={action:M.CBACTION_LOADCONTENT,'post-data':block.data('post-data')};var jsSettings=t.getJsSettings(pageSection,block);if(jsSettings['loadcontent-showdisabledlayer']){options['show-disabled-layer']=true;}
$(document).ready(function($){t.fetchBlock(pageSection,block,options);});}},runPageSectionJSMethods:function(pageSection,options){var t=this;var sessionIds=popJSRuntimeManager.getPageSectionSessionIds(pageSection);if(!sessionIds)return;var executedTemplates=[];var templateMethods=popManager.getPageSectionJsMethods(pageSection);$.each(templateMethods,function(template,groupMethods){if(executedTemplates.indexOf(template)==-1){executedTemplates.push(template);if(sessionIds[template]&&groupMethods){$.each(groupMethods,function(group,methods){var ids=sessionIds[template][group];if(ids){var selector='#'+ids.join(', #');var targets=$(selector);if(targets.length){$.each(methods,function(index,method){var args={pageSection:pageSection,targets:targets};t.extendArgs(args,options);popJSLibraryManager.execute(method,args);});}}});}}});},runBlockJSMethods:function(pageSection,block,options){var t=this;t.runJSMethods(pageSection,block,null,null,options);popJSRuntimeManager.deleteBlockLastSessionIds(pageSection,block);},runJSMethods:function(pageSection,block,templateFrom,session,options){var t=this;var sessionIds=popJSRuntimeManager.getBlockSessionIds(pageSection,block,session);if(!sessionIds)return;var templateMethods=t.getTemplateJSMethods(pageSection,block,templateFrom);t.runJSMethodsInner(pageSection,block,templateMethods,sessionIds,[],options);},runJSMethodsInner:function(pageSection,block,templateMethods,sessionIds,executedTemplates,options){var t=this;options=options||{};var template=templateMethods[M.JS_TEMPLATE];var groupMethods=templateMethods[M.JS_METHODS];if(executedTemplates.indexOf(template)==-1){executedTemplates.push(template);if(sessionIds[template]&&groupMethods){$.each(groupMethods,function(group,methods){var ids=sessionIds[template][group];if(ids){var selector='#'+ids.join(', #');var targets=$(selector);if(targets.length){$.each(methods,function(index,method){var args={pageSection:pageSection,block:block,targets:targets};t.extendArgs(args,options);popJSLibraryManager.execute(method,args);});}}});}}
if(templateMethods[M.JS_NEXT]){$.each(templateMethods[M.JS_NEXT],function(index,next){t.runJSMethodsInner(pageSection,block,next,sessionIds,executedTemplates,options);})}},getTemplateJSMethods:function(pageSection,block,templateFrom){var t=this;var templateMethods=popManager.getBlockJsMethods(pageSection,block);if(!templateFrom){return templateMethods;}
return t.getTemplateJSMethodsInner(pageSection,block,templateFrom,templateMethods);},getTemplateJSMethodsInner:function(pageSection,block,templateFrom,templateMethods){var t=this;if(templateMethods[M.JS_TEMPLATE]==templateFrom){return templateMethods;}
var found;if(templateMethods[M.JS_NEXT]){$.each(templateMethods[M.JS_NEXT],function(index,next){found=t.getTemplateJSMethodsInner(pageSection,block,templateFrom,next);if(found){return false;}});}
return found;},maybeRedirect:function(feedback){var t=this;if(feedback.redirect&&feedback.redirect.url){if(feedback.redirect.fetch){t.click(feedback.redirect.url)}
else{window.location=feedback.redirect.url;return true;}}
return false;},historyReplaceState:function(elem,options){var t=this;var url=elem.data('historystate-url');var title=elem.data('historystate-title');var thumb=elem.data('historystate-thumb');popBrowserHistory.replaceState(url);if(title){t.documentTitle=unescapeHtml(title);document.title=t.documentTitle;}},hideIfEmpty:function(pageSection,block){var t=this;var feedback=popManager.getBlockFeedback(pageSection,block);return feedback[M.URLPARAM_HIDEBLOCK];},isHidden:function(elem){var t=this;if(elem.hasClass('hidden'))return true;var elem_id=elem.attr('id');if(elem_id){if(!($('#'+elem_id).length)){return true;}}
var tabPanes=elem.parents('.tab-pane');var activeTabPanes=tabPanes.filter('.active');if(tabPanes.length>activeTabPanes.length){return true;}
var executed=popJSLibraryManager.execute('isHidden',{targets:elem});var ret=false;$.each(executed,function(index,value){if(value){ret=true;return-1;}});return ret;},isContentLoaded:function(pageSection,block){var t=this;var blockParams=t.getBlockParams(pageSection,block);return blockParams[M.DATALOAD_CONTENTLOADED]||false;},setContentLoaded:function(pageSection,block){var t=this;var blockParams=t.getBlockParams(pageSection,block);blockParams[M.DATALOAD_CONTENTLOADED]=true;},getSettingsTemplate:function(elem){var t=this;if(elem.data('templateid')){return elem;}
return elem.closest('data-templateid');},updateDocument:function(){var t=this;var feedback=t.getTopLevelFeedback();t.documentTitle=unescapeHtml(feedback[M.URLPARAM_TITLE]);document.title=t.documentTitle;},hideMessages:function(pageSection){var t=this;var status=popPageSectionManager.getPageSectionStatus(pageSection);var loading=status.find('.pop-loading');var error=status.find('.pop-error');loading.addClass('hidden');error.addClass('hidden');},executeSetFilterBlockParams:function(pageSection,block,filter){var t=this;var blockParams=t.getBlockParams(pageSection,block);blockParams.filter=filter.find('.'+M.FILTER_INPUT).filter(function(){return $.trim(this.value);}).serialize();if(blockParams.filter){blockParams.filter+='&'+filter.find('.'+M.FILTER_NAME_INPUT).serialize();}},setFilterBlockParams:function(pageSection,block,filter){var t=this;if(t.jsInitialized(block)){t.executeSetFilterBlockParams(pageSection,block,filter);}
else{block.one('js:initialized',function(){t.executeSetFilterBlockParams(pageSection,block,filter);});}},filter:function(pageSection,block,filter){var t=this;t.setFilterBlockParams(pageSection,block,filter);t.reload(pageSection,block);t.blockScrollTop(pageSection,block);},blockScrollTop:function(pageSection,block){var t=this;var modal=block.closest('.modal');if(modal.length==0){t.scrollToElem(pageSection,block.children('.blocksection-status').first(),true);}
else{modal.animate({scrollTop:0},'fast');}},setReloadBlockParams:function(pageSection,block){var t=this;var blockParams=t.getBlockParams(pageSection,block);if(blockParams[M.DATALOAD_PARAMS]&&blockParams[M.DATALOAD_PARAMS][M.URLPARAM_PAGED]){blockParams[M.DATALOAD_PARAMS][M.URLPARAM_PAGED]='';}
if(blockParams[M.URLPARAM_STOPFETCHING]){blockParams[M.URLPARAM_STOPFETCHING]=false;}},refetch:function(pageSection,block,options){var t=this;options=options||{};options.action=M.CBACTION_REFETCH;block.triggerHandler('beforeRefetch');popManager.reload(pageSection,block,options);},reset:function(pageSection,block,options){var t=this;options=options||{};if(!options['skip-restore']){t.restoreInitialBlockMemory(pageSection,block);}
t.processBlock(pageSection,block,{operation:M.URLPARAM_OPERATION_REPLACE,action:M.CBACTION_RESET,reset:true});},reload:function(pageSection,block,options){var t=this;options=options||{};options.operation=M.URLPARAM_OPERATION_REPLACE;options.reload=true;options['hide-latestcount']=true;t.setReloadBlockParams(pageSection,block);block.triggerHandler('beforeReload');t.fetchBlock(pageSection,block,options);},loadLatest:function(pageSection,block,options){var t=this;options=options||{};var blockParams=t.getBlockParams(pageSection,block);options.operation=M.URLPARAM_OPERATION_PREPEND;options['skip-stopfetching-check']=true;options['hide-latestcount']=true;var post_data={};post_data[M.URLPARAM_ACTION]=M.URLPARAM_ACTION_LATEST;post_data[M.URLPARAM_TIMESTAMP]=blockParams[M.URLPARAM_TIMESTAMP];options['onetime-post-data']=$.param(post_data);block.triggerHandler('beforeLoadLatest');t.fetchBlock(pageSection,block,options);},handleLoadingStatus:function(pageSection,operation,options){var t=this;var loading;options=options||{};if(typeof options['loadingmsg-target']!='undefined'){if(!options['loadingmsg-target']){return;}
loading=$(options['loadingmsg-target']);}
else{var status=popPageSectionManager.getPageSectionStatus(pageSection);loading=status.find('.pop-loading');var error=status.find('.pop-error');error.addClass('hidden');}
var num=loading.data('num')||0;if(operation=='add'){num+=1;}
else if(operation=='remove'){num-=1;}
loading.data('num',num);if(num){loading.removeClass('hidden');}
else{loading.addClass('hidden');}
if(num>=2){loading.find('.pop-box').text('x'+num);}
else{loading.find('.pop-box').text('');}},fetch:function(url,options){var t=this;options=options||{};var pageSection=t.getFetchTargetPageSection(options.target);var params=t.getPageSectionParams(pageSection);if(!params){if(options['noparams-reload-url']){window.location=url;}
return;}
t.fetchPageSection(pageSection,url,options);},getStoredData:function(localStorageKey){if(M.USELOCALSTORAGE&&Modernizr.localstorage){var stored=localStorage[localStorageKey];if(stored){stored=$.parseJSON(stored);if((stored.version==M.VERSION)&&(typeof stored.expires=='undefined'||stored.expires>Date.now())){return stored.value;}
delete localStorage[localStorageKey];}}
return null;},storeData:function(localStorageKey,value,expires){if(M.USELOCALSTORAGE&&Modernizr.localstorage){var stored={version:M.VERSION,value:value}
if(expires){stored.expires=Date.now()+expires;}
try{localStorage[localStorageKey]=JSON.stringify(stored);}
catch(err){}}},fetchPageSection:function(pageSection,url,options){var t=this;var params=t.getPageSectionParams(pageSection);if(!params){return;}
if(params.loading.indexOf(url)>-1){return;}
options=options||{};var target=t.getTarget(pageSection);var fetchUrl=add_query_arg(M.URLPARAM_TARGET,target,url);fetchUrl=add_query_arg(M.URLPARAM_MODULE,M.URLPARAM_MODULE_SETTINGSDATA,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_OUTPUT,M.URLPARAM_OUTPUT_JSON,fetchUrl);var topLevelFeedback=t.getTopLevelFeedback();var paramsData=$.extend({},topLevelFeedback[M.DATALOAD_PARAMS],params[M.DATALOAD_PARAMS]);if(options.params){$.extend(paramsData,options.params);}
var postData=$.param(paramsData);var localStorageKey;localStorageKey=fetchUrl+'|'+postData;var stored=t.getStoredData(localStorageKey);if(stored){t.processPageSectionResponse(pageSection,stored,options);t.triggerURLFetched(url);return;}
var status=popPageSectionManager.getPageSectionStatus(pageSection);var error=status.find('.pop-error');if(options['disable-layer']){options['disable-layer'].children('.pop-disabledlayer').removeClass('hidden');}
var crossdomain=t.getCrossDomainOptions(fetchUrl);$.ajax($.extend(crossdomain,{dataType:"json",url:fetchUrl,data:postData,beforeSend:function(jqXHR,settings){jqXHR.url=settings.url;params.url[jqXHR.url]=url;params.loading.push(url);t.handleLoadingStatus(pageSection,'add',options);},complete:function(jqXHR){var fetchedUrl=params.url[jqXHR.url];delete params.url[jqXHR.url];params.loading.splice(params.loading.indexOf(fetchedUrl),1);t.handleLoadingStatus(pageSection,'remove',options);if(options['urlfetched-callbacks']){var handler='urlfetched:'+escape(fetchedUrl);$.each(options['urlfetched-callbacks'],function(index,callback){$(document).one(handler,callback);});}
t.triggerURLFetched(fetchedUrl);if(options['disable-layer']){options['disable-layer'].children('.pop-disabledlayer').addClass('hidden');}},success:function(response){t.backgroundLoad(response.feedback.toplevel[M.URLPARAM_BACKGROUNDLOADURLS]);error.addClass('hidden');if(response.feedback.toplevel[M.URLPARAM_STORELOCAL]){t.storeData(localStorageKey,response);}
t.processPageSectionResponse(pageSection,response,options);},error:function(jqXHR,textStatus,errorThrown){var fetchedUrl=params.url[jqXHR.url];t.showError(pageSection,t.getError(fetchedUrl,jqXHR,textStatus,errorThrown));pageSection.triggerHandler('fetchFailed');}}));},getCrossDomainOptions:function(url){var t=this;var options={};if(!url.startsWith(M.HOME_URL)){$.each(M.ALLOWED_URLS,function(index,allowed){if(url.startsWith(allowed)){options.xhrFields={withCredentials:true};options.crossDomain=true;return-1;}});}
return options;},showError:function(pageSection,message){var t=this;var status=popPageSectionManager.getPageSectionStatus(pageSection);var error=status.find('.pop-error');error.children('div.pop-box').html(message);error.removeClass('hidden');t.scrollTop(error);},triggerURLFetched:function(url){var t=this;$(document).triggerHandler('urlfetched:'+escape(url));$(document).triggerHandler('urlfetched',[url]);},processPageSectionResponse:function(pageSection,response,options){var t=this;var target=t.getTarget(pageSection);t.saveUrlPointers(response,target);t.addReplicableMemory(response,target);t.addInitialBlockMemory(response);t.integrateDatabases(response);var dfd=$.Deferred();var lastPromise=t.mergingTemplatePromise;t.mergingTemplatePromise=dfd.promise();if(lastPromise){lastPromise.done(function(){t.processPageSection(pageSection,response,options);});}
else{t.processPageSection(pageSection,response,options);}
dfd.resolve();},maybeUpdateDocument:function(pageSection,options){var t=this;options=options||{};if(options.silentDocument){return;}
var settings=t.getFetchPageSectionSettings(pageSection);if(settings.updateDocument){if(!options.skipPushState){var topLevelFeedback=t.getTopLevelFeedback();popBrowserHistory.pushState(topLevelFeedback[M.URLPARAM_URL]);}
t.updateDocument();}},processPageSection:function(pageSection,response,options){var t=this;var target=t.getTarget(pageSection);t.integrateTopLevelFeedback(response);var topLevelFeedback=t.getTopLevelFeedback();var errorMessage=topLevelFeedback[M.URLPARAM_ERROR];if(errorMessage){t.showError(pageSection,errorMessage);}
var url=topLevelFeedback[M.URLPARAM_URL];if(options.reloadurl){t.triggerDestroyTarget(url,target);}
if(topLevelFeedback[M.URLPARAM_SILENTDOCUMENT]){options.silentDocument=true;}
t.maybeUpdateDocument(pageSection,options);if(options.maybeRedirect){if(t.maybeRedirect(topLevelFeedback))return;}
t.integratePageSection(response);$.each(response.settings.configuration,function(rpssId,rpsConfiguration){var psId=rpsConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);t.renderPageSection(pageSection,options);pageSection.triggerHandler('fetched',[options,url]);pageSection.triggerHandler('completed');});},scrollToElem:function(elem,position,animate){var t=this;if(popPerfectScrollbar.scrollToElem(elem,position,animate)){return;}},scrollTop:function(elem,top,animate){var t=this;if(popPerfectScrollbar.scrollTop(elem,top,animate)){return;}
if(popBootstrap.scrollTop(elem)){return;}},getPosition:function(elem){var t=this;return popPerfectScrollbar.getPosition(elem);},getSettingsId:function(objectOrId){var t=this;if($.type(objectOrId)=='object'){var object=objectOrId;return object.attr('data-settings-id');}
return objectOrId;},getError:function(url,jqXHR,textStatus,errorThrown){var t=this;if(jqXHR.status==404){return M.ERROR_404;}
return M.ERROR_MSG.format(url);},closeMessageFeedback:function(elem){var t=this;$(document).ready(function($){elem.find('.pop-messagefeedback').removeClass('fade').alert('close');});},closeMessageFeedbacks:function(pageSection){var t=this;$(document).ready(function($){pageSection.find('.pop-messagefeedback').removeClass('fade').alert('close');});},processBlock:function(pageSection,block,options){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var memory=t.getMemory();options.extendContext={items:memory.dataset[pssId][bsId]};t.renderTarget(pageSection,block,options);},fetchBlock:function(pageSection,block,options){var t=this;options=options||{};if(!options['skip-stopfetching-check']){var blockParams=t.getBlockParams(pageSection,block);if(blockParams[M.URLPARAM_STOPFETCHING]){return;}}
t.executeFetchBlock(pageSection,block,options);},getBlockPostData:function(pageSection,block,options){var t=this;options=options||{};var paramsGroup=options.paramsGroup||'all';var blockParams=t.getBlockParams(pageSection,block);var params={};if(paramsGroup=='all'){$.extend(params,blockParams[M.DATALOAD_PARAMS]);}
var visibleparams=blockParams[M.DATALOAD_VISIBLEPARAMS];if(visibleparams){$.extend(params,visibleparams);}
$.each(params,function(key,value){if(!value)delete params[key];});var post_data=$.param(params);if(blockParams.filter){if(post_data){post_data+='&';}
post_data+=blockParams.filter;}
return post_data;},executeFetchBlock:function(pageSection,block,options){var t=this;options=options||{};var fetchUrl=t.getQueryUrl(pageSection,block);if(!fetchUrl){return;}
var params=t.getBlockParams(pageSection,block);if(options['post-data']){params['post-data']=options['post-data'];}
var topLevelFeedback=t.getTopLevelFeedback();var pageSectionFeedback=t.getPageSectionFeedback(pageSection);var blockFeedback=t.getBlockFeedback(pageSection,block);var paramsData=$.extend({},topLevelFeedback[M.DATALOAD_PARAMS],pageSectionFeedback[M.DATALOAD_PARAMS],blockFeedback[M.DATALOAD_PARAMS]);var post_data=$.param(paramsData);if(params['post-data']){if(post_data){post_data+='&';}
post_data+=params['post-data'];}
if(options['onetime-post-data']){if(post_data){post_data+='&';}
post_data+=options['onetime-post-data'];}
var block_post_data=t.getBlockPostData(pageSection,block);if(post_data&&block_post_data){post_data+='&';}
post_data+=block_post_data;var target=t.getTarget(pageSection);fetchUrl=add_query_arg(M.URLPARAM_TARGET,target,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_MODULE,M.URLPARAM_MODULE_DATA,fetchUrl);fetchUrl=add_query_arg(M.URLPARAM_OUTPUT,M.URLPARAM_OUTPUT_JSON,fetchUrl);var loadingUrl=fetchUrl+post_data;if(params.loading.indexOf(loadingUrl)>-1){return;}
var loading=block.find('.pop-loading');var error=block.find('.pop-error');if(!options['skip-status']){loading.removeClass('hidden');error.addClass('hidden');t.closeMessageFeedback(block);}
t.triggerEvent(pageSection,block,'beforeFetch',[options]);var type=options.type||'GET';if(options['show-disabled-layer']){block.children('.pop-disabledlayer').removeClass('hidden');}
var crossdomain=t.getCrossDomainOptions(fetchUrl);$.ajax($.extend(crossdomain,{dataType:"json",url:fetchUrl,data:post_data,type:type,beforeSend:function(jqXHR,settings){jqXHR.url=settings.url;params.url[jqXHR.url]=loadingUrl;params.loading.push(loadingUrl);params.operation[loadingUrl]=options.operation;params.action[loadingUrl]=options.action;params['paramsscope-url'][loadingUrl]=block.data('paramsscope-url');if(options.reload){params.reload.push(loadingUrl);}},success:function(response,textStatus,jqXHR){t.backgroundLoad(response.feedback.toplevel[M.URLPARAM_BACKGROUNDLOADURLS]);if(options['hide-latestcount']){block.children('.blocksection-latestcount').find('.pop-latestcount').addClass('hidden').find('.pop-count').text('0');}
var lastPromise=t.mergingTemplatePromise;var dfd=$.Deferred();var thisPromise=dfd.promise();t.mergingTemplatePromise=thisPromise;if(lastPromise){lastPromise.done(function(){t.executeFetchBlockSuccess(pageSection,block,params,response,jqXHR);});}
else{t.executeFetchBlockSuccess(pageSection,block,params,response,jqXHR);}
dfd.resolve();},error:function(jqXHR,textStatus,errorThrown){if(!options['skip-status']){error.removeClass('hidden');t.scrollTop(error);}
t.triggerEvent(pageSection,block,'fetchFailed');},complete:function(jqXHR){var status={};var loadingUrl=params.url[jqXHR.url];delete params.url[jqXHR.url];params.loading.splice(params.loading.indexOf(loadingUrl),1);delete params.operation[loadingUrl];delete params.action[loadingUrl];delete params['paramsscope-url'][loadingUrl];var index=params.reload.indexOf(loadingUrl);if(index>-1){status.reload=true;params.reload.splice(index,1);}
var lastPromise=t.mergingTemplatePromise;var dfd=$.Deferred();var thisPromise=dfd.promise();t.mergingTemplatePromise=thisPromise;if(lastPromise){lastPromise.done(function(){t.fetchBlockComplete(pageSection,block,params,status,options);});}
else{t.fetchBlockComplete(pageSection,block,params,status,options);}
dfd.resolve();}}));},fetchBlockComplete:function(pageSection,block,params,status,options){var t=this;block.children('.pop-disabledlayer').addClass('hidden');if(options['datasetcount-target']){t.displayDatasetCount(pageSection,block,$(options['datasetcount-target']),options['datasetcount-updatetitle']);}
if(!params.loading.length){var loading=block.find('.pop-loading');loading.addClass('hidden');}
var blockParams=t.getBlockParams(pageSection,block);if(blockParams[M.URLPARAM_STOPFETCHING]){block.addClass('pop-stopfetching');}
else{block.removeClass('pop-stopfetching');}
t.triggerEvent(pageSection,block,'fetchCompleted',[status]);},displayDatasetCount:function(pageSection,block,target,updateTitle){var t=this;var dataset=t.getBlockDataset(pageSection,block);if(dataset.length){var mode=target.data('datasetcount-mode')||'add';var count=dataset.length;if(mode=='add'){count+=target.text()?parseInt(target.text()):0;}
if(count){target.removeClass('hidden').text(count);if(updateTitle){document.title='('+count+') '+t.documentTitle;}}}},executeFetchBlockSuccess:function(pageSection,block,params,response,jqXHR){var t=this;var loadingUrl=params.url[jqXHR.url];var action=params.action[loadingUrl];var runtimeOptions={url:params['paramsscope-url'][loadingUrl]};var processOptions={operation:params.operation[loadingUrl],action:params.action[loadingUrl]};var memory=t.getMemory();var restoreinitial_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH,M.CBACTION_RESET];var restoreinitial=restoreinitial_actions.indexOf(action)>-1;if(restoreinitial){var initialMemory=t.getInitialBlockMemory(runtimeOptions.url);$.each(response.params,function(rpssId,rpsParams){$.each(rpsParams,function(rbsId,rbParams){memory.runtimesettings.configuration[rpssId][rbsId]=initialMemory.runtimesettings.configuration[rpssId][rbsId];});});}
t.integrateTopLevelFeedback(response);t.integrateDatabases(response);$.each(response.params,function(rpssId,rpsParams){var rPageSection=$('#'+memory.settings.configuration[rpssId].id);if(!memory.feedback.block[rpssId]){memory.feedback.block[rpssId]={};}
$.extend(memory.feedback.block[rpssId],response.feedback.block[rpssId]);if(!memory.dataset[rpssId]){memory.dataset[rpssId]={};}
$.extend(memory.dataset[rpssId],response.dataset[rpssId]);if(!memory.params[rpssId]){memory.params[rpssId]={};}
$.extend(memory.params[rpssId]);$.each(rpsParams,function(rbsId,rbParams){try{var rBlock=$('#'+t.getBlockId(rpssId,rbsId,runtimeOptions));$.extend(t.getBlockParams(rPageSection,rBlock,runtimeOptions),rbParams);var process_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH];if(process_actions.indexOf(action)>-1){var jsSettings=t.getJsSettings(rPageSection,rBlock);if(jsSettings['processblock-ifhasdata']&&!response.dataset[rpssId][rbsId].length){return;}}
t.processBlock(rPageSection,rBlock,processOptions);}
catch(err){}});});block.triggerHandler('fetched',[response,action]);},triggerEvent:function(pageSection,block,event,args){var t=this;block.triggerHandler(event,args);},integrateTopLevelFeedback:function(response){var t=this;var tlFeedback=t.getMemory().feedback.toplevel;$.each(response.feedback.toplevel,function(key,value){if($.type(value)=='array'&&value.length==0){}
else if($.type(value)=='object'){if(!tlFeedback[key]){tlFeedback[key]={};}
$.extend(tlFeedback[key],value);}
else{tlFeedback[key]=value;}});},clearUserDatabase:function(){var t=this;t.userdatabase={};},integrateDatabase:function(database,responsedb){var t=this;$.each(responsedb,function(dbKey,dbItems){database[dbKey]=database[dbKey]||{};if($.type(dbItems)=='array'){return;}
$.each(dbItems,function(key,value){if(!database[dbKey][key]){database[dbKey][key]={};}
$.extend(database[dbKey][key],value);});});},integrateDatabases:function(response){var t=this;t.integrateDatabase(t.database,response.database);t.integrateDatabase(t.userdatabase,response.userdatabase);},getMergeTargetContainer:function(target){var t=this;if(target.data('merge-container')){return $(target.data('merge-container'));}
return target;},getMergeTarget:function(target,templateName,options){var t=this;options=options||{};var selector='.pop-merge.'+templateName;var mergeTarget=options['merge-target']?$(options['merge-target']):target.find(selector).addBack(selector);return t.getMergeTargetContainer(mergeTarget);},generateUniqueId:function(){var t=this;var unique=Date.now();var tlFeedback=t.getTopLevelFeedback();tlFeedback[M.UNIQUEID]=unique;return unique;},getUniqueId:function(){var t=this;var tlFeedback=t.getTopLevelFeedback();return tlFeedback[M.UNIQUEID];},addUniqueId:function(url){var t=this;var unique=t.getUniqueId();return url+'#'+unique;},mergeTargetTemplate:function(pageSection,target,templateName,options){var t=this;options=options||{};var rerender_actions=[M.CBACTION_LOADCONTENT,M.CBACTION_REFETCH,M.CBACTION_RESET];var rerender=rerender_actions.indexOf(options.action)>-1;if(rerender){t.generateUniqueId();}
var html=t.getTemplateHtml(pageSection,target,templateName,options);var targetContainer=t.getMergeTarget(target,templateName,options);var operation=options.operation||M.URLPARAM_OPERATION_REPLACE;if(operation==M.URLPARAM_OPERATION_REPLACE){target.triggerHandler('replace',[options.action]);if(rerender){target.triggerHandler('rerender',[options.action]);}
targetContainer.empty();}
var merged=t.mergeHtml(html,targetContainer,operation);target.triggerHandler('merged',[merged.newDOMs]);return merged;},mergeHtml:function(html,container,operation){var t=this;var newDOMs=$(html);if(operation==M.URLPARAM_OPERATION_PREPEND){container.prepend(newDOMs);}
else if(operation==M.URLPARAM_OPERATION_REPLACEINLINE){container.replaceWith(newDOMs);container=newDOMs;}
else{container.append(newDOMs);}
t.triggerHTMLMerged();return{targetContainer:container,newDOMs:newDOMs};},triggerHTMLMerged:function(){var t=this;$(document).triggerHandler('template:merged');},renderPageSection:function(pageSection,options){var t=this;options=options||{};$.extend(options,t.getFetchPageSectionSettings(pageSection));var newDOMs=t.renderTarget(pageSection,pageSection,options);if(newDOMs.length){t.pageSectionRendered(pageSection,newDOMs,options);}},renderTarget:function(pageSection,target,options){var t=this;options=options||{};target.triggerHandler('beforeMerge',[options]);var templates_cbs=t.getTemplatesCbs(pageSection,target,options.action);var targetContainers=$();var newDOMs=$();$.each(templates_cbs,function(index,templateName){var merged=t.mergeTargetTemplate(pageSection,target,templateName,options);targetContainers=targetContainers.add(merged.targetContainer);newDOMs=newDOMs.add(merged.newDOMs);});t.triggerRendered(target,newDOMs,targetContainers);return newDOMs;},triggerRendered:function(target,newDOMs,targetContainers){var t=this;target.triggerHandler('rendered',[newDOMs,targetContainers]);$(document).triggerHandler('rendered',[target,newDOMs,targetContainers]);},getPageSectionConfiguration:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getMemory().settings.configuration[pssId];},getTargetConfiguration:function(pageSection,target,template){var t=this;var templatePath=t.getTemplatePath(pageSection,target,template);var targetConfiguration=t.getPageSectionConfiguration(pageSection);$.each(templatePath,function(index,pathLevel){targetConfiguration=targetConfiguration[pathLevel];});return targetConfiguration;},overrideFromItemObject:function(itemObject,override,overrideFields){var t=this;if(itemObject){$.each(overrideFields,function(index,overrideFromItemObject){override[overrideFromItemObject.key]=itemObject[overrideFromItemObject.field];});}},replaceFromItemObject:function(pssId,bsId,template,itemObject,override,strReplace){var t=this;var feedback=t.getTopLevelFeedback();var targetConfiguration=t.getTargetConfiguration(pssId,bsId,template);$.each(strReplace,function(index,replace){var replaceWhereField=replace['replace-where-field'];var replaceWherePath=replace['replace-where-path'];var replaceFromField=replace['replace-from-field']||replaceWhereField;var replacements=replace['replacements'];var replaceFrom=targetConfiguration[replaceFromField];$.each(replacements,function(index,replacement){var replaceStr=replacement['replace-str'];if(itemObject){var replaceWithField=replacement['replace-with-field'];if(replaceWithField&&replaceStr!=itemObject[replaceWithField]){var replaceWith=itemObject[replaceWithField];if(replacement['encode-uri-component']){replaceWith=encodeURIComponent(replaceWith);}
else if(replacement['encode-uri']){replaceWith=encodeURI(replaceWith);}
replaceFrom=replaceFrom.replace(new RegExp(replaceStr,'g'),replaceWith);}}
var replaceFromFeedback=replacement['replace-from-feedback'];if(replaceFromFeedback&&replaceStr!=feedback[replaceFromFeedback]){replaceFrom=replaceFrom.replace(new RegExp(replaceStr,'g'),feedback[replaceFromFeedback]);}});var overrideWhere=override;if(replaceWherePath){$.each(replaceWherePath,function(index,pathlevel){overrideWhere[pathlevel]={};overrideWhere=overrideWhere[pathlevel];});}
overrideWhere[replaceWhereField]=replaceFrom;});},getTemplateHtml:function(pageSection,target,templateName,options,itemDBKey,itemObjectId){var t=this;var targetConfiguration=t.getTargetConfiguration(pageSection,target,templateName);options=options||{};targetContext=targetConfiguration;var templatePath=t.getTemplatePath(pageSection,target,templateName);if(templatePath.length){var block=t.getBlock(target);t.initContextSettings(pageSection,block,targetContext);t.extendContext(targetContext,itemDBKey,itemObjectId);}
var extendContext=options.extendContext;if(extendContext){targetContext=$.extend({},targetContext,extendContext);}
return t.getHtml(templateName,targetContext);},extendContext:function(context,itemDBKey,itemObjectId,override){var t=this;override=override||{};$.extend(context,override);if(itemDBKey){$.extend(context,{itemDBKey:itemDBKey});if(itemObjectId){var itemObject=t.getItemObject(itemDBKey,itemObjectId);$.extend(context,{itemObject:itemObject});}}},initTopLevelJson:function(){var t=this;var jsonHtml=$('#'+popPageSectionManager.getTopLevelSettingsId());var json=$.parseJSON(jsonHtml.html());t.database=json.database;t.userdatabase=json.userdatabase;var memory=t.getMemory();memory.settings=json.settings;memory.runtimesettings=json.runtimesettings;memory.dataset=json.dataset;memory.feedback=json.feedback;memory.params=json.params;$.each(memory.dataset,function(pssId,psDataset){if($.type(psDataset)=='array'){memory.dataset[pssId]={};}});$.each(memory.params,function(pssId,psParams){if($.type(psParams)=='array'){memory.params[pssId]={};}});$.each(memory.feedback.pagesection,function(pssId,psFeedback){if($.type(psFeedback)=='array'){memory.feedback.pagesection[pssId]={};}});$.each(memory.feedback.block,function(pssId,bFeedback){if($.type(bFeedback)=='array'){memory.feedback.block[pssId]={};}});t.saveUrlPointers(json);t.addReplicableMemory(json);t.addInitialBlockMemory(json);},getBlockDefaultParams:function(){var t=this;return{url:[],loading:[],reload:[],operation:{},action:{},'paramsscope-url':{},'post-data':'',filter:''};},getPageSectionDefaultParams:function(){var t=this;return{url:[],loading:[]};},initPageSectionRuntimeMemory:function(pageSection,options){var t=this;var runtimeMempage=t.newRuntimeMemoryPage(pageSection,pageSection,options);var pssId=t.getSettingsId(pageSection);runtimeMempage.params=t.getPageSectionDefaultParams();var args={pageSection:pageSection,runtimeMempage:runtimeMempage};popJSLibraryManager.execute('initPageSectionRuntimeMemory',args);},initBlockRuntimeMemory:function(pageSection,block,options){var t=this;var runtimeMempage=t.newRuntimeMemoryPage(pageSection,block,options);var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);runtimeMempage.params=$.extend(t.getBlockDefaultParams(),t.getMemory().params[pssId][bsId]);runtimeMempage['query-url']=t.getRuntimeSettings(pageSection,block,'query-url');runtimeMempage.id=block.attr('id');var args={pageSection:pageSection,block:block,runtimeMempage:runtimeMempage};popJSLibraryManager.execute('initBlockRuntimeMemory',args);},getViewport:function(pageSection,el){var t=this;var viewport=el.closest('.pop-viewport');if(viewport.length){return viewport;}
return pageSection;},getDOMContainer:function(pageSection,el){var t=this;if(M.DOMCONTAINER_ID){return $('#'+M.DOMCONTAINER_ID);}
return t.getViewport(pageSection,el);},getBlock:function(el){var t=this;if(el.hasClass('pop-block')){return el;}
if(el.closest('.pop-block').length){return el.closest('.pop-block');}
if(el.closest('[data-block]').length){return $(el.closest('[data-block]').data('block'));}
return null;},isBlockGroup:function(block){var t=this;return block.hasClass('pop-blockgroup');},getBlockGroupActiveBlock:function(blockGroup){var t=this;return blockGroup.find('.tab-pane.active .pop-block, .collapse.in .pop-block');},getBlockGroupBlocks:function(blockGroup){var t=this;return blockGroup.find('.pop-block');},getTemplateSource:function(template){var t=this;return t.getMemory().settings['template-sources'][template]||template;},initPageSectionSettings:function(pageSection,psConfiguration){var t=this;var tls=t.getTopLevelSettings();$.extend(psConfiguration,{tls:tls});var pss=t.getPageSectionSettings(pageSection);var pssId=t.getSettingsId(pageSection);var psId=psConfiguration[M.JS_FRONTENDID];$.extend(psConfiguration,{pss:pss});t.expandJSKeys(psConfiguration);if(psConfiguration[M.JS_MODULES]){$.each(psConfiguration[M.JS_MODULES],function(bsId,bConfiguration){var bId=bConfiguration[M.JS_FRONTENDID];var bs=t.getBlockSettings(pssId,bsId,psId,bId);$.extend(bConfiguration,{tls:tls,pss:pss,bs:bs});t.expandJSKeys(bConfiguration);});}},initContextSettings:function(pageSection,block,context){var t=this;var tls=t.getTopLevelSettings();$.extend(context,{tls:tls});var pss=t.getPageSectionSettings(pageSection);$.extend(context,{pss:pss});var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');var bsId=t.getSettingsId(block);var bId=block.attr('id');var bs=t.getBlockSettings(pssId,bsId,psId,bId);$.extend(context,{pss:pss,bs:bs});t.expandJSKeys(context);if(!context.itemDBKey){context.itemDBKey=bs['db-keys']['db-key'];}},integratePageSection:function(response){var t=this;var memory=t.getMemory();$.extend(memory.settings['template-sources'],response.settings['template-sources']);$.each(response.settings.configuration,function(pssId,rpsConfiguration){$.extend(memory.params[pssId],response.params[pssId]);$.extend(memory.dataset[pssId],response.dataset[pssId]);$.extend(memory.feedback.pagesection[pssId],response.feedback.pagesection[pssId]);$.extend(memory.feedback.block[pssId],response.feedback.block[pssId]);$.extend(memory.runtimesettings['query-url'][pssId],response.runtimesettings['query-url'][pssId]);$.extend(memory.runtimesettings.configuration[pssId],response.runtimesettings.configuration[pssId]);$.extend(memory.settings['js-settings'][pssId],response.settings['js-settings'][pssId]);$.extend(memory.settings.jsmethods.pagesection[pssId],response.settings.jsmethods.pagesection[pssId]);$.extend(memory.settings.jsmethods.block[pssId],response.settings.jsmethods.block[pssId]);$.extend(memory.settings['templates-cbs'][pssId],response.settings['templates-cbs'][pssId]);$.extend(memory.settings['templates-paths'][pssId],response.settings['templates-paths'][pssId]);$.extend(memory.settings['db-keys'][pssId],response.settings['db-keys'][pssId]);if(!memory.settings.configuration[pssId]){memory.settings.configuration[pssId]={};}
var psConfiguration=memory.settings.configuration[pssId];$.each(rpsConfiguration,function(key,value){if($.type(value)=='array'){psConfiguration[key]={};}
else if($.type(value)=='object'){if(!psConfiguration[key]){psConfiguration[key]={};}
$.extend(psConfiguration[key],value);}
else{psConfiguration[key]=value;}});var psId=rpsConfiguration[M.JS_FRONTENDID];var pageSection=$('#'+psId);t.initPageSectionSettings(pageSection,psConfiguration);});},getTopLevelSettings:function(){var t=this;return{feedback:t.getTopLevelFeedback()};},getPageSectionSettings:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);var psId=pageSection.attr('id');var pageSectionSettings={feedback:t.getPageSectionFeedback(pageSection),pssId:pssId,psId:psId};return pageSectionSettings;},getBlockSettings:function(pssId,bsId,psId,bId){var t=this;var blockSettings={"db-keys":t.getDatabaseKeys(pssId,bsId),dataset:t.getBlockDataset(pssId,bsId),feedback:t.getBlockFeedback(pssId,bsId),bsId:bsId,bId:bId,};t.expandBlockSettingsJSKeys(blockSettings);return blockSettings;},expandBlockSettingsJSKeys:function(blockSettings){var t=this;if(blockSettings&&M.COMPACT_JS_KEYS){if(blockSettings['db-keys']&&blockSettings['db-keys'][M.JS_SUBCOMPONENTS]){blockSettings['db-keys'].subcomponents=blockSettings['db-keys'][M.JS_SUBCOMPONENTS];}}},getBlockDataset:function(pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);return t.getMemory().dataset[pssId][bsId];},getBlockFeedback:function(pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);return t.getMemory().feedback.block[pssId][bsId];},getPageSectionFeedback:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getMemory().feedback.pagesection[pssId];},getTopLevelFeedback:function(){var t=this;return t.getMemory().feedback.toplevel;},getSettings:function(pageSection,target,item){var t=this;var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);var memory=t.getMemory();return memory.settings[item][pssId][targetId];},getRuntimeSettings:function(pageSection,target,item){var t=this;var pssId=t.getSettingsId(pageSection);var targetId=t.getSettingsId(target);var memory=t.getMemory();return memory.runtimesettings[item][pssId][targetId];},getQueryUrl:function(pageSection,block){var t=this;return t.getRuntimeMemoryPage(pageSection,block)['query-url'];},getRuntimeConfiguration:function(pageSection,block,el){var t=this;el=el||block;var elsId=t.getTemplateOrObjectSettingsId(el);var configuration=t.getRuntimeSettings(pageSection,block,'configuration');return configuration[elsId]||{};},getDatabaseKeys:function(pageSection,block){var t=this;return t.getSettings(pageSection,block,'db-keys');},getBlockFilteringUrl:function(pageSection,block,use_pageurl){var t=this;var url=t.getQueryUrl(pageSection,block);if(!url&&use_pageurl){url=window.location.href;}
var post_data=t.getBlockPostData(pageSection,block,{paramsGroup:'visible'});if(post_data){if(url.indexOf('?')>-1){url+='&';}
else{url+='?';}
url+=post_data;}
return url;},click:function(url,container){var t=this;container=container||$('body');var linkHtml='<a href="'+url+'" class="hidden"></a>';var link=$(linkHtml).appendTo(container);link.trigger('click');},getUnembedUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getUnembedUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getEmbedUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getEmbedUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getPrintUrl:function(url){var t=this;var executed=popJSLibraryManager.execute('getPrintUrl',{url:url});var ret=false;$.each(executed,function(index,value){if(value){url=value;return-1;}});return url;},getDestroyUrl:function(url){var t=this;var domain=M.HOME_URL;$.each(M.ALLOWED_URLS,function(index,allowed){if(url.startsWith(allowed)){domain=allowed;return-1;}});return url.replace(domain,domain+'/destroy');},getTemplateOrObjectSettingsId:function(el){var t=this;if($.type(el)=='object'){return el.data('templateid');}
return el;},getPageSectionJsSettings:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);return t.getSettings(pageSection,pageSection,'js-settings')||{};},getJsSettings:function(pageSection,block,el){var t=this;el=el||block;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var jsSettingsId=t.getTemplateOrObjectSettingsId(el);var settings=t.getSettings(pageSection,block,'js-settings');return settings[jsSettingsId]||{};},getPageSectionJsMethods:function(pageSection){var t=this;var pssId=t.getSettingsId(pageSection);var memory=t.getMemory();return memory.settings['jsmethods']['pagesection'][pssId]||{};},getBlockJsMethods:function(pageSection,block){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var memory=t.getMemory();return memory.settings['jsmethods']['block'][pssId][bsId]||{};},restoreInitialBlockMemory:function(pageSection,block,options){var t=this;var pssId=t.getSettingsId(pageSection);var bsId=t.getSettingsId(block);var url=block.data('paramsscope-url');var initialMemory=t.getInitialBlockMemory(url);t.getRuntimeMemoryPage(pageSection,block,options).params=$.extend(t.getBlockDefaultParams(),initialMemory.params[pssId][bsId]);t.getMemory().runtimesettings.configuration[pssId][bsId]=$.extend({},initialMemory.runtimesettings.configuration[pssId][bsId]);t.getMemory().feedback.block[pssId][bsId]=$.extend({},initialMemory.feedback.block[pssId][bsId]);var dataset=initialMemory.dataset[pssId][bsId];if(dataset.length){$.extend(t.getMemory().dataset[pssId][bsId],dataset);}
else{t.getMemory().dataset[pssId][bsId]=[];}},getBlockParams:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options).params;},getPageSectionParams:function(pageSection,options){var t=this;return t.getRuntimeMemoryPage(pageSection,pageSection,options).params;},getTarget:function(pageSection){var t=this;var id=pageSection.attr('id');var ret=M.URLPARAM_TARGET_MAIN;$.each(M.FETCHTARGET_SETTINGS,function(target,psId){if(psId==id){ret=target;return-1;}});return ret;},targetExists:function(target){var t=this;return M.FETCHTARGET_SETTINGS[target];},getFetchTargetPageSection:function(target){var t=this;if(!target||target=='_self'||!M.FETCHTARGET_SETTINGS[target]){target=M.URLPARAM_TARGET_MAIN;}
return $('#'+M.FETCHTARGET_SETTINGS[target]);},getFetchPageSectionSettings:function(pageSection){var t=this;var psId=pageSection.attr('id');return M.FETCHPAGESECTION_SETTINGS[psId]||{};},getTemplatesCbs:function(pageSection,target,action){var t=this;action=action||'main';var templatesCbs=t.getSettings(pageSection,target,'templates-cbs');var cbs=templatesCbs.cbs;var actions=templatesCbs.actions;if($.isArray(actions)&&!actions.length){return cbs;}
var allowed=[];$.each(cbs,function(index,cb){if(!actions[cb]||actions[cb].indexOf(action)>-1){allowed.push(cb);}});return allowed;},getTemplatePath:function(pageSection,target,template){var t=this;var templatePaths=t.getSettings(pageSection,target,'templates-paths');return templatePaths[template];},getScriptTemplate:function(templateName){var t=this;var templateSource=t.getTemplateSource(templateName);return Handlebars.templates[templateSource];},getPageSectionGroup:function(elem){var t=this;return elem.closest('.pop-pagesection-group').addBack('.pop-pagesection-group');},getPageSection:function(elem){var t=this;return elem.closest('.pop-pagesection').addBack('.pop-pagesection');},getPageSectionPage:function(elem){var t=this;var page=elem.closest('.pop-pagesection-page').addBack('.pop-pagesection-page');if(page.length){return page;}
return t.getPageSection(elem);},getBlockId:function(pageSection,block,options){var t=this;return t.getRuntimeMemoryPage(pageSection,block,options).id;},getHtml:function(templateName,context){var t=this;var template=t.getScriptTemplate(templateName);if(typeof template=='undefined'){console.error('No template for '+templateName);return'';}
return template(context);},getItemObject:function(itemDBKey,itemObjectId){var t=this;var userItem={},item={};if(t.userdatabase[itemDBKey]&&t.userdatabase[itemDBKey][itemObjectId]){userItem=t.userdatabase[itemDBKey][itemObjectId];}
if(t.database[itemDBKey]&&t.database[itemDBKey][itemObjectId]){item=t.database[itemDBKey][itemObjectId];}
return $.extend({},userItem,item);},getFrameTarget:function(pageSection){var t=this;return pageSection.data('frametarget')||M.URLPARAM_TARGET_MAIN;},getClickFrameTarget:function(pageSection){var t=this;return pageSection.data('clickframetarget')||t.getFrameTarget(pageSection);},getOriginalLink:function(link){var t=this;var intercepted=link.data('interceptedTarget');if(intercepted){return t.getOriginalLink(intercepted);}
return link;},};})(jQuery);
;Handlebars.registerHelper('latestCountTargets',function(itemObject,options){var targets=[];var selector='.pop-block.'+M.JS_INITIALIZED+' > .blocksection-latestcount > .pop-latestcount';var post_type=itemObject['post-type'];var cats=itemObject['cats'];if(cats&&cats.length){targets.push(selector+'.'+post_type+'-'+cats.join('.'+post_type+'-'));}
jQuery.each(itemObject['tags'],function(index,tag){var target=selector+'.tag'+tag;targets.push(target);});jQuery.each(itemObject['authors'],function(index,author){var target=selector+'.author'+author;if(cats&&cats.length){target+='.author-'+post_type+'-'+cats.join('.author-'+post_type+'-');}
targets.push(target);});jQuery.each(itemObject['references'],function(index,post_id){var target=selector+'.single'+post_id;if(cats&&cats.length){target+='.single-'+post_type+'-'+cats.join('.single-'+post_type+'-');}
targets.push(target);});return new Handlebars.SafeString(targets.join(','));});;(function($){popCustomBootstrap={initDocument:function(){var t=this;$(document).on('focusin',function(e){if($(e.target).closest(".mce-window").length){e.stopImmediatePropagation();}});},runScriptsBefore:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;newDOMs.find('.collapse').addBack('.collapse').on('show.bs.collapse',function(){t.addBubblingFlag($(this),'.collapse','show');}).on('shown.bs.collapse',function(){t.addBubblingFlag($(this),'.collapse','shown');}).on('hide.bs.collapse',function(){t.addBubblingFlag($(this),'.collapse','hide');}).on('hidden.bs.collapse',function(){t.addBubblingFlag($(this),'.collapse','hidden');});},pageSectionNewDOMsInitialized:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;t.activateNestedComponents(pageSection,newDOMs);t.showComponentInitializeJS(pageSection,newDOMs);t.triggerTabPaneEvents(newDOMs);},isHidden:function(args){var t=this;var targets=args.targets;if(targets.parents('.collapse,.modal').not('.in').length){return true;}
if(targets.parents('.tab-pane').not('.active').length){return true;}
return false;},activeTabLink:function(args){var t=this;var targets=args.targets;targets.click(function(e){var link=$(this);link.parent('li').addClass('active').siblings('li').removeClass('active');})},activatePageTab:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(){var interceptor=$(this);var pageTabBtn=$(interceptor.data('target'));t.clickPageTab(pageSection,pageTabBtn);});targets.trigger('click');},customQuickView:function(args){var t=this;var pageSection=args.pageSection;var modal=pageSection.closest('.modal');pageSection.on('fetched',function(){if(!popBootstrap.showingModal(modal)){popBootstrap.closeModals();modal.modal('show');}});popManager.getPageSectionGroup(pageSection).on('on.bs.pagesection-group:pagesection-'+pageSection.attr('id')+':closed',function(){modal.modal('hide');});},destroyPageOnModalClose:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var link=$(this);link.closest('.modal').on('hidden.bs.modal',function(){link.trigger('click');});});},customCloseModals:function(args){var t=this;var pageSection=args.pageSection;pageSection.on('destroy',function(){popBootstrap.closeModals();});},showComponentInitializeJS:function(pageSection,newDOMs){var t=this;var collapses=newDOMs.find('.collapse.pop-bscomponent').addBack('.collapse.pop-bscomponent');if(collapses.length){t.initComponentHandlers(pageSection,collapses,'shown.bs.collapse');}
var modals=newDOMs.find('.modal.pop-bscomponent').addBack('.modal.pop-bscomponent');if(modals.length){t.initComponentHandlers(pageSection,modals,'shown.bs.modal');}
var tabPanes=newDOMs.find('.tab-pane.pop-bscomponent').addBack('.tab-pane.pop-bscomponent');if(tabPanes.length){t.initComponentHandlers(pageSection,tabPanes,'shown.bs.tabpane');}
var carousels=newDOMs.find('.carousel.pop-bscomponent').addBack('.carousel.pop-bscomponent');if(carousels.length){t.initComponentHandlers(pageSection,carousels,'slid.bs.carousel',true);}},initComponentHandlers:function(pageSection,targets,handler,useRelatedTarget){var t=this;targets.on(handler,function(e){var component=useRelatedTarget?$(e.relatedTarget):$(this);var blocks=$(component.data('initjs-targets'));var block_data={'post-data':component.data('post-data'),}
t.recursiveSetBlockData(pageSection,blocks,block_data);});targets.on(handler,function(e){var component=useRelatedTarget?$(e.relatedTarget):$(this);var blocks=$(component.data('initjs-targets')).not('.'+M.JS_INITIALIZED);if(!blocks.length){return;}
var options={'force-init':true};var url=component.data('intercept-url');if(url){options.url=url;}
popManager.initBlockBranches(pageSection,blocks,options);});targets.on(handler,function(e){var component=useRelatedTarget?$(e.relatedTarget):$(this);var blocks=$(component.data('initjs-targets'));if(component.data('onetime-refetch')){t.recursiveOneTimeRefetch(pageSection,blocks);}
t.triggerBlocksVisible(pageSection,blocks);});},recursiveSetBlockData:function(pageSection,blocks,block_data){var t=this;blocks.each(function(){var block=$(this);$.each(block_data,function(key,value){block.data(key,value);});var jsSettings=popManager.getJsSettings(pageSection,block);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.recursiveSetBlockData(pageSection,$(blockBranches.join(', ')),block_data);}});},recursiveOneTimeRefetch:function(pageSection,blocks){var t=this;blocks.each(function(){var block=$(this);popSystem.makeOneTimeRefetch(pageSection,block);var jsSettings=popManager.getJsSettings(pageSection,block);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.recursiveOneTimeRefetch(pageSection,$(blockBranches.join(', ')));}});},triggerBlocksVisible:function(pageSection,blocks){var t=this;blocks.each(function(){var block=$(this);block.triggerHandler('visible');var jsSettings=popManager.getJsSettings(pageSection,block);var blockBranches=jsSettings['initjs-blockbranches'];if(blockBranches){t.triggerBlocksVisible(pageSection,$(blockBranches.join(', ')));}});},activateNestedComponents:function(pageSection,newDOMs){var t=this;newDOMs.find('div.tab-pane div.tab-pane').addBack('div.tab-pane div.tab-pane').on('shown.bs.tabpane',function(){t.activateOuterTabPanes($(this));});newDOMs.find('div.tab-pane div.collapse').addBack('div.tab-pane div.collapse').on('shown.bs.collapse',function(){t.activateOuterTabPanes($(this));});newDOMs.find('div.carousel div.collapse').addBack('div.carousel div.collapse').on('shown.bs.collapse',function(){t.activateOuterCarousel($(this));});newDOMs.find('div.carousel div.tab-pane').addBack('div.carousel div.tab-pane').on('shown.bs.tabpane',function(){t.activateOuterCarousel($(this));});},activateOuterTabPanes:function(component){var t=this;var outerTabPanes=component.parents('.tab-pane').not('.active');if(outerTabPanes.length){$('a[href="#'+outerTabPanes.attr('id')+'"]').tab('show');}},activateOuterCarousel:function(component){var t=this;var outerCarousel=component.closest('.carousel');popBootstrapCarousel.showElement(outerCarousel,component);},triggerTabPaneEvents:function(elem){var t=this;elem.find('a[data-toggle="tab"]').addBack('a[data-toggle="tab"]').on('show.bs.tab',function(e){t.triggerTabPaneEvent($(this),e,'show.bs.tabpane');}).on('shown.bs.tab',function(e){t.triggerTabPaneEvent($(this),e,'shown.bs.tabpane');}).on('hide.bs.tab',function(e){t.triggerTabPaneEvent($(this),e,'hide.bs.tabpane');}).on('hidden.bs.tab',function(e){t.triggerTabPaneEvent($(this),e,'hidden.bs.tabpane');});},triggerTabPaneEvent:function(link,e,event){var t=this;var tabPane=$($(e.target).attr('href'));tabPane.data('post-data',link.data('post-data'));tabPane.data('onetime-refetch',link.data('onetime-refetch'));tabPane.data('intercept-url',link.data('intercept-url'));tabPane.data('original-url',link.data('original-url'));tabPane.triggerHandler(event,[e]);},resetBubbling:function(){$('[data-bubbling]').attr('data-bubbling',null);$('[data-bubbling-origin]').attr('data-bubbling-origin',null);},bubbling:function(elem,selector){var t=this;if(elem.is(selector)){var bubblingId=elem.attr('data-bubbling');if(bubblingId&&elem.find('[data-bubbling-origin="'+bubblingId+'"]').length){return true;}}
return false;},addBubblingFlag:function(elem,parentSelector,type){var t=this;if(elem.parents(parentSelector).length){var ran=getRandomInt(1,10000000000);var bubblingId=elem.attr('id')+'-'+type+'-'+ran;elem.attr('data-bubbling-origin',bubblingId);elem.parents(parentSelector).attr('data-bubbling',bubblingId);}},activateSideTabpanes:function(pageSection,newDOMs){var t=this;if(newDOMs.filter('.tab-pane').length){var firstLoad=popManager.isFirstLoad(pageSection);if(!firstLoad){newDOMs.siblings('.tab-pane').removeClass('active');}
newDOMs.filter('.tab-pane').addClass('active').on('shown.bs.tabpane',function(){var openmode=popPageSectionManager.getOpenMode(pageSection);if(openmode=='automatic'){popPageSectionManager.open(pageSection);popManager.scrollTop(pageSection);}});if(!firstLoad){popManager.scrollTop(pageSection);}}},activateQuickviewTabpanes:function(pageSection,newDOMs){var t=this;if(newDOMs.filter('.tab-pane').length){newDOMs.filter('.tab-pane').addClass('active').siblings('.tab-pane').removeClass('active');}},activateModals:function(pageSection,newDOMs){var t=this;var modal=newDOMs.filter('.modal');if(modal.length){popBootstrap.closeModals();modal.modal('show');modal.on('show.bs.modal',function(e){popManager.closeMessageFeedback(modal);});modal.on('shown.bs.modal',function(e){windowResize();});}},activateTabPanes:function(pageSection,newDOMs,removeTheather,sides){var t=this;if(newDOMs.filter('.tab-pane').length){var firstLoad=popManager.isFirstLoad(pageSection);if(!firstLoad){var previousTabPane=newDOMs.siblings('.tab-pane.active');t.savePosition(pageSection,previousTabPane);previousTabPane.removeClass('active');}
newDOMs.filter('.tab-pane').addClass('active').on('show.bs.tabpane',function(){var tabPane=$(this);var previousTabPane=tabPane.siblings('.active');t.savePosition(pageSection,previousTabPane);}).on('shown.bs.tabpane',function(){var tabPane=$(this);popPageSectionManager.open(pageSection);t.newPageSectionJS(pageSection,removeTheather,sides,tabPane);});if(!firstLoad){t.newPageSectionJS(pageSection,removeTheather,sides);}}},clickPageTab:function(pageSection,pageTabBtn){var t=this;pageSection.find('.pop-pagetab-btn').removeClass('active');pageTabBtn.addClass('active');},savePosition:function(pageSection,tabPane){var t=this;tabPane.data('lastposition',popManager.getPosition(pageSection));tabPane.data('theater',popPageSectionManager.isTheater());},newPageSectionJS:function(pageSection,removeTheather,sides,tabPane){var t=this;sides.each(function(){var sidePageSection=$(this);popPageSectionManager.close(sidePageSection,'xs');})
popBootstrap.closeModals();var pos=0,theater;if(tabPane){pos=tabPane.data('lastposition')||0;theater=tabPane.data('theater')||false;}
popManager.scrollTop(pageSection,pos);if(removeTheather&&!theater){popPageSectionManager.theater(false);}
if(theater){popPageSectionManager.theater(true);}
windowResize();},};})(jQuery);popJSLibraryManager.register(popCustomBootstrap,['initDocument','runScriptsBefore','pageSectionNewDOMsInitialized','activeTabLink','isHidden'],true);popJSLibraryManager.register(popCustomBootstrap,['customQuickView','destroyPageOnModalClose','customCloseModals','activatePageTab']);;(function($){popSystem={documentInitialized:function(){var t=this;t.links();},activeLinks:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;var settings=popManager.getFetchPageSectionSettings(pageSection);if(settings.activeLinks){var feedback=popManager.getTopLevelFeedback();var parentPageId=feedback[M.URLPARAM_PARENTPAGEID];if(parentPageId){targets.find('.menu-item-object-id-'+parentPageId).each(function(){var menuItem=$(this);menuItem.addClass('active');menuItem.parents('.menu-item').addClass('active');});}}},fullscreen:function(args){var t=this;var targets=args.targets;$(document).bind("fullscreenchange",function(){var glyphicon=targets.find('.glyphicon');if($(document).fullScreen()){glyphicon.removeClass('glyphicon-fullscreen').addClass('glyphicon-resize-small');}
else{glyphicon.addClass('glyphicon-fullscreen').removeClass('glyphicon-resize-small');}});targets.click(function(e){e.preventDefault();var button=$(this);var fullScreen=button.closest('.pop-fullscreen');fullScreen.toggleFullScreen();});},newWindow:function(args){var t=this;var targets=args.targets;targets.click(function(e){e.preventDefault();window.open(popManager.getUnembedUrl(window.location.href),'_blank');});},clickURLParam:function(args){var t=this;var url=getParam(M.URLPARAM_URL);if(url){$(document).ready(function($){popManager.click(decodeURIComponent(url));});}},initDelegatorFilter:function(args){var t=this;var delegatorPageSection=args.pageSection,targets=args.targets;targets.submit(function(e){e.preventDefault();var form=$(this);if(form.data('blocktarget')){var block=$(form.data('blocktarget'));var pageSection=popManager.getPageSection(block);if(popManager.isBlockGroup(block)){t.filterBlockGroup(pageSection,block,form);}
else{popManager.filter(pageSection,block,form);}
popPageSectionManager.close(delegatorPageSection,'xs');}});},initBlockFilter:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.submit(function(e){e.preventDefault();var form=$(this);if(form.data('blocktarget')){block=$(form.data('blocktarget'));pageSection=popManager.getPageSection(block);}
popManager.filter(pageSection,block,form);});},initBlockGroupFilter:function(args){var t=this;var pageSection=args.pageSection,blockGroup=args.block,targets=args.targets;targets.each(function(e){var filter=$(this);blocks.each(function(){var block=$(this);popManager.setFilterBlockParams(pageSection,block,filter);});});targets.submit(function(e){e.preventDefault();var filter=$(this);t.filterBlockGroup(pageSection,blockGroup,filter);});},reloadBlockGroup:function(args){var t=this;var pageSection=args.pageSection,blockGroup=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var activeBlock=popManager.getBlockGroupActiveBlock(blockGroup);popManager.reload(pageSection,activeBlock);});},reloadBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();popManager.reload(pageSection,block);});},loadLatestBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();popManager.loadLatest(pageSection,block);});},timeoutLoadLatestBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var target=$(this);var time=target.data('clicktime')||30000;t.execTimeoutLoadLatestBlock(pageSection,block,target,time);});},displayBlockDatasetCount:function(args){var t=this;var pageSection=args.pageSection,block=args.block;if(block.data('datasetcount-target')){var jsSettings=popManager.getJsSettings(pageSection,block);var when=jsSettings['display-datasetcount-when']||['oncreated'];var updateTitle=jsSettings['datasetcount-updatetitle'];if(when.indexOf('oncreated')>-1){$(document).ready(function($){var target=$(block.data('datasetcount-target'));popManager.displayDatasetCount(pageSection,block,target,updateTitle);});}
if(when.indexOf('onrendered')>-1){block.on('rendered',function(e){var target=$(block.data('datasetcount-target'));popManager.displayDatasetCount(pageSection,block,target,updateTitle);});}}},clearDatasetCount:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var link=$(this);var target=$(link.data('datasetcount-target'));var updateTitle=link.data('datasetcount-updatetitle')?true:false;link.click(function(e){e.preventDefault();t.execClearDatasetCount(target,updateTitle);});link.hover(function(){t.execClearDatasetCount(target,updateTitle);});});},clearDatasetCountOnUserLoggedOut:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var link=$(this);var target=$(link.data('datasetcount-target'));var updateTitle=link.data('datasetcount-updatetitle')?true:false;$(document).on('user:loggedout',function(e){t.execClearDatasetCount(target,updateTitle);});});},onDestroyPageSwitchTab:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var link=$(this);var pageSectionPage=popManager.getPageSectionPage(link);pageSectionPage.on('destroy',function(){t.switchTab(link);})})},closePageTab:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var link=$(this);var url=link.data('url')||popManager.getBlock(link).data('paramsscope-url');var target=link.attr('target')||popManager.getFrameTarget(pageSection);popManager.triggerDestroyTarget(url,target);});},resetOnSuccess:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;var pssId=popManager.getSettingsId(pageSection);targets.on('fetched',function(e,response){var block=$(this);var bsId=popManager.getSettingsId(block);var blockFeedback=response.feedback.block[pssId][bsId];if(blockFeedback.result===true){popManager.reset(pageSection,block,{'skip-restore':true});}});},resetOnUserLogout:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;$(document).on('user:loggedout',function(e,source){targets.each(function(){var block=$('#'+$(this).attr('id'));if(block.length){popManager.reset(pageSection,block);}});});},destroyPageOnSuccess:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;var pssId=popManager.getSettingsId(pageSection);targets.on('fetched',function(e,response){var block=$(this);var bsId=popManager.getSettingsId(block);var blockFeedback=response.feedback.block[pssId][bsId];var target=popManager.getFrameTarget(pageSection);if(blockFeedback.result===true){var destroyTime=block.data('destroytime')||0;setTimeout(function(){popManager.triggerDestroyTarget(block.data('paramsscope-url'),target);},destroyTime);}});},destroyPageOnUserLoggedOut:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;pageSection.one('completed',function(){t.execDestroyPageOnUserLoggedOut(targets);});},destroyPageOnUserNoRole:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;pageSection.one('completed',function(){t.execDestroyPageOnUserNoRole(pageSection,targets);});},refetchBlockOnUserLoggedIn:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;$(document).one('user:loggedin',function(e,source){if(source=='initialfeedback'){return;}
t.execRefetchBlock(pageSection,targets);});},nonendingRefetchBlockOnUserLoggedIn:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;t.execNonendingRefetchBlockOnUserEvent(pageSection,targets,'user:loggedin');},nonendingRefetchBlockOnUserLoggedInOut:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;t.execNonendingRefetchBlockOnUserEvent(pageSection,targets,'user:loggedinout');},deleteBlockFeedbackValueOnUserLoggedInOut:function(args){var t=this;var pageSection=args.pageSection,block=args.block;$(document).on('user:loggedinout',function(e,source){if(source=='initialfeedback'||source=='initialuserdata'){return;}
var jsSettings=popManager.getJsSettings(pageSection,block);var keys=jsSettings['user:loggedinout-deletefeedbackvalue']||[];if(keys.length){var blockFeedback=popManager.getBlockFeedback(pageSection,block);$.each(keys,function(index,keyLevels){var feedbackLevel=blockFeedback;for(i=0;i<(keyLevels.length)-1;i++){feedbackLevel=feedbackLevel[keyLevels[i]];}
delete feedbackLevel[keyLevels[(keyLevels.length)-1]];});}});},scrollTopOnUserLoggedInOut:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;$(document).on('user:loggedinout',function(e,source){if(source=='initialfeedback'||source=='initialuserdata'){return;}
targets.each(function(){var target=$(this);var jsSettings=popManager.getJsSettings(pageSection,block,target);var animate=jsSettings['scrolltop-animate']||false;popManager.scrollToElem(target,target,animate);});});},refetchBlockGroupOnUserLoggedIn:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;$(document).one('user:loggedin',function(e,source){if(source=='initialfeedback'){return;}
targets.each(function(){var blockGroup=$('#'+$(this).attr('id'));if(blockGroup.length){var blocks=popManager.getBlockGroupBlocks(blockGroup);var activeBlock=popManager.getBlockGroupActiveBlock(blockGroup);blocks.each(function(){var block=$(this);if(block.attr('id')==activeBlock.attr('id')){t.refetchBlock(pageSection,block);}
else{t.makeOneTimeRefetch(pageSection,block);}});}});});},closeMessageFeedbacksOnPageSectionOpen:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;popPageSectionManager.getGroup(pageSection).on('on.bs.pagesection-group:pagesection-'+pageSection.attr('id')+':opened',function(){popManager.closeMessageFeedbacks(pageSection);});},closePageSectionOnSuccess:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;var pssId=popManager.getSettingsId(pageSection);targets.on('fetched',function(e,response){var block=$(this);var bsId=popManager.getSettingsId(block);var blockFeedback=response.feedback.block[pssId][bsId];if(blockFeedback.result===true){var closeTime=block.data('closetime')||0;t.timeoutClosePageSection(pageSection,closeTime);}});},destroyPage:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var link=$(this);var pageSectionPage=$(link.data('target'));popManager.destroyPageSectionPage(pageSection,pageSectionPage);});},replicateTopLevel:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var link=$(this);var type=link.data('replicate-type');if(type==M.REPLICATETYPES.MULTIPLE){t.replicateMultipleTopLevel(pageSection,link);}
else if(type==M.REPLICATETYPES.SINGLE){t.replicateSingleTopLevel(pageSection,link);}});},replicatePageSection:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var link=$(this);var type=link.data('replicate-type');if(type==M.REPLICATETYPES.MULTIPLE){t.replicateMultiplePageSection(pageSection,link);}
else if(type==M.REPLICATETYPES.SINGLE){t.replicateSinglePageSection(pageSection,link);}});},closePageSection:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();popPageSectionManager.close(pageSection);});},closePageSectionOnTabShown:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var block=$(this);var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.on('shown.bs.tabpane',function(){popPageSectionManager.close(pageSection);});popPageSectionManager.close(pageSection);});},initFilter:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var filter=$(this);popManager.setFilterBlockParams(pageSection,block,filter);});},interceptForm:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var link=$(this);var form=$(link.data('target'));var params=splitParams(link.data('post-data'));$.each(params,function(key,value){form.find('input[name="'+key+'"]').val(value);});form.submit();});},forms:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;var pssId=popManager.getSettingsId(pageSection);var bsId=popManager.getSettingsId(block);targets.submit(function(e){e.preventDefault();var form=$(this);form.triggerHandler('beforeSubmit');popManager.fetchBlock(pageSection,block,{type:'POST',"post-data":form.serialize()});popManager.blockScrollTop(pageSection,block);});block.on('fetched',function(e,response){var blockFeedback=response.feedback.block[pssId][bsId];if(blockFeedback.result===true){targets.triggerHandler('clear');}
popManager.maybeRedirect(blockFeedback);});},clearInput:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var input=$(this);input.closest('form').on('clear',function(){input.val('');});});},makeAlwaysRefetchBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block;block.on('visible',function(){var block=$(this);t.refetchBlock(pageSection,block);});},filterBlockGroup:function(pageSection,blockGroup,filter){var t=this;var activeBlock=popManager.getBlockGroupActiveBlock(blockGroup);var blocks=popManager.getBlockGroupBlocks(blockGroup);blocks.each(function(){var block=$(this);popManager.setFilterBlockParams(pageSection,block,filter);if(block.attr('id')==activeBlock.attr('id')){popManager.reload(pageSection,block);}
else{t.makeOneTimeRefetch(pageSection,block);}});},execClearDatasetCount:function(target,updateTitle){var t=this;target.html('').addClass('hidden');if(updateTitle){document.title=popManager.documentTitle;}},execTimeoutLoadLatestBlock:function(pageSection,block,target,time){var t=this;var jsSettings=popManager.getJsSettings(pageSection,block,target);var options={'skip-status':true,'datasetcount-target':jsSettings['datasetcount-target'],'datasetcount-updatetitle':jsSettings['datasetcount-updatetitle'],};var onlyLoggedIn=jsSettings['only-loggedin']||false;if(onlyLoggedIn&&!popUserAccount.isLoggedIn()){$(document).one('user:loggedin',function(e,source){t.execTimeoutLoadLatestBlock(pageSection,block,target,time);});return;}
setTimeout(function(){if($('#'+target.attr('id')).length){popManager.loadLatest(pageSection,block,options);t.execTimeoutLoadLatestBlock(pageSection,block,target,time);}},time);},timeoutClosePageSection:function(pageSection,closeTime){var t=this;setTimeout(function(){popPageSectionManager.close(pageSection);popManager.closeMessageFeedbacks(pageSection);},closeTime);},execNonendingRefetchBlockOnUserEvent:function(pageSection,targets,handler){var t=this;$(document).on(handler,function(e,source){if(source=='initialfeedback'||source=='initialuserdata'){return;}
t.execRefetchBlock(pageSection,targets);});},execRefetchBlock:function(pageSection,blocks){var t=this;blocks.each(function(){var block=$('#'+$(this).attr('id'));if(block.length){t.refetchBlock(pageSection,block);}});},execDestroyPageOnUserLoggedOut:function(targets){var t=this;$(document).one('user:loggedout',function(e,source){targets.each(function(){var block=$('#'+$(this).attr('id'));if(block.length){var pageSection=popManager.getPageSection(block);var target=popManager.getFrameTarget(pageSection);popManager.triggerDestroyTarget(block.data('paramsscope-url'),target);}});});},execDestroyPageOnUserNoRole:function(pageSection,block){var t=this;var neededRole=block.data('neededrole');$(document).one('user:updated',function(e,updates){block=$('#'+block.attr('id'));if(block.length){if(updates.roles&&updates.roles.indexOf(neededRole)==-1){var target=popManager.getFrameTarget(pageSection);popManager.triggerDestroyTarget(block.data('paramsscope-url'),target);}
else{t.execDestroyPageOnUserNoRole(pageSection,block);}}});},switchTab:function(link){var t=this;if(link.prev('a.pop-pagetab-btn').hasClass('active')){var current=popManager.getPageSectionPage(link);var next=current.nextAll('.pop-pagesection-page').first();if(!next.length){next=current.prevAll('.pop-pagesection-page').first();}
if(next.length){next.find('a.pop-pagetab-btn').trigger('click');}}},replicateMultipleTopLevel:function(pageSection,targets){var t=this;targets.click(function(e){e.preventDefault();var link=$(this);var addUniqueId=link.data('unique-url')||false;t.execReplicateTopLevel(pageSection,link,true,addUniqueId);});},replicateSingleTopLevel:function(pageSection,targets){var t=this;targets.one('click',function(e){e.preventDefault();var link=$(this);t.execReplicateTopLevel(pageSection,link,false,false);});},execReplicateTopLevel:function(pageSection,link,generateUniqueId,addUniqueId){var t=this;var memory=popManager.getMemory();var interceptUrl=link.data('intercept-url');var target=popManager.getFrameTarget(pageSection);var replicableMemory=popManager.getReplicableMemory(interceptUrl,target);memory.feedback.toplevel=$.extend({},replicableMemory.feedback.toplevel);var url=link.data('original-url');if(generateUniqueId){popManager.generateUniqueId();if(addUniqueId){url=popManager.addUniqueId(url);}}
var title=link.data('title');var tlFeedback=popManager.getTopLevelFeedback();tlFeedback[M.URLPARAM_TITLE]=title;tlFeedback[M.URLPARAM_PARENTPAGEID]=null;tlFeedback[M.URLPARAM_URL]=url;popManager.maybeUpdateDocument(pageSection);},replicateMultiplePageSection:function(pageSection,targets){var t=this;targets.click(function(e){e.preventDefault();var link=$(this);t.execReplicatePageSection(pageSection,link);});},replicateSinglePageSection:function(pageSection,targets){var t=this;targets.one('click',function(e){e.preventDefault();var link=$(this);t.execReplicatePageSection(pageSection,link);});},execReplicatePageSection:function(pageSection,link){var t=this;var bsId=link.data('block-settingsid');var pssId=popManager.getSettingsId(pageSection);var template=link.data('templateid');var memory=popManager.getMemory();var interceptUrl=link.data('intercept-url');var target=popManager.getFrameTarget(pageSection);var replicableMemory=popManager.getReplicableMemory(interceptUrl,target);$.extend(memory.feedback.pagesection,replicableMemory.feedback.pagesection);$.each(replicableMemory.feedback.block,function(ipssId,ipsFeedback){$.extend(memory.feedback.block[ipssId],ipsFeedback);$.extend(memory.dataset[ipssId],replicableMemory.dataset[ipssId]);$.extend(memory.params[ipssId],replicableMemory.params[ipssId]);});var tlFeedback=popManager.getTopLevelFeedback();var psFeedback=popManager.getPageSectionFeedback(pageSection);var psConfiguration=popManager.getPageSectionConfiguration(pageSection);if(!psFeedback['intercept-urls'][template]){psFeedback['intercept-urls'][template]={};}
psFeedback['intercept-urls'][template][template]=tlFeedback[M.URLPARAM_URL];psConfiguration[M.JS_TEMPLATE]=template;var blockSettingsIds={};link.next('.pop-interceptor-blocksettingsids').children().each(function(){var settingElem=$(this);var val=settingElem.data('value');if(settingElem.data('value')){val=[settingElem.data('value')];}
else{val=[];}
blockSettingsIds[settingElem.data('key')]=val;});psConfiguration[M.JS_BLOCKSETTINGSIDS]=blockSettingsIds;popManager.initPageSectionSettings(pageSection,psConfiguration);var options={'js-args':{relatedTarget:link},url:tlFeedback[M.URLPARAM_URL]}
popManager.renderPageSection(pageSection,options);},refetchBlock:function(pageSection,block){var t=this;var options={'post-data':block.data('post-data'),'show-disabled-layer':true};popManager.refetch(pageSection,block,options);},makeOneTimeRefetch:function(pageSection,block){var t=this;if(!popManager.jsInitialized(block)||!popManager.isContentLoaded(pageSection,block)){return;}
block.one('visible',function(){var block=$(this);t.refetchBlock(pageSection,block);});},linkBlankTarget:function(anchor){var t=this;if(!anchor.attr('target')){anchor.attr('target','_blank');}},maybeaddspinner:function(anchor,url){var t=this;var addspinner=!anchor.hasClass('hidden')&&((M.ADDANCHORSPINNER&&(typeof anchor.data('addspinner')=='undefined')||anchor.data('addspinner')));if(addspinner){var spinner=$('<span class="pop-spinner">'+M.SPINNER+'</span>');if(anchor.find('img').length){spinner.addClass('spinner-img');}
$(document).one('urlfetched:'+escape(url),function(){anchor.removeClass('loading').children('.pop-spinner').remove();});anchor.trigger('blur').addClass('loading').prepend(spinner);}
return addspinner;},links:function(){var t=this;var imgRegex=new RegExp(/\.(gif|jpg|jpeg|tiff|png)$/i);var otherRegex=new RegExp(/\.(pdf|css|js|zip|tar|ppt|pptx|doc|docx|xls|xlsx)$/i);var allowedAnchors=[];$.each(M.ALLOWED_URLS,function(index,domain){allowedAnchors.push('a[href^="'+domain+'"]');});$(document).on('click',allowedAnchors.join(','),function(e){var anchor=$(this);var url=anchor.attr('href');if(imgRegex.test(url)){var method='linksImage';if(popJSLibraryManager.getLibraries(method).length){e.preventDefault();var args={anchor:anchor}
popJSLibraryManager.execute(method,args);}
else{t.linkBlankTarget(anchor);}}
else if(otherRegex.test(url)){t.linkBlankTarget(anchor);}
else{popCustomBootstrap.resetBubbling();var pageSection=popManager.getPageSection(anchor);var target=anchor.attr('target')||M.URLPARAM_TARGET_MAIN;if(target==M.URLPARAM_TARGET_FULL){e.preventDefault();t.maybeaddspinner(anchor,url);window.location=url;return;}
if(target==M.URLPARAM_TARGET_PRINT){e.preventDefault();t.openPrint(url);return;}
if(popManager.targetExists(target)){e.preventDefault();if(url==M.HOME_URL){url=M.HOME_URL+'/';}
var intercept=false,options={},interceptOptions={};if(anchor.data('reloadurl')){options.reloadurl=true;}
else{var interceptTarget=anchor.attr('target')||popManager.getClickFrameTarget(pageSection);interceptOptions={event:e,relatedTarget:anchor,target:interceptTarget,};var interceptUrl=url;if(anchor.data('append-intercepturl')){interceptUrl+=anchor.data('append-intercepturl');}
intercept=popURLInterceptors.getInterceptors(interceptUrl,interceptOptions).length;}
if(intercept){popURLInterceptors.intercept(interceptUrl,interceptOptions);}
else{options.target=target;options['js-args']={relatedTarget:anchor};var addspinner=t.maybeaddspinner(anchor,url);var loadingmsg_target=addspinner?'':null;if(typeof anchor.data('loadingmsg-target')!='undefined'){loadingmsg_target=anchor.data('loadingmsg-target');}
if(loadingmsg_target!=null){options['loadingmsg-target']=loadingmsg_target;}
popManager.fetch(url,options);}}}});$(document).on('click','a[target="'+M.URLPARAM_TARGET_SOCIALMEDIA+'"]',function(e){e.preventDefault();var anchor=$(this);var url=anchor.attr('href');t.openSocialMedia(url);});$(document).on('click','a[href^="#"]',function(e){var anchor=$(this);var url=anchor.attr('href');if(url.length>1){var elem=$(url);var bootstrap=typeof anchor.data('toggle')!=='undefined'||typeof anchor.data('slide')!=='undefined';if(elem.length&&!bootstrap){e.preventDefault();popManager.scrollToElem(popManager.getPageSection(elem),elem,true);}}});$(document).on('click','a[href^="http://"],a[href^="https://"]',function(e){var anchor=$(this);var url=anchor.attr('href');var openblank=true;$.each(M.ALLOWED_URLS,function(index,domain){if(url.startsWith(domain)){openblank=false;return-1;}});if(openblank){t.linkBlankTarget(anchor);}});},openPrint:function(url){window.open(url,'_blank');},openSocialMedia:function(url){window.open(url,'_blank','left=20,top=20,width=500,height=400,toolbar=1,resizable=0');},scrollHandler:function(args){var t=this;var pageSection=args.pageSection;var lastScrollTop=0,delta=200;pageSection.scroll(function(){var nowScrollTop=$(this).scrollTop();if(Math.abs(lastScrollTop-nowScrollTop)>=delta){if(nowScrollTop>lastScrollTop){$(window).triggerHandler('scroll:down');}
else{$(window).triggerHandler('scroll:up');}
lastScrollTop=nowScrollTop;}});},};})(jQuery);popJSLibraryManager.register(popSystem,['documentInitialized','activeLinks','newWindow','fullscreen','clickURLParam','initDelegatorFilter','initBlockGroupFilter','initBlockFilter','reloadBlockGroup','reloadBlock','loadLatestBlock','timeoutLoadLatestBlock','displayBlockDatasetCount','clearDatasetCount','clearDatasetCountOnUserLoggedOut','replicateTopLevel','replicatePageSection','closePageSection','closePageSectionOnTabShown','onDestroyPageSwitchTab','closePageTab','resetOnSuccess','resetOnUserLogout','closeMessageFeedbacksOnPageSectionOpen','closePageSectionOnSuccess','destroyPageOnUserLoggedOut','destroyPageOnUserNoRole','refetchBlockOnUserLoggedIn','nonendingRefetchBlockOnUserLoggedIn','nonendingRefetchBlockOnUserLoggedInOut','deleteBlockFeedbackValueOnUserLoggedInOut','scrollTopOnUserLoggedInOut','refetchBlockGroupOnUserLoggedIn','destroyPageOnSuccess','destroyPage','initFilter','interceptForm','forms','clearInput','makeAlwaysRefetchBlock','scrollHandler']);;(function($){popForms={formCreatePostBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block;var pssId=popManager.getSettingsId(pageSection);var bsId=popManager.getSettingsId(block);block.one('fetched',function(e,response){t.execFormCreatePostBlock(pageSection,block,response);});},manageStatus:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;t.execManageStatus(targets);var pssId=popManager.getSettingsId(pageSection);var bsId=popManager.getSettingsId(block);block.on('fetched',function(e,response){var blockFeedback=response.feedback.block[pssId][bsId];if(blockFeedback.result===true){t.execManageStatus(targets);}});},execFormCreatePostBlock:function(pageSection,block,response){var t=this;var pssId=popManager.getSettingsId(pageSection);var bsId=popManager.getSettingsId(block);var blockFeedback=response.feedback.block[pssId][bsId];if(blockFeedback.result===true){popSystem.execDestroyPageOnUserLoggedOut(block);}
else{block.one('fetched',function(e,response){t.execFormCreatePostBlock(pageSection,block,response);});}},execManageStatus:function(targets){var t=this;targets.each(function(){var input_status=$(this);if(input_status.val()==M.POSTSTATUS.PUBLISH){input_status.find('option[value="'+M.POSTSTATUS.PENDING+'"]').attr('disabled','disabled');input_status.find('option[value="'+M.POSTSTATUS.PUBLISH+'"]').attr('disabled',false);}
else{input_status.find('option[value="'+M.POSTSTATUS.PUBLISH+'"]').attr('disabled','disabled');input_status.find('option[value="'+M.POSTSTATUS.PENDING+'"]').attr('disabled',false);}});},};})(jQuery);popJSLibraryManager.register(popForms,['formCreatePostBlock','manageStatus']);;(function($){popEditor={editor:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;block.one('rerender',function(action){t.destroy(targets);});var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.one('destroy',function(){t.destroy(targets);});targets.each(function(){var editor=$(this).find('.pop-editor');var editorId=editor.attr('id');editor.closest('form').on('beforeSubmit',function(){if(tinymce.get(editorId)){tinymce.get(editorId).save();}});});targets.filter('.pop-editor-form-clear').each(function(){var editor=$(this).find('.pop-editor');var editorId=editor.attr('id');editor.closest('form').on('clear',function(){if(tinymce.get(editorId)){tinymce.get(editorId).setContent('');}});});if(!POP_CACHED_SETTINGS&&popManager.isFirstLoad(pageSection)){return;}
$(document).ready(function($){targets.each(function(){var editor=$(this).find('.pop-editor');var editorId=editor.attr('id');var settings=tinyMCEPreInit.mceInit[M.TEMPLATE_EDITOR_NAME];if(editor.hasClass('pop-editor-autofocus')){settings=$.extend({},settings,{auto_focus:editorId});}
tinyMCE.init(settings);tinymce.execCommand('mceAddEditor',true,editorId);var qtOptions=$.extend({},tinyMCEPreInit.qtInit[M.TEMPLATE_EDITOR_NAME],{id:editorId});quicktags(qtOptions);if(!window.wpActiveEditor){window.wpActiveEditor=editorId;}
if(typeof jQuery!=='undefined'){editor.closest('.wp-editor-wrap').on('click.wp-editor',function(){if(this.id){window.wpActiveEditor=this.id.slice(3,-5);}});}else{document.getElementById('wp-'+editorId+'-wrap').onclick=function(){window.wpActiveEditor=this.id.slice(3,-5);}}});});},destroy:function(targets){var t=this;targets.each(function(){var editor=$(this).find('.pop-editor');var editorId=editor.attr('id');tinymce.execCommand('mceRemoveEditor',false,editorId);});}};})(jQuery);popJSLibraryManager.register(popEditor,['editor']);;(function($){popMentions={previousData:{},documentInitialized:function(){var t=this;t.prefetch();},prefetch:function(){var t=this;$.each(M.MENTIONS.TYPES,function(delimiter,settings){t.fetchData(delimiter,settings.baseline);});},fetchData:function(delimiter,url,process){var t=this;var stored=popManager.getStoredData(url);if(stored){t.processData(delimiter,stored,process);}
else{$.getJSON(url,function(data){var ttl=86400000;popManager.storeData(url,data,ttl);t.processData(delimiter,data,process);});}},processData:function(delimiter,data,process){var t=this;t.previousData[delimiter]=data;if(process){process(data);}},source:function(query,process,delimiter){var t=this;if(M.MENTIONS.TYPES[delimiter]){var url;if(query){url=M.MENTIONS.TYPES[delimiter].url.replace(M.MENTIONS.QUERYWILDCARD,query);}
else{url=M.MENTIONS.TYPES[delimiter].baseline;}
if(url){var previousData=t.previousData[delimiter]||[];process(previousData);t.fetchData(delimiter,url,process);}}},render:function(item){var t=this;var delimiter=t.infereDelimiter(item);var html=popManager.getHtml(M.MENTIONS.TYPES[delimiter].template,item);return'<li><a href="javascript:;"><span>'+html+'</span></a></li>';},insert:function(item){var t=this;var delimiter=t.infereDelimiter(item);return'<span>'+delimiter+item[M.MENTIONS.TYPES[delimiter].key]+'</span>&nbsp;';},infereDelimiter:function(item){var t=this;var ret='';$.each(M.MENTIONS.TYPES,function(delimiter,settings){if(typeof item[settings.key]!='undefined'){ret=delimiter;return-1;}});return ret;},};})(jQuery);popJSLibraryManager.register(popMentions,['documentInitialized']);function mentions_source(query,process,delimiter){popMentions.source(query,process,delimiter);}
function mentions_insert(item){return popMentions.insert(item);}
function mentions_render(item){return popMentions.render(item);};(function($){popFeaturedImage={frame:null,documentInitialized:function(){var t=this;t.frame=wp.media({title:M.LABELS.MEDIA_FEATUREDIMAGE_TITLE,multiple:false,library:{type:'image'},button:{text:M.LABELS.MEDIA_FEATUREDIMAGE_BTN}});t.frame.on('open',function(){var featuredImage=$('.pop-featuredimage.open');var selected=featuredImage.find('input[type="hidden"]');if(selected.val()){var selection=t.frame.state().get('selection');attachment=wp.media.attachment(selected.val());attachment.fetch();selection.add(attachment?[attachment]:[]);}});t.frame.on('close',function(){var featuredImage=$('.pop-featuredimage.open');var configuration={};var selection=t.frame.state().get('selection');if(selection.length){var value,imgsrc;var imgSize=featuredImage.data('img-size');selection.map(function(attachment){attachment=attachment.toJSON();var imgData=attachment.sizes[imgSize]||attachment.sizes['medium']||attachment.sizes['thumbnail'];value=attachment.id;imgsrc={src:imgData.url,width:imgData.width,height:imgData.height};});var block=popManager.getBlock(featuredImage);var pageSection=popManager.getPageSection(block);t.merge(pageSection,block,featuredImage,value,imgsrc);}
featuredImage.removeClass('open');});},featuredImageSet:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var button=$(this);var featuredImage=button.closest('.pop-featuredimage');featuredImage.addClass('open');t.frame.open();});},featuredImageRemove:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var button=$(this);var featuredImage=button.closest('.pop-featuredimage');t.remove(pageSection,block,featuredImage);});},merge:function(pageSection,block,featuredImage,value,imgsrc){var t=this;var options={extendContext:{value:value,img:imgsrc}}
var template=featuredImage.data('merge-template');popManager.mergeTargetTemplate(pageSection,block,template,options);popManager.runJSMethods(pageSection,block,template,'full');},remove:function(pageSection,block,featuredImage){var t=this;t.merge(pageSection,block,featuredImage,'','');}};})(jQuery);popJSLibraryManager.register(popFeaturedImage,['documentInitialized','featuredImageSet','featuredImageRemove']);;(function($){popUserAccount={initialuserdata:false,loggedin:false,id:null,name:'',avatar:'',url:'',roles:[],userattributes:[],documentInitialized:function(){var t=this;t.checkpointInvalidateBlocks();if(t.initialuserdata){t.fetchLoggedInUserData();}},pageSectionInitialized:function(args){var t=this;var pageSection=args.pageSection;pageSection.on('fetched',function(e,options,url){t.feedbackLoginOut(false);});},blockInitialized:function(args){var t=this;var pageSection=args.pageSection,block=args.block;block.on('fetched',function(e){t.feedbackLoginOut(false);});},loadAvatar:function(args){var t=this;var targets=args.targets;targets.attr('src',t.avatar);},initialLogin:function(){var t=this;feedbackAvailable=t.feedbackLoginOut(true);t.initialuserdata=!feedbackAvailable;},fetchLoggedInUserData:function(options){var t=this;options=options||{};options['loadingmsg-target']=M.USERLOGGEDIN_LOADINGMSG_TARGET;options.silentDocument=true;popManager.fetch(M.USERLOGGEDIN_DATA_PAGEURL,options);},isLoggedIn:function(){var t=this;return t.loggedin;},updateUserInfo:function(id,name,avatar,url,roles,userattributes){var t=this;var updates={};if(t.name!=name){t.name=name;$('.pop-user-name').text(t.name);updates.name=t.name;}
if(t.id!=id||t.avatar!=avatar){t.id=id;t.avatar=avatar;$('.pop-user-avatar').attr('src',t.avatar);updates.avatar=t.avatar;}
if(t.url!=url){t.url=url;$('.pop-user-url').attr('href',t.url);updates.url=t.url;}
var eq_roles=$(t.roles).not(roles).length===0&&$(roles).not(t.roles).length===0;if(!eq_roles){t.roles=roles;$.each(M.ROLES,function(index,role){$('body').removeClass(role);});$.each(t.roles,function(index,role){$('body').addClass(role);});updates.roles=t.roles;}
var eq_userattributes=$(t.userattributes).not(userattributes).length===0&&$(userattributes).not(t.userattributes).length===0;if(!eq_userattributes){t.userattributes=userattributes;$.each(M.USERATTRIBUTES,function(index,userattribute){$('body').removeClass(userattribute);});$.each(t.userattributes,function(index,userattribute){$('body').addClass(userattribute);});updates.userattributes=t.userattributes;}
if(!$.isEmptyObject(updates)){updates.id=id;$(document).triggerHandler('user:updated',[updates]);}},loginout:function(source,loggedin,id,name,avatar,url,roles,userattributes){var t=this;t.updateUserInfo(id,name,avatar,url,roles,userattributes);if(t.loggedin!=loggedin){t.loggedin=loggedin;var name,body=$('body');if(t.loggedin){body.data('loggedinuser-id',id).addClass('loggedin user-'+id);name='user:loggedin';}
else{body.removeClass('loggedin').removeClass('user-'+body.data('loggedinuser-id')).data('loggedinuser-id','');name='user:loggedout';}
if(source!='initialfeedback'){t.closeCheckpointMessages();}
$(document).triggerHandler(name,[source]);$(document).triggerHandler('user:loggedinout',[source]);}},feedbackLoginOut:function(initial){var t=this;var topLevelFeedback=popManager.getTopLevelFeedback();var userInfo=topLevelFeedback[M.DATALOAD_USER];if(typeof userInfo!='undefined'){var loggedin,id,name,avatar,url;loggedin=userInfo[M.DATALOAD_USER_LOGGEDIN];id=userInfo[M.DATALOAD_USER_ID];name=userInfo[M.DATALOAD_USER_NAME];avatar=userInfo[M.DATALOAD_USER_AVATAR];url=userInfo[M.DATALOAD_USER_URL];roles=userInfo[M.DATALOAD_USER_ROLES];userattributes=userInfo[M.DATALOAD_USER_ATTRIBUTES];var source='feedback';if(initial){source='initialfeedback';}
else if(t.initialuserdata){source='initialuserdata';t.initialuserdata=false;}
t.loginout(source,loggedin,id,name,avatar,url,roles,userattributes);return true;}
return false;},checkpointInvalidateBlocks:function(){var t=this;$(document).on('user:loggedin',function(e,source){if(source=='initialfeedback'||source=='initialuserdata'){return;}
t.closeCheckpointMessages();});},closeCheckpointMessages:function(){var t=this;jQuery(document).ready(function($){$('.alert.in.pop-messagefeedback.checkpoint').removeClass('fade').alert('close');});},};})(jQuery);popJSLibraryManager.register(popUserAccount,['documentInitialized','pageSectionInitialized','blockInitialized','loadAvatar']);;(function($){popBootstrap={modal:function(args){var t=this;var targets=args.targets;targets.on('show.bs.modal',function(e){var modal=$(this);var link=$(e.relatedTarget);link=popManager.getOriginalLink(link);var modalHeader=link.data('header')||'';modal.find('.modal-header .pop-box').html(modalHeader);});},closeModals:function(){var t=this;$('.modal.in').modal('hide');},showingModal:function(modal){var t=this;return modal.hasClass('in');},popover:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;t.execPopover(pageSection,block,targets);},contentPopover:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;t.execPopover(pageSection,block,targets.find('a[data-popover-target]'));},tooltip:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;jQuery(document).ready(function($){var pageSectionPage=popManager.getPageSectionPage(targets);pageSectionPage.one('destroy',function(){targets.tooltip('destroy');});targets.each(function(){var tooltip=$(this);var container=popManager.getDOMContainer(pageSection,tooltip);var containerTarget='#'+container.attr('id');var options={placement:tooltip.data('tooltip-placement')||"top",title:tooltip.attr('title'),container:containerTarget,};tooltip.tooltip(options);});});},openParentCollapse:function(args){var t=this;var targets=args.targets;t.execOpenParentCollapse(targets);},alertCloseOnTimeout:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;var closeTime=targets.data('closetime')||3000;targets.data('close',true);targets.mouseenter(function(){targets.data('close',null);targets.addClass('hover');})
targets.mouseleave(function(){targets.data('close',true);t.execAlertCloseOnTimeout(targets,closeTime);targets.removeClass('hover');})
t.execAlertCloseOnTimeout(targets,closeTime);},execOpenParentCollapse:function(targets){var t=this;targets.closest('.collapse').not('.in').collapse('show');},execPopover:function(pageSection,block,targets){var t=this;jQuery(document).ready(function($){var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.one('destroy',function(){targets.popover('destroy');});var container=popManager.getDOMContainer(pageSection,block);var containerTarget='#'+container.attr('id');var options={animation:false,html:true,trigger:'manual focus',placement:'auto',delay:{hide:100},container:containerTarget,};targets.each(function(){var popover=$(this);var popoverTarget=$(popover.data('popover-target')).first();if(popoverTarget.length){var content=popoverTarget.html();var blockTarget='#'+popManager.getBlock(popover).attr('id');content='<span data-block="'+blockTarget+'">'+content+'</span>';var popoverOptions=$.extend({},options,{content:content});popover.popover(popoverOptions).on("mouseenter",function(){var _this=this;$(this).popover("show");$(".popover").on("mouseleave",function(){$(_this).popover('hide');});}).on("mouseleave",function(){var _this=this;setTimeout(function(){if(!$(".popover:hover").length){$(_this).popover("hide")}},popoverOptions.delay.hide);});}});});},execAlertCloseOnTimeout:function(targets,closeTime){var t=this;setTimeout(function(){if(targets.data('close')){targets.alert('close');}},closeTime);},scrollTop:function(elem){var t=this;var modal=elem.closest('.modal').addBack('.modal');if(modal.length){modal.animate({scrollTop:0},'fast');return true;}
return false;},};})(jQuery);popJSLibraryManager.register(popBootstrap,['modal','closeModals','popover','contentPopover','tooltip','openParentCollapse','alertCloseOnTimeout']);;(function($){popBootstrapCarousel={carouselStatic:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;t.prepareCarousel(pageSection,block,targets);targets.carousel({interval:false,wrap:false});},carouselAutomatic:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;block.on('beforeReload',function(e){targets.carousel('pause');});t.prepareCarousel(pageSection,block,targets);if(carousel.find('.item.active').length){if(gdBootstrapCarousel.numberSlides(carousel)>=2){if($(window).width()>=768){carousel.carousel();}
else{carousel.carousel({interval:false,wrap:false});}
carousel.find('.pop-carousel-controls').removeClass('hidden');}
else{carousel.find('.pop-carousel-controls').addClass('hidden');}}},prepareCarousel:function(pageSection,block,targets){var t=this;block.on('rendered',function(){t.targetsAddActive(targets);});t.targetsAddActive(targets);},targetsAddActive:function(targets){var t=this;targets.each(function(){var carousel=$(this);t.addActive(carousel);});},addActive:function(carousel){var t=this;if(carousel.find('.item.active').length==0){carousel.find('.item:first-child').addClass('active');}},showElement:function(carousel,elem){var t=this;var slide=elem.closest('.item');var slideNumber=slide.parent().children().index(slide);t.slideTo(carousel,slideNumber);},slideTo:function(carousel,number){var t=this;carousel.carousel(number);},next:function(carousel){var t=this;carousel.carousel('next');},prev:function(carousel){var t=this;carousel.carousel('prev');},isFirstSlide:function(carousel){var t=this;return carousel.find('.item:first-child').hasClass('active');},isLastSlide:function(carousel){var t=this;return carousel.find('.item:last-child').hasClass('active');},isNthSlide:function(carousel,position){var t=this;return carousel.find('.item:nth-child('+position+')').hasClass('active');},isNthLastSlide:function(carousel,position){var t=this;return carousel.find('.item:nth-last-child('+position+')').hasClass('active');},numberSlides:function(carousel){var t=this;return carousel.find('.item').length;},};})(jQuery);(function($){popBootstrapCarouselControls={initBlockRuntimeMemory:function(args){var t=this;var pageSection=args.pageSection,block=args.block,mempage=args.runtimeMempage;mempage.carouselControls={};t.resetBlockRuntimeMemory(pageSection,block);},carouselControls:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;var carousel=t.getCarousel(targets);var controlNext=targets.children('.pop-carousel-control.right');t.controlCarouselNext(pageSection,block,carousel,targets,controlNext);var controlPrev=targets.children('.pop-carousel-control.left');t.controlCarouselPrev(pageSection,block,carousel,targets,controlPrev);block.on('fetchCompleted',function(e){t.handleReload(pageSection,block,targets);});t.setEnabledDisabled(pageSection,block,targets);},getRuntimeMemoryPage:function(pageSection,targetOrId){var t=this;return popManager.getRuntimeMemoryPage(pageSection,targetOrId).carouselControls;},resetBlockRuntimeMemory:function(pageSection,targetOrId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,targetOrId);var empty={state:'',};$.extend(mempage,empty);},slideNext:function(pageSection,block,carousel,controlNext){var t=this;var blockParams=popManager.getBlockParams(pageSection,block);if(popBootstrapCarousel.isNthLastSlide(carousel,2)&&blockParams[M.URLPARAM_STOPFETCHING]){t.disable(controlNext);}
t.enable(controlNext.siblings('.pop-carousel-control.left'));popBootstrapCarousel.next(carousel);},controlCarouselNext:function(pageSection,block,carousel,carouselControls,control){var t=this;var blockParams=popManager.getBlockParams(pageSection,block);control.click(function(e){e.preventDefault();var control=$(this);if(t.disabled(control))return;if(popBootstrapCarousel.isLastSlide(carousel)){if(blockParams.loading.length||blockParams[M.URLPARAM_STOPFETCHING]){return;}
popManager.fetchBlock(pageSection,block,{operation:M.URLPARAM_OPERATION_APPEND});t.setControlState(pageSection,block,'loading');}
else{t.slideNext(pageSection,block,carousel,control);}});},controlCarouselPrev:function(pageSection,block,carousel,carouselControls,control){var t=this;control.click(function(e){e.preventDefault();var control=$(this);if(t.disabled(control))return;if(popBootstrapCarousel.isNthSlide(carousel,2)){t.disable(control);}
if(popBootstrapCarousel.numberSlides(carousel)>1){t.enable(control.siblings('.pop-carousel-control.right'));}
popBootstrapCarousel.prev(carousel);});},handleReload:function(pageSection,block,carouselControls){var t=this;var dataset=popManager.getBlockDataset(pageSection,block);t.setEnabledDisabled(pageSection,block,carouselControls);if(dataset&&dataset.length&&t.getControlState(pageSection,block)=='loading'){var carousel=t.getCarousel(carouselControls);var controlNext=carouselControls.children('.pop-carousel-control.right');t.slideNext(pageSection,block,carousel,controlNext);}
t.setControlState(pageSection,block,'');},getControlState:function(pageSection,block){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);return mempage.state;},setControlState:function(pageSection,block,state){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);mempage.state=state;},getCarousel:function(carouselControls){var t=this;return $(carouselControls.data('target'));},setEnabledDisabled:function(pageSection,block,carouselControls){var t=this;var carousel=t.getCarousel(carouselControls);var controlPrev=carouselControls.children('.pop-carousel-control.left');var controlNext=carouselControls.children('.pop-carousel-control.right');if(popBootstrapCarousel.numberSlides(carousel)==0){t.disable(controlPrev);t.disable(controlNext);}
else{if(popBootstrapCarousel.isFirstSlide(carousel)){t.disable(controlPrev);}
else{t.enable(controlPrev);}
var blockParams=popManager.getBlockParams(pageSection,block);if(popBootstrapCarousel.isLastSlide(carousel)&&blockParams[M.URLPARAM_STOPFETCHING]){t.disable(controlNext);}
else{t.enable(controlNext);}}},disable:function(control){var t=this;control.addClass('disabled');control.attr('disabled',true);},enable:function(control){var t=this;control.removeClass('disabled');control.attr('disabled',false);},disabled:function(control){var t=this;return control.hasClass('disabled');}};})(jQuery);popJSLibraryManager.register(popBootstrapCarousel,['carouselStatic','carouselAutomatic']);popJSLibraryManager.register(popBootstrapCarouselControls,['initBlockRuntimeMemory','controlCarouselPrev','controlCarouselNext','carouselControls']);;(function($){popWaypoints={documentInitialized:function(){var t=this;$(window).on('resized',function(){Waypoint.refreshAll();});},waypointsHistoryStateNew:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;jQuery(document).ready(function($){targets.each(function(){var target=$(this);var opts=t.getOptions(pageSection,target);var waypointUp=new Waypoint({element:target,handler:function(direction){var waypoint=this;var target=this.element;if(popManager.isHidden(target)){return;}
if(direction=='up'){popManager.historyReplaceState($(this));}},context:opts.context,offset:'bottom-in-view'});var waypointDown=new Waypoint({element:target,handler:function(direction){var waypoint=this;var target=this.element;if(popManager.isHidden(target)){return;}
if(direction=='down'){popManager.historyReplaceState($(this));}},context:opts.context});t.destroy(pageSection,block,waypointUp);t.destroy(pageSection,block,waypointDown);});});},waypointsHistoryStateOriginal:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;jQuery(document).ready(function($){targets.each(function(){var target=$(this);var opts=t.getOptions(pageSection,target);var waypoint=new Waypoint({element:target,handler:function(direction){var waypoint=this;var target=this.element;if(popManager.isHidden(target)){return;}
if(direction=='up'){popManager.historyReplaceState(target);}},context:opts.context});t.destroy(pageSection,block,waypoint);});});},waypointsToggleCollapse:function(args){var t=this;var targets=args.targets;jQuery(document).ready(function($){targets.each(function(){var collapse=$(this);var target=$(collapse.data('collapse-target'));if(target.length){var block=popManager.getBlock(target);var pageSection=popManager.getBlock(block);t.execWaypointsToggleCollapse(pageSection,block,target,collapse);}});});},waypointsTheater:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;jQuery(document).ready(function($){targets.each(function(){var target=$(this);var opts=t.getOptions(pageSection,target);var waypoint=new Waypoint({element:target,handler:function(direction){var waypoint=this;var target=this.element;if(popManager.isHidden(target)){return;}
if(direction=='down'){popPageSectionManager.theater(true);}
else if(direction=='up'){popPageSectionManager.theater(false);}},context:opts.context});t.destroy(pageSection,block,waypoint);});});},waypointsFetchMore:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;jQuery(document).ready(function($){var waypoints=[];var contentLoaded=popManager.isContentLoaded(pageSection,block);targets.each(function(){var target=$(this);var opts=t.getOptions(pageSection,target);var waypoint=new Waypoint({element:target,handler:function(direction){var waypoint=this;var target=this.element;if(direction=='down'){if(popManager.isHidden(target)){return;}
target.trigger('click');}},context:opts.context,enabled:contentLoaded,offset:'bottom-in-view'});t.destroy(pageSection,block,waypoint);waypoints.push(waypoint);});block.on('fetchCompleted',function(e){var block=$(this);var blockParams=popManager.getBlockParams(pageSection,block);if(blockParams[M.URLPARAM_STOPFETCHING]){$.each(waypoints,function(index,waypoint){if(waypoint.enabled){waypoint.disable();t.reEnable(pageSection,block,waypoint);}});}
else{$.each(waypoints,function(index,waypoint){if(!waypoint.enabled){waypoint.enable();}
waypoint.context.refresh();});}});});},reEnable:function(pageSection,block,waypoint){var t=this;block.one('beforeReload',function(){block.one('fetchCompleted',function(){var blockParams=popManager.getBlockParams(pageSection,block);if(!blockParams[M.URLPARAM_STOPFETCHING]){waypoint.enable();}
else{t.reEnable(pageSection,block,waypoint);}});});},execWaypointsToggleCollapse:function(pageSection,block,target,collapse){var t=this;var opts=t.getOptions(pageSection,target);var waypoint=new Waypoint({element:target,handler:function(direction){var waypoint=this;var target=this.element;if(popManager.isHidden(target)){return;}
if(direction=='down'){collapse.collapse('show');}
else if(direction=='up'){collapse.collapse('hide');}},context:opts.context});t.destroy(pageSection,block,waypoint);},getOptions:function(pageSection,waypoint){var t=this;var options={};var context=pageSection.filter('.pop-waypoints-context');if(context.length){options.context=context;}
else{context=waypoint.closest('.pop-waypoints-context');if(context.length){options.context=context;}}
return options;},destroy:function(pageSection,block,waypoint){var t=this;var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.one('destroy',function(){waypoint.destroy();});},};})(jQuery);popJSLibraryManager.register(popWaypoints,['documentInitialized','waypointsFetchMore','waypointsToggleCollapse','waypointsTheater','waypointsHistoryStateOriginal','waypointsHistoryStateNew']);;(function($){popWindow={windowSize:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var control=$(this);var target=$(control.data('target'));if(target.length){var action=control.data('toggle');if(action=='window-fullsize'){t.fullsize(target);}
else if(action=='window-maximize'){t.maximize(target);}
else if(action=='window-minimize'){t.minimize(target);}}});},getSize:function(target){var t=this;if(target.hasClass('fullsize')){return'fullsize';}
else if(target.hasClass('maximized')){return'maximized';}
else if(target.hasClass('minimized')){return'minimized';}
return null;},fullsize:function(target){var t=this;target.removeClass('maximized minimized').addClass('fullsize');target.triggerHandler('fullsize.bs.window');},maximize:function(target){var t=this;target.removeClass('fullsize minimized').addClass('maximized');target.triggerHandler('maximized.bs.window');},minimize:function(target){var t=this;target.removeClass('fullsize maximized').addClass('minimized');target.triggerHandler('minimized.bs.window');},};})(jQuery);popJSLibraryManager.register(popWindow,['windowSize']);;(function($){popMultiselect={multiselect:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.one('destroy',function(){targets.multiselect('destroy');});var options={buttonClass:'btn btn-default',buttonContainer:'<div class="btn-group multiselect-btn-group" />',enableHTML:true,nonSelectedText:M.MULTISELECT_NONSELECTEDTEXT,nSelectedText:M.MULTISELECT_NSELECTEDTEXT,allSelectedText:M.MULTISELECT_ALLSELECTEDTEXT};targets.each(function(){var multiselect=$(this);var customOptions=$.extend({},options);if(multiselect.attr('title')){customOptions['nonSelectedText']=multiselect.attr('title');}
if(multiselect.hasClass('input-sm')){customOptions['buttonClass']+=' btn-sm';}
if(multiselect.hasClass('input-lg')){customOptions['buttonClass']+=' btn-lg';}
multiselect.multiselect(customOptions);});}};})(jQuery);popJSLibraryManager.register(popMultiselect,['multiselect']);;(function($){popDynamicMaxHeight={dynamicMaxHeight:function(args){var t=this;var targets=args.targets;targets.dynamicMaxHeight();}};})(jQuery);popJSLibraryManager.register(popDynamicMaxHeight,['dynamicMaxHeight']);;(function($){popDateRange={dateRange:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;var format=M.DATERANGE_FORMAT||'DD/MM/YYYY';var settings={autoApply:true,linkedCalendars:false,showWeekNumbers:false,timePicker:false,buttonClasses:['btn'],applyClass:'btn-success',cancelClass:'btn-warning',format:format,separator:M.DATERANGE_SEPARATOR,locale:{applyLabel:M.DATERANGE_APPLY,cancelLabel:M.DATERANGE_CANCEL,fromLabel:M.DATERANGE_FROM,toLabel:M.DATERANGE_TO,customRangeLabel:M.DATERANGE_CUSTOMRANGE,daysOfWeek:M.DATERANGE_DAYSOFWEEK,monthNames:M.DATERANGE_MONTHNAMES,firstDay:1}};var daterange_past={maxDate:moment().add(1,'days')};var daterange_future={minDate:moment().subtract(1,'days')};var opens_right={opens:'right'};var opens_left={opens:'left'};targets.each(function(){var daterange=$(this);var settings_opens=daterange.hasClass('opens-left')?opens_left:opens_right;var container_settings={parentEl:'#'+popManager.getDOMContainer(pageSection,daterange).attr('id')};var daterange_settings=$.extend({},settings,settings_opens,container_settings);if(daterange.hasClass('daterange-future')&&!daterange.hasClass('daterange-past')){$.extend(daterange_settings,daterange_future);}
else if(daterange.hasClass('daterange-past')&&!daterange.hasClass('daterange-future')){$.extend(daterange_settings,daterange_past);}
if(daterange.hasClass('timepicker')){var timeformat=M.DATERANGE_TIMEFORMAT||'h:mm A';daterange_settings.locale.format=format+' '+timeformat;var timePicker={autoApply:false,timePicker:true,timePicker24Hour:(timeformat!='h:mm A'),timePickerIncrement:15};$.extend(daterange_settings,timePicker);}
daterange.daterangepicker(daterange_settings,t.callback);if(!daterange.siblings('.from').val()){daterange.val('');}});},callback:function(start,end){var t=this;var dateinput=t.element;dateinput.siblings('.from').val(start.format('YYYY-MM-DD'));dateinput.siblings('.to').val(end.format('YYYY-MM-DD'));if(dateinput.siblings('.fromtime').length){dateinput.siblings('.fromtime').val(start.format('HH:mm'));dateinput.siblings('.totime').val(end.format('HH:mm'));}}};})(jQuery);popJSLibraryManager.register(popDateRange,['dateRange']);;(function($){popTypeahead={typeaheadSearchBtn:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(){var control=$(this);var typeahead=control.closest('.pop-typeahead');t.executeTypeaheadSearch(pageSection,block,typeahead);});},typeaheadSearchInput:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.keypress(function(e){if(event.which==13){event.preventDefault();var searchbox=$(this);var typeahead=searchbox.closest('.pop-typeahead');var input=typeahead.find('input[type="text"].tt-input');input.typeahead('close');t.executeTypeaheadSearch(pageSection,block,typeahead);}});},fillTypeahead:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var typeahead=$(this);var urlparam=typeahead.data('urlparam');if(urlparam){var url=block.data('paramsscope-url');var values=getParam(urlparam,url);if(values){var database_key=typeahead.data('database-key');$.each(values,function(key,value){var datum=popManager.getItemObject(database_key,value);t.selectTypeahead(pageSection,block,typeahead,datum);});popBootstrap.execOpenParentCollapse(typeahead);}}});},selectDatum:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var link=$(this);var typeahead=$(link.data('target'));var value=link.data('objectid');var database_key=link.data('db-key');var datum=popManager.getItemObject(database_key,value);t.selectTypeahead(pageSection,block,typeahead,datum);});},selectableTypeahead:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;t.typeahead(pageSection,block,targets);targets.each(function(){var typeahead=$(this);t.validateMaxSelected(pageSection,block,typeahead);typeahead.bind('typeahead:selected',function(obj,datum,name){var typeahead=$(this);t.selectTypeahead(pageSection,block,typeahead,datum);});});},fetchlinkTypeahead:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;t.typeahead(pageSection,block,targets);targets.each(function(){var typeahead=$(this);typeahead.bind('typeahead:selected',function(obj,datum,name){var selected=$(this);var typeahead=selected.closest('.pop-typeahead');popManager.click(datum.url,typeahead);});});},selectableTypeaheadTrigger:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.on('close.bs.alert',function(){var alert=$(this);var typeahead=alert.closest('.pop-typeahead');var disable=t.getElementsToDisable(typeahead);disable.attr('disabled',false);disable.removeClass('disabled');var val=alert.children('input[type="hidden"]').val();typeahead.triggerHandler('close',[alert,val]);});},selectTypeahead:function(pageSection,block,typeahead,datum){var t=this;var input=typeahead.find('input[type="text"].tt-input');t.triggerSelect(pageSection,block,typeahead,datum);input.typeahead('val','');},executeTypeaheadSearch:function(pageSection,block,typeahead){var t=this;var input=typeahead.find('input[type="text"].tt-input');var url=popManager.getQueryUrl(pageSection,block);var val=input.typeahead('val');if(val){url=url.replace('%QUERY',input.typeahead('val'));popManager.click(url,typeahead);}},getElementsToDisable:function(typeahead){var t=this;return typeahead.children('div.pop-operation').find('a, button, input');},typeahead:function(pageSection,block,targets){var t=this;var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.one('destroy',function(){t.destroy(targets);});block.one('rerender',function(action){t.destroy(targets);});targets.each(function(){var typeahead=$(this);var input=typeahead.find('input[type="text"]');var jsSettings=popManager.getJsSettings(pageSection,block,typeahead);var dataset=[];$.each(jsSettings['dataset-components'],function(index,component){var datasetJsSettings=popManager.getJsSettings(pageSection,block,component);dataset.push(datasetJsSettings['dataset']);});$.each(dataset,function(index,datasetunit){var layout=datasetunit['layout'];datasetunit.template=popManager.getScriptTemplate(layout);});var bloodhounds=[];var settings=[];var search;$.each(dataset,function(index,datasetunit){var limit=datasetunit.limit;if(dataset.length>1){if(limit>3){limit=3;}}
var options={datumTokenizer:function(d){var tokens=[];$.each(datasetunit.tokenizerKeys,function(index,tokenizerKey){tokens=tokens.concat(Bloodhound.tokenizers.whitespace(d[tokenizerKey]));});return tokens;},queryTokenizer:Bloodhound.tokenizers.whitespace,};if(datasetunit.local){options.local=datasetunit.local;}
if(datasetunit.prefetch){options.prefetch={url:datasetunit.prefetch,thumbprint:datasetunit.thumbprint};}
if(datasetunit.remote){options.remote={url:datasetunit.remote,wildcard:'%QUERY'};}
var bloodhound=new Bloodhound(options);bloodhounds.push(bloodhound);var source;if(datasetunit.staticSuggestions){source=function(query,cb){var result=[];$.each(datasetunit.staticSuggestions,function(index,staticSuggestion){var suggestion={};$.each(staticSuggestion,function(key,value){if(typeof value=='string'){value=value.replace('%QUERY',query);}
suggestion[key]=value;});result.push(suggestion);});cb(result);};}
else{source=bloodhound.ttAdapter();}
settings.push({source:source,name:datasetunit.name,display:datasetunit.valueKey,limit:limit,templates:{suggestion:datasetunit.template,header:datasetunit.header,pending:datasetunit.pending,notFound:datasetunit.notFound,}});});$.each(bloodhounds,function(index,bloodhound){bloodhound.initialize();});if(settings.length==1){input.typeahead({highlight:true},settings[0]);}
else if(settings.length==2){input.typeahead({highlight:true},settings[0],settings[1]);}
else if(settings.length==3){input.typeahead({highlight:true},settings[0],settings[1],settings[2]);}
else if(settings.length==4){input.typeahead({highlight:true},settings[0],settings[1],settings[2],settings[3]);}});},triggerSelect:function(pageSection,block,typeahead,datum){var t=this;if(typeahead.find('input[type="hidden"][value="'+datum.id+'"]').length==0){var jsSettings=popManager.getJsSettings(pageSection,block,typeahead);var template=jsSettings['trigger-layout'];var pssId=popManager.getSettingsId(pageSection);var bsId=popManager.getSettingsId(block);var context=$.extend({itemObject:datum},jsSettings['datum-context']);var options={extendContext:context}
var html=popManager.getTemplateHtml(pageSection,block,template,options);popManager.mergeHtml(html,typeahead.find('.pop-box'));popManager.runJSMethods(pageSection,block,template,'last');popJSRuntimeManager.deleteBlockLastSessionIds(pageSection,block,template);t.validateMaxSelected(pageSection,block,typeahead);typeahead.triggerHandler('selected',[datum]);}},validateMaxSelected:function(pageSection,block,typeahead){var t=this;if(typeahead.data('max-selected')){var numSelected=typeahead.find('input[type="hidden"]').length;if(numSelected==typeahead.data('max-selected')){var disable=t.getElementsToDisable(typeahead);disable.attr('disabled','disabled');disable.addClass('disabled');}}},removeSelected:function(typeahead,id){var t=this;var selected=typeahead.find('input[type="hidden"][value="'+id+'"]');var alert=selected.closest('.alert');alert.alert('close');},destroy:function(targets){var t=this;targets.find('input[type="text"].tt-input').typeahead('destroy');}};})(jQuery);popJSLibraryManager.register(popTypeahead,['selectableTypeahead','fillTypeahead','selectDatum','fetchlinkTypeahead','selectableTypeaheadTrigger','typeaheadSearchBtn','typeaheadSearchInput']);;(function($){popModals={modalForm:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.on('show.bs.modal',function(e){var modal=$(this);var link=$(e.relatedTarget);var blocks=$(modal.data('initjs-targets'));blocks.each(function(){var block=$(this);popManager.closeMessageFeedback(block);})});}};})(jQuery);popJSLibraryManager.register(popModals,['modalForm']);;(function($){popGA={documentInitialized:function(){var t=this;var _gaq=_gaq||[];_gaq.push(['_setAccount',M.GOOGLEANALYTICS]);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();},replaceState:function(args){var t=this;_gaq.push(['_trackPageview']);},};})(jQuery);popJSLibraryManager.register(popGA,['documentInitialized','replaceState']);;(function($){popPerfectScrollbar={scrollbarHorizontal:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;jQuery(document).ready(function($){targets.perfectScrollbar({suppressScrollY:true});});},scrollbarVertical:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;jQuery(document).ready(function($){targets.perfectScrollbar({suppressScrollX:true});});},doScroll:function(scrollbar,x,animate){var t=this;if(animate){scrollbar.animate({scrollTop:x});}
else{scrollbar.scrollTop(x);}
scrollbar.perfectScrollbar('update');},scrollToElem:function(elem,position,animate){var t=this;var scrollbar=elem.closest('.perfect-scrollbar').addBack('.perfect-scrollbar');if(scrollbar.length){var x=0;if(position){var offsetReference=scrollbar.children('.perfect-scrollbar-offsetreference');if(!offsetReference.length){offsetReference=elem;}
x=position.offset().top-offsetReference.offset().top;}
t.doScroll(scrollbar,x,animate);return true;}
return false;},getPosition:function(elem){var t=this;var scrollbar=elem.closest('.perfect-scrollbar').addBack('.perfect-scrollbar');if(scrollbar.length){var offsetReference=scrollbar.children('.perfect-scrollbar-offsetreference');if(offsetReference.length){return offsetReference.position().top*-1;}}
return 0;},scrollTop:function(elem,top,animate){var t=this;top=top||0;var scrollbar=elem.closest('.perfect-scrollbar').addBack('.perfect-scrollbar');if(scrollbar.length){t.doScroll(scrollbar,top,animate);return true;}
return false;},};})(jQuery);popJSLibraryManager.register(popPerfectScrollbar,['scrollbarHorizontal','scrollbarVertical']);;(function($){popFunctions={expandJSKeys:function(args){var t=this;var context=args.context;if(context[M.JS_FONTAWESOME]){context.fontawesome=context[M.JS_FONTAWESOME];}
if(context[M.JS_DESCRIPTION]){context.description=context[M.JS_DESCRIPTION];}},beep:function(args){beep();},showmore:function(args){var t=this;var targets=args.targets;targets.find(".pop-showmore-more").click(function(e){e.preventDefault();var link=$(this);var content=link.closest('.pop-content');content.find(".pop-showmore-more").addClass('hidden');content.find(".pop-showmore-less").removeClass('hidden');content.find(".pop-showmore-more-full").removeClass('hidden');});targets.find(".pop-showmore-less").click(function(e){e.preventDefault();var link=$(this);var content=link.closest('.pop-content');content.find(".pop-showmore-less").addClass('hidden');content.find(".pop-showmore-more").removeClass('hidden');content.find(".pop-showmore-more-full").addClass('hidden');});},hideEmpty:function(args){var t=this;var targets=args.targets;targets.closest('.pop-hide-empty').addClass('hidden');},imageResponsive:function(args){var t=this;var targets=args.targets;targets.find('div.pop-content').addBack('div.pop-content').find('img, .wp-caption').addClass('img-responsive');},printWindow:function(args){var t=this;var action=getParam(M.URLPARAM_ACTION,window.location.href);if(action==M.URLPARAM_ACTION_PRINT){jQuery(document).ready(function($){window.print();});}},copyHeader:function(args){var t=this;var targets=args.targets,link=args.relatedTarget;if(link){link=popManager.getOriginalLink(link);var header=link.data('header');if(header){targets.find('.pop-header').removeClass('hidden').find('.pop-box').html(header);}}},fillURLParamInput:function(args){var t=this;var block=args.block,targets=args.targets;targets.each(function(){var input=$(this);var val=t.getURLParamInputValue(block,input);input.val(val);});},fillAddonInput:function(args){var t=this;var targets=args.targets,link=args.relatedTarget;if(link){targets.each(function(){var input=$(this);t.fillInput(input,link);});}},fillModalInput:function(args){var t=this;var targets=args.targets;targets.each(function(){var input=$(this);var modal=input.closest('.modal');modal.on('show.bs.modal',function(e){var link=$(e.relatedTarget);t.fillInput(input,link);});});},fillAddonURLInput:function(args){var t=this;var targets=args.targets,link=args.relatedTarget;if(link){targets.each(function(){var input=$(this);t.fillURLInput(input,link);});}},fillModalURLInput:function(args){var t=this;var targets=args.targets;targets.each(function(){var input=$(this);var modal=input.closest('.modal');modal.on('show.bs.modal',function(e){var link=$(e.relatedTarget);t.fillURLInput(input,link);});});},switchTargetClass:function(args){var t=this;var targets=args.targets;targets.click(function(e){var button=$(this);if(button.is('a[href="#"]')){e.preventDefault();}
var target=$(button.data('target'))||$('body');var mode=button.data('mode')||'add';var classs=button.data('class');if(mode=='add'){target.addClass(classs);}
else if(mode=='remove'){target.removeClass(classs);}
else if(mode=='toggle'){target.toggleClass(classs);}});},doNothing:function(args){var t=this;var targets=args.targets;targets.click(function(e){e.preventDefault();});},fetchMore:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;block.on('beforeFetch',function(e,options){if(!options['skip-status']){targets.button('loading');}});block.on('fetchCompleted',function(e){var blockParams=popManager.getBlockParams(pageSection,block);if(blockParams[M.URLPARAM_STOPFETCHING]){targets.addClass('hidden');}
else{targets.removeClass('hidden');targets.button('reset');}});targets.click(function(e){e.preventDefault();popManager.fetchBlock(pageSection,block,{operation:M.URLPARAM_OPERATION_APPEND});});},fetchMoreDisable:function(args){var t=this;var block=args.block,targets=args.targets;block.on('beforeFetch',function(e,options){if(!options['skip-status']){targets.addClass('disabled').attr('disabled','disabled');}});block.on('fetchCompleted',function(e){targets.removeClass('disabled').attr('disabled',false);});},saveLastClicked:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){var clicked=$(this);block.find('[data-action="retry"]').data('lastclicked','#'+clicked.attr('id')).removeClass('hidden');});},retrySendRequest:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var retryBtn=$(this);if(retryBtn.data('lastclicked')){$(retryBtn.data('lastclicked')).trigger('click');}})},highlight:function(args){var t=this;var targets=args.targets;targets.each(function(){var target=$(this);var pageSection=popManager.getPageSection(target);popManager.scrollToElem(pageSection,target,true);});},embedCode:function(args){var t=this;var targets=args.targets;targets.each(function(){var input=$(this);var modal=input.closest('.modal');modal.on('show.bs.modal',function(e){var link=$(e.relatedTarget);var url=t.getUrl(link,true);url=popManager.getEmbedUrl(url);t.execReplaceCode(input,url);});});},modalReloadEmbedPreview:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var iframe=$(this);var block=popManager.getBlock(iframe);var modal=block.closest('.modal');modal.on('show.bs.modal',function(e){var link=$(e.relatedTarget);var url=t.getUrl(link,true);url=popManager.getEmbedUrl(url);t.embedPreview(pageSection,block,iframe,url);});});},reloadEmbedPreview:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var connector=$(this);var input=$(connector.data('input-target'));input.change(function(){var input=$(this);t.embedPreviewFromInput(pageSection,block,connector);});t.embedPreviewFromInput(pageSection,block,connector);});},replaceCode:function(args){var t=this;var targets=args.targets;targets.each(function(){var input=$(this);var modal=input.closest('.modal');modal.on('show.bs.modal',function(e){var link=$(e.relatedTarget);t.execReplaceCode(input,t.getUrl(link));});});},socialmedia:function(args){var t=this;var targets=args.targets;targets.one('mouseenter',function(){var socialmedia=$(this);socialmedia.children('a.socialmedia-item').each(function(){var item=$(this);var provider=item.data('provider');if(provider){var settings=M.SOCIALMEDIA[provider];if(settings){$.ajax({type:'GET',dataType:settings.dataType,url:settings['counter-url'].replace('%s',item.data('url')),success:function(json){if(!json.hasOwnProperty(settings.property))
return;var count=json[settings.property];if(count==0)return;item.children('.pop-counter').html(count);}});}}});});},mediaplayer:function(args){var t=this;var targets=args.targets;targets.mediaelementplayer();},reset:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.click(function(e){e.preventDefault();var button=$(this);var block=popManager.getBlock(button);popManager.reset(pageSection,block);popManager.closeMessageFeedback(block);});},browserUrl:function(args){var t=this;var targets=args.targets;targets.closest('form').on('beforeSubmit',function(){var url=window.location.href;targets.val(url);})},smallScreenHideCollapse:function(args){var t=this;var targets=args.targets;if($(window).width()<768){var targets=args.targets;targets.collapse('hide');}},cookies:function(args){var t=this;var targets=args.targets;targets.each(function(){var cookie=$(this);if(!($.cookie(cookie.data('cookieid')))){cookie.removeClass('hidden');}
cookie.children("button.close").click(function(e){e.preventDefault();var cookie=$(this).parent('.cookie');$.cookie(cookie.data('cookieid'),"dismissed",{expires:90,path:"/"});});});},cookieToggleClass:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var container=$(this);var cookieid=container.data('cookieid');t.cookieToggleClassInitial(pageSection,container);if(container.data('deletecookiebtn')){var selector=container.data('deletecookiebtn');var btn=(selector=='self'?container:$(selector));btn.click(function(e){$.cookie(cookieid,null,{expires:-1,path:"/"});});}
if(container.data('setcookiebtn')){var selector=container.data('setcookiebtn');var btn=(selector=='self'?container:$(selector));btn.click(function(e){$.cookie(cookieid,"dismissed",{expires:180,path:"/"});});}
if(container.data('togglecookiebtn')){var selector=container.data('togglecookiebtn');var btn=(selector=='self'?container:$(selector));btn.click(function(e){if($.cookie(cookieid)){$.cookie(cookieid,null,{expires:-1,path:"/"});}
else{$.cookie(cookieid,"dismissed",{expires:180,path:"/"});}});}});},sortable:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.sortable({cursor:"move"});},onActionThenClick:function(args){var t=this;var targets=args.targets;targets.each(function(){var clickable=$(this);var trigger=$(clickable.data('triggertarget'));var action=clickable.data('trigger-action')||'click';if(clickable.data('triggertarget-internal')){trigger=trigger.find(clickable.data('triggertarget-internal'));}
trigger.on(action,function(e){clickable.trigger('click');});});},cookieToggleClassInitial:function(pageSection,container){var t=this;var cookieid=container.data('cookieid');if(!$.cookie(cookieid)){var target=$(container.data('cookietarget'));var collapse=container.data('cookiecollapse');if(collapse){jQuery(document).ready(function($){target.collapse(collapse);});}
var classs=container.data('cookieclass');if(classs){target.addClass(classs);}}},embedPreviewFromInput:function(pageSection,block,connector){var t=this;var input=$(connector.data('input-target'));var url=input.val();if(url&&isUrlValid(url)){var iframe=$(connector.data('iframe-target'));var merged=t.embedPreview(pageSection,block,iframe,url);connector.data('iframe-target','#'+merged.targetContainer.attr('id'));}},getURLParamInputValue:function(block,input){var t=this;var val,urlparam=input.data('urlparam');if(urlparam){var url=block.data('paramsscope-url');val=getParam(urlparam,url);}
return val||'';},embedPreview:function(pageSection,block,iframe,url){var t=this;var options={operation:M.URLPARAM_OPERATION_REPLACEINLINE,extendContext:{src:url},'merge-target':'#'+iframe.attr('id')}
var template=iframe.data('templateid');var merged=popManager.mergeTargetTemplate(pageSection,block,template,options);popManager.runJSMethods(pageSection,block,template,'full');return merged;},fillInput:function(input,link){var t=this;link=popManager.getOriginalLink(link);var val,attr=input.data('attr');if(attr){val=link.data(attr);}
val=val||'';input.val(val);},fillURLInput:function(input,link){var t=this;link=popManager.getOriginalLink(link);var url=t.getUrl(link);input.val(url);},getUrl:function(link,use_pageurl){var t=this;link=popManager.getOriginalLink(link);var url=link.data('target-url');if(!url){var blockTarget=$(link.data('blocktarget'));var pageSection=popManager.getPageSection(blockTarget);url=popManager.getBlockFilteringUrl(pageSection,blockTarget,use_pageurl);}
return url;},execReplaceCode:function(input,url){var t=this;var placeholder=input.data('code-placeholder');var code=placeholder.format(url);input.val(code);},};})(jQuery);popJSLibraryManager.register(popFunctions,['expandJSKeys','showmore','hideEmpty','imageResponsive','printWindow','copyHeader','fillURLParamInput','fillAddonInput','fillModalInput','fillAddonURLInput','fillModalURLInput','switchTargetClass','doNothing','fetchMore','fetchMoreDisable','saveLastClicked','retrySendRequest','highlight','replaceCode','modalReloadEmbedPreview','reloadEmbedPreview','embedCode','socialmedia','mediaplayer','reset','browserUrl','smallScreenHideCollapse','cookies','cookieToggleClass','sortable','onActionThenClick','beep']);;(function($){popBlockFunctions={hideIfEmptyBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block;if(popManager.hideIfEmpty(pageSection,block)){block.addClass('hidden');}
else{block.removeClass('hidden');}}};})(jQuery);popJSLibraryManager.register(popBlockFunctions,['hideIfEmptyBlock']);;(function($){popControls={controlPrint:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var control=$(this);var url=t.getBlockFilteringUrl(pageSection,control,true);url=popManager.getPrintUrl(url);popSystem.openPrint(url);});},controlSocialMedia:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){e.preventDefault();var control=$(this);var url=t.getBlockFilteringUrl(pageSection,control,true);var provider=control.data('provider');var settings=M.SOCIALMEDIA[provider];var shareUrl=settings['share-url'].replace(new RegExp('%url%','g'),encodeURIComponent(url)).replace(new RegExp('%title%','g'),encodeURIComponent(popManager.documentTitle));popSystem.openSocialMedia(shareUrl);});},getBlockFilteringUrl:function(pageSection,control,use_pageurl){var t=this;var targetBlock=$(control.data('blocktarget'));return popManager.getBlockFilteringUrl(pageSection,targetBlock,use_pageurl);},};})(jQuery);popJSLibraryManager.register(popControls,['controlPrint','controlSocialMedia']);
;/*
 jquery.fullscreen 1.1.5
 https://github.com/kayahr/jquery-fullscreen-plugin
 Copyright (C) 2012-2013 Klaus Reimer <k@ailis.de>
 Licensed under the MIT license
 (See http://www.opensource.org/licenses/mit-license)
*/
function d(c){var b,a;if(!this.length)return this;b=this[0];b.ownerDocument?a=b.ownerDocument:(a=b,b=a.documentElement);if(null==c){if(!a.exitFullscreen&&!a.webkitExitFullscreen&&!a.webkitCancelFullScreen&&!a.msExitFullscreen&&!a.mozCancelFullScreen)return null;c=!!a.fullscreenElement||!!a.msFullscreenElement||!!a.webkitIsFullScreen||!!a.mozFullScreen;return!c?c:a.fullscreenElement||a.webkitFullscreenElement||a.webkitCurrentFullScreenElement||a.msFullscreenElement||a.mozFullScreenElement||c}c?(c=
b.requestFullscreen||b.webkitRequestFullscreen||b.webkitRequestFullScreen||b.msRequestFullscreen||b.mozRequestFullScreen)&&c.call(b):(c=a.exitFullscreen||a.webkitExitFullscreen||a.webkitCancelFullScreen||a.msExitFullscreen||a.mozCancelFullScreen)&&c.call(a);return this}jQuery.fn.fullScreen=d;jQuery.fn.toggleFullScreen=function(){return d.call(this,!d.call(this))};var e,f,g;e=document;
e.webkitCancelFullScreen?(f="webkitfullscreenchange",g="webkitfullscreenerror"):e.msExitFullscreen?(f="MSFullscreenChange",g="MSFullscreenError"):e.mozCancelFullScreen?(f="mozfullscreenchange",g="mozfullscreenerror"):(f="fullscreenchange",g="fullscreenerror");jQuery(document).bind(f,function(){jQuery(document).trigger(new jQuery.Event("fullscreenchange"))});jQuery(document).bind(g,function(){jQuery(document).trigger(new jQuery.Event("fullscreenerror"))});
;!function($){"use strict";if(typeof ko!=='undefined'&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect){ko.bindingHandlers.multiselect={after:['options','value','selectedOptions'],init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var $element=$(element);var config=ko.toJS(valueAccessor());$element.multiselect(config);if(allBindings.has('options')){var options=allBindings.get('options');if(ko.isObservable(options)){ko.computed({read:function(){options();setTimeout(function(){var ms=$element.data('multiselect');if(ms)
ms.updateOriginalOptions();$element.multiselect('rebuild');},1);},disposeWhenNodeIsRemoved:element});}}
if(allBindings.has('value')){var value=allBindings.get('value');if(ko.isObservable(value)){ko.computed({read:function(){value();setTimeout(function(){$element.multiselect('refresh');},1);},disposeWhenNodeIsRemoved:element}).extend({rateLimit:100,notifyWhenChangesStop:true});}}
if(allBindings.has('selectedOptions')){var selectedOptions=allBindings.get('selectedOptions');if(ko.isObservable(selectedOptions)){ko.computed({read:function(){selectedOptions();setTimeout(function(){$element.multiselect('refresh');},1);},disposeWhenNodeIsRemoved:element}).extend({rateLimit:100,notifyWhenChangesStop:true});}}
ko.utils.domNodeDisposal.addDisposeCallback(element,function(){$element.multiselect('destroy');});},update:function(element,valueAccessor,allBindings,viewModel,bindingContext){var $element=$(element);var config=ko.toJS(valueAccessor());$element.multiselect('setOptions',config);$element.multiselect('rebuild');}};}
function forEach(array,callback){for(var index=0;index<array.length;++index){callback(array[index],index);}}
function Multiselect(select,options){this.$select=$(select);if(this.$select.attr("data-placeholder")){options.nonSelectedText=this.$select.data("placeholder");}
this.options=this.mergeOptions($.extend({},options,this.$select.data()));this.originalOptions=this.$select.clone()[0].options;this.query='';this.searchTimeout=null;this.lastToggledInput=null
this.options.multiple=this.$select.attr('multiple')==="multiple";this.options.onChange=$.proxy(this.options.onChange,this);this.options.onDropdownShow=$.proxy(this.options.onDropdownShow,this);this.options.onDropdownHide=$.proxy(this.options.onDropdownHide,this);this.options.onDropdownShown=$.proxy(this.options.onDropdownShown,this);this.options.onDropdownHidden=$.proxy(this.options.onDropdownHidden,this);this.buildContainer();this.buildButton();this.buildDropdown();this.buildSelectAll();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.updateSelectAll();if(this.options.disableIfEmpty&&$('option',this.$select).length<=0){this.disable();}
this.$select.hide().after(this.$container);};Multiselect.prototype={defaults:{buttonText:function(options,select){if(options.length===0){return this.nonSelectedText;}
else if(this.allSelectedText&&options.length===$('option',$(select)).length&&$('option',$(select)).length!==1&&this.multiple){if(this.selectAllNumber){return this.allSelectedText+' ('+options.length+')';}
else{return this.allSelectedText;}}
else if(options.length>this.numberDisplayed){return options.length+' '+this.nSelectedText;}
else{var selected='';var delimiter=this.delimiterText;options.each(function(){var label=($(this).attr('label')!==undefined)?$(this).attr('label'):$(this).text();selected+=label+delimiter;});return selected.substr(0,selected.length-2);}},buttonTitle:function(options,select){if(options.length===0){return this.nonSelectedText;}
else{var selected='';var delimiter=this.delimiterText;options.each(function(){var label=($(this).attr('label')!==undefined)?$(this).attr('label'):$(this).text();selected+=label+delimiter;});return selected.substr(0,selected.length-2);}},optionLabel:function(element){return $(element).attr('label')||$(element).text();},onChange:function(option,checked){},onDropdownShow:function(event){},onDropdownHide:function(event){},onDropdownShown:function(event){},onDropdownHidden:function(event){},onSelectAll:function(){},enableHTML:false,buttonClass:'btn btn-default',inheritClass:false,buttonWidth:'auto',buttonContainer:'<div class="btn-group" />',dropRight:false,selectedClass:'active',maxHeight:false,checkboxName:false,includeSelectAllOption:false,includeSelectAllIfMoreThan:0,selectAllText:' Select all',selectAllValue:'multiselect-all',selectAllName:false,selectAllNumber:true,enableFiltering:false,enableCaseInsensitiveFiltering:false,enableClickableOptGroups:false,filterPlaceholder:'Search',filterBehavior:'text',includeFilterClearBtn:true,preventInputChangeEvent:false,nonSelectedText:'None selected',nSelectedText:'selected',allSelectedText:'All selected',numberDisplayed:3,disableIfEmpty:false,delimiterText:', ',templates:{button:'<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> <b class="caret"></b></button>',ul:'<ul class="multiselect-container dropdown-menu"></ul>',filter:'<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text"></div></li>',filterClearBtn:'<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="glyphicon glyphicon-remove-circle"></i></button></span>',li:'<li><a tabindex="0"><label></label></a></li>',divider:'<li class="multiselect-item divider"></li>',liGroup:'<li class="multiselect-item multiselect-group"><label></label></li>'}},constructor:Multiselect,buildContainer:function(){this.$container=$(this.options.buttonContainer);this.$container.on('show.bs.dropdown',this.options.onDropdownShow);this.$container.on('hide.bs.dropdown',this.options.onDropdownHide);this.$container.on('shown.bs.dropdown',this.options.onDropdownShown);this.$container.on('hidden.bs.dropdown',this.options.onDropdownHidden);},buildButton:function(){this.$button=$(this.options.templates.button).addClass(this.options.buttonClass);if(this.$select.attr('class')&&this.options.inheritClass){this.$button.addClass(this.$select.attr('class'));}
if(this.$select.prop('disabled')){this.disable();}
else{this.enable();}
if(this.options.buttonWidth&&this.options.buttonWidth!=='auto'){this.$button.css({'width':this.options.buttonWidth,'overflow':'hidden','text-overflow':'ellipsis'});this.$container.css({'width':this.options.buttonWidth});}
var tabindex=this.$select.attr('tabindex');if(tabindex){this.$button.attr('tabindex',tabindex);}
this.$container.prepend(this.$button);},buildDropdown:function(){this.$ul=$(this.options.templates.ul);if(this.options.dropRight){this.$ul.addClass('pull-right');}
if(this.options.maxHeight){this.$ul.css({'max-height':this.options.maxHeight+'px','overflow-y':'auto','overflow-x':'hidden'});}
this.$container.append(this.$ul);},buildDropdownOptions:function(){this.$select.children().each($.proxy(function(index,element){var $element=$(element);var tag=$element.prop('tagName').toLowerCase();if($element.prop('value')===this.options.selectAllValue){return;}
if(tag==='optgroup'){this.createOptgroup(element);}
else if(tag==='option'){if($element.data('role')==='divider'){this.createDivider();}
else{this.createOptionValue(element);}}},this));$('li input',this.$ul).on('change',$.proxy(function(event){var $target=$(event.target);var checked=$target.prop('checked')||false;var isSelectAllOption=$target.val()===this.options.selectAllValue;if(this.options.selectedClass){if(checked){$target.closest('li').addClass(this.options.selectedClass);}
else{$target.closest('li').removeClass(this.options.selectedClass);}}
var value=$target.val();var $option=this.getOptionByValue(value);var $optionsNotThis=$('option',this.$select).not($option);var $checkboxesNotThis=$('input',this.$container).not($target);if(isSelectAllOption){if(checked){this.selectAll();}
else{this.deselectAll();}}
if(!isSelectAllOption){if(checked){$option.prop('selected',true);if(this.options.multiple){$option.prop('selected',true);}
else{if(this.options.selectedClass){$($checkboxesNotThis).closest('li').removeClass(this.options.selectedClass);}
$($checkboxesNotThis).prop('checked',false);$optionsNotThis.prop('selected',false);this.$button.click();}
if(this.options.selectedClass==="active"){$optionsNotThis.closest("a").css("outline","");}}
else{$option.prop('selected',false);}}
this.$select.change();this.updateButtonText();this.updateSelectAll();this.options.onChange($option,checked);if(this.options.preventInputChangeEvent){return false;}},this));$('li a',this.$ul).on('mousedown',function(e){if(e.shiftKey){return false;}});$('li a',this.$ul).on('touchstart click',$.proxy(function(event){event.stopPropagation();var $target=$(event.target);if(event.shiftKey&&this.options.multiple){if($target.is("label")){event.preventDefault();$target=$target.find("input");$target.prop("checked",!$target.prop("checked"));}
var checked=$target.prop('checked')||false;if(this.lastToggledInput!==null&&this.lastToggledInput!==$target){var from=$target.closest("li").index();var to=this.lastToggledInput.closest("li").index();if(from>to){var tmp=to;to=from;from=tmp;}
++to;var range=this.$ul.find("li").slice(from,to).find("input");range.prop('checked',checked);if(this.options.selectedClass){range.closest('li').toggleClass(this.options.selectedClass,checked);}
for(var i=0,j=range.length;i<j;i++){var $checkbox=$(range[i]);var $option=this.getOptionByValue($checkbox.val());$option.prop('selected',checked);}}
$target.trigger("change");}
if($target.is("input")&&!$target.closest("li").is(".multiselect-item")){this.lastToggledInput=$target;}
$target.blur();},this));this.$container.off('keydown.multiselect').on('keydown.multiselect',$.proxy(function(event){if($('input[type="text"]',this.$container).is(':focus')){return;}
if(event.keyCode===9&&this.$container.hasClass('open')){this.$button.click();}
else{var $items=$(this.$container).find("li:not(.divider):not(.disabled) a").filter(":visible");if(!$items.length){return;}
var index=$items.index($items.filter(':focus'));if(event.keyCode===38&&index>0){index--;}
else if(event.keyCode===40&&index<$items.length-1){index++;}
else if(!~index){index=0;}
var $current=$items.eq(index);$current.focus();if(event.keyCode===32||event.keyCode===13){var $checkbox=$current.find('input');$checkbox.prop("checked",!$checkbox.prop("checked"));$checkbox.change();}
event.stopPropagation();event.preventDefault();}},this));if(this.options.enableClickableOptGroups&&this.options.multiple){$('li.multiselect-group',this.$ul).on('click',$.proxy(function(event){event.stopPropagation();var group=$(event.target).parent();var $options=group.nextUntil('li.multiselect-group');var $visibleOptions=$options.filter(":visible:not(.disabled)");var allChecked=true;var optionInputs=$visibleOptions.find('input');optionInputs.each(function(){allChecked=allChecked&&$(this).prop('checked');});optionInputs.prop('checked',!allChecked).trigger('change');},this));}},createOptionValue:function(element){var $element=$(element);if($element.is(':selected')){$element.prop('selected',true);}
var label=this.options.optionLabel(element);var value=$element.val();var inputType=this.options.multiple?"checkbox":"radio";var $li=$(this.options.templates.li);var $label=$('label',$li);$label.addClass(inputType);if(this.options.enableHTML){$label.html(" "+label);}
else{$label.text(" "+label);}
var $checkbox=$('<input/>').attr('type',inputType);if(this.options.checkboxName){$checkbox.attr('name',this.options.checkboxName);}
$label.prepend($checkbox);var selected=$element.prop('selected')||false;$checkbox.val(value);if(value===this.options.selectAllValue){$li.addClass("multiselect-item multiselect-all");$checkbox.parent().parent().addClass('multiselect-all');}
$label.attr('title',$element.attr('title'));this.$ul.append($li);if($element.is(':disabled')){$checkbox.attr('disabled','disabled').prop('disabled',true).closest('a').attr("tabindex","-1").closest('li').addClass('disabled');}
$checkbox.prop('checked',selected);if(selected&&this.options.selectedClass){$checkbox.closest('li').addClass(this.options.selectedClass);}},createDivider:function(element){var $divider=$(this.options.templates.divider);this.$ul.append($divider);},createOptgroup:function(group){var groupName=$(group).prop('label');var $li=$(this.options.templates.liGroup);if(this.options.enableHTML){$('label',$li).html(groupName);}
else{$('label',$li).text(groupName);}
if(this.options.enableClickableOptGroups){$li.addClass('multiselect-group-clickable');}
this.$ul.append($li);if($(group).is(':disabled')){$li.addClass('disabled');}
$('option',group).each($.proxy(function(index,element){this.createOptionValue(element);},this));},buildSelectAll:function(){if(typeof this.options.selectAllValue==='number'){this.options.selectAllValue=this.options.selectAllValue.toString();}
var alreadyHasSelectAll=this.hasSelectAll();if(!alreadyHasSelectAll&&this.options.includeSelectAllOption&&this.options.multiple&&$('option',this.$select).length>this.options.includeSelectAllIfMoreThan){if(this.options.includeSelectAllDivider){this.$ul.prepend($(this.options.templates.divider));}
var $li=$(this.options.templates.li);$('label',$li).addClass("checkbox");if(this.options.enableHTML){$('label',$li).html(" "+this.options.selectAllText);}
else{$('label',$li).text(" "+this.options.selectAllText);}
if(this.options.selectAllName){$('label',$li).prepend('<input type="checkbox" name="'+this.options.selectAllName+'" />');}
else{$('label',$li).prepend('<input type="checkbox" />');}
var $checkbox=$('input',$li);$checkbox.val(this.options.selectAllValue);$li.addClass("multiselect-item multiselect-all");$checkbox.parent().parent().addClass('multiselect-all');this.$ul.prepend($li);$checkbox.prop('checked',false);}},buildFilter:function(){if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var enableFilterLength=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);if(this.$select.find('option').length>=enableFilterLength){this.$filter=$(this.options.templates.filter);$('input',this.$filter).attr('placeholder',this.options.filterPlaceholder);if(this.options.includeFilterClearBtn){var clearBtn=$(this.options.templates.filterClearBtn);clearBtn.on('click',$.proxy(function(event){clearTimeout(this.searchTimeout);this.$filter.find('.multiselect-search').val('');$('li',this.$ul).show().removeClass("filter-hidden");this.updateSelectAll();},this));this.$filter.find('.input-group').append(clearBtn);}
this.$ul.prepend(this.$filter);this.$filter.val(this.query).on('click',function(event){event.stopPropagation();}).on('input keydown',$.proxy(function(event){if(event.which===13){event.preventDefault();}
clearTimeout(this.searchTimeout);this.searchTimeout=this.asyncFunction($.proxy(function(){if(this.query!==event.target.value){this.query=event.target.value;var currentGroup,currentGroupVisible;$.each($('li',this.$ul),$.proxy(function(index,element){var value=$('input',element).length>0?$('input',element).val():"";var text=$('label',element).text();var filterCandidate='';if((this.options.filterBehavior==='text')){filterCandidate=text;}
else if((this.options.filterBehavior==='value')){filterCandidate=value;}
else if(this.options.filterBehavior==='both'){filterCandidate=text+'\n'+value;}
if(value!==this.options.selectAllValue&&text){var showElement=false;if(this.options.enableCaseInsensitiveFiltering&&filterCandidate.toLowerCase().indexOf(this.query.toLowerCase())>-1){showElement=true;}
else if(filterCandidate.indexOf(this.query)>-1){showElement=true;}
$(element).toggle(showElement).toggleClass('filter-hidden',!showElement);if($(element).hasClass('multiselect-group')){currentGroup=element;currentGroupVisible=showElement;}
else{if(showElement){$(currentGroup).show().removeClass('filter-hidden');}
if(!showElement&&currentGroupVisible){$(element).show().removeClass('filter-hidden');}}}},this));}
this.updateSelectAll();},this),300,this);},this));}}},destroy:function(){this.$container.remove();this.$select.show();this.$select.data('multiselect',null);},refresh:function(){$('option',this.$select).each($.proxy(function(index,element){var $input=$('li input',this.$ul).filter(function(){return $(this).val()===$(element).val();});if($(element).is(':selected')){$input.prop('checked',true);if(this.options.selectedClass){$input.closest('li').addClass(this.options.selectedClass);}}
else{$input.prop('checked',false);if(this.options.selectedClass){$input.closest('li').removeClass(this.options.selectedClass);}}
if($(element).is(":disabled")){$input.attr('disabled','disabled').prop('disabled',true).closest('li').addClass('disabled');}
else{$input.prop('disabled',false).closest('li').removeClass('disabled');}},this));this.updateButtonText();this.updateSelectAll();},select:function(selectValues,triggerOnChange){if(!$.isArray(selectValues)){selectValues=[selectValues];}
for(var i=0;i<selectValues.length;i++){var value=selectValues[i];if(value===null||value===undefined){continue;}
var $option=this.getOptionByValue(value);var $checkbox=this.getInputByValue(value);if($option===undefined||$checkbox===undefined){continue;}
if(!this.options.multiple){this.deselectAll(false);}
if(this.options.selectedClass){$checkbox.closest('li').addClass(this.options.selectedClass);}
$checkbox.prop('checked',true);$option.prop('selected',true);if(triggerOnChange){this.options.onChange($option,true);}}
this.updateButtonText();this.updateSelectAll();},clearSelection:function(){this.deselectAll(false);this.updateButtonText();this.updateSelectAll();},deselect:function(deselectValues,triggerOnChange){if(!$.isArray(deselectValues)){deselectValues=[deselectValues];}
for(var i=0;i<deselectValues.length;i++){var value=deselectValues[i];if(value===null||value===undefined){continue;}
var $option=this.getOptionByValue(value);var $checkbox=this.getInputByValue(value);if($option===undefined||$checkbox===undefined){continue;}
if(this.options.selectedClass){$checkbox.closest('li').removeClass(this.options.selectedClass);}
$checkbox.prop('checked',false);$option.prop('selected',false);if(triggerOnChange){this.options.onChange($option,false);}}
this.updateButtonText();this.updateSelectAll();},selectAll:function(justVisible,triggerOnSelectAll){var justVisible=typeof justVisible==='undefined'?true:justVisible;var allCheckboxes=$("li input[type='checkbox']:enabled",this.$ul);var visibleCheckboxes=allCheckboxes.filter(":visible");var allCheckboxesCount=allCheckboxes.length;var visibleCheckboxesCount=visibleCheckboxes.length;if(justVisible){visibleCheckboxes.prop('checked',true);$("li:not(.divider):not(.disabled)",this.$ul).filter(":visible").addClass(this.options.selectedClass);}
else{allCheckboxes.prop('checked',true);$("li:not(.divider):not(.disabled)",this.$ul).addClass(this.options.selectedClass);}
if(allCheckboxesCount===visibleCheckboxesCount||justVisible===false){$("option:enabled",this.$select).prop('selected',true);}
else{var values=visibleCheckboxes.map(function(){return $(this).val();}).get();$("option:enabled",this.$select).filter(function(index){return $.inArray($(this).val(),values)!==-1;}).prop('selected',true);}
if(triggerOnSelectAll){this.options.onSelectAll();}},deselectAll:function(justVisible){var justVisible=typeof justVisible==='undefined'?true:justVisible;if(justVisible){var visibleCheckboxes=$("li input[type='checkbox']:not(:disabled)",this.$ul).filter(":visible");visibleCheckboxes.prop('checked',false);var values=visibleCheckboxes.map(function(){return $(this).val();}).get();$("option:enabled",this.$select).filter(function(index){return $.inArray($(this).val(),values)!==-1;}).prop('selected',false);if(this.options.selectedClass){$("li:not(.divider):not(.disabled)",this.$ul).filter(":visible").removeClass(this.options.selectedClass);}}
else{$("li input[type='checkbox']:enabled",this.$ul).prop('checked',false);$("option:enabled",this.$select).prop('selected',false);if(this.options.selectedClass){$("li:not(.divider):not(.disabled)",this.$ul).removeClass(this.options.selectedClass);}}},rebuild:function(){this.$ul.html('');this.options.multiple=this.$select.attr('multiple')==="multiple";this.buildSelectAll();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.updateSelectAll();if(this.options.disableIfEmpty&&$('option',this.$select).length<=0){this.disable();}
else{this.enable();}
if(this.options.dropRight){this.$ul.addClass('pull-right');}},dataprovider:function(dataprovider){var groupCounter=0;var $select=this.$select.empty();$.each(dataprovider,function(index,option){var $tag;if($.isArray(option.children)){groupCounter++;$tag=$('<optgroup/>').attr({label:option.label||'Group '+groupCounter,disabled:!!option.disabled});forEach(option.children,function(subOption){$tag.append($('<option/>').attr({value:subOption.value,label:subOption.label||subOption.value,title:subOption.title,selected:!!subOption.selected,disabled:!!subOption.disabled}));});}
else{$tag=$('<option/>').attr({value:option.value,label:option.label||option.value,title:option.title,selected:!!option.selected,disabled:!!option.disabled});}
$select.append($tag);});this.rebuild();},enable:function(){this.$select.prop('disabled',false);this.$button.prop('disabled',false).removeClass('disabled');},disable:function(){this.$select.prop('disabled',true);this.$button.prop('disabled',true).addClass('disabled');},setOptions:function(options){this.options=this.mergeOptions(options);},mergeOptions:function(options){return $.extend(true,{},this.defaults,this.options,options);},hasSelectAll:function(){return $('li.multiselect-all',this.$ul).length>0;},updateSelectAll:function(){if(this.hasSelectAll()){var allBoxes=$("li:not(.multiselect-item):not(.filter-hidden) input:enabled",this.$ul);var allBoxesLength=allBoxes.length;var checkedBoxesLength=allBoxes.filter(":checked").length;var selectAllLi=$("li.multiselect-all",this.$ul);var selectAllInput=selectAllLi.find("input");if(checkedBoxesLength>0&&checkedBoxesLength===allBoxesLength){selectAllInput.prop("checked",true);selectAllLi.addClass(this.options.selectedClass);this.options.onSelectAll();}
else{selectAllInput.prop("checked",false);selectAllLi.removeClass(this.options.selectedClass);}}},updateButtonText:function(){var options=this.getSelected();if(this.options.enableHTML){$('.multiselect .multiselect-selected-text',this.$container).html(this.options.buttonText(options,this.$select));}
else{$('.multiselect .multiselect-selected-text',this.$container).text(this.options.buttonText(options,this.$select));}
$('.multiselect',this.$container).attr('title',this.options.buttonTitle(options,this.$select));},getSelected:function(){return $('option',this.$select).filter(":selected");},getOptionByValue:function(value){var options=$('option',this.$select);var valueToCompare=value.toString();for(var i=0;i<options.length;i=i+1){var option=options[i];if(option.value===valueToCompare){return $(option);}}},getInputByValue:function(value){var checkboxes=$('li input',this.$ul);var valueToCompare=value.toString();for(var i=0;i<checkboxes.length;i=i+1){var checkbox=checkboxes[i];if(checkbox.value===valueToCompare){return $(checkbox);}}},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options;},asyncFunction:function(callback,timeout,self){var args=Array.prototype.slice.call(arguments,3);return setTimeout(function(){callback.apply(self||window,args);},timeout);},setAllSelectedText:function(allSelectedText){this.options.allSelectedText=allSelectedText;this.updateButtonText();}};$.fn.multiselect=function(option,parameter,extraOptions){return this.each(function(){var data=$(this).data('multiselect');var options=typeof option==='object'&&option;if(!data){data=new Multiselect(this,options);$(this).data('multiselect',data);}
if(typeof option==='string'){data[option](parameter,extraOptions);if(option==='destroy'){$(this).data('multiselect',false);}}});};$.fn.multiselect.Constructor=Multiselect;$(function(){$("select[data-role=multiselect]").multiselect();});}(window.jQuery);
;!function(t,i,e,n){"use strict";t.fn.dynamicMaxHeight=function(i){function e(t,i){var e;e=t.hasClass(d)?i.data("replace-text"):i.attr("title"),i.text(e)}function n(t,i){t.find("."+c).css("max-height",i)}function a(t,i){i.css("display","inline-block")}var c="dynamic-height-wrap",d="dynamic-height-active",o="js-dynamic-show-hide";return this.each(function(i,s){var h=t(s),u=h.data("maxheight"),l=h.find("."+c).outerHeight(),r=h.find("."+o);h.attr("data-itemheight",l),l>u&&(n(h,u),h.toggleClass(d),a(h,r)),r.click(function(){h.hasClass(d)?n(h,l):n(h,u),e(h,r),h.toggleClass(d)})})}}(window.jQuery||window.$,document,window),"undefined"!=typeof module&&module.exports&&(module.exports=dynamicMaxHeight);
;(function($){popNotifications={timeFromNow:function(args){var t=this;var targets=args.targets;targets.each(function(){var target=$(this);t.execTimeFromNow(target);});},execTimeFromNow:function(target){var t=this;if(($('#'+target.attr('id'))).length){var time=target.data('time');var format=target.data('format');target.html(moment(time,format).fromNow());setTimeout(function(){t.execTimeFromNow(target);},60000);}},};})(jQuery);popJSLibraryManager.register(popNotifications,['timeFromNow']);
;(function($){popFileUpload={fileUpload:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.each(function(){var that=this;var fileupload=$(this);var action=fileupload.data('action');var block=popManager.getBlock(fileupload);fileupload.fileupload({url:action,autoUpload:true,maxNumberOfFiles:1,maxFileSize:2000000,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,uploadTemplateId:null,downloadTemplateId:null,uploadTemplate:function(o){var templateName=fileupload.data('template-upload');var rows=$();var data={o:o,locale:locale};var html=popManager.getHtml(templateName,data);var row=$(html);rows=rows.add(row);return rows;},downloadTemplate:function(o){var templateName=fileupload.data('template-download');var rows=$();var targetConfiguration=popManager.getTargetConfiguration(pageSection,block,templateName);popManager.expandJSKeys(targetConfiguration);var data=$.extend({},targetConfiguration,{o:o,locale:locale});var html=popManager.getHtml(templateName,data);var row=$(html);$(document).triggerHandler('gd-fileupload:rendered',[row]);rows=rows.add(row);return rows;},completed:function(e,data){fileupload.find('.pop-fileuploaded-hide').hide();},destroyed:function(e,data){fileupload.find('.pop-fileuploaded-hide').show();}});if(fileupload.hasClass('pop-fileupload-loadfromserver')){$.getJSON(action,function(result){if(result&&result.files&&result.files.length){fileupload.fileupload('option','done').call(that,$.Event('done'),{result:result});}});}});}};})(jQuery);popJSLibraryManager.register(popFileUpload,['fileUpload']);
;(function($){popCreateLocation={createLocationModal:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;t.execCreateLocationModal(pageSection,targets);},createLocationModalBlock:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets,link=args.relatedTarget;t.transferAttributes(targets.closest('.modal'),link);t.execCreateLocationModal(pageSection,targets.closest('.modal'));},maybeCloseLocationModal:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;var pssId=popManager.getSettingsId(pageSection);targets.on('fetched',function(e,response){var block=$(this);var bsId=popManager.getSettingsId(block);var blockFeedback=response.feedback.block[pssId][bsId];if(blockFeedback.result===true){block.closest('.modal').modal('hide');}});},transferAttributes:function(modals,link){var t=this;link=popManager.getOriginalLink(link);modals.data('typeahead-target',link.data('typeahead-target'));},execCreateLocationModal:function(pageSection,modals){var t=this;modals.addClass('pop-createlocation');modals.on('show.bs.modal',function(e){var modal=$(this);var link=$(e.relatedTarget);t.transferAttributes(modal,link);});}};})(jQuery);popJSLibraryManager.register(popCreateLocation,['createLocationModal','createLocationModalBlock','maybeCloseLocationModal']);;(function($){popMap={initBlockRuntimeMemory:function(args){var t=this;var pageSection=args.pageSection,block=args.block,mempage=args.runtimeMempage;mempage.map={};t.resetBlockRuntimeMemory(pageSection,block);},map:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;block.one('rerender',function(action){t.destroy(pageSection,block,targets);});targets.each(function(){var map=$(this);t.triggerShowMap(pageSection,block,map);});},mapModal:function(args){var t=this;var pageSection=args.pageSection,targets=args.targets;targets.on('shown.bs.modal',function(){var modal=$(this);$.each(modal.find('.pop-map'),function(){var map=$(this);var block=popManager.getBlock(map);if(popManager.jsInitialized(block)){t.triggerShowMap(pageSection,block,map);}});});},mapStandalone:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;popPageSectionManager.getGroup(pageSection).on('on.bs.pagesection:theater off.bs.pagesection:theater',function(e){targets.each(function(){var map=$(this);if(!popManager.isHidden(map)){t.refresh(pageSection,block,map);}});});block.on('fetchCompleted',function(e,status){targets.each(function(){var map=$(this);t.addMarkers(pageSection,block,map,status.reload);});});targets.each(function(){var map=$(this);t.hoverBlockElems(pageSection,block,map);});},getRuntimeMemoryPage:function(pageSection,targetOrId){var t=this;return popManager.getRuntimeMemoryPage(pageSection,targetOrId).map;},resetBlockRuntimeMemory:function(pageSection,targetOrId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,targetOrId);var empty={markers:{},markersPos:{},markersOpen:{},maps:{},};$.extend(mempage,empty);},destroy:function(pageSection,block,targets){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);targets.each(function(){var map=$(this);var mapId=map.attr('id');delete mempage.maps[mapId];});},triggerShowMap:function(pageSection,block,map){var t=this;if(!popManager.isHidden(map)){t.execTriggerShowMap(pageSection,block,map);}
else{if(popPageSectionManager.execIsHidden(pageSection)){popPageSectionManager.getGroup(pageSection).one('on.bs.pagesection-group:pagesection-'+pageSection.attr('id')+':opened',function(){block=$('#'+block.attr('id'));if(block.length){t.execTriggerShowMap(pageSection,block,map);}});}
else if(map.parents('.collapse').not('.in').length){var collapse=map.parents('.collapse').not('.in');collapse.one('shown.bs.collapse',function(){t.execTriggerShowMap(pageSection,block,map);});}}},execTriggerShowMap:function(pageSection,block,map){var t=this;t.addMarkers(pageSection,block,map,map.data('markers-removecurrent'));windowResize();},refresh:function(pageSection,block,map){var t=this;var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;gMap.refresh();},hoverBlockElems:function(pageSection,block,map){var t=this;block.on('mouseenter','.pop-openmapmarkers',function(){var elem=$(this),links;if(elem.hasClass('make-popover')){var popover_id=elem.attr('aria-describedby');if(popover_id){links=$('#'+popover_id).find('a.pop-modalmap-link');}}
else{links=elem.find('a.pop-modalmap-link');}
t.openMapMarkers(pageSection,block,map,links);});},openMapMarkers:function(pageSection,block,map,links){var t=this;if(popManager.isHidden(map))return;t.closeMarkers(pageSection,block,map);if(links.length){t.openMarkers(pageSection,block,map,links);}},closeMarkers:function(pageSection,block,map){var t=this;var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;var markersInfo=t.getMarkersInfo(pageSection,block,map);gMap.hideInfoWindows();$.each(markersInfo.markersOpen,function(index,markerId){markerPos=markersInfo.markersPos[markerId];gMap.markers[markerPos].setIcon('https://maps.google.com/mapfiles/ms/icons/red-dot.png');});},getMarkerIdsFromLinkURLs:function(links){var t=this;var markerIds=[];links.each(function(){var link=$(this);link=popManager.getOriginalLink(link);var url=link.attr('href');var paramIds=getParam(M.LOCATIONSID_FIELDNAME,url);if(paramIds){$.each(paramIds,function(index,value){markerIds.push(value);})}});return markerIds;},openMarkers:function(pageSection,block,map,links){var t=this;var markerIds=t.getMarkerIdsFromLinkURLs(links);if(!markerIds.length)return;markerIds=markerIds.filter(function(item,pos){return markerIds.indexOf(item)==pos});var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;var markersInfo=t.getMarkersInfo(pageSection,block,map);$.each(markerIds,function(index,markerId){markerPos=markersInfo.markersPos[markerId];if(gMap.markers[markerPos]){gMap.markers[markerPos].setIcon('https://maps.google.com/mapfiles/ms/icons/green-dot.png');}});if(markerIds.length==1){markerPos=markersInfo.markersPos[markerIds[0]];if(gMap.markers[markerPos]){google.maps.event.trigger(gMap.markers[markerPos],'click');}}
else{gMap.fitZoom();}
t.setMarkersOpen(pageSection,block,map,markerIds,true);},initMarker:function(pageSection,block,markerId,markerData){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);var loadedMarkerData=mempage.markers[markerId];if(loadedMarkerData){if(loadedMarkerData.title.split(' | ').indexOf(markerData.title)>-1)return;markerData.title=loadedMarkerData.title+' | '+markerData.title;markerData.infoWindow.content=markerData.infoWindow.content+'<hr/>'+loadedMarkerData.infoWindow.content;markerData.icon='https://maps.google.com/mapfiles/ms/icons/red-dot.png';}
mempage.markers[markerId]=markerData;},hasMarker:function(pageSection,block,markerId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);return mempage.markers[markerId];},getGMap:function(pageSection,block,map){var t=this;if(typeof GMaps=='undefined')return;var mempage=t.getRuntimeMemoryPage(pageSection,block);var mapId=map.attr('id');var gMap=mempage.maps[mapId];if(!gMap){gMap=mempage.maps[mapId]=new GMaps({div:'#'+mapId,lat:M.LOCATIONSMAP_LAT,lng:M.LOCATIONSMAP_LNG,zoom:parseInt(M.LOCATIONSMAP_ZOOM),});}
return gMap;},getMarkersInfo:function(pageSection,block,map){var t=this;var markersPageSection=map.data('markers-pagesection')||pageSection;var markersBlock=map.data('markers-block')||block;var mempage=t.getRuntimeMemoryPage(markersPageSection,markersBlock);var mapId=map.attr('id');return{markers:mempage.markers||{},markersPos:mempage.markersPos[mapId]||{},markersOpen:mempage.markersOpen[mapId]||[]};},setMarkersOpen:function(pageSection,block,map,markersOpen,removeCurrent){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);var mapId=map.attr('id');if(removeCurrent||!mempage.markersOpen[mapId]){mempage.markersOpen[mapId]=[];}
if(markersOpen){mempage.markersOpen[mapId]=mempage.markersOpen[mapId].concat(markersOpen);}},setMarkersPos:function(pageSection,block,map,markersPos,removeCurrent){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);var mapId=map.attr('id');if(removeCurrent||!mempage.markersPos[mapId]){mempage.markersPos[mapId]={};}
if(markersPos){$.extend(mempage.markersPos[mapId],markersPos);}},removeMarker:function(pageSection,block,map,markerId){var t=this;var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;var markersInfo=t.getMarkersInfo(pageSection,block,map);markerPos=markersInfo.markersPos[markerId];gMap.markers[markerPos].setMap(null);t.zoom(pageSection,block,map);},zoom:function(pageSection,block,map){var t=this;var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;if(gMap.markers.length>1){gMap.fitZoom();}
else if(gMap.markers.length==1){var pos=gMap.markers[0].getPosition();gMap.setCenter(pos.lat(),pos.lng());gMap.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM));}},addMarkers:function(pageSection,block,map,removeCurrent){var t=this;var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;if(removeCurrent){gMap.removeMarkers();t.setMarkersOpen(pageSection,block,map,null,true);t.setMarkersPos(pageSection,block,map,null,true);}
var markerIds=map.data('marker-ids');if(!markerIds||!markerIds.length)return;map.data('marker-ids',null);var markersInfo=t.getMarkersInfo(pageSection,block,map);var markerData,marker,markerPos;var markersPos={};$.each(markerIds,function(index,markerId){markerData=markersInfo.markers[markerId];var infoWindow={content:markerData.infoWindow.header+'<br/>'+markerData.infoWindow.content};var markerOptions={lat:markerData.coordinates.lat,lng:markerData.coordinates.lng,title:markerData.title,infoWindow:infoWindow,icon:markerData.icon,animation:google.maps.Animation.DROP};marker=gMap.addMarker(markerOptions);markerPos=gMap.markers.length-1;markersPos[markerId]=markerPos;});t.setMarkersPos(pageSection,block,map,markersPos);var onemarkerClick=map.data('open-onemarker-infowindow');if(markerIds.length==1&&onemarkerClick){gMap.hideInfoWindows();google.maps.event.trigger(marker,'click');}
t.zoom(pageSection,block,map);},geocode:function(pageSection,block,map,address,latInput,lngInput){var t=this;var gMap=t.getGMap(pageSection,block,map);if(!gMap)return;GMaps.geocode({address:address,callback:function(results,status){if(status=='OK'){gMap.removeMarkers();var latlng=results[0].geometry.location;gMap.setCenter(latlng.lat(),latlng.lng());gMap.addMarker({lat:latlng.lat(),lng:latlng.lng(),draggable:true});gMap.setZoom(parseInt(M.LOCATIONSMAP_1MARKER_ZOOM));latInput.val(latlng.lat());lngInput.val(latlng.lng());var marker=gMap.markers[0];google.maps.event.addListener(marker,'dragend',function(){var latlng=marker.getPosition();latInput.val(latlng.lat());lngInput.val(latlng.lng());});}}});}};})(jQuery);(function($){popMapRuntime={initBlockRuntimeMemory:function(args){var t=this;var pageSection=args.pageSection,block=args.block,mempage=args.runtimeMempage;mempage.mapRuntime={};t.resetBlockRuntimeMemory(pageSection,block);},getRuntimeMemoryPage:function(pageSection,targetOrId){var t=this;return popManager.getRuntimeMemoryPage(pageSection,targetOrId).mapRuntime;},resetBlockRuntimeMemory:function(pageSection,targetOrId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,targetOrId);var empty={content:'',title:'',marker_ids:[],};$.extend(mempage,empty);},drawMarkers:function(pageSection,block,mapDiv){var t=this;if(popManager.jsInitialized(block)){t.execDrawMarkers(pageSection,block,mapDiv);}
else{block.one('initialize',function(){t.execDrawMarkers(pageSection,block,mapDiv);});}},execDrawMarkers:function(pageSection,block,mapDiv){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);mapDiv.data('marker-ids',mempage.marker_ids);},resetMarkerIds:function(pageSection,block){var t=this;if(popManager.jsInitialized(block)){t.execResetMarkerIds(pageSection,block);}
else{block.one('initialize',function(){t.execResetMarkerIds(pageSection,block);});}},execResetMarkerIds:function(pageSection,block){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);mempage.marker_ids=[];},setMarkerData:function(pageSection,block,title,content){var t=this;if(popManager.jsInitialized(block)){t.execSetMarkerData(pageSection,block,title,content);}
else{block.one('initialize',function(){t.execSetMarkerData(pageSection,block,title,content);});}},execSetMarkerData:function(pageSection,block,title,content){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);if(!mempage.title){mempage.title=title;}
if(!mempage.content){mempage.content=content;}},initMarker:function(pageSection,block,locationId,lat,lng,defaultTitle,defaultContent){var t=this;if(popManager.jsInitialized(block)){t.execInitMarker(pageSection,block,locationId,lat,lng,defaultTitle,defaultContent);}
else{block.one('initialize',function(){t.execInitMarker(pageSection,block,locationId,lat,lng,defaultTitle,defaultContent);});}},execInitMarker:function(pageSection,block,locationId,lat,lng,defaultTitle,defaultContent){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);t.setMarkerData(pageSection,block,defaultTitle,defaultContent);var title=mempage.title;var content=mempage.content;var marker_data={coordinates:{lat:lat,lng:lng},title:title,infoWindow:{header:'<strong>'+title+'</strong>',content:content},icon:'https://maps.google.com/mapfiles/ms/icons/red-dot.png'};mempage.marker_ids.push(locationId);popMap.initMarker(pageSection,block,locationId,marker_data);mempage.content='';mempage.title='';},};})(jQuery);popJSLibraryManager.register(popMap,['initBlockRuntimeMemory','map','mapModal','mapStandalone']);popJSLibraryManager.register(popMapRuntime,['initBlockRuntimeMemory']);;(function($){popTypeaheadMap={typeaheadMap:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.each(function(){var typeaheadMap=$(this);var typeahead=typeaheadMap.find('.pop-typeahead');var map=typeaheadMap.find('.pop-map');var template=typeaheadMap.data('addmarker-template');typeahead.on('selected',function(e,datum){if(!popMap.hasMarker(pageSection,block,datum.id)){var targetConfiguration=popManager.getTargetConfiguration(pageSection,block,template);$.extend(targetConfiguration,{itemObject:datum});var html=popManager.getTemplateHtml(pageSection,block,template);popManager.mergeHtml(html,typeaheadMap);popManager.runJSMethods(pageSection,block,template,'last');popJSRuntimeManager.deleteBlockLastSessionIds(pageSection,block,template);}
map.data('marker-ids',[datum.id]);popMap.addMarkers(pageSection,block,map);});typeahead.on('close',function(e,alert,markerId){popMap.removeMarker(pageSection,block,map,markerId);});});}};})(jQuery);popJSLibraryManager.register(popTypeaheadMap,['typeaheadMap']);;(function($){popMapCollection={formMapLocationGeocode:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.find('input.address-input').change(function(){var input=$(this);var locationMapGeocode=input.closest('div.pop-map-locationgeocode');var address=[];locationMapGeocode.find('input.address-input').each(function(){var addressInput=$(this);if(addressInput.val()){address.push(addressInput.val());}});var map=locationMapGeocode.find('div.pop-map');var latInput=locationMapGeocode.find('input.address-lat');var lngInput=locationMapGeocode.find('input.address-lng');popMap.geocode(pageSection,block,map,address.join(', '),latInput,lngInput);});},modalMap:function(args){var t=this;var targets=args.targets;targets.on('show.bs.modal',function(e){var modal=$(this);var link=$(e.relatedTarget);t.execModalMap(modal,link);});},modalMapBlock:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets,link=args.relatedTarget;var modal=targets.closest('.modal');t.execModalMap(modal,link);},execModalMap:function(modals,link){var t=this;link=popManager.getOriginalLink(link);var block=popManager.getBlock(link);var pageSection=popManager.getPageSection(block);var mapDiv=modals.find('.pop-map');mapDiv.data('markers-pagesection',pageSection);mapDiv.data('markers-block',block);mapDiv.data('markers-removecurrent',true);var markerIds=popMap.getMarkerIdsFromLinkURLs(link);mapDiv.data('marker-ids',markerIds);},};})(jQuery);popJSLibraryManager.register(popMapCollection,['formMapLocationGeocode','modalMap','modalMapBlock']);;(function($){popFullCalendar={initBlockRuntimeMemory:function(args){var t=this;var pageSection=args.pageSection,block=args.block,mempage=args.runtimeMempage;mempage.fullCalendar={};t.resetBlockRuntimeMemory(pageSection,block);},calendar:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;var pageSectionPage=popManager.getPageSectionPage(block);pageSectionPage.one('destroy',function(){targets.fullCalendar('destroy');});block.on('beforeMerge',function(e,options){var block=$(this);if(options.operation==M.URLPARAM_OPERATION_REPLACE){t.resetBlockRuntimeMemory(pageSection,block);}});block.on('rendered',function(e){var block=$(this);var pageSection=popManager.getPageSection(block);t.execCalendar(pageSection,block,targets,'update');windowResize();});t.execCalendar(pageSection,block,targets,'new');},getRuntimeMemoryPage:function(pageSection,targetOrId){var t=this;return popManager.getRuntimeMemoryPage(pageSection,targetOrId).fullCalendar;},resetBlockRuntimeMemory:function(pageSection,targetOrId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,targetOrId);var empty={eventsHtml:{},runJS:false,events:[],loadedEventIds:{},loadedDates:{},};$.extend(mempage,empty);},addEvents:function(pageSection,block,events_data){var t=this;if(!events_data.length)return;if(popManager.jsInitialized(block)){t.execAddEvents(pageSection,block,events_data);}
else{block.one('initialize',function(){t.execAddEvents(pageSection,block,events_data);});}},execAddEvents:function(pageSection,block,events_data){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);var events_data_to_add=[];$.each(events_data,function(index,event_data){if(!t.isEventLoaded(pageSection,block,event_data.id)){events_data_to_add.push(event_data);t.setEventLoaded(pageSection,block,event_data.id);}});$.merge(mempage.events,events_data_to_add);},execCalendar:function(pageSection,block,targets,state){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);var date=t.getDate(pageSection,block);var options;if(state=='new'){options={header:{left:'title',center:'',right:''},events:function(start,end,timezone,callback){var events;events=mempage.events;callback(events);},defaultDate:date,fixedWeekCount:false,height:'auto',contentHeight:'auto',dayNamesShort:M.DATERANGE_DAYSOFWEEK};}
targets.each(function(){var calendar=$(this);if(state=='new'){var jsSettings=popManager.getJsSettings(pageSection,block,calendar);var customOptions=jsSettings.options||{};var calendarOptions=$.extend({},options,customOptions);var layouts=jsSettings.layouts;calendarOptions.eventRender=function(event,element){t.renderEvent(pageSection,block,layouts,event,element);};calendarOptions.eventAfterAllRender=function(view){t.renderEventAfterAll(pageSection,block,layouts);};calendar.fullCalendar(calendarOptions);}
else if(state=='update'){calendar.fullCalendar('refetchEvents');}});t.setDateLoaded(pageSection,block,date);},setDateLoaded:function(pageSection,block,date){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);mempage.loadedDates[date.year()+'-'+(date.month()+1)]=true;},isDateLoaded:function(pageSection,block,date){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);return mempage.loadedDates[date.year()+'-'+(date.month()+1)]===true;},setEventLoaded:function(pageSection,block,eventId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);mempage.loadedEventIds[eventId]=true;},isEventLoaded:function(pageSection,block,eventId){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);return mempage.loadedEventIds[eventId]===true;},getDate:function(pageSection,block){var t=this;var blockParams=popManager.getBlockParams(pageSection,block);var year=parseInt(blockParams[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]);var month=parseInt(blockParams[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]);return moment(year+'-'+month+'-01','YYYY-M-DD');},renderEvent:function(pageSection,block,layouts,event,element){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);var eventId=event.id;var html=mempage.eventsHtml[eventId];if(html){mempage.runJS=true;}
else{var options={}
var dbKeys=popManager.getDatabaseKeys(pageSection,block);var itemDBKey=dbKeys['db-key'];html='';$.each(layouts,function(index,layout){html+=popManager.getTemplateHtml(pageSection,block,layout,options,itemDBKey,eventId);});mempage.eventsHtml[eventId]=html;}
element.html(html);},renderEventAfterAll:function(pageSection,block,layouts){var t=this;var mempage=t.getRuntimeMemoryPage(pageSection,block);popManager.triggerHTMLMerged();if(mempage.runJS){mempage.runJS=false;$.each(layouts,function(index,layout){popManager.runJSMethods(pageSection,block,layout,'full');});}},fetch:function(pageSection,block,calendar){var t=this;var date=t.getDate(pageSection,block);calendar.fullCalendar('gotoDate',date);if(t.isDateLoaded(pageSection,block,date)){return;}
popManager.fetchBlock(pageSection,block,{operation:M.URLPARAM_OPERATION_APPEND});}};})(jQuery);(function($){popFullCalendarControls={controlCalendarPrev:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){var control=$(this);t.execute(pageSection,block,control,'prev');});},controlCalendarNext:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.click(function(e){var control=$(this);t.execute(pageSection,block,control,'next');});},setCalendarBlockParams:function(pageSection,block,date){var t=this;var blockParams=popManager.getBlockParams(pageSection,block);blockParams[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]=date.year();blockParams[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]=date.month()+1;},execute:function(pageSection,block,control,operation){var t=this;var calendar=$(control.closest('.pop-calendar-controls').data('target'));var date=calendar.fullCalendar('getDate');if(operation=='next'){date.add(1,'months');}
else{date=date.subtract(1,'months');}
t.setCalendarBlockParams(pageSection,block,date);popManager.closeMessageFeedback(block);popFullCalendar.fetch(pageSection,block,calendar);}};})(jQuery);popJSLibraryManager.register(popFullCalendar,['initBlockRuntimeMemory','calendar']);popJSLibraryManager.register(popFullCalendarControls,['controlCalendarPrev','controlCalendarNext']);
;(function($){popWSL={loginBlock:null,wslNetworkLink:function(args){var t=this;var targets=args.targets;targets.click(function(e){e.preventDefault();var link=$(this);popupurl=link.data('url');var block=popManager.getBlock(link);t.loginBlock=$(block.data('loginblock'));window.open(popupurl,"hybridauth_social_sing_on","location=1,status=0,scrollbars=0,width=600,height=400");});},};})(jQuery);popJSLibraryManager.register(popWSL,['wslNetworkLink']);function wsl_wordpress_social_login_callback(){if(popUserAccount.isLoggedIn()){if(popWSL.loginBlock){var pageSection=popManager.getPageSection(popWSL.loginBlock);var closeTime=M.WSL_LOGINUSER_CLOSETIME||1500;popSystem.timeoutClosePageSection(pageSection,closeTime);}}}
window.wsl_wordpress_social_login=function(config){var options={params:config}
if(popWSL.loginBlock){options['disable-layer']=popWSL.loginBlock;options['urlfetched-callbacks']=[wsl_wordpress_social_login_callback];}
popUserAccount.fetchLoggedInUserData(options);}
;(function($){popPhotoSwipe={linksImage:function(args){var t=this;var anchor=args.anchor;var lightBox=new PhotoSwipe($('#pswp')[0],PhotoSwipeUI_Default,t.getItems(anchor),t.getOptions(anchor));lightBox.init();},getOptions:function(anchor){var t=this;return{index:t.getIndex(anchor),bgOpacity:0.8,showHideOpacity:true,history:false,loop:false,shareButtons:[{id:'download',label:M.LABELS.DOWNLOAD,url:'{{raw_image_url}}?fileaction=download',download:true}],};},getItem:function(anchor){var t=this;var image=anchor.children('img');var item={src:anchor.attr('href'),msrc:image.attr('src'),w:640,h:480,};if(image.attr('width')&&image.attr('height')){item.w=image.attr('width');item.h=image.attr('height');}
if(anchor.data('size')){var size=anchor.data('size').split('x')
item.w=size[0];item.h=size[1];}
if(anchor.attr('title')){item.title=anchor.attr('title');}
else if(image.attr('alt')){item.title=image.attr('alt');}
return item;},getItems:function(anchor){var t=this;var items=[];var gallery=anchor.closest('.gallery');if(gallery.length){gallery.find('.gallery-item a').each(function(){items.push(t.getItem($(this)));});}
else{items.push(t.getItem(anchor));}
return items;},getIndex:function(anchor){var t=this;var galleryItem=anchor.closest('.gallery-item');if(galleryItem.length){return galleryItem.index();}
return 0;},};})(jQuery);popJSLibraryManager.register(popPhotoSwipe,['linksImage']);
;(function($){popCustomFunctions={addPageSectionIds:function(args){var t=this;var pageSection=args.pageSection,template=args.template;var pssId=popManager.getSettingsId(pageSection);var psId=pageSection.attr('id');if(psId==M.PS_HOVER_ID){popJSRuntimeManager.addPageSectionId(pssId,template,psId,'closehover');}
else if(psId==M.PS_FRAME_NAVIGATOR_ID){popJSRuntimeManager.addPageSectionId(pssId,template,psId,'closenavigator');}
else if(psId==M.PS_ADDONS_ID){popJSRuntimeManager.addPageSectionId(pssId,template,psId,'window-fullsize');popJSRuntimeManager.addPageSectionId(pssId,template,psId,'window-maximize');popJSRuntimeManager.addPageSectionId(pssId,template,psId,'window-minimize');}},pageSectionInitialized:function(args){var t=this;var pageSection=args.pageSection;var psId=pageSection.attr('id');if(psId==M.PS_PAGETABS_ID){popManager.getPageSectionGroup(pageSection).on('on.bs.pagesection-group:pagesection-'+M.PS_HOVER_ID+':closed',function(){pageSection.find('a.pop-pagetab-btn.active').trigger('click');});}},pageSectionNewDOMsBeforeInitialize:function(args){var t=this;var pageSection=args.pageSection,newDOMs=args.newDOMs;var psId=pageSection.attr('id');var firstLoad=popManager.isFirstLoad(pageSection);if(psId==M.PS_ADDONS_ID){newDOMs.filter('.tab-pane').addClass('active').on('shown.bs.tabpane',function(){t.handleWindow(pageSection,'minimized');});if(!firstLoad){t.handleWindow(pageSection,'minimized');}}
else{var addonsPageSection=$('#'+M.PS_ADDONS_ID);newDOMs.filter('.tab-pane').addClass('active').on('shown.bs.tabpane',function(){t.handleWindow(addonsPageSection,'fullsize');});if(!firstLoad){t.handleWindow(addonsPageSection,'fullsize');}}
var tabPanes=[M.PS_MAIN_ID,M.PS_HOVER_ID,M.PS_ADDONS_ID,M.PS_FRAME_NAVIGATOR_ID];var quickviews=[M.PS_QUICKVIEW_ID,M.PS_QUICKVIEWINFO_ID];var sides=[M.PS_SIDEINFO_ID];var modals=[M.PS_MODALS_ID];if(tabPanes.indexOf(psId)>-1){var removeTheather=(psId==M.PS_MAIN_ID);var sides=$('#'+M.PS_SIDEINFO_ID+',#'+M.PS_FRAME_SIDE_ID+',#'+M.PS_FRAME_NAVIGATOR_ID);popCustomBootstrap.activateTabPanes(pageSection,newDOMs,removeTheather,sides);}
else if(sides.indexOf(psId)>-1){popCustomBootstrap.activateSideTabpanes(pageSection,newDOMs);}
else if(quickviews.indexOf(psId)>-1){popCustomBootstrap.activateQuickviewTabpanes(pageSection,newDOMs);}
else if(modals.indexOf(psId)>-1){popCustomBootstrap.activateModals(pageSection,newDOMs);}},isUserIdSameAsLoggedInUser:function(args){var t=this;if(popUserAccount.isLoggedIn()){var user_id=args.input;return(popUserAccount.id==user_id);}
return false;},getEmbedUrl:function(args){var t=this;var url=args.url;return t.addURLParams(add_query_arg(M.URLPARAM_THEMEMODE,M.THEMEMODE_WASSUP_EMBED,url));},getUnembedUrl:function(args){var t=this;var url=args.url;return removeQueryFields(url,[M.URLPARAM_THEMEMODE]);},getPrintUrl:function(args){var t=this;var url=args.url;return t.addURLParams(add_query_arg(M.URLPARAM_ACTION,M.URLPARAM_ACTION_PRINT,add_query_arg(M.URLPARAM_THEMEMODE,M.THEMEMODE_WASSUP_PRINT,url)));},addURLParams:function(url){var t=this;if(M.THEMESTYLE){url=add_query_arg(M.URLPARAM_THEMESTYLE,M.THEMESTYLE,url);}
return url;},handleWindow:function(pageSection,exitSize){var t=this;var windoww=pageSection.closest('.window');if(popWindow.getSize(windoww)==exitSize){popWindow.maximize(windoww);}},};})(jQuery);popJSLibraryManager.register(popCustomFunctions,['addPageSectionIds','pageSectionNewDOMsBeforeInitialize'],true);popJSLibraryManager.register(popCustomFunctions,['pageSectionInitialized','getEmbedUrl','getUnembedUrl','getPrintUrl','isUserIdSameAsLoggedInUser']);;(function($){popUserRole={filterByCommunity:function(args){var t=this;var pageSection=args.pageSection,block=args.block,targets=args.targets;targets.change(function(e){var checkbox=$(this);var user_id=checkbox.val();var communityTypeahead=$(checkbox.data('target'));if(checkbox.is(':checked')){var user=checkbox.data('user-datum');popTypeahead.triggerSelect(pageSection,block,communityTypeahead,user);}
else{popTypeahead.removeSelected(communityTypeahead,user_id);}});},};})(jQuery);popJSLibraryManager.register(popUserRole,['filterByCommunity']);;(function($){popUREAAL={isActionUpdatedUserMembership:function(args){var t=this;var action=args.input;return(action==M.ACTION_USER_UPDATEDUSERMEMBERSHIP);},isActionJoinedCommunity:function(args){var t=this;var action=args.input;return(action==M.ACTION_USER_JOINEDCOMMUNITY);},isObjectTypeUser:function(args){var t=this;var object_type=args.input;return(object_type==M.OBJECTTYPE_USER);},};})(jQuery);popJSLibraryManager.register(popUREAAL,['isActionUpdatedUserMembership','isActionJoinedCommunity','isObjectTypeUser']);